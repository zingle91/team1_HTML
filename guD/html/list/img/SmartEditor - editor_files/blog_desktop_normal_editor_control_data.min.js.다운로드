/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineComponent("se.AbstractDocumentValidator",{construct:function(){},validateWidthProhibitedWords:function(){return this._IMPL_onValidateWidthProhibitedWords.apply(this,arguments)},validate:function(){return this._IMPL_onValidate.apply(this,arguments)},_IMPL_onValidate:function(){AbstractMethodNotOverrideException("_IMPL_onValidate")}});se.defineClass("se.BlogDocumentValidator",se.AbstractDocumentValidator,{construct:function(){this._initVar();this._$elTemp=$("<div></div>");this._elTemp=this._$elTemp.get(0)},_initVar:function(){this._sFilterUrl="/Service/PwmFilter.json"},_isHashTable:function(a){return typeof a==="object"&&!$.isArray(a)},_completeCompType:function(a,b){var c=b;var d={media:true,extraMedia:true,topBackground:true,bottomBackground:true,mainIngredient:true,subIngredient:true,wrapComp:true,locationMap:true};var e=false;if(b==="centerPos"||b==="markerPos"||b==="location"){c="position"}else if(b===$SE_CONFIG.COMP_TYPE.REPRESENTATIVE_PLACE){c="place"}if(b==="thumbnail"&&a&&a["@ctype"]==="simpleThumbnail"){c="simpleThumbnail"}if(d[b]){e=true}if(b===$SE_CONFIG.COMP_TYPE.PARAGRAPH||b===$SE_CONFIG.COMP_TYPE.QUOTATION){a.value=$SE_STRING.removeInvalidXmlCharList(a.value)}else if(b===$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE||b===$SE_CONFIG.COMP_TYPE.SECTION_TITLE){a.title=$SE_STRING.removeInvalidXmlCharList(a.title)}else if(b===$SE_CONFIG.COMP_TYPE.IMAGE||b===$SE_CONFIG.COMP_TYPE.VIDEO||b===$SE_CONFIG.COMP_TYPE.IMAGE_STRIP){a.caption=$SE_STRING.removeInvalidXmlCharList(a.caption)}if(c!==undefined&&c!=="original"&&a&&a["@ctype"]!==c&&!e){a["@ctype"]=c}},_completeRecursively:function(a,b){var c;if(b!==undefined){this._completeCompType(a,b)}for(var d in a){c=a[d];if(typeof c==="object"){if(this._isHashTable(c)){this._completeCompType(c,d)}else if($.isArray(c)){for(var e=0;e<c.length;e++){this._completeRecursively(c[e])}}else{this._completeRecursively(c)}}else if(typeof c==="string"){a[d]=$SE_STRING.removeInvalidXmlCharList(c)}}},_isTitleEmpty:function(a){return this._isEmptyString(a.title)},_isContentsEmpty:function(a){var b=false,c=a.components;if(c&&c.length===1){b=true}if(!b&&c&&c.length>1){var d=c.slice(1,c.length);for(var e=0;e<d.length;e++){if(d[e]["@ctype"]===$SE_CONFIG.COMP_TYPE.PARAGRAPH){this._$elTemp.html(d[e].value);b=this._isEmptyString($SE_COMMON_UTIL.getInnerText(this._elTemp))}else if(d[e]["@ctype"]===$SE_CONFIG.COMP_TYPE.SECTION_TITLE){b=this._isEmptyString(d[e].title)}else{b=false}if(!b){break}}}return b},_isEmptyString:function(a){return $SE_STRING.isEmpty(a)},complementData:function(a){var b=$.extend({},a);this._completeRecursively(b);return b},_IMPL_onValidateWidthProhibitedWords:function(a,b){return this._basicDocValidate(a,b)},_IMPL_onValidate:function(a,b){return this._basicDocValidate(a,b)},_isCoverCardEmpty:function(a){if(a.cards&&a.cards.length>0&&a.cards[0]["@ctype"]===$SE_CONFIG.CARD_TYPE.COVER){return this._isEmptyString(a.title)}return true},_isCardContentsEmpty:function(a){var b=a.cards;var c=b.slice(1);var d=true;c.forEach(function(a){if(d){d=a.isEmpty}});if(!d){d=!(b&&b.length>1&&b[0]["@ctype"]===$SE_CONFIG.CARD_TYPE.COVER)}return d},_cardDocValidate:function(a,b){var c=true,d=this._isCoverCardEmpty(a),e=this._isCardContentsEmpty(a),f={};f.bIsPublish=b===undefined?true:b;if(f.bIsPublish){c=!d&&!e}else{c=!d||!e}return{valid:c,reason:{title:{empty:d},contents:{empty:e}}}},_basicDocValidate:function(a,b){var c=this._isTitleEmpty(a),d=this._isContentsEmpty(a),e,f={};f.bIsPublish=b===undefined?true:b;if(f.bIsPublish){e=!c&&(!d||!!a.scrapDocData)}else{e=!c||!d}return{valid:e,reason:{title:{empty:c},contents:{empty:d}}}},_getSeriesInfo:function(){return $SE_EVENT_HUB.trigger("GET_SERIES_INFO")},_checkProhibitedWords:function(){var a=$.Deferred();$SE_AJAX.request($SE_CONFIG.API.SUICIDE_PREVENTION,{type:"post",timeout:6e4,data:JSON.stringify({serviceId:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,word:$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getTitle()}),contentType:"application/json; charset=UTF-8",dataType:"json"},{fSuccess:this._onSuccessForCheckingProhibitedWords.bind(this,this._notHasProhibitedWords,this._hasProhibitedWords,a)});return a},_onSuccessForCheckingProhibitedWords:function(a,b,c,d,e,f){var g=d.result;if(g.isMatche){b(g.suicideWord)}else{a();c.resolve()}},_notHasProhibitedWords:function(){},_hasProhibitedWords:function(a){var b=$.Deferred();$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:se.editor.template.control["prohibitedWords-Layer.hbs"]({isBlog:$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE,isPost:$SE_CONFIG.ENV_SETTING.IS_POST_SERVICE,sProhibitedWords:a}),buttons:[{text:"확인","class":"type1",click:function(a){a.stopPropagation();$SE_MODAL.close()}}],"class":"pop_forbidden_wrap"});$SE_MODAL.open()},_getContentsCardDocText:function(a){var b=[],c=$("<div></div>").get(0);var d=function(a){c.innerHTML=a;return $SE_COMMON_UTIL.getInnerText(c)};var e=function(a,b){if(b.sectionTitle){a.push(b.sectionTitle.title)}if(b.ingredientItems&&b.ingredientItems.length>0){b.ingredientItems.forEach(function(b){a.push(b.value)})}return a};a.forEach(function(a){if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.COVER){b.push(a.sectionTitle.title)}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.BASIC_MEDIA){if(a.sectionTitle){b.push(a.sectionTitle.title)}b.push(d(a.paragraph.value))}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.TEXT){if(a.sectionTitle){b.push(a.sectionTitle.title)}b.push(d(a.paragraph.value))}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.QUOTATION){b.push(a.quotation.value)}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.BACKGROUND){if(a.paragraph){b.push(d(a.paragraph.value))}}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.DOUBLE_BACKGROUND){if(a.sectionTitle){b.push(a.sectionTitle.title)}if(a.paragraph){b.push(d(a.paragraph.value))}}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.INGREDIENT){if(a.sectionTitle){b.push(a.sectionTitle.title)}if(a.measureUnit){b.push(a.measureUnit)}if(a.mainIngredient){b=e(b,a.mainIngredient)}if(a.subIngredient){b=e(b,a.subIngredient)}}else if(a["@ctype"]===$SE_CONFIG.CARD_TYPE.INGREDIENT_IMAGE){if(a.sectionTitle){b.push(a.sectionTitle.title)}if(a.measureUnit){b.push(a.measureUnit)}if(a.ingredient){b=e(b,a.ingredient)}}});return b.join(" ")},_getContentsNormalDocText:function(a){var b=[],c,d=$("<div></div>").get(0);for(var e=0,f=a.length;e<f;e++){c=a[e];if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.PARAGRAPH){d.innerHTML=c.value;b.push($SE_COMMON_UTIL.getInnerText(d))}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.SECTION_TITLE){b.push(c.title)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.IMAGE||c["@ctype"]===$SE_CONFIG.COMP_TYPE.VIDEO){b.push(c.caption)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.IMAGE||c["@ctype"]===$SE_CONFIG.COMP_TYPE.VIDEO){b.push(c.caption)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.MAP){b.push(c.title)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.QUOTATION){b.push(c.value)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.IMAGE_STRIP){b.push(c.caption)}else if(c["@ctype"]===$SE_CONFIG.COMP_TYPE.OGLINK){b.push(c.desc);b.push(c.title)}}return b.join(" ")}});se.defineComponent("se.DataManager",{construct:function(){this._initVar();this._createManageAPIProcessFunction();this._attachEvent()},_createManageAPIProcessFunction:function(){Object.getPrototypeOf(this)["_"+$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"ReadProcess"]=function(a,b){this._setTempDocInfo(a,b.result.hash)}.bind(this);Object.getPrototypeOf(this)["_"+$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"SaveProcess"]=function(a){this._$elAutoSave.find("span").html("저장됨");this._hideAutoSave()}.bind(this)},_initVar:function(){this._oDocument=null;this._oMetaData=null;this._aAttach=[];this._oValidator=new(se[$SE_STRING.capitalize($SE_CONFIG.ENV_SETTING.SERVICE_NAME)+"DocumentValidator"]);this._sTempDocHash="";this._sTempDocId="";this._sDocId="";this._htUrlMap={};this._sServiceName=$SE_CONFIG.ENV_SETTING.SERVICE_NAME;this._oAjax=null;this._htPreDocData={};this._bStopSave=false;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"SaveDoc"]=$SE_CONFIG.API.SAVE_TEMP_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"ReadDocList"]=$SE_CONFIG.API.READ_TEMP_DOCUMENT_LIST;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"ReadDoc"]=$SE_CONFIG.API.READ_TEMP_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"DeleteDoc"]=$SE_CONFIG.API.DELETE_TEMP_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP+"UpdateDoc"]=$SE_CONFIG.API.UPDATE_TEMP_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.RESERV+"ReadDocList"]=$SE_CONFIG.API.READ_RESERVATION_DOCUMENT_LIST;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.RESERV+"ReadDoc"]=$SE_CONFIG.API.READ_RESERVATION_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.RESERV+"DeleteDoc"]=$SE_CONFIG.API.DELETE_RESERVATION_DOCUMENT;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE+"SaveDoc"]=$SE_CONFIG.API.SAVE_TEMPLATE;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE+"ReadDocList"]=$SE_CONFIG.API.READ_TEMPLATE_LIST;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE+"ReadDoc"]=$SE_CONFIG.API.READ_TEMPLATE;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE+"DeleteDoc"]=$SE_CONFIG.API.DELETE_TEMPLATE;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE+"UpdateDoc"]=$SE_CONFIG.API.UPDATE_TEMPLATE;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE+"ReadDocList"]=$SE_CONFIG.API.READ_BASE_TEMPLATE_LIST;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE+"ReadDoc"]=$SE_CONFIG.API.READ_BASE_TEMPLATE;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE+"ReadDocList"]=$SE_CONFIG.API.READ_EVENT_TEMPLATE_LIST;this._htUrlMap[$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE+"ReadDoc"]=$SE_CONFIG.API.READ_EVENT_TEMPLATE;this._htParamIdMap={};this._htParamIdMap[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP]="tempId";this._htParamIdMap[$SE_CONFIG.MANAGE_DOC_TYPE.RESERV]="reservationId";this._htParamIdMap[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE]="templateId";this._htParamIdMap[$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE]="templateId";this._htParamIdMap[$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE]="templateId";this._$elAutoSave=$(".lbl_autoSaving");this._nSetTimeout=-1;this._nAjaxTimeout=5e3},_attachEvent:function(){$SE_EVENT_HUB.on("PUBLISH_DOUCMENT",this._onPublishDocument.bind(this))},_onPublishDocument:function(a){this._htMetaData=a["htMetaData"];this._htDocData=a["htDocData"];return this.publishDocument()},_noticeEmptyContents:function(a){$(document.body).ntoast("setMessage",se.i18n.getMsg(a));$(document.body).ntoast("popupToast");setTimeout(function(){this._focusContents()}.bind(this),200)},_focusContents:function(){if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_CARD,1)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_COMP_TYPE,$SE_CONFIG.COMP_TYPE.PARAGRAPH)}},validateDocument:function(a,b,c,d){var e=this._oValidator.validate(a,b);var f=e.reason.title.empty||e.reason.contents.empty;var g=this._getContentMsg();if(e.valid){return true}if(d){d()}if(!c){return false}if(b){$SE_EVENT_HUB.trigger("CHECK_PUBLISH_VALIDATION",e,b,c,d)}else{if(f){this._noticeEmptyContents(g)}}return false},_getContentMsg:function(){switch($SE_CONFIG.ENV_SETTING.SERVICE_NAME){case $SE_CONFIG.SERVICE_TYPE.STOREFARM:return"MSG_EMPTY_CONTENTS";case $SE_CONFIG.SERVICE_TYPE.GP:return"MSG_EMPTY_TITLE";default:return"MSG_EMPTY_TITLE_OR_CONTENTS"}},createDocumentData:function(a,b){a=a||{};var c=a.contentsMeta||{};var d=a.document||$SE_MODEL_DATA_COORD.getNewDocData().document;this._resetDocId(a);if(b){this._sDocId=a.documentId||"";this._sDocId=this._sDocId==="null"?"":this._sDocId}d.author=$SE_CONFIG.USER_INFO.nickName;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_META_DATA,a.publishMeta);this._oMetaData=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA);this._aAttach=c.attachments||[];this._oDocument=new se.DocumentModel(d);this._oDocument.setDocumentStyle($SE_MODEL_DATA_COORD.getThemeDocStyle(this._oDocument.getTheme()));this._htPreDocData=$.extend(true,{},this._oDocument.getJson());this.trigger("onCreateDocument",{oDocument:this._oDocument,oMetaData:this._oMetaData,aAttach:this._aAttach})},_resetDocId:function(a){if(this._isStoreFarm()&&this._isTemplateDocument(a)){return}this._sDocId=""},getDocument:function(){return this._oDocument},getMetaData:function(){return this._oMetaData},_isStoreFarm:function(){return $SE_CONFIG.ENV_SETTING.SERVICE_NAME===$SE_CONFIG.SERVICE_TYPE.STOREFARM},_isTemplateDocument:function(a){return typeof a.templateId!=="undefined"},_setTempDocInfo:function(a,b){this._sTempDocHash=b||"";this._sTempDocId=a||""},_abortTempSave:function(){if(this._oAjax){this._hideAutoSave();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_PROGRESS_BAR);this._oAjax.abort()}},publishDocument:function(){var a=this._htDocData;var b=this._htMetaData;var c;var d;var e;var f=this;this._abortTempSave();a=this._oValidator.complementData(a);if(this._sServiceName!=="gp"){b["@service"]=this._sServiceName}a.publishDate=moment().format();d={serviceId:this._sServiceName,document:a,docType:$SE_CONFIG.ENV_SETTING.DOC_TYPE,publishMeta:b};if(this._sTempDocId&&this._sTempDocId!==""){d.tempDocumentId=this._sTempDocId}var g=function(a){if(a.isSuccess){this._setTempDocInfo()}}.bind(this);var h=function(){this._bStopSave=false;this.trigger("onEnabledPublishLayer");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"outer")}.bind(this);var i=function(a){f._bStopSave=false;f.trigger("onEnabledPublishLayer");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"outer");if(a.errorCode==="205"){f._bStopSave=true;this.bShowFailMsg=false;$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:se.editor.template.common["modal-ajax-error-content.hbs"]({errorTitle:se.i18n.getMsg("MSG_ERROR_PUBLISH_205_TITLE"),errorContents:se.i18n.getMsg("MSG_ERROR_PUBLISH_205_CONTENTS")}),dimmed:true,buttons:[{text:se.i18n.getMsg("MSG_ERROR_PUBLISH_205_BTN_SAVE_TEMP"),"class":"type1",click:function(){f._setTempDocInfo();f._sDocId="";f._bStopSave=false;f.saveManageDocument($SE_CONFIG.MANAGE_DOC_TYPE.TEMP,false,function(){$SE_MODAL.close()})}},{text:se.i18n.getMsg("MSG_ERROR_PUBLISH_205_BTN_NEW_DOC"),"class":"type2",click:function(){document.location="/editor"}}],"class":"pop_demoErr_wrap",close:false});$SE_MODAL.open()}else if(a.errorCode==="222"){$SE_CONFIG.alertInvalidUser()}else if(a.errorCode==="220"){f._bStopSave=true;this.bShowFailMsg=false;$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:se.editor.template.common["modal-ajax-error-content.hbs"]({errorTitle:se.i18n.getMsg("MSG_ERROR_PUBLISH_220_TITLE"),errorContents:se.i18n.getMsg("MSG_ERROR_PUBLISH_220_CONTENTS")}),dimmed:true,buttons:[{text:se.i18n.getMsg("MSG_ERROR_PUBLISH_205_BTN_SAVE_TEMP"),"class":"type1",click:function(){f._setTempDocInfo();f._sDocId="";f._bStopSave=false;f.saveManageDocument($SE_CONFIG.MANAGE_DOC_TYPE.TEMP,false,function(){$SE_MODAL.close()})}}],"class":"pop_demoErr_wrap",close:false});$SE_MODAL.open()}};var j=$SE_CONFIG.API.SAVE_DOCUMENT;if(this._sDocId!==""){d.documentId=this._sDocId;j=$SE_CONFIG.API.UPDATE_DOCUMENT}c={type:"POST",processData:false,data:JSON.stringify(d),timeout:6e4};e={fSuccess:g,fError:h,fFail:i};this._bStopSave=true;var k=se.i18n.getMsg("MSG_PUBLISH_DOC");if(this._isStoreFarm()){k=se.i18n.getMsg("MSG_PUBLISH_PRODUCT")}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.SHOW_LOADING_LAYER,"outer",k);return this._requestServerAPI(j,c,e)},readDocumentData:function(a){var b={type:"get",data:{serviceId:this._sServiceName,documentId:a}};var c=function(a){this._setTempDocInfo();this.createDocumentData(a.result);this.trigger("onReadDocument",{})}.bind(this);var d=function(){}.bind(this);this._requestServerAPI($SE_CONFIG.API.READ_DOCUMENT,b,{fSuccess:c,fError:d})},_requestServerAPI:function(a,b,c){c=$.extend({fFail:function(){},fError:function(){}},c);this._oAjax=$SE_AJAX.request(a,b,c);this._oAjax.always(function(){this._oAjax=null}.bind(this));return this._oAjax},loadManageDocumentList:function(a,b){var c=this._htUrlMap[a+"ReadDocList"];var d={type:"get",data:{serviceId:this._sServiceName,docType:$SE_CONFIG.ENV_SETTING.DOC_TYPE,page:b,pageSize:$SE_CONFIG.ENV_SETTING.MANAGE_PAGE_BASE},timeout:2e4};var e=function(b){var c=b.result.list;var d;if(c&&c.length>0){for(var e=0;e<c.length;e++){d=c[e];d.id=d[this._htParamIdMap[a]];if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV){d.createdAt=moment(d.reservationDate).format()}if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){if(d.updatedAt){d.createdAt=d.updatedAt}}c[e]=d}}var f={page:b.result.page.current,pageBase:b.result.page.size,total:b.result.page.total,list:c};this.trigger("onLoadManageDocumentList",{sDocType:a,htListData:f})}.bind(this);var f=function(){}.bind(this);this._requestServerAPI(c,d,{fSuccess:e,fError:f})},readManageDocument:function(a,b){if(!b||b===""){return false}this._abortTempSave();var c=this._htUrlMap[a+"ReadDoc"];var d=se.i18n.getMsg("MSG_LODING_DOC");var e={type:"get",data:{serviceId:this._sServiceName,docType:$SE_CONFIG.ENV_SETTING.DOC_TYPE},timeout:3e4};if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV){e.data.documentId=b}else{e.data[this._htParamIdMap[a]]=b}if(a===$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE||a===$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE||a===$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE){d=se.i18n.getMsg("MSG_LODING_TEMPLATE")}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.SHOW_LOADING_LAYER,"inner",d);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.WEB_FONT_BOLD_LOADING);var f=function(c){$SE_CONFIG.SERVICE_CONFIG.IS_ON_MODIFICATION=false;delete $SE_CONFIG.SERVICE_CONFIG.MATERIAL_SELECTED_BLOG;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.CLEAR_LIBRARY);this.trigger("onReadManageDocument",{sDocType:a});if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC&&$SE_CONFIG.ENV_SETTING.IS_POST_SERVICE){if(!c.result.publishMeta){c.result.publishMeta={}}if(a===$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE){c.result.publishMeta.cloudTags=["구연동화공모전"]}}this.createDocumentData(c.result,a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV);if(this["_"+a+"ReadProcess"]){this["_"+a+"ReadProcess"](b,c)}else{this._setTempDocInfo()}}.bind(this);var g=function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"inner")}.bind(this);var h=function(a){if(a===222){$SE_CONFIG.alertInvalidUser()}else{g()}}.bind(this);this._requestServerAPI(c,e,{fSuccess:f,fFail:h,fError:g})},saveTempDocument:function(a,b){var c=function(a,b,c){return $.proxy(this.saveManageDocument,this,$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,a,b,c)}.bind(this);var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson(true);if(!this.validateDocument(d,false,a||false)){this.trigger("onTempSaveRequestClose");return}if(this._sTempDocId===""){this._createTempId(c(a,b,false))}else{c(a,b,true)()}},_createTempId:function(a){var b=$SE_CONFIG.API.CREATE_TEMPLATE_ID;var c={type:"get",data:{serviceId:this._sServiceName},timeout:3e4};var d=function(b){this._setTempDocInfo(b.result.tempId,b.result.hash);a()}.bind(this);var e=function(a,b){if(b!=="abort"){this._popupTost(se.i18n.getMsg("MSG_ERROR_TEMP_ID_CREATE"))}}.bind(this);var f=function(a){this._popupTost(se.i18n.getMsg("MSG_ERROR_TEMP_ID_CREATE"))}.bind(this);if(this._bStopSave){return false}this._abortTempSave();this._oAjax=this._requestServerAPI(b,c,{fSuccess:d,fError:e,fFail:f,bShowFailMsg:false,bShowErrorModal:false})},saveManageDocument:function(a,b,c,d){c=c&&$.isFunction(c)?c:function(){};var e=this._htUrlMap[a+"SaveDoc"];var f;var g=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson(true);var h;var i=5e3;var j=false;if(this._bStopSave){return false}this._abortTempSave();if(!$SE_CONFIG.SERVICE_CONFIG.FEATURES.DOCUMENT_TITLE){g.title=this._getDocumentContentsSimpleText(100,"...")}if(a===$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE){j=true;b=true}if(!this.validateDocument(g,j,b||false)){c();return false}g=this._oValidator.complementData(g);g.publishDate=moment().format();htParam={serviceId:this._sServiceName,documentId:this._sDocId,document:g,docType:$SE_CONFIG.ENV_SETTING.DOC_TYPE};if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){htParam.skipHashCheck=true;htParam.publishMeta=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA).getJson();if(this._sServiceName!=="gp"){htParam.publishMeta["@service"]=this._sServiceName}htParam.contentsMeta={attachments:this._aAttach};if(this._sTempDocId!==""&&typeof d==="undefined"){d=true}if(this._sTempDocId!==""){e=this._htUrlMap[a+"UpdateDoc"];htParam[this._htParamIdMap[a]]=this._sTempDocId;htParam.hash=this._sTempDocHash}}else if(a===$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE){delete htParam.documentId;i=0}f={type:"POST",timeout:i,processData:false,data:JSON.stringify(htParam)};var k={};k[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP]={success:se.i18n.getMsg("MSG_SUCCESS_TEMP_SAVE"),error:se.i18n.getMsg(b?"MSG_ERROR_TEMP_SAVE":"MSG_ERROR_AUTO_SAVE")};k[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE]={success:se.i18n.getMsg("MSG_SUCCESS_USER_TEMPLATE_SAVE"),error:se.i18n.getMsg("MSG_ERROR_USER_TEMPLATE_SAVE")};var l=function(e){this._hideAutoSave();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_PROGRESS_BAR);if(this["_"+a+"SaveProcess"]){this["_"+a+"SaveProcess"](e)}c(e);if(b){this._popupTost(k[a].success)}this.trigger("onTempSaveRequestClose");this.trigger("onSaveManageDocument",{sDocType:a,bUpdate:d})}.bind(this);var m=function(b,d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_PROGRESS_BAR);if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){this._hideAutoSave();this._sTempDocHash="";this.trigger("onTempSaveRequestClose")}if(d!=="abort"){this._popupTost(k[a].error)}c()}.bind(this);var n=function(a,b,c){var d=(a.errorCode||"")+"";if(d==="207"||d==="222"){if($SE_CONFIG.SERVICE_CONFIG.IS_USE_NAVER_LOGIN){$SE_COMMON_UTIL.alertNaverLogin()}else{$SE_COMMON_UTIL.alertInvalidUser()}}else{if(d==="E404"){k[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP].error=se.i18n.getMsg("MSG_ERROR_TEMP_E404")}m(c,b)}}.bind(this);if(!b){this._showAutoSave()}else{this._hideAutoSave();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.SHOW_PROGRESS_BAR)}this._requestServerAPI(e,f,{fSuccess:l,fFail:n,fError:m,bShowFailMsg:false,bShowErrorModal:false})},deleteManageDocument:function(a,b){var c=this._htUrlMap[a+"DeleteDoc"];var d;var e;var f=false;var g;var h="POST";if(!b||b===""){return false}d={serviceId:this._sServiceName};if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){d[this._htParamIdMap[a]+"s"]=[b];g=JSON.stringify(d)}else if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV){d.documentId=b;f=true;g=d;h="GET"}else{d[this._htParamIdMap[a]]=b;g=JSON.stringify(d)}e={type:h,processData:f,data:g};var i=function(c){if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){if(this._sTempDocId===b){this._setTempDocInfo()}}else if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV){if(this._sDocId===b){this._sDocId=""}}this.trigger("onDeleteManageDocument",{sDocType:a,sDocId:b})}.bind(this);var j=function(){}.bind(this);this._requestServerAPI(c,e,{fSuccess:i,fError:j})},deleteAllTemporaryDocuments:function(){var a=$SE_CONFIG.API.DELETE_ALL_TEMP_DOCUMENTS;var b={serviceId:this._sServiceName,docType:$SE_CONFIG.ENV_SETTING.DOC_TYPE};var c={type:"POST",processData:false,data:JSON.stringify(b)};var d=function(a){this.trigger("onDeleteAllTemporaryDocuments",{sDocType:$SE_CONFIG.MANAGE_DOC_TYPE.TEMP});this._setTempDocInfo()}.bind(this);var e=function(){}.bind(this);this._requestServerAPI(a,c,{fSuccess:d,fError:e})},updateDocument:function(a){this._htPreDocData=$.extend(true,{},a.getJson());this._oDocument=a},getDocumentPreData:function(){return this._htPreDocData},updateMetaData:function(a){if(a){this._oMetaData=a}},updateAttachMement:function(a){this._aAttach=a},isEmptyDocument:function(a){var b=this._oValidator.validate(a,true);if(!b.valid){if(b.reason.title.empty&&b.reason.contents.empty){return true}}return false},isChangeDocument:function(a){var b=this._oDocument.getJson();var c=!_.isEqual(a,b);return c},getDocId:function(){return this._sDocId},_showAutoSave:function(){this._$elAutoSave.show().find("span").html("저장중...")},_hideAutoSave:function(){if(this._nSetTimeout>-1){clearTimeout(this._nSetTimeout);this._nSetTimeout=-1}this._nSetTimeout=setTimeout(function(){this._$elAutoSave.hide()}.bind(this),200)},_popupTost:function(a){$(document.body).ntoast("setMessage",a);$(document.body).ntoast("popupToast")},_getDocumentContentsSimpleText:function(a,b){var c=this._getNormalTextContentsExceptTitle();return this._textTruncate(c,a,b)},_getNormalTextContentsExceptTitle:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_PLAIN_TEXT);return a.join("")},_getTextFromHtml:function(a){var b=$("<div></div>").get(0);b.innerHTML=a;return $SE_COMMON_UTIL.getInnerText(b)},_textTruncate:function(a,b,c){if(a.length>b){a=a.substring(0,b)+c}return a},getCurrentTempDocId:function(){return this._sTempDocId},destroy:function(){}});se.defineController("se.DataController",{construct:function(){this._initVar();this._createModule();this._bindModuleEvent();this._bindGatewayEvent()},_initVar:function(){this._oManager=null;this._nErrorSaveTimerId=-1;this._nErrorTry=30;this._fnSaveTempDocProxy=null;this._nTryTimeout=2e3;this._bFirstLoad=$SE_CONFIG.ENV_SETTING.EMPTY_DOCUENT},_createModule:function(){this._oManager=new se.DataManager},_bindModuleEvent:function(){this._oManager.on("onCreateDocument",function(a){if($SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){this._requestServerTime(function(a){$SE_CONFIG.ENV_SETTING.SERVER_TIME=a})}this._updateEditorView(a.oDocument,a.oMetaData,a.aAttach)}.bind(this));this._oManager.on("onPublishDocument",function(a){this.trigger("afterPublishDocument",a)}.bind(this));this._oManager.on("onReadDocument",function(a){this.oApp.exec("READ_DOCUMENT",[]);this.oApp.exec("HISTORY_RESET",[])}.bind(this));this._oManager.on("onEnabledPublishLayer",function(a){this.oApp.exec("ENABLE_PUBLISH_LAYER",[]);this.trigger("onEnabledPublish",a)}.bind(this));this._oManager.on("onLoadManageDocumentList",function(a){this.oApp.exec("TOP_MANAGE_DOC_LIST_UPDATE",[a.sDocType,a.htListData])}.bind(this));this._oManager.on("onReadManageDocument",function(a){if(this._nErrorSaveTimerId>-1)clearTimeout(this._nErrorSaveTimerId);this.oApp.exec("READ_MANAGE_DOCUMENT",[a.sDocType]);this.oApp.exec("HISTORY_RESET",[])}.bind(this));this._oManager.on("onSaveManageDocument",function(a){this.oApp.exec("TOP_MANAGE_DOC_SAVED",[a.sDocType,a.bUpdate]);if(a.sDocType===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){if(this._nErrorSaveTimerId>-1)clearTimeout(this._nErrorSaveTimerId);this._nErrorSaveTimerId=-1;this._nErrorTry=30;this._fnSaveTempDocProxy=null}}.bind(this));this._oManager.on("onTempSaveRequestClose",function(){this.oApp.exec("TOP_CLEAR_TEMP_SAVE_TIMER")}.bind(this));this._oManager.on("onDeleteManageDocument",function(a){this.oApp.exec("TOP_MANAGE_DOC_DELETE",[a.sDocType,a.sDocId])}.bind(this));this._oManager.on("onDeleteAllTemporaryDocuments",function(){this.oApp.exec("TOP_TEMPORARY_ALL_DOCS_DELETE")}.bind(this));this._oManager.on("onErrorAutoSaveDocument",function(){}.bind(this))},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_DOCUMENT_DATA,function(){return{oDocument:this.getDocument(),oTagData:this.getTagData()}}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_DOCUMENT,this.getDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DOCUMENT,this.updateDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.IS_EMPTY_DOCUMENT,this.isEmptyDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.IS_CHANGE_DOCUMENT,this.isChangeDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.VALIDATE_DOCUMENT,this.validateDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_DOC_ID,this.getDocId.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_CURRNET_TEMPDOC_ID,this.getCurrentTempDocId.bind(this))},_requestServerTime:function(a){this._nServerTimestamp=null;var b=$SE_CONFIG.BLOG_META.API.CURRENT_SERVER_TIME;var c=function(){this._nServerTimestamp=(new Date).getTime();a.call(this,this._nServerTimestamp)}.bind(this);var d=function(b){if(!b.isSuccess||!b.result||typeof b.result!=="number"){c();return}this._nServerTimestamp=b.result;a.call(this,this._nServerTimestamp)};$SE_AJAX.request(b,{bShowErrorModal:false,fSuccess:d.bind(this),fFail:c,fError:c})},_updateEditorView:function(a,b,c){b=b||{};c=c||[];if(!b.getTagInfo){b.getTagInfo=function(){return[]}}var d=b.getTagInfo();this.oApp.exec("TOP_METADATA_UPDATE",[b]);this.oApp.exec("SIDE_ATTACH_UPDATE",[c]);if(window.$SE_EVENT_HUB){if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){if(!this._bFirstLoad){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.SET_DOCUMENT,a)}if(!this._bFirstLoad||d&&d.length>0){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.SET_TAG,b.getTagInfo())}}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESTORE_CANVAS,$.extend(true,{},a.getJson()),true);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.SET_TAG_LIST,b.getTagInfo())}}this._bFirstLoad=false},_collectDocumentData:function(a){var b=null;if(a){this._oManager.updateMetaData(a)}if(window.$SE_EVENT_HUB){b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT);this._oManager.updateDocument(b)}this._oManager.updateAttachMement($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_ATTACH))},$ON_DATA_SAVE_MANAGE_DOCUMENT:function(a){this._collectDocumentData();this._oManager.saveManageDocument(a,false)},$ON_DATA_SAVE_TEMP_DOCUMENT:function(a,b,c,d){var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA);e.setTags($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.GET_TAG_LIST));if(!d){this._fnSaveTempDocProxy=$.proxy(this.$ON_DATA_SAVE_TEMP_DOCUMENT,this,a,e,b,c,true)}try{if(this._nErrorSaveTimerId>-1)clearTimeout(this._nErrorSaveTimerId);this._collectDocumentData(e);this._oManager.saveTempDocument(b,c)}catch(f){if(!b){}}},_tryAutoSave:function(){if(this._nErrorTry===0){$(document.body).ntoast("setMessage",se.i18n.getMsg("MSG_ERROR_AUTO_SAVE"));$(document.body).ntoast("popupToast");if(this._nErrorSaveTimerId>-1)clearTimeout(this._nErrorSaveTimerId);this._nErrorSaveTimerId=-1;this._nErrorTry=30;return false}this._nErrorTry--;this._nErrorSaveTimerId=setTimeout(this._fnSaveTempDocProxy,this._nTryTimeout)},$ON_DATA_LOAD_MANAGE_DOCUMENT_LIST:function(a,b){this._oManager.loadManageDocumentList(a,b)},$ON_DATA_READ_MANAGE_DOCUMENT:function(a,b){this._oManager.readManageDocument(a,b)},$ON_DATA_DELETE_MANAGE_DOCUMENT:function(a,b){this._oManager.deleteManageDocument(a,b)},$ON_DATA_DELETE_ALL_TEMPORARY_DOCUMENTS:function(){this._oManager.deleteAllTemporaryDocuments()},$ON_DATA_SAVE_PUBLISH_DOCUMENT:function(a){this._collectDocumentData(a);this._oManager.publishDocument()},$ON_DATA_READ_DOCUMENT:function(a){this._oManager.readDocumentData(a)},createDocumentData:function(a,b){if($SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){a=this._refineBlogPublishMeta(a)}this._oManager.createDocumentData(a,b)},_createMrBlogData:function(){var a=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.MR_BLOG);a.title=$SE_CONFIG.SERVICE_CONFIG.MRBLOG_DATA.title;a.talkCode=$SE_CONFIG.SERVICE_CONFIG.MRBLOG_DATA.talkCode;a.contents=$SE_CONFIG.SERVICE_CONFIG.MRBLOG_DATA.contents;return a},_insertMrBlogCompData:function(a){var b=this._createMrBlogData();a.components.splice(1,0,b);var c=$SE_STRING.getPlainText(b.contents);var d=/\(([^)]+)\)/g;c=c.replace(d,"");a.components[0].title=c;return a},_refineBlogPublishMeta:function(a){if(!$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){return a}if((!a||!a.document)&&$SE_CONFIG.SERVICE_CONFIG.USE_MRBLOG){a=a||{};var b=$SE_MODEL_DATA_COORD.getNewDocData().document;b=this._insertMrBlogCompData(b);a.document=b}if(!a||!a.publishMeta){return a}$SE_CONFIG.SERVICE_CONFIG.SKIP_ADD_MATERIAL_BLOG_ON_INIT=true;var c=a.publishMeta;var d=c.leverage||{};var e=d.reject;var f=true;var g=c.directoryDetail;if(e===true||!c.leverage&&g){f=false}c.checkSendToNaverService=f;if(f){$SE_CONFIG.SERVICE_CONFIG.LOCK_SERVICE_LINK_CHECK_BLOG=true}var h=d.approval;c.enableSendToNaverService=typeof h==="boolean"?!h:true;return a},getDocument:function(){return this._oManager.getDocument()},updateDocument:function(a){this._oManager.updateDocument(a);
},getTagData:function(){var a=this._oManager.getMetaData();var b=[];if(a){if(a["tagInfo"]){b=a["tagInfo"]}else if(a["tagList"]){b=a["tagList"]}}return b},getMetaData:function(){return this._oManager.getMetaData()},isEmptyDocument:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson(true);return this._oManager.isEmptyDocument(a)},isChangeDocument:function(){var a=$.extend(true,{},this._oManager.getDocumentPreData());var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson();return!_.isEqual(a,b)},validateDocument:function(a,b,c){var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT);return this._oManager.validateDocument(d.getJson(true),a,b,c)},getDocId:function(){return this._oManager.getDocId()},getCurrentTempDocId:function(){return this._oManager.getCurrentTempDocId()},destroy:function(){}});
//# sourceMappingURL=blog_desktop_normal_editor_control_data.min.js.map