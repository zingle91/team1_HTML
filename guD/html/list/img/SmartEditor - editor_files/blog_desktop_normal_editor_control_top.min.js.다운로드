/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineController("se.PublishManager",{construct:function(a){this._htDefaultMetaData=a;this._initVar();this._createModule();this._attachEvent();this._bindGatewayEvent()},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DIRECTORY_BLOG_META_FROM_MATERIAL,this.updateDirectoryBlogMetaFromMaterial.bind(this))},_initVar:function(){this._sCaplitalizeServiceName=$SE_STRING.capitalize($SE_CONFIG.ENV_SETTING.SERVICE_NAME)},_createModule:function(){this._oPublishViewController=this._getPublishViewControllerInstance();this._oDocumentValidator=this._getDocumentValidatorInstance()},_getDocumentValidatorInstance:function(){if(!this._oDocumentValidator){return new se[this._sCaplitalizeServiceName+"DocumentValidator"]}else{return this._oDocumentValidator}},_getMetaDataInstance:function(){if(!this._oMetaData){return new se[this._sCaplitalizeServiceName+"MetaDataModel"](this._htDefaultMetaData)}else{return this._oMetaData}},_onUpdateMetaModel:function(a){this._oMetaData.updateData(a)},_getPublishViewControllerInstance:function(){this._oMetaData=this._getMetaDataInstance();return new se[this._sCaplitalizeServiceName+"PublishViewController"](this._oMetaData)},_attachEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA,this._getMetaDataInstance.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.UPDATE_META_DATA,this._onUpdateMetaModel.bind(this));var a=_.debounce(this._onPublishDocument.bind(this),300);this._oPublishViewController.on("onPublishDocument",a)},_onPublishDocument:function(){$.when(this._oDocumentValidator.validateWidthProhibitedWords($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson(true),true)).done(this._onSuccessValidation.bind(this)).always(this._onAfterValidate.bind(this))},_onSuccessValidation:function(a){var b=this._getPublishData();if($SE_EVENT_HUB.trigger("CHECK_PUBLISH_VALIDATION",a,true,true)){var c=$SE_EVENT_HUB.trigger("PUBLISH_DOUCMENT",b);c.done(this._onSuccessPublish.bind(this))}},_onSuccessPublish:function(a){this._oPublishViewController._IMPL_onAfterPublish(a.result)},_onAfterValidate:function(){$SE_EVENT_HUB.trigger("AFTER_VALIDATION_DOCUMENT")},_getPublishData:function(){var a=this._oPublishViewController.getPublishMetaData();var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT).getJson(true);return{htDocData:b,htMetaData:a}},updateDirectoryBlogMetaFromMaterial:function(a){if(!$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){return}if(this._oMetaData.getDirectorySetManuallyYn()&&!this._oMetaData.getDirectoryLinkedToMaterialYn()){return}if(this._oMetaData.getCategorySetManuallyYn()&&a.directorySeq!==this._oMetaData.getDirectorySeq()){return}if(a.directorySeq===this._oMetaData.getDirectorySeq()&&a.directoryTitle===this._oMetaData.getDirectoryTitle()&&a.directoryId===this._oMetaData.getDirectoryId()){return}else if($SE_CONFIG.SERVICE_CONFIG.IS_ON_MODIFICATION){a.enableSendToNaverService=true;delete $SE_CONFIG.SERVICE_CONFIG.LOCK_SERVICE_LINK_CHECK_BLOG}a.tempThemeSourceCode=a.themeSourceCode;this._deepExtendTempModelData(a);this._patchTempModelDataToModel()},_deepExtendTempModelData:function(a){this._oTempModelData=this._oTempModelData||{};this._clearBlogMaterialMeta();this._oTempModelData=$.extend(true,this._oTempModelData,a)},_clearBlogMaterialMeta:function(){if(!$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){return}this._oTempModelData.directorySeq=null;this._oTempModelData.directoryTitle=null;this._oTempModelData.directoryId=null;this._oTempModelData.directoryDetail=null;this._oTempModelData.themeSourceCode=null;this._oTempModelData.tempThemeSourceCode=null;this._oTempModelData.bookThemeInfoPk=null;this._oTempModelData.movieThemeInfoPk=null;this._oTempModelData.musicThemeInfoPk=null},_patchTempModelDataToModel:function(){if(!this._oTempModelData){return}var a;for(a in this._oTempModelData){if(this._oTempModelData.hasOwnProperty(a)&&this._oMetaData["set"+$SE_STRING.capitalize(a)]){this._oMetaData["set"+$SE_STRING.capitalize(a)](this._oTempModelData[a])}}}});se.defineClass("se.BaseTemplateManageList",se.AbstractDocumentManageList,{construct:function(a,b,c){},_IMPL_activeList:function(){this._$elTotalCount.html("0")},_IMPL_afterCreateList:function(){$("#se_template_popup").show()}});se.defineClass("se.UserTemplateManageList",se.AbstractDocumentManageList,{construct:function(a,b,c){},_IMPL_activeList:function(){var a=_.debounce(function(){this._oManage.trigger("onSaveTemplate")}.bind(this),300);this._$elTotalCount.html("0");this._$elSaveBtn=this._$elSaveBtn||this._$elBase.find(".__se_top_save_template_btn");this._$elSaveBtn.on("click",a)},_IMPL_afterCreateList:function(){$("#se_template_popup").show()},_IMPL_deactiveList:function(){this._$elSaveBtn.off("click")}});se.defineClass("se.EventTemplateManageList",se.AbstractDocumentManageList,{construct:function(a,b,c){},_IMPL_activeList:function(){},_IMPL_afterCreateList:function(){$("#se_template_popup").show()}});se.defineComponent("se.TemplateDocumentManage",{construct:function(){this._initVar();this._wrapperElements();this._bindEvent()},_initVar:function(){this._$elBtn=null;this._TOOLTIP_COOKIE_NAME="SE3_CARD_TOOLTIP"},_wrapperElements:function(){this._$elBase=$("#se_top_templatelist_layer");this._$elBtn=$("#se_top_template_btn");this._$elTab=null;this._oCurrentTab=null;this._sSelectTab="";this._htTabInstance={}},_createModule:function(){var a=new se.UserTemplateManageList(this,$("#se_top_templatedoc_user_layer"),{sListType:$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE,sClickCode:"tpl*m.list"});var b=new se.BaseTemplateManageList(this,$("#se_top_templatedoc_base_layer"),{sListType:$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE,sTemplateName:"loaddoc-base-template-docList.hbs",sClickCode:""});var c=new se.EventTemplateManageList(this,$("#se_top_templatedoc_event_layer"),{sListType:$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE,sTemplateName:"loaddoc-event-template-docList.hbs",sClickCode:""});this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE]=a;this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE]=b;this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE]=c},_bindEvent:function(){this._$elBtn.on("click",function(a){a.preventDefault();this._toggleLayer();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.CLOSE);return false}.bind(this))},_bindLayerEvent:function(){this._$elTab=$("#se_templatedoc_tab");this._$elTab.on("click",".__se_templatedoc_tab",function(a){a.preventDefault();var b=$(a.target),c;b=b.closest(".__se_templatedoc_tab");c=b.data("tabtype");this._activeTab(c)}.bind(this))},_toggleLayer:function(){if(this._$elBase.children().get(0)){this.close()}else{this.open()}},_activeTab:function(a){if(this._sSelectTab!==a&&this._oCurrentTab){this._oCurrentTab.deactivate()}else if(this._sSelectTab===a){return}this._$elTab.find(".__se_templatedoc_tab").removeClass("is-active");this._$elTab.find("a[data-tabtype='"+a+"']").addClass("is-active");this._oCurrentTab=this._htTabInstance[a];this._oCurrentTab.activate();this._sSelectTab=a},_unbindEvent:function(){},open:function(a,b){$SE_EVENT_UTIL.offBodyClickClose();var c={initOverlay:a?true:false,cardDoc:$SE_CONFIG.ENV_SETTING.IS_CARD_DOC,eventUse:$SE_CONFIG.ENV_SETTING.EVENT_TEMPLATE_USE};var d=se.editor.template.control["top-template-docmanage.hbs"];var e=$SE_CONFIG.MANAGE_DOC_TYPE[$SE_CONFIG.ENV_SETTING.TOTAL_USER_TEMPLATE_COUNT>0?"USER_TEMPLATE":"BASE_TEMPLATE"];if(a&&$SE_CONFIG.ENV_SETTING.EVENT_TEMPLATE_USE&&b==="event"){e=$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE}var f=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.TEMPLATE,{content:d(c),"class":"pop_cardTemplate_wrap",templateData:c,animate:true,buttons:[],afterOpen:function(){this._createModule();this._bindLayerEvent();this._$elBase.find(".__se_pop_wrap").show("block").addClass("is-on");this._activeTab(e);this.trigger("onOpen",{oSelf:this})}.bind(this),beforeOpen:function(){this._$elBase.find(".__se_pop_wrap").removeClass("is-on")}.bind(this),afterClose:function(){this._oCurrentTab=null;this._sSelectTab=null;this.trigger("onClose",{oSelf:this});if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC&&$SE_COMMON_UTIL.getCookie(this._TOOLTIP_COOKIE_NAME)!=="T"){var a=$(".btn_tip").ntooltip({left:62,type:"bottom",pointerType:"top",message:"에디터 사용법과 <span>TIP</span>을<br>확인해보세요"});a.ntooltip("openTooltip");$SE_COMMON_UTIL.setCookie(this._TOOLTIP_COOKIE_NAME,"T",365*5);setTimeout(function(){a.ntooltip("closeTooltip")},4e3)}}.bind(this)},this._$elBase);$SE_MODAL.open()},close:function(){$SE_MODAL.close()},createManageDocList:function(a,b){if(a==$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE){$SE_CONFIG.ENV_SETTING.TOTAL_USER_TEMPLATE_COUNT=b.total}this._htTabInstance[a].createDocList(b)},deleteManageDoc:function(a,b){this._htTabInstance[a].deleteListItem(b)},saveManageDoc:function(a){if($SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE===this._sSelectTab){this._oCurrentTab.loadDocList()}},getBaseElement:function(){return this._$elBase.get(0)},destroy:function(){}});se.defineClass("se.TempDocumentManageList",se.AbstractDocumentManageList,{construct:function(a,b,c){this._bAutoSaveUse=$SE_CONFIG.ENV_SETTING.AUTO_SAVE_USE},_IMPL_activeList:function(){this._bindAutoSaveSetting()},_IMPL_deactiveList:function(){this._unbindAutoSaveSetting()},_bindAutoSaveSetting:function(){this._$elAutoSaveBtnWrapper=this._$elAutoSaveBtnWrapper||this._$elBase.find(".__se_top_autosave_setting");this._$elAutoSaveBtn=this._$elAutoSaveBtn||this._$elBase.find(".__se_top_autosave_btn");this._$elAutoSaveForm=this._$elAutoSaveForm||this._$elBase.find(".__se_autosave_term_form");this._$elAutoSaveBtn.on("click",function(a){a.preventDefault();this._toggleSave(a)}.bind(this));this._initAutoSave()},_unbindAutoSaveSetting:function(){this._$elAutoSaveBtn.off("click")},_toggleSave:function(a){if(this._bAutoSaveUse){clickcr(this._$elAutoSaveBtn[0],"tpb*s.autooff","","",a);this._offAutoSave()}else{clickcr(this._$elAutoSaveBtn[0],"tpb*s.autoon","","",a);this._onAutoSave()}this._requestSaveAutoSetting(this._bAutoSaveUse)},_initAutoSave:function(){if(this._bAutoSaveUse){this._onAutoSave()}else{this._offAutoSave()}},_onAutoSave:function(){this._$elAutoSaveBtn.addClass("is-active");this._bAutoSaveUse=true;$SE_CONFIG.ENV_SETTING.AUTO_SAVE_USE=true},_offAutoSave:function(){this._$elAutoSaveBtn.removeClass("is-active");this._bAutoSaveUse=false;$SE_CONFIG.ENV_SETTING.AUTO_SAVE_USE=false;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_PROGRESS_BAR)},_requestSaveAutoSetting:function(a){var b=function(){if(a){this.trigger("onRequestTempSave")}}.bind(this);var c=function(){$(document.body).ntoast("setMessage",se.i18n.getMsg("MSG_AUTO_SAVE_SETTING_UPDATE_ERROR"));if(a){this._offAutoSave()}else{this._onAutoSave()}}.bind(this);var d=function(a){if(a===222){$SE_CONFIG.alertInvalidUser()}else{c()}}.bind(this);$SE_AJAX.request($SE_CONFIG.API.AUTO_SAVE_UPDATE,{type:"get",data:{serviceId:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,value:a}},{fSuccess:b,fFail:d,fError:c,bShowFailMsg:false,bShowErrorModal:false})}});se.defineComponent("se.SaveDocumentManage",{construct:function(){this._initVar();this._wrapperElements();this._bindEvent()},_initVar:function(){this._nTimer=-1;this._$elBtn=null;this._oCurrentTab=null;this._sSelectTab="";this._nTotalTmpDocCount=$SE_CONFIG.ENV_SETTING.TOTAL_TEMPDOC_COUNT!==""?Number($SE_CONFIG.ENV_SETTING.TOTAL_TEMPDOC_COUNT):0;this._htTabInstance={};this._LONG_KEEP_SAVE_TIMEOUT=1e4;this._KEEP_SAVE_TIMEOUT=1e3;this._bAutoSaveBlock=false},_wrapperElements:function(){this._$elBase=$("#se_top_savelist_layer");this._$elSaveBtn=$("#se_top_savedoc_temp_save_btn");this._$elCountBtn=$("#se_top_savedoc_temp_count_btn");this._$elCountView=$("#se_top_savedoc_temp_count_view")},_createModule:function(){var a=new se.TempDocumentManageList(this,$("#se_top_savedoc_temp_layer"),{sListType:$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,sClickCode:"tpb*s.tlist"});var b=new se.AbstractDocumentManageList(this,$("#se_top_savedoc_reserv_layer"),{sListType:$SE_CONFIG.MANAGE_DOC_TYPE.RESERV,sClickCode:"tpb*s.slist"});a.on("onRequestTempSave",function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.IS_CHANGE_DOCUMENT);if(b){this._saveTempDocument(true)}}.bind(this));this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP]=a;this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.RESERV]=b},_bindEvent:function(){this._$elSaveBtn.on("click",function(a){a.preventDefault();if(this._bAutoSaveBlock===false){this._bAutoSaveBlock=true;this._saveTempDocument(true);this._settingAutoSaveEnableTimer(this._LONG_KEEP_SAVE_TIMEOUT)}return false}.bind(this));this._$elCountBtn.on("click",function(a){a.preventDefault();a.stopPropagation();this._toggleLayer();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.CLOSE)}.bind(this))},_settingAutoSaveEnableTimer:function(a){if(this._nTimer>-1){clearTimeout(this._nTimer)}this._nTimer=setTimeout(function(){this._bAutoSaveBlock=false;this._nTimer=-1}.bind(this),a)},clearAutoSaveTimer:function(){if(this._nTimer>-1){clearTimeout(this._nTimer)}this._bAutoSaveBlock=false;this._nTimer=-1},_bindLayerEvent:function(){this._$elTab=$("#se_savedoc_tab");this._$elTab.on("click",".__se_savedoc_tab",function(a){a.preventDefault();var b=$(a.target),c;b=b.closest(".__se_savedoc_tab");c=b.data("tabtype");this._activeTab(c)}.bind(this))},_toggleLayer:function(){if(this._$elBase.children().get(0)){this.close()}else{this.open()}},open:function(){var a=se.editor.template.control["top-temp-docmanage.hbs"];var b=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.WINDOW,{content:a({useReservationMenu:$SE_CONFIG.SERVICE_CONFIG.USE_RESERVATION_MENU}),animate:false,afterOpen:function(){this._createModule();this._bindLayerEvent();this._activeTab($SE_CONFIG.MANAGE_DOC_TYPE.TEMP);this.trigger("onOpen",{oSelf:this})}.bind(this),afterClose:function(){this._oCurrentTab=null;this._sSelectTab=null;this.trigger("onClose",{oSelf:this})}.bind(this),"class":"is-on"},this._$elBase);$SE_MODAL.open()},close:function(){$SE_MODAL.close()},_activeTab:function(a){if(this._sSelectTab!==a&&this._oCurrentTab){this._oCurrentTab.deactivate()}else if(this._sSelectTab===a){return}this._$elTab.find(".__se_savedoc_tab").removeClass("is-active");this._$elTab.find("button[data-tabtype='"+a+"']").addClass("is-active");this._oCurrentTab=this._htTabInstance[a];this._oCurrentTab.activate();this._sSelectTab=a},_unbindEvent:function(){},_saveTempDocument:function(a){this.trigger("onSaveTempDocument",{bSaveNow:a||false})},_updateTempCount:function(){var a=this._nTotalTmpDocCount;if(this._nTotalTmpDocCount>99){a="99+"}this._$elCountView.html(a)},saveManageDoc:function(a){if(this._nTimer>-1){this._settingAutoSaveEnableTimer(this._KEEP_SAVE_TIMEOUT)}if(a){return false}this._nTotalTmpDocCount++;this._updateTempCount()},createManageDocList:function(a,b){if(a==$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){this._nTotalTmpDocCount=b.total;this._updateTempCount()}if(this._oCurrentTab){this._htTabInstance[a].createDocList(b)}},deleteManageDoc:function(a,b){if(a==$SE_CONFIG.MANAGE_DOC_TYPE.TEMP){this._nTotalTmpDocCount--;this._updateTempCount()}this._htTabInstance[a].deleteListItem(b)},deleteAllTemporaryDocuments:function(){this._htTabInstance[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP].deleteListItem(null)},getBaseElement:function(){return this._$elBase.get(0)},destroy:function(){}});se.defineComponent("se.PreviewPanel",{construct:function(){this._initVar();this._wrapperElements();this._bindEvent()},_initVar:function(){this._$elPreviewBar=null;this._sCurrentSize="full";this._htWindowSizeMap={};this._htWindowSizeMap[$SE_CONFIG.PREVIEW_TYPE.PC]=$SE_CONFIG.PREVIEW_SIZE.PC;this._htWindowSizeMap[$SE_CONFIG.PREVIEW_TYPE.TABLET]=$SE_CONFIG.PREVIEW_SIZE.TABLET;this._htWindowSizeMap[$SE_CONFIG.PREVIEW_TYPE.MOBILE]=$SE_CONFIG.PREVIEW_SIZE.MOBILE},_wrapperElements:function(){this._$elPreviewWrapper=$("#se_preview_ctrl")},_bindEvent:function(){this._$elPreviewWrapper.on("click",".__preview_type",function(a){a.preventDefault();var b=$(a.target).data("previewtype");this.changePreviewSize(b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.HIDE_ALL_INSERT_POINTS)}.bind(this))},_selectPreviewType:function(a){this._sCurrentSize=a;this._$elPreviewWrapper.find(".__preview_type").removeClass("is-active");this._$elPreviewWrapper.find(".device_"+a).addClass("is-active")},_unbindEvent:function(){},changePreviewSize:function(a){this._selectPreviewType(a);this.trigger("onChangePreview",{sSize:this._htWindowSizeMap[a],sType:a})},destroy:function(){}});se.defineComponent("se.CanvasFrameHandler",{construct:function(){this._initVar();this._wrapperElements();this._makeCanvasFrame()},_initVar:function(){this._$elFrameWrapper=null;this._$elFrame=null},_wrapperElements:function(){this._$elFrameWrapper=$("#se_frame_layer")},_makeCanvasFrame:function(){var a=$SE_CONFIG.ENV_SETTING.CANVAS_FRAME_ID;var b=[["serviceId",$SE_CONFIG.ENV_SETTING.SERVICE_NAME],["deviceType",$SE_CONFIG.ENV_SETTING.DEVICE_TYPE],["docType",$SE_CONFIG.ENV_SETTING.DOC_TYPE]];var c=_.map(b,function(a){return a.join("=")}).join("&");var d=[$SE_CONFIG.ENV_SETTING.CANVAS_FRAME_URL,c].join("?");this._$elFrameWrapper.append($('<iframe id="'+a+'" src="'+d+'" title="'+se.i18n.getMsg("MSG_IFRAME_TITLE")+'"class="se_inputarea" width="100%" height="100%" frameborder="0"></iframe>'));this._$elFrame=$("#"+a)},resizeWrapper:function(a){this._$elFrameWrapper.css("height",a+"px");$SE_SIZE_STORE.prepareCanvasClientRect()},changePreview:function(a,b){this._$elFrame.css("max-width",b);if($SE_CONFIG.ENV_SETTING.SERVICE_NAME===$SE_CONFIG.SERVICE_TYPE.BLOG){this._settingBlogLayout(a)}this._hideAllTooltip()},_hideAllTooltip:function(){var a=this._$elFrame.contents().find(".pop_GTooltip_wrap");a.removeClass("is-on")},_settingBlogLayout:function(a){var b="";var c=$SE_CONFIG.SERVICE_CONFIG.VIEW_WIDTH;if(a===$SE_CONFIG.PREVIEW_TYPE.PC&&$SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT>0){if($SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT==1&&c>=886){b="se_blog_layout1"}else if($SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT==1&&c<=693||$SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT==2&&c>=693){b="se_blog_layout2"}else if($SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT==2&&c>=500||$SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT==3&&c<=500){b="se_blog_layout3"}}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.CHANGE_CANVAS_ELEMENT_CLASS,"body","se_blog_layout",b)},bindWheelEvent:function(){var a=$SE_CONFIG.ENV_SETTING.CANVAS_FRAME_ID;var b=document.getElementById(a);this._$elFrameBody=$(b.contentWindow||b.contentDocument);this._$elFrameWrapper.on("mousewheel DOMMouseScroll",this._moveScroll.bind(this))},_moveScroll:function(a){var b=this._$elFrameBody;var c=$(a.currentTarget);if(b[0].offsetHeight>=b[0].scrollHeight){return}var d=a.type==="mousewheel"?-a.originalEvent.wheelDelta:40*a.originalEvent.detail;var e=b.scrollTop()+d;b.scrollTop(e);if(e<=0||e>=c[0].scrollHeight-b.height()){a.preventDefault()}},_unbindEvent:function(){},destroy:function(){}});window.$SE_SNS_HELPER=se.defineStatic("se.SnsPopupHelper",function(){var a={};function b(b,c){a[b]=c}function c(b){a[b]()}return{setCallback:b,execCallback:c}}());htSnsHelper={execSnsCallback:function(a){$SE_SNS_HELPER.execCallback(a)}};se.defineClass("se.BlogPublishViewController",se.AbstractPublishViewController,{SCRAP_TOOLTIP_CONFIG:{type:"top",pointerType:"down",top:-30,left:0,message:"이제 본문도 바로 볼 수 있도록<br>본문 스크랩 기능이 추가되었어요",autoClose:true},construct:function(a){this._oModel=a;this._initVar();this._assignDefaultLayerElement();this._attachEvent()},_initVar:function(){this._aTag=[];this._$elMetaSettingWrapper=null;this._$elBtn=null;this._sServiceName=$SE_CONFIG.ENV_SETTING.SERVICE_NAME;this._htBlogMetaConf=$SE_CONFIG.BLOG_META;this._htElement={};this._aHandledElementName=[];this._sServiceName=$SE_CONFIG.SERVICE_TYPE.BLOG;this._fTemplate=se.editor.template.control[this._sServiceName+"-metaSetting.hbs"];this._fStopPropagation=this._stopPropagation.bind(this);this._nPreviousOpenType=null;this._rxHHMM=new RegExp("([0-9]{2})(:)([0-9]{2})");this._sFullTimeFormat="YYYY-MM-DD HH:mm";this._nServerTimestamp=null},_assignDefaultLayerElement:function(){this._$elSettingLayer=$("#se_top_publish_setting_layer");this._$elBase=$("#se_top_publish_layer");this._$elMetaSettingWrapper=$("#se_top_publish_btn");this._$elBtn=$("#se_top_publish_btn");this._$elPublishBtn=$("#se_publish_doc_btn");this._$elLi=this._$elBase.parent()},_attachEvent:function(){$SE_EVENT_HUB.on("AFTER_VALIDATION_DOCUMENT",this.close.bind(this));$SE_EVENT_HUB.on("AFTER_PUBLISH_DOCUMENT",this._IMPL_onAfterPublish.bind(this));$SE_EVENT_HUB.on("CHECK_PUBLISH_VALIDATION",this._IMPL_onCheckValidate.bind(this));this._$elBtn.on("click",this._IMPL_onClickPublishBtn.bind(this))},_activateLayer:function(){this._showLayer();if(this._oModel.getScrapType()===1){this._prevScrapValueon=this._oModel.getScrapType()}else{this._prevScrapValueon=2}this._drawLayer();this._assignElements();this._setToggleOptionMap();this._assignLabelCommonWithEvent();this._initDatePicker();this._updateAfterActivate();this._bindEvent();this._showToolTipIfNecessary()},_showToolTipIfNecessary:function(){if(!this._isToolTipNecessary()){return}var a=this._$elSettingLayer.find(".__se_select_scrap_type_btn");localStorage.setItem("SE3_PUBLISH_LAYER_USED","T");this._htBlogMetaConf.SCRAP_TOOLTIP_CONFIG.message=se.i18n.getMsg("MSG_PUBLISH_SCRAP_TOOLTIP");this._scrapTooltip=a.ntooltip(this._htBlogMetaConf.SCRAP_TOOLTIP_CONFIG);this._scrapTooltip.ntooltip("openTooltip")},_isToolTipNecessary:function(){var a=$SE_CONFIG.SERVICE_CONFIG.USE_TOOLTIP;var b=localStorage.getItem("SE3_PUBLISH_LAYER_USED")!=="T";return a&&b},_isOnlyTargetCategory:function(a,b){return!a&&b&&b!==""},_getPublishViewCategoryId:function(a){var b=a.targetCategory;var c=a.categoryId;if(this._isOnlyTargetCategory(c,b)){this._updateModel("targetCategory",null);return parseInt(b,10)}return c},_updateAfterActivate:function(){var a=this._oModel.getJson();var b=a.directorySeq;var c=this._getPublishViewCategoryId(a);var d=$SE_CONFIG.USER_INFO;var e;var f;if(d.categoryList){e=d.categoryList}if(typeof c==="number"){f=this._getCategoryDataById(c)}if(!f&&e){f=e[0];c=f.categoryNo}if(typeof b!=="number"&&f){b=f.directorySeq}var g;if(f&&!f.isOpen){g=0}var h=a.directoryTitle;if(typeof c==="number"){this._updateCategory({nDirectorySeq:b,sDirectoryTitle:h,nCategoryId:c})}else{b=b||0;this._updateDirectory(b,h)}g=typeof g==="number"?g:a.openType;var i=a.targetUserId;if(i){g=2}if(typeof g==="number"){this._updateOpenType({nOpenType:g},{bUseOn:false,isOnActivate:true})}var j=a.localPostingTime;var k;if(j){k=j.match(this._rxHHMM)}if(k){this._htElement.$elHour.val(k[1]);this._htElement.$elMinute.val(k[3])}var l=a.prePostRegistDirectly;if(!l){if(this._htElement.$elReservationWrapper.is(":visible")){this._requestServerTime(this._validateReserveTime.bind(this))}}this._toggleSendToNaverServiceMethod(a.searchYn)},deactivate:function(){this._hideLayer();this._unbindEvent();this._unassignElements()},getMetaData:function(){this.trigger("onGetDocumentTitleComp");this.trigger("onGetTag");return this._oModel},setMetaData:function(a){this._oModel=a},isValid:function(){if(this._htElement.$elDate.is(":visible")){if(!this._validateReserveTime()){return false}}return true},_validateReserveTime:function(a){a=a||{};var b=a.bSkipInvalidUI;var c=new Date(this._nServerTimestamp);c.setMilliseconds(0);var d=c.getTime();var e=this._getReserveTimestamp();if(!e){alert(se.i18n.getMsg("MSG_RESERVE_TIME_INVALID"));return false}var f=e-d;var g=this._htElement.$elInvalidReservationIndicator;var h=this._htBlogMetaConf.UI_ERROR;if(f<60*1e3&&!b){g.addClass(h);return false}else{g.removeClass(h)}return true},_assignElements:function(){var a=this._htElement;a.$elLayer=$("div.se_blog",this._$elSettingLayer);a.$elDropdownBtn=$("button.btn_dropDown",this._$elSettingLayer);a.$elDropdownListWrapper=$("div.dropDown_lst_wrap",this._$elSettingLayer);a.$elDropdownList=$("> ul",a.$elDropdownListWrapper);a.$elDropdownListStatus=$("span.blind > span",a.$elDropdownListWrapper);a.$elDirectory=$("button.category",this._$elSettingLayer);a.$elDirectorySearchBtn=$("button.btn_search",this._$elSettingLayer);a.$elDirectoryListWrapper=$("div.se_blog_directory",this._$elSettingLayer);a.$elDirectoryApplyBtn=$("button.__se_apply",a.$elDirectoryListWrapper);a.$elDirectoryCancelBtn=$("button.__se_cancel",a.$elDirectoryListWrapper);a.$elDirectoryTitle=$("div.keyword",a.$elLayer);a.$elDirectorySpecificOptionWrapper=$("div.setting_category",this._$elSettingLayer);this._$elOpenLevelListWrapper=$("div.lv_public",this._$elSettingLayer);a.$elOpenLevelList=$("ul",this._$elOpenLevelListWrapper);a.$elCclSpecifyBtn=$(".__se_btn_ccl_specify",this._$elSettingLayer);a.$elCclSpecifyWrapper=$("div.ly_ccl",this._$elSettingLayer);a.$elCommercialUsesYnWrapper=$("div.ccl_commercial",this._$elSettingLayer);a.$elContentsModificationWrapper=$("div.ccl_modify",this._$elSettingLayer);a.$elCclSpecifyApplyBtn=$("button.btn_ccl_apply",a.$elCclSpecifyWrapper);a.$elCclSpecifyCancelBtn=$("button.btn_ccl_cancel",a.$elCclSpecifyWrapper);a.$elReservationWrapper=$("div.setAppointment",this._$elSettingLayer);a.$elCancelReservation=$("button.btn_cancel",this._$elSettingLayer);a.$elDate=$("input.date",this._$elSettingLayer);a.$elHour=$("select.hour",this._$elSettingLayer);a.$elMinute=$("select.minutes",this._$elSettingLayer);a.$elPublishBtn=$("button.btn_publish",this._$elSettingLayer);a.$elReserveBtn=$("button.btn_appointment",this._$elSettingLayer);a.$elInvalidReservationIndicator=$("div.setDate",this._$elSettingLayer);a.$elSnsBtnWrapper=$("div.sns_buttons",this._$elSettingLayer);a.$elTwitterPostingYnBtn=$("button.twt",this._$elSettingLayer);a.$elFacebookPostingYnBtn=$("button.fb",this._$elSettingLayer);this._$elScrapTypeWrapper=$(".__se_scrap_type_wrapper",this._$elSettingLayer);a.$elScrapTypeSelectBtn=$(".__se_select_scrap_type_btn",this._$elSettingLayer);a.$elScrapTypeSelectLayer=$(".__se_select_scrap_type_layer",this._$elSettingLayer)},_unassignElements:function(){this._htElement={}},_bindEvent:function(){this._attachEventOnElement("Layer","click",this._onClickLayer.bind(this));this._attachEventOnElement("DropdownBtn","click",this._onClickDropdownBtn.bind(this));this._attachEventOnElement("DropdownListWrapper","click","li",this._onClickDropdownListWrapper.bind(this));this._attachEventOnElement("Directory","click",this._onClickDirectory.bind(this));this._attachEventOnElement("DirectoryListWrapper","click","label",this._onClickDirectoryListWrapper.bind(this));this._attachEventOnElement("DirectoryApplyBtn","click",this._onClickDirectoryApplyBtn.bind(this));this._attachEventOnElement("DirectoryCancelBtn","click",this._onClickDirectoryCancelBtn.bind(this));this._attachEventOnElement("OpenLevelList","click","label",this._onClickOpenLevelList.bind(this));this._attachEventOnElement("CclSpecifyBtn","click",this._onClickCclSpecifyBtn.bind(this));this._attachEventOnElement("CommercialUsesYnWrapper","click","label",this._onClickRadioWrapperCommon({htClass:{bSkipUpdateModel:true}}).bind(this));this._attachEventOnElement("ContentsModificationWrapper","click","label",this._onClickRadioWrapperCommon({htClass:{bSkipUpdateModel:true}}).bind(this));this._attachEventOnElement("CclSpecifyApplyBtn","click",this._onClickCclSpecifyApplyBtn.bind(this));this._attachEventOnElement("CclSpecifyCancelBtn","click",this._onClickCclSpecifyCancelBtn.bind(this));this._attachEventOnElement("CancelReservation","click",this._onClickCancelReservation.bind(this));this._attachEventOnElement("PublishBtn","click",this._onClickPublishBtn.bind(this));this._attachEventOnElement("ReserveBtn","click",this._onClickReserveBtn.bind(this));this._attachEventOnElement("NoticePostYnLabel","click",this._onClickNoticePostLabel.bind(this));this._attachEventOnElement("SnsBtnWrapper","click","button",this._onClickSnsBtnWrapperBtn.bind(this));var a=this._onChangeHourMinute.bind(this);this._attachEventOnElement("Hour","change",a);this._attachEventOnElement("Minute","change",a);this._attachEventOnElement("Date","focus",this._onFocusDate.bind(this));this._attachEventOnElement("ScrapTypeSelectBtn","click",function(a){this._toggleScrapTypeSelectLayer()}.bind(this));this._htElement.$elScrapTypeSelectLayer.on("click","button",this._onClickScrapType.bind(this))},_onClickScrapType:function(a){this._setScrapTypeFrom($(a.currentTarget))},_setScrapTypeFrom:function(a){if(a.hasClass(this._htBlogMetaConf["UI_SELECTED"])){return}this._selectScrapTypeBtn(a);this._updateScrapTypeModel()},_selectScrapTypeBtn:function(a){var b=this._htBlogMetaConf["UI_SELECTED"];var c=this._htElement.$elScrapTypeSelectLayer.find("button");c.removeClass(b);a.addClass(b);this._htElement.$elScrapTypeSelectBtn.text(a.text())},_toggleScrapTypeSelectLayer:function(a){var b=this._htBlogMetaConf["UI_ON"];var c=this._htElement.$elScrapTypeSelectLayer;a=a===undefined?!c.hasClass(b):a;c.toggleClass(b,a)},_assignLabelCommonWithEvent:function(){var a=this._htToggleOptionMap;var b=this._htElement;var c;var d;var e;var f;var g;for(c in a){if(!a.hasOwnProperty(c)){continue}d=$SE_STRING.capitalize(c);e=a[c];if(!e.isNotSequential){g=$('input[data-modelprop="'+c+'"]',this._$elSettingLayer);if(g[0]){b["$el"+d+"Checkbox"]=g;b["$el"+d+"Label"]=$('label[for="'+g.attr("id")+'"]',this._$elSettingLayer)}}if(!e.isNotCommonEvent){f=e.htToggleOption;this._attachEventOnElement(d+"Label","click",this._onClickLabelCommon(f).bind(this))}}},_attachEventOnElement:function(a){var b=Array.prototype.slice;var c=this._htElement;var d=c["$el"+a];var e=b.call(arguments,1);if(!d||!d[0]){return}var f=e.length-1;var g=e[f];e[f]=function(a){var b=$(a.currentTarget);if(!b.hasClass(this._htBlogMetaConf.UI_DISABLED)){g.apply(this,arguments)}}.bind(this);d.on.apply(d,e);this._aHandledElementName.push(a)},_unbindEvent:function(){var a;var b=this._aHandledElementName.length;var c;for(a=b;a--;){c=this._htElement["$el"+this._aHandledElementName[a]];c.off()}this._aHandledElementName=[]},_initDatePicker:function(){var a=this._oModel.getLocalPostingTime();$SE_COMMON_UTIL.createDatepicker(this._htElement.$elDate,{minDate:this._getMinMaxDateForDatepicker($SE_CONFIG.ENV_SETTING.SERVER_TIME),maxDate:this._getMinMaxDateForDatepicker($SE_CONFIG.ENV_SETTING.SERVER_TIME,true),currentDate:this._getMinMaxDateForDatepicker(a||$SE_CONFIG.ENV_SETTING.SERVER_TIME),onSelect:this._onSelectDatePicker.bind(this)});var b=$("#ui-datepicker-div");b.on("click",this._fStopPropagation);this._htElement.$elCalendar=b},_setToggleOptionMap:function(){this._htToggleOptionMap={sendToNaverBookYn:{htToggleOption:{htClass:{fnAdditionalOn:this._setThemeSourceCode.bind(this,{bFill:true}),fnAdditionalOff:function(){this._setThemeSourceCode()}.bind(this)}}},commentYn:{},sympathyYn:{},showCclYn:{htToggleOption:{htClass:{fnAdditionalOn:this._getToggleCclSpecifyEnablementMethod(true),fnAdditionalOff:this._getToggleCclSpecifyEnablementMethod(false)}}},searchYn:{htToggleOption:{htClass:{fnAdditionalOn:this._getToggleSearchYnAdditionalMethod(true),fnAdditionalOff:this._getToggleSearchYnAdditionalMethod(false)}}},scrapTypeYn:{htToggleOption:{htClass:{fnAdditionalOn:this._getToggleScrapTypeSpecifyEnablementMethod(true),fnAdditionalOff:this._getToggleScrapTypeSpecifyEnablementMethod(false)}}},outSideAllowYn:{},noticePostYn:{isNotCommonEvent:true},continueSaved:{},autoByCategoryYn:{htToggleOption:{htClass:{bSkipUpdateModel:true}}}}},_toggleOption:function(a,b){if(!a){return}b=b||{htClass:{}};var c=b.htClass;if(c){this._toggleClass(a,c)}var d=b.htDisplay;if(d){this._toggleDisplay(a,d)}},_toggleClass:function(a,b){var c=b&&typeof b.sCondition==="string"?b.sCondition:this._htBlogMetaConf.UI_CHECKED;var d=b&&typeof b.fnOn==="function"?b.fnOn:null;var e=b&&typeof b.fnOff==="function"?b.fnOff:null;var f=b&&typeof b.sStatus==="string"?b.sStatus:null;var g=b&&typeof b.fnAdditionalOn==="function"?b.fnAdditionalOn:null;var h=b&&typeof b.fnAdditionalOff==="function"?b.fnAdditionalOff:null;this._setModelInfoToOption(a,"sModelProp",b);this._setModelInfoToOption(a,"vModelValueOn",b);this._setModelInfoToOption(a,"vModelValueOff",b);var i;if(f){i=f===this._htBlogMetaConf.STATUS.ON;
}else{i=!a.hasClass(c)}if(i){if(typeof d==="function"){d()}else{this._classOn(a,c,b)}if(typeof g==="function"){g()}}else{if(typeof e==="function"){e()}else{this._classOff(a,c,b)}if(typeof h==="function"){h()}}},_classOn:function(a,b,c){if(a.hasClass(b)){return}a.addClass(b);var d=c&&c.bSkipUpdateModel?c.bSkipUpdateModel:false;if(!d){var e=c?c.sModelProp:null;var f=c&&typeof c.vModelValueOn!=="undefined"?c.vModelValueOn:true;if(e){this._updateModel(e,f)}}},_classOff:function(a,b,c){if(!a.hasClass(b)){return}a.removeClass(b);var d=c&&c.bSkipUpdateModel?c.bSkipUpdateModel:false;if(!d){var e=c?c.sModelProp:null;var f=c&&typeof c.vModelValueOff!=="undefined"?c.vModelValueOff:false;if(e){this._updateModel(e,f)}}},_setOptionEnablement:function(a,b){var c=a[0];if(!c){return}var d=b&&typeof b.sClassDisabled!=="undefined"?b.sClassDisabled:this._htBlogMetaConf.UI_DISABLED;var e=b&&typeof b.isToBeOn!=="undefined"?b.isToBeOn:true;if(e){a.removeClass(d)}else{a.addClass(d)}var f;if(c.tagName.toUpperCase()==="INPUT"){f=$('label[for="'+a.attr("id")+'"]')}if(f&&f[0]){if(e){f.removeClass(d)}else{f.addClass(d)}}},_toggleDisplay:function(a,b){var c=b&&typeof b.sCondition==="string"?b.sCondition:"block";var d=b&&typeof b.fnOn==="function"?b.fnOn:null;var e=b&&typeof b.fnOff==="function"?b.fnOff:null;var f=b&&typeof b.sStatus==="string"?b.sStatus:null;var g=b&&typeof b.fnAdditionalOn==="function"?b.fnAdditionalOn:null;var h=b&&typeof b.fnAdditionalOff==="function"?b.fnAdditionalOff:null;var i;if(f){i=f===this._htBlogMetaConf.STATUS.ON}else{i=a.css("display")==="none"}if(i){if(typeof d==="function"){d()}else{this._displayOn(a,c)}if(typeof g==="function"){g()}}else{if(typeof e==="function"){e()}else{this._displayOff(a)}if(typeof h==="function"){h()}}},_displayOn:function(a,b){if(a){a.css("display",b||"block")}},_displayOff:function(a){if(a){a.css("display","none")}},_updateModel:function(a,b){a=$SE_STRING.capitalize(a);this._oModel["set"+a](b)},_setModelInfoToOption:function(a,b,c,d){if(arguments.length===3){d=b.slice(1).toLowerCase()}if(!d){return}var e=a.data(d);if(typeof e==="undefined"){return}var f=e;if(typeof c[b]==="undefined"&&typeof f!=="undefined"){c[b]=f}},_nClick:function(a){var b=a[0];if(!b){return}var c=a.data("nclick");if(!c){return}clickcr(b,c,"","")},_collenctAndNClick:function(){var a=this._htElement;var b={continueSaved:a.$elContinueSavedCheckbox,twitterPostingYn:a.$elTwitterPostingYnBtn,facebookPostingYn:a.$elFacebookPostingYnBtn};var c;var d;var e;var f;for(c in b){if(!b.hasOwnProperty(c)){continue}d=$SE_STRING.capitalize(c);e=this._oModel["get"+d]();if(e===true){f=b[c];this._nClick(f)}}var g=["openType"];var h;var i;for(h=g.length;h--;){i=g[h];d=$SE_STRING.capitalize(i);e=this._oModel["get"+d]();f=$('[data-modelprop="'+i+'"][data-modelvalueon="'+e+'"]');this._nClick(f)}},_onSelectDatePicker:function(a){this._htElement.$elDate[0].value=a;var b=this._oModel.getLocalPostingTime();var c=$SE_TIME_UTIL.getPostingTimeFromDatepicker(a,b);this._updateModel("localPostingTime",c);this._validateReserveTime({bSkipInvalidUI:true})},_onClickLayer:function(a){var b=a.target;var c=$(b);var d=c.hasClass("slt_belong")?c:c.parents("div.slt_belong");if(!d[0]&&this._htElement.$elDropdownListWrapper.css("display")!=="none"){this._toggleDropdownListWrapper(false)}var e=c.parents("button.btn_more");var f=c.hasClass("ly_ccl")?c:c.parents("div.ly_ccl");if(!e[0]&&!f[0]&&this._htElement.$elCclSpecifyWrapper.hasClass(this._htBlogMetaConf.UI_ON)){this._toggleCclSpecifyWrapper(false)}if(!c.hasClass("__se_select_scrap_type_btn")){this._toggleScrapTypeSelectLayer(false)}},_onClickNoticePostLabel:function(a){var b=a.currentTarget;var c=this._getLinkedInputWithLabel(b,true);this._toggleOption(c,{htClass:{fnOn:this._requestNoticePostList.bind(this,c)}})},_onClickDropdownBtn:function(a){var b=a.target;var c=$(b);this._toggleOption(c,{htClass:{bSkipUpdateModel:true,sCondition:this._htBlogMetaConf.UI_ACTIVE}});this._toggleDropdownListWrapper()},_onClickDropdownListWrapper:function(a){this._clearMaterialInfo();this._updateModel("categorySetManuallyYn",true);var b=a.currentTarget;this._updateCategory({elListItem:b});this._toggleOption(this._htElement.$elDropdownBtn,{htClass:{sCondition:this._htBlogMetaConf.UI_ACTIVE},fnOff:function(){}});this._toggleDropdownListWrapper();a.preventDefault()},_onClickDirectory:function(a){this._nClick($(a.currentTarget));this._toggleDirectoryListWrapper()},_onClickDirectoryListWrapper:function(a){var b=a.delegateTarget;var c=a.currentTarget;var d=this._getIdFromLabel(c);if(d==="chk_item13"){return}this._selectRadioInWrapper({elWrapper:b,elLabel:c,htToggleOption:{htClass:{bSkipUpdateModel:true}}})},_onClickDirectoryApplyBtn:function(){this._updateModel("directorySetManuallyYn",true);var a=$("input."+this._htBlogMetaConf.UI_CHECKED,this._htElement.$elDirectoryListWrapper);var b=a.data("modelvalueon");if(this._isLinkedToMaterial(b)){this._updateModel("directoryLinkedToMaterialYn",true);this._updateModel("directorySeq",b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.UPDATE_REPRESENTATIVE_MATERIAL);var c=this._oModel.getDirectoryTitle();this._updateDirectory(b,c)}else{this._clearMaterialInfo();this._updateDirectory(b)}this._toggleDirectoryListWrapper(false,{bSaveUIStatus:true})},_isLinkedToMaterial:function(a){var b=this._htBlogMetaConf.DIRECTORY_DATA;var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_FIRST_MATERIAL);var d=c?c.type:"";return a===parseInt(b.BOOK.DIRECTORY_SEQUENCE,10)&&d===b.BOOK.TYPE||a===parseInt(b.MOVIE.DIRECTORY_SEQUENCE,10)&&d===b.MOVIE.TYPE||a===parseInt(b.BROADCAST.DIRECTORY_SEQUENCE,10)&&d==="broadcast"||a===parseInt(b.MUSIC.DIRECTORY_SEQUENCE,10)&&d===b.MUSIC.TYPE||a===parseInt(b.SHOPPING.DIRECTORY_SEQUENCE,10)&&d==="shopping"},_onClickDirectoryCancelBtn:function(){this._toggleDirectoryListWrapper()},_onClickRadioWrapperCommon:function(a){return function(b){var c=b.delegateTarget;var d=b.currentTarget;this._selectRadioInWrapper({elWrapper:c,elLabel:d,htToggleOption:a})}},_onClickLabelCommon:function(a){return function(b){var c=this._getIdFromLabel(b.currentTarget);var d=$("input#"+c);if(d.hasClass(this._htBlogMetaConf.UI_DISABLED)){return}this._toggleOption(d,a)}},_onClickOpenLevelList:function(a){this._updateOpenType({elLabel:a.currentTarget})},_onClickCancelReservation:function(a){if(this._htElement.$elReservationWrapper.is(":visible")){this._nClick($(a.currentTarget));var b=this._htElement.$elInvalidReservationIndicator;var c=this._htBlogMetaConf.UI_ERROR;if(b.hasClass(c)){this._updateModel("localPostingTime",null);var d=this._getReserveTime({isLatest:true});this._setReserveTimeOnLayer(d);this._updateModel("localPostingTime",d);b.removeClass(c)}this._hideReservationWrapper()}},_onClickCclSpecifyBtn:function(a){this._stopPropagation(a);this._toggleCclSpecifyWrapper()},_onClickCclSpecifyApplyBtn:function(){this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO,sMode:this._htBlogMetaConf.MODE.SET,sClassSelected:this._htBlogMetaConf.UI_CHECKED,elWrapper:this._htElement.$elCommercialUsesYnWrapper});this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO,sMode:this._htBlogMetaConf.MODE.SET,sClassSelected:this._htBlogMetaConf.UI_CHECKED,elWrapper:this._htElement.$elContentsModificationWrapper});this._toggleCclSpecifyWrapper(false,{bSaveUIStatus:true})},_onClickCclSpecifyCancelBtn:function(){this._toggleCclSpecifyWrapper()},_onClickPublishBtn:function(a){this._nClick($(a.currentTarget));this._collenctAndNClick();if(this._oModel.getPostingTime()){this._requestServerTime(this._publish.bind(this))}else{this._publish()}},_onClickReserveBtn:function(a){if(!this._htElement.$elReservationWrapper.is(":visible")){this._nClick($(a.currentTarget));this._requestServerTime(this._showReservationWrapper.bind(this))}},_onClickSnsBtnWrapperBtn:function(a){var b=a.currentTarget;var c=$(b);var d=this._getSnsType(c);this._toggleOption(c,{htClass:{sCondition:this._htBlogMetaConf.UI_SELECTED,fnOn:this._getPublishSnsMethod(d,c,true)}})},_onChangeHourMinute:function(a){var b=a.currentTarget;var c=$(b);var d=b.value;var e=this._getReserveTime();var f=moment(e);var g=parseInt(d);if(c.hasClass("hour")){f.hour(g)}else if(c.hasClass("minutes")){f.minute(g)}e=f.format(this._sFullTimeFormat);this._updateModel("localPostingTime",e);this._validateReserveTime({bSkipInvalidUI:true})},_onFocusDate:function(a){var b=a.currentTarget;var c=$(b);c.trigger("blur")},_stopPropagation:function(a){a.stopPropagation()},_publish:function(){if(!this.isValid()){return}this._setKoreaBasedPostingTime();this.close();this.trigger("onGetDocumentTitleComp");this.trigger("onGetTag");this.trigger("onPublishDocument",{oMetaData:this._oModel})},_getPublishSnsMethod:function(a,b,c){return function(){this._publishSns(a,b,c)}.bind(this)},_publishSns:function(a,b,c){if(!a){return}var d=$SE_CONFIG.ENV_SETTING["IS_"+a.toUpperCase()+"_LINKED"];if(d===true){this._publishSnsOn(b);return}if(!c){return}var e=this._htBlogMetaConf.API.OAUTH_CALLBACK.replace(/\{\{sOrigin}}/,location.origin).replace(/\{\{sSns}}/,a);e=encodeURIComponent(e);var f=this._htBlogMetaConf.API.OAUTH.replace(/\{\{sSns}}/g,a).replace(/\{\{sServiceKey}}/,$SE_CONFIG.ENV_SETTING.SERVICE_NAME).replace(/\{\{sOAuthCallbackAPI}}/,e);$SE_SNS_HELPER.setCallback(a,function(){$SE_CONFIG.ENV_SETTING["IS_"+a.toUpperCase()+"_LINKED"]=true;this._publishSnsOn(b)}.bind(this));window.open(f,"snsAuthPopup","status=no,menubar=no,scrollbars=yes,resizable=no,width=360,height=360")},_getSnsType:function(a){var b;if(a.hasClass("twt")){b="twitter"}else if(a.hasClass("fb")){b="facebook"}return b},_publishSnsOn:function(a){this._toggleOption(a,{htClass:{sStatus:this._htBlogMetaConf.STATUS.ON,sCondition:this._htBlogMetaConf.UI_SELECTED}})},_requestNoticePostList:function(a){var b=this._htBlogMetaConf.API.NOTICE_POST_LIST;var c=$SE_AJAX.showError;var d=function(b){if(!b.isSuccess||!b.result||!b.result.postList){c();return}var d=b.result.postList;var e=d.length;var f=this._htBlogMetaConf.MAX_NOTICE_POST_LENGTH;var g;if(e>=f){g=$SE_STRING.processTemplate(se.i18n.getMsg("MSG_EXCEED_MAX_NOTICE_POST_LENGTH"),{MAXLENGTH:f});$(document.body).ntoast("setMessage",g);$(document.body).ntoast("popupToast");return}this._toggleOption(a,{htClass:{sStatus:this._htBlogMetaConf.STATUS.ON}})};$SE_AJAX.request(b,{fSuccess:d.bind(this),fFail:c,fError:c})},_requestServerTime:function(a){this._nServerTimestamp=null;var b=this._htBlogMetaConf.API.CURRENT_SERVER_TIME;var c=function(){this._nServerTimestamp=(new Date).getTime();a()}.bind(this);var d=function(b){if(!b.isSuccess||!b.result||typeof b.result!=="number"){c();return}this._nServerTimestamp=b.result;a()};$SE_AJAX.request(b,{bShowErrorModal:false,fSuccess:d.bind(this),fFail:c,fError:c})},_toggleDirectoryListWrapper:function(a,b){var c={htDisplay:{fnAdditionalOff:!(b&&b.bSaveUIStatus)?this._restoreDirectory.bind(this):null}};if(typeof a!=="undefined"){if(a){c.htDisplay.sStatus=this._htBlogMetaConf.STATUS.ON}else{c.htDisplay.sStatus=this._htBlogMetaConf.STATUS.OFF}}this._toggleOption(this._htElement.$elDirectoryListWrapper,c)},_drawLayer:function(){var a=this._oModel.getJson();var b=$SE_CONFIG.USER_INFO;var c={};var d=b.categoryList;if(d){c.categoryList=d}var e=b.directoryList;if(e){c.directoryGroupList=e.directoryGroupList}if(a.targetUserId){c.continueSaved=false}c.isOnModification=$SE_CONFIG.SERVICE_CONFIG.IS_ON_MODIFICATION;c.useCclYn=a.cclYn&&!a.targetUserId;var f=a.localPostingTime;var g=a.prePostRegistDirectly;if(f&&!g){a.reservationDate=c.postingDate=$SE_TIME_UTIL.getPostingYMDForDatepicker(f)}a.checkSendToNaverService=this._determineCheckSendToNaverService();a=$.extend(c,a);a.hoursTmp=[];this._getFormattedHMs(a.hoursTmp,23,{sMode:this._htBlogMetaConf.TIME.HOUR});a.minutesTmp=[];this._getFormattedHMs(a.minutesTmp,5,{sMode:this._htBlogMetaConf.TIME.MINUTE});a.scrapTypeYn=a.openType!==0&&a.scrapType!==0;this._$elSettingLayer.html(this._fTemplate(a))},_getMinMaxDateForDatepicker:function(a,b){var c=moment(a);if(b){c=c.add(365,"days")}return new Date(c.valueOf())},_showLayer:function(){this._$elSettingLayer=$("#se_top_publish_setting_layer");this._$elSettingLayer.show()},_hideLayer:function(){this._htElement.$elDate.datepicker("hide");this._$elSettingLayer.html("").hide()},_showReservationWrapper:function(){var a;var b;if(this._nServerTimestamp){b=$SE_TIME_UTIL.getFirstMinuteCeiledTimestamp(this._nServerTimestamp);a=moment(b).format("YYYY-MM-DD HH:mm")}else{a=this._getReserveTime()}this._htElement.$elDate.datepicker("option","minDate",this._getMinMaxDateForDatepicker(a));this._htElement.$elDate.datepicker("option","maxDate",this._getMinMaxDateForDatepicker(a,true));this._setReserveTimeOnLayer(a);this._updateModel("localPostingTime",a);this._updateModel("prePostRegistDirectly",false);this._htElement.$elReservationWrapper.show()},_hideReservationWrapper:function(){this._updateModel("prePostRegistDirectly",true);this._htElement.$elReservationWrapper.hide()},_getToggleCclSpecifyEnablementMethod:function(a){return function(){this._onToggleCclSpecifyEnablement(a)}.bind(this)},_onToggleCclSpecifyEnablement:function(a){var b=this._htElement.$elCclSpecifyBtn;if(a){this._selectRadioInWrapper({elWrapper:this._htElement.$elCommercialUsesYnWrapper,htToggleOption:{htClass:{vModelValueOn:false}}});this._selectRadioInWrapper({elWrapper:this._htElement.$elContentsModificationWrapper,htToggleOption:{htClass:{vModelValueOn:0}}})}else{this._toggleCclSpecifyWrapper(false);this._updateModel("commercialUsesYn",null);this._updateModel("contentsModification",null)}this._setOptionEnablement(b,{isToBeOn:a})},_getToggleSearchYnAdditionalMethod:function(a){return function(){this._toggleSendToNaverServiceMethod(a)}.bind(this)},_toggleSendToNaverServiceMethod:function(a){var b=["sendToNaverBookYn"];var c;var d=[];if(a){if($SE_CONFIG.SERVICE_CONFIG.LOCK_SERVICE_LINK_CHECK_BLOG){d=["sendToNaverBookYn"]}if(d.length>0){this._setEnablement(d,{sMode:this._htBlogMetaConf.STATUS.ON})}if(this._oModel.getEnableSendToNaverService()===false){return}c=this._htBlogMetaConf.STATUS.ENABLED}else{c=this._htBlogMetaConf.STATUS.DISABLED}this._setEnablement(b,{sMode:c})},_determineScrapType:function(){if(this._oModel.getScrapTypeYn()===false){this._updateModel("scrapType",0)}},_determineCheckSendToNaverService:function(){var a=this._oModel;var b=a.getThemeSourceCode();if($SE_CONFIG.SERVICE_CONFIG.IS_ON_MODIFICATION){return a.getCheckSendToNaverService()}return b&&b!=="0"},_getToggleScrapTypeSpecifyEnablementMethod:function(a){return function(){this._toggleScrapTypeSpecifyEnablementMethod(a)}.bind(this)},_toggleScrapTypeSpecifyEnablementMethod:function(a){this._setOptionEnablement(this._htElement.$elScrapTypeSelectBtn,{isToBeOn:a});if(a===true){this._updateScrapTypeModel()}else{this._updateModel("scrapType",0)}},_updateScrapTypeModel:function(){var a=this._getSelectedScrapType();var b=a.data("modelvalueon");this._updateModel("scrapType",b)},_getSelectedScrapType:function(){return $(".is-selected",this._htElement.$elScrapTypeSelectLayer)},_setReserveTimeOnLayer:function(a){var b;var c;var d;if(a){d=a.match(this._rxHHMM)}if(d&&d.length>-1){b=d[1];c=d[3]}var e=$SE_TIME_UTIL.getPostingYMDForDatepicker(a);this._htElement.$elDate[0].value=e;this._htElement.$elHour[0].selectedIndex=b?parseInt(b,10):oDate.getHours();this._htElement.$elMinute[0].selectedIndex=c?parseInt(c,10)/10:Math.ceil(oDate.getMinutes()/10)%6*10},_getReserveTimestamp:function(){var a=this._oModel.getLocalPostingTime();if(!a){return}var b=moment(a);b.millisecond(0);return b.valueOf()},_getFormattedYmdFromTimestamp:function(a,b,c,d){var e=""+a;var f=""+b;var g=""+c;if(b<10){f="0"+f}if(c<10){g="0"+g}var h=d?"-":".";return e+h+f+h+g},_getReserveTimeFromTimestamp:function(){var a=$SE_TIME_UTIL.getFirstMinuteCeiledTimestamp();var b=new Date(a);var c=this._getFormattedYmdFromTimestamp(b.getFullYear(),b.getMonth()+1,b.getDate(),true);var d;var e;d=e=b.getMinutes();if(e===0){d="0"+e}var f;var g;f=g=b.getHours();if(g<10){f="0"+f}var h=c+" "+f+":"+d;return h},_getReserveTime:function(a){a=a||{};var b=a.isLatest;var c=this._oModel.getLocalPostingTime();if(!c||b){c=this._getReserveTimeFromTimestamp()}return c},_getFormattedHMs:function(a,b,c){var d=/^1/;var e=c?c.sMode:null;var f=0;var g=b+1;var h;if(e===this._htBlogMetaConf.TIME.HOUR){for(;f<g;f++){h=(""+(100+f)).replace(d,"");a.push(h)}}else if(e===this._htBlogMetaConf.TIME.MINUTE){for(;f<g;f++){h=(""+(10+f)).replace(d,"")+"0";a.push(h)}}},_setKoreaBasedPostingTime:function(){var a=this._oModel.getLocalPostingTime();var b=$SE_TIME_UTIL.getKoreanTimezoneSwitchedMoment(true,{base:a,format:this._sFullTimeFormat});this._updateModel("postingTime",b)},_toggleDropdownListWrapper:function(a){var b={htDisplay:{fnAdditionalOn:this._updateDropdownListStatus.bind(this,true),fnAdditionalOff:this._updateDropdownListStatus.bind(this,false)}};if(typeof a!=="undefined"){if(a){b.htDisplay.sStatus=this._htBlogMetaConf.STATUS.ON}else{b.htDisplay.sStatus=this._htBlogMetaConf.STATUS.OFF}}this._toggleOption(this._htElement.$elDropdownListWrapper,b);var c=this._htElement.$elDropdownListWrapper;var d=this._htElement.$elDropdownList;var e;if(c.css("display")!=="none"){d.scrollTo("li.lst."+this._htBlogMetaConf.UI_SELECTED)}},_clearMaterialInfo:function(){this._updateModel("directoryLinkedToMaterialYn",false);this._updateModel("directoryTitle",null);this._updateModel("directoryDetail",null);this._updateModel("bookThemeInfoPk",null);this._updateModel("movieThemeInfoPk",null)},_updateDropdownListStatus:function(a){var b=this._htElement.$elDropdownListStatus;if(a){b.html(this._htBlogMetaConf.STATUS.DROPDOWN_OPENED)}else{b.html(this._htBlogMetaConf.STATUS.DROPDOWN_CLOSED)}},_toggleCclSpecifyWrapper:function(a,b){var c={htClass:{fnAdditionalOff:!(b&&b.bSaveUIStatus)?this._restoreCclSpecify.bind(this):null,sCondition:this._htBlogMetaConf.UI_ON}};if(typeof a!=="undefined"){if(a){c.htClass.sStatus=this._htBlogMetaConf.STATUS.ON}else{c.htClass.sStatus=this._htBlogMetaConf.STATUS.OFF}}this._toggleOption(this._htElement.$elCclSpecifyWrapper,c)},_getIdFromLabel:function(a){var b=$(a);var c=b.attr("for");return c},_getLinkedInputWithLabel:function(a,b){var c=this._getIdFromLabel(a);var d=$("input#"+c);var e=b?d:d[0];return e},_getInputByModelProp:function(a,b){var c=$('input[data-modelprop="'+a+'"]');var d=b?c:c[0];return d},_updateDirectory:function(a,b){var c=$("label[for=seq"+a+"]",this._htElement.$elDirectoryListWrapper);var d=c.html()||this._htBlogMetaConf.NO_CATEGORY;if(this._htElement&&this._htElement.$elDirectory){this._htElement.$elDirectory.html("<span>"+d+"</span>")}var e=this._htElement.$elDirectoryListWrapper;this._selectRadioInWrapper({elWrapper:e,elLabel:c[0],htToggleOption:{htClass:{vModelValueOn:a}}});var f={sMode:this._htBlogMetaConf.MODE.SET,sClassSelected:this._htBlogMetaConf.UI_CHECKED,elWrapper:e};this._handleLastSelectedInput($.extend(f,{sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO}));this._handleLastSelectedInput($.extend(f,{sInputType:this._htBlogMetaConf.INPUT_TYPE.CHECKBOX,sModelProp:"autoByCategoryYn"}));this._updateDirectoryTitle(b);this._toggleDirectorySpecificOption(a,b)},_setThemeSourceCode:function(a){a=a||{};var b;if(a.bFill){b=this._oModel.getTempThemeSourceCode()}else{b=null}this._updateModel("themeSourceCode",b)},_toggleDirectorySpecificOption:function(a,b){var c=this._htElement.$elDirectorySpecificOptionWrapper;c.children("ul").hide();if(b){c.children('ul[data-directoryseq="'+a+'"]').show()}},_updateDirectoryTitle:function(a){var b=this._htElement;b.$elDirectoryTitle.html(a);var c=this._htBlogMetaConf.UI_SET;if(a){b.$elDirectory.addClass(c)}else{b.$elDirectory.removeClass(c)}},_getCategoryDataById:function(a){var b;var c;b=$SE_CONFIG.USER_INFO;if(b.categoryList){c=b.categoryList}var d;var e;for(d=c.length;d--;){e=c[d];if(e.categoryNo===a){return e}}},_updateCategory:function(a){var b=a.nCategoryId;var c=a.nDirectorySeq;var d=a.sDirectoryTitle;var e;var f;var g=this._htElement;var h=g.$elDropdownListWrapper;if(typeof b!=="undefined"){f=$('li[data-modelvalueon="'+b+'"]',h);e=f[0]}else{e=a.elListItem;f=$(e)}if(!e){return}if(typeof b==="undefined"){b=f.data("modelvalueon")}var i=this._htBlogMetaConf.UI_SELECTED;var j;var k=$("li."+i,h);if(k&&k[0]!==e){j=f.html();this._toggleOption(k,{htClass:{sCondition:i,sStatus:this._htBlogMetaConf.STATUS.OFF,bSkipUpdateModel:true}});this._toggleOption(f,{htClass:{sCondition:i,sStatus:this._htBlogMetaConf.STATUS.ON}});g.$elDropdownBtn.html(j)}var l=this._getCategoryDataById(b);if(typeof c==="undefined"&&l){c=l.directorySeq}if(typeof c==="number"){this._updateDirectory(c,d)}var m=l&&l.isOpen;if(m===false){var n=0;this._setEnablementByOpenType(n,{bUseOn:false});this._updateOpenType({nOpenType:n})}this._setOpenTypeClosedAllowedOnly(m)},_setOpenTypeClosedAllowedOnly:function(a){if(this._oModel.getTargetUserId()){return}var b=this._htElement;var c=$('input:not([id="lv_public_4"]), label:not([for="lv_public_4"])',b.$elOpenLevelList);if(a){c.removeClass(this._htBlogMetaConf.UI_DISABLED)}else{c.addClass(this._htBlogMetaConf.UI_DISABLED)}},_updateOpenType:function(a,b){a=a||{};var c=a.nOpenType;var d=a.elLabel;var e=this._htElement;var f=this._$elOpenLevelListWrapper;if(!d){if(typeof c==="undefined"){return}d=$('label[data-modelvalueon="'+c+'"]',this._$elOpenLevelListWrapper)[0]}this._selectRadioInWrapper({elWrapper:this._$elOpenLevelListWrapper,elLabel:d,htToggleOption:{htClass:{vModelValueOn:c}}});var g;if(typeof c!=="number"&&d){g=this._getLinkedInputWithLabel(d,true);c=g.data("modelvalueon")}this._updateOpenTypeLabel(c);b=b||{};this._setEnablementByOpenType(c,b);this._nPreviousOpenType=c},_updateOpenTypeLabel:function(a){var b="MSG_BLOG_META_OPEN_TYPE_DESC_";this._$elSettingLayer.find(".__se_openType_label").text(se.i18n.getMsg($SE_CONFIG.LOCALE.KO,b+a))},_setEnablementByOpenType:function(a,b){var c=this._htElement;var d=b&&typeof b.bUseEnable!=="undefined"?b.bUseEnable:true;var e=b&&typeof b.bUseDisable!=="undefined"?b.bUseDisable:true;var f=b&&typeof b.bUseOn!=="undefined"?b.bUseOn:true;var g=b&&typeof b.isOnActivate!=="undefined"?b.isOnActivate:false;var h=this._getOpenTypeEnablementSet(a).aEnabled;var i=this._getOpenTypeEnablementSet(a).aDisabled;var j=this._getOpenTypeEnablementSet(a).aOn;if(d){this._setEnablement(h,{sMode:this._htBlogMetaConf.STATUS.ENABLED})}if(e){this._setEnablement(i,{sMode:this._htBlogMetaConf.STATUS.DISABLED})}if(f&&!g){this._setEnablement(j,{sMode:this._htBlogMetaConf.STATUS.ON})}},_setEnablement:function(a,b){if(!a){return}b=b||{};var c=b.sMode;var d=a.length;var e;var f;var g;var h;var i;for(;d--;){e=a[d];if(e==="facebookPostingYn"||e==="twitterPostingYn"){f=this._htElement["$el"+$SE_STRING.capitalize(e)+"Btn"]}else{f=this._getInputByModelProp(e,true)}if(c===this._htBlogMetaConf.STATUS.ENABLED){this._setOptionEnablement(f,{isToBeOn:true})}else{h={htClass:{sStatus:c===this._htBlogMetaConf.STATUS.DISABLED?this._htBlogMetaConf.STATUS.OFF:c}};i=$.extend(true,h,this._htToggleOptionMap[e]||{});g=this._getSnsType(f);if(g){i.htClass.sCondition=this._htBlogMetaConf.UI_SELECTED;if(c===this._htBlogMetaConf.STATUS.ON){i.htClass.fnOn=this._getPublishSnsMethod(g,f)}}else if(e==="searchYn"){if(c===this._htBlogMetaConf.STATUS.ON){i.htClass.fnAdditionalOn=this._getToggleSearchYnAdditionalMethod(true)}else if(c===this._htBlogMetaConf.STATUS.DISABLED){i.htClass.fnAdditionalOff=this._getToggleSearchYnAdditionalMethod(false)}}else if(e==="scrapTypeYn"){if(c===this._htBlogMetaConf.STATUS.ON){i.htClass.fnAdditionalOn=this._getToggleScrapTypeSpecifyEnablementMethod(true)}else if(c===this._htBlogMetaConf.STATUS.DISABLED){i.htClass.fnAdditionalOff=this._getToggleScrapTypeSpecifyEnablementMethod(false)}}this._toggleOption(f,i);if(c===this._htBlogMetaConf.STATUS.DISABLED){this._setOptionEnablement(f,{isToBeOn:false})}}}},_getOpenTypeEnablementSet:function(a){var b={0:{aEnabled:["commentYn","showCclYn"],aDisabled:["sympathyYn","searchYn","scrapTypeYn","outSideAllowYn","facebookPostingYn","twitterPostingYn","noticePostYn"]},1:{aEnabled:["commentYn","sympathyYn","showCclYn","scrapTypeYn","noticePostYn"],aDisabled:["searchYn","outSideAllowYn","facebookPostingYn","twitterPostingYn"]},2:{aOn:["searchYn"],aEnabled:["commentYn","sympathyYn","showCclYn","scrapTypeYn","searchYn","outSideAllowYn","facebookPostingYn","twitterPostingYn","noticePostYn"]},3:{aEnabled:["commentYn","sympathyYn","showCclYn","scrapTypeYn","noticePostYn"],aDisabled:["searchYn","outSideAllowYn","facebookPostingYn","twitterPostingYn"]}};var c=b[a];c.aOn=c.aOn||[];if(a!==0&&this._nPreviousOpenType===0){c.aOn.push("scrapTypeYn")}return c},_selectRadioInWrapper:function(a){var b=$.extend(true,{htClass:{fnOff:function(){}}},a.htToggleOption);var c=b.htClass.vModelValueOn;var d=a.elWrapper;var e=a.sClass||this._htBlogMetaConf.UI_CHECKED;var f=a.elLabel;var g=a.$elTargetInput;var h;if(typeof g==="undefined"){if(typeof c!=="undefined"){g=$('input[data-modelvalueon="'+c+'"]',d)}else if(f){g=this._getLinkedInputWithLabel(f,true)}}if(!g||!g[0]||g.attr("type")!=="radio"){return}if(typeof c==="undefined"){c=g.data("modelvalueon");b.htClass.vModelValueOn=c}var i=$("input."+e+'[type="'+this._htBlogMetaConf.INPUT_TYPE.RADIO+'"]',d);i.removeClass(e);this._toggleOption(g,b)},_handleLastSelectedInput:function(a){var b=a.elWrapper;var c=a.sClassSelected;var d=a.sInputType;var e=a.sModelProp;var f=a.sMode;var g=this._getInputSelector(a);var h=$(g,b);if(!h||!h[0]){return}var i;if(f===this._htBlogMetaConf.MODE.SET){if(!e){e=h.data("modelprop")}var j;if(d===this._htBlogMetaConf.INPUT_TYPE.CHECKBOX){j=h.hasClass(c)}else{j=h.data("modelvalueon")}this._updateModel(e,j);if(d===this._htBlogMetaConf.INPUT_TYPE.RADIO){this._markLatestSelected(h,b)}else if(d===this._htBlogMetaConf.INPUT_TYPE.CHECKBOX){i=this._htBlogMetaConf.UI_WAS_ON;if(j){h.addClass(i)}else{h.removeClass(i)}}}else if(f===this._htBlogMetaConf.MODE.RESTORE){if(d===this._htBlogMetaConf.INPUT_TYPE.RADIO){this._selectRadioInWrapper({elWrapper:b,$elTargetInput:h,htToggleOption:{htClass:{bSkipUpdateModel:true}}})}else if(d===this._htBlogMetaConf.INPUT_TYPE.CHECKBOX){i=this._htBlogMetaConf.UI_WAS_ON;var k={htClass:{bSkipUpdateModel:true}};if(h.hasClass(i)){k.htClass.sStatus=this._htBlogMetaConf.STATUS.ON}else{k.htClass.sStatus=this._htBlogMetaConf.STATUS.OFF}this._toggleOption(h,k)}}},_getInputSelector:function(a){var b=a.sClassSelected;var c=a.sInputType;var d=a.sModelProp;var e="input";if(c===this._htBlogMetaConf.INPUT_TYPE.RADIO){if(b){e+="."+b}}if(d){e+='[data-modelprop="'+d+'"]'}e+='[type="'+c+'"]';return e},_markLatestSelected:function(a,b){var c=this._htBlogMetaConf.UI_LATEST;var d=$("input."+c,b);if(d[0]){d.removeClass(c)}a.addClass(c);this._selectRadioInWrapper({elWrapper:b,$elTargetInput:a,htToggleOption:{htClass:{bSkipUpdateModel:true}}})},_restoreCclSpecify:function(){this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO,sMode:this._htBlogMetaConf.MODE.RESTORE,sClassSelected:this._htBlogMetaConf.UI_LATEST,elWrapper:this._htElement.$elCommercialUsesYnWrapper});this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO,sMode:this._htBlogMetaConf.MODE.RESTORE,sClassSelected:this._htBlogMetaConf.UI_LATEST,elWrapper:this._htElement.$elContentsModificationWrapper})},_restoreDirectory:function(){this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.RADIO,sMode:this._htBlogMetaConf.MODE.RESTORE,sClassSelected:this._htBlogMetaConf.UI_LATEST,elWrapper:this._htElement.$elDirectoryListWrapper});this._handleLastSelectedInput({sInputType:this._htBlogMetaConf.INPUT_TYPE.CHECKBOX,sMode:this._htBlogMetaConf.MODE.RESTORE,sModelProp:"autoByCategoryYn",elWrapper:this._htElement.$elDirectoryListWrapper})},setDocumentTitle:function(a){this._oModel.setTitle(a)},setTag:function(a){this._oModel.setTagList(a)},_setDirectoryLinkedToMaterial:function(){if(this._isLinkedToMaterial(this._oModel.getDirectorySeq())){this._updateModel("directoryLinkedToMaterialYn",true)}},open:function(){if(!this._htModel){this._htModel=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA)}this._$elBase.attr("data-isopen","open");this._$elLi.addClass("is-active");var a=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.POPUP,{content:"<div id='se_top_publish_setting_layer'></div>",afterOpen:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_OUT_FOCUSED);this._$elBtn.addClass("is-active");this._activateLayer()}.bind(this),beforeClose:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE);this._$elLi.removeClass("is-active");this._$elBtn.removeClass("is-active")}.bind(this),afterClose:function(){this._$elBase.attr("data-isopen","close");if(this._htElement&&this._htElement.$elCalendar){this._htElement.$elCalendar.hide()}}.bind(this)},this._$elBase);if($SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){this._setDirectoryLinkedToMaterial();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.UPDATE_REPRESENTATIVE_MATERIAL)}$SE_MODAL.open()},close:function(){this._$elBase.attr("data-isopen","close");$SE_MODAL.close()},_IMPL_onCheckValidate:function(a,b,c,d){var e=false;var f=false;var g=false;var h;var i;var j;i=function(){if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_CARD,0,"sectionTitle")}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_COMP_TYPE,$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE)}};j=function(){if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_CARD,1)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_COMP_TYPE,$SE_CONFIG.COMP_TYPE.PARAGRAPH)}};if(!a.valid){if(d){d()}if(!c){return false}h="MSG_EMPTY_CONTENTS";if(b){e=a.reason.title.empty;f=a.reason.contents.empty}else{f=a.reason.title.empty||a.reason.contents.empty;h="MSG_EMPTY_TITLE_OR_CONTENTS"}if(b&&e&&f){$(document.body).ntoast("setMessage",se.i18n.getMsg("MSG_EMPTY_TITLE_AND_CONTENTS"));$(document.body).ntoast("popupToast");setTimeout(function(){i();i=null},100)}else if(e){$(document.body).ntoast("setMessage",se.i18n.getMsg("MSG_EMPTY_TITLE"));$(document.body).ntoast("popupToast");setTimeout(function(){i();i=null},100)}else if(f){$(document.body).ntoast("setMessage",se.i18n.getMsg(h));$(document.body).ntoast("popupToast");setTimeout(function(){j();j=null},200)}return false}return true},_IMPL_onClickPublishBtn:function(a){a.preventDefault();a.stopPropagation();if(this._$elBase.attr("data-isopen")==="open"){this.close()}else{this.open()}},_IMPL_onAfterPublish:function(a){$(window).off("beforeunload");$SE_CONFIG.ENV_SETTING.PUBLISH_RETURN_URL=a&&a.returnUrl?a.returnUrl:"";if($SE_CONFIG.ENV_SETTING.PUBLISH_RETURN_URL&&$SE_CONFIG.ENV_SETTING.PUBLISH_RETURN_URL!==""){$SE_MEDIA.closeAll();this._redirect()}},_redirect:function(){location.href=$SE_CONFIG.ENV_SETTING.PUBLISH_RETURN_URL},_IMPL_onGetPublishMetaData:function(){this._oModel.setTags($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.GET_TAG_LIST));return this._oModel.getJson()}});se.defineComponent("se.DocumentToolbar",{construct:function(a){this._initVar();this._createFontFamilyButton(a);this._createLineHeightButton(a);this._assignElements(a);this._makeCardLayoutMenu();this.activate()},_initVar:function(){this._buttons=[];this._htPopupHandler={}},_assignElements:function(a){var b=$(a);this._$elDocTypeSelector=b.find(".__se_doc_type_selector");this._$elDocTypeList=b.find(".__se_doc_type_list");this._$elCardAdd=b.find(".__se_doc_add_card");this._$elLayoutMenu=b.find(".__se_doc_type_layout");this._$elAlign=b.find(".__se_doc_align");this._$elBase=b},_createFontFamilyButton:function(a){if($SE_CONFIG.SERVICE_CONFIG.FEATURES.DOCUMENT_FONT_FAMILY===false){return}this._buttons.push(new se.FontFamilyButton({$parent:a.find(".__document_toolbar"),template:se.editor.template.control["document-fontFamily-button.hbs"],callbacks:{onChanged:function(a){this.trigger("onChangeDocFont",{sFont:a});$SE_EVENT_UTIL.offBodyClickClose()}.bind(this)}}))},_createLineHeightButton:function(a){
if($SE_CONFIG.SERVICE_CONFIG.FEATURES.DOCUMENT_LINE_HEIGHT===false){return}this._buttons.push(new se.LineHeightButton({$parent:a.find(".__se_doc_line_height"),checker:$SE_CONFIG.SERVICE_CONFIG.DESKTOP_TOOLBAR.buttons.lineHeight.checker,callbacks:{onChange:function(a){this.trigger("onChangeDocLineHeight",{lineHeight:a});$SE_EVENT_UTIL.offBodyClickClose()}.bind(this)}}))},_bindEvent:function(){var a,b;this._$elDocTypeSelector.on("click",function(a){a.preventDefault();this._$elDocTypeSelector.addClass("is-active");$SE_EVENT_UTIL.onBodyClickClose({sSelector:".__se_doc_type_list",fnOtherClick:function(){this._$elDocTypeSelector.removeClass("is-active")}.bind(this)})}.bind(this));this._$elDocTypeList.on("click",".__se_doctype_btn",function(a){a.preventDefault();b=$(a.target).closest(".__se_doctype_btn");var c=b.data("doctype");this._changeDocType(c);$SE_EVENT_UTIL.offBodyClickClose()}.bind(this));this._$elAlign.on("click",".__se_align_btn",function(b){b.preventDefault();a=$(b.target).data("align");this.trigger("onChangeDocAlign",{sAlign:a})}.bind(this));if(this._$elCardAdd){$("#se_layout_menu_layer").on("click",".__se_layout_menu",function(a){a.preventDefault();var b=$(a.target).closest(".__se_layout_menu");var c=b.data("category");$SE_EVENT_UTIL.offBodyClickClose();this.trigger("onAddCard",{sCategory:c})}.bind(this));$("#se_layout_menu_layer").find(".__se_pop_close").on("click",function(a){a.preventDefault();$SE_EVENT_UTIL.offBodyClickClose()});this._$elCardAdd.on("click",function(a){a.preventDefault();this._$elLayoutMenu.addClass("is-on");$SE_EVENT_UTIL.onBodyClickClose({sSelector:"#se_layout_menu_layer",fnOtherClick:function(){this._$elLayoutMenu.removeClass("is-on")}.bind(this)})}.bind(this))}},_changeDocType:function(a){var b;if(a===$SE_CONFIG.ENV_SETTING.DOC_TYPE){return}b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.IS_EMPTY_DOCUMENT);if(!b&&!confirm(se.i18n.getMsg("MSG_CHANGE_TYPE_DOCUMENT"))){return}var c=function(){$SE_MEDIA.closeAll();$SE_CONFIG.ENV_SETTING.IS_ALLOW_EMPTY_CHECK=false;var a=document.location.href.replace(/\#(.+)?/g,"");a=a.replace(/[?&]docId=([^&]*)?/,"");if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){var b=new RegExp("[&|?]docType="+$SE_CONFIG.DOC_TYPE.CARD+"[&]?");document.location=a.replace(b,function(a){if(a.lastIndexOf("&")>0){return a.indexOf("&")===0?"&":"?"}return""})}else{document.location=a+(a.indexOf("?")>-1?"&":"?")+"docType="+$SE_CONFIG.DOC_TYPE.CARD}}.bind(this);if(!b){this.trigger("onTempSave",{fCallback:c})}else{c()}},_makeCardLayoutMenu:function(){if(this._$elLayoutMenu.length===0){return false}var a=$SE_MODEL_DATA_COORD.getCardLayoutMenuDefine();this._$elLayoutMenu.html(se.editor.template.control["cardlayout-menu.hbs"](a))},_unbindEvent:function(){$SE_EVENT_UTIL.offBodyClickClose();this._$elDocTypeSelector.off("click");this._$elAlign.off("click");if(this._$elCardAdd){this._$elCardAdd.off("click")}},activate:function(){this._bindEvent();this._buttons.forEach(function(a){a.activate()})},deactivate:function(){this._unbindEvent();this._buttons.forEach(function(a){a.deactivate()})}});se.defineComponent("se.FontFamilyButton",{construct:function(a){a=a||{};this._callbakcs=a.callbacks;this._render(a.$parent,a.template);this._assignElements(a.$parent)},_render:function(a,b){if(!a||!b){return}a.prepend(b())},_assignElements:function(a){this._$elFont=a.find(".__se_font_select");this._$elFontList=a.find(".__se_font_list")},_bindEvent:function(){this._$elFont.on("click",this._onClickButton.bind(this));this._$elFontList.on("click",".__se_font_list_item",this._onClickFontItem.bind(this))},_onClickButton:function(a){a.preventDefault();this._$elFont.addClass("is-active");$SE_EVENT_UTIL.onBodyClickClose({sSelector:".__se_font_list",fnOtherClick:function(){this._$elFont.removeClass("is-active")}.bind(this)})},_onClickFontItem:function(a){a.preventDefault();var b=$(a.target).closest(".__se_font_list_item");var c=b.data("font");this._callbakcs.onChanged.call(this,c)},_unbindEvent:function(){this._$elFont.off("click");this._$elFontList.off("click")},activate:function(){this._bindEvent()},deactivate:function(){this._unbindEvent()}});se.defineComponent("se.LineHeightButton",{construct:function(a){a=a||{};this._validator=a.checker.validator;this._minValue=a.minValue||50;this._onChange=a.callbacks.onChange;this._assignElements(a.$parent)},_assignElements:function(a){this._$elLineheightBtn=a;this._$elLineheightList=a.find(".__se_line_height_list");this._$inputCustom=a.find(".__se_custom");this._$applyCustom=a.find(".__se_submit")},_bindEvent:function(){this._$elLineheightBtn.on("click",".__se_line_height_btn",this._onClickButton.bind(this));this._$elLineheightList.on("click",".__se_option_btn",this._onClickItem.bind(this));this._$inputCustom.on("keyup",this._onKeyUpInput.bind(this));this._$applyCustom.on("click",this._onClickSubmitBtn.bind(this))},_onClickButton:function(a){a.preventDefault();this._$elLineheightBtn.addClass("is-active");$SE_EVENT_UTIL.onBodyClickClose({sSelector:".__se_line_height_list",fnOtherClick:function(){this._$elLineheightBtn.removeClass("is-active")}.bind(this)})},_onKeyUpInput:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickSubmitBtn(a)}this._toggleApplyBtn()},_toggleApplyBtn:function(){var a=this._$inputCustom.val();if(a===""){this._$applyCustom.removeClass("is-on")}else{this._$applyCustom.addClass("is-on")}},_onClickSubmitBtn:function(a){var b=this._$inputCustom.val();if(this._isValid(b)){this._onChange.call(this,parseInt(b,10))}else{this._showError(b)}},_onClickItem:function(a){a.preventDefault();var b=$(a.target).closest(".__se_option_btn");var c=parseInt(b.text(),10);this._onChange.call(this,c)},_isValid:function(a){var b=this._validator(a);return b.validFormat&&b.validRange},_showError:function(a){var b=this._validator(a);var c=se.i18n.getMsg("MSG_ERROR_LINEHEIGHT_FORMAT");if(b.validRange===false){c=se.i18n.getMsg("MSG_ERROR_LINEHEIGHT_RANGE");this._$inputCustom.val(this._minValue)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,c);this._$inputCustom.focus()},_unbindEvent:function(){this._$elLineheightBtn.off("click");this._$elLineheightList.off("click");this._$applyCustom.removeClass("is-on");this._$elLineheightBtn.removeClass("is-active")},activate:function(){this._bindEvent()},deactivate:function(){this._unbindEvent()}});se.defineController("se.TopPanelController",{construct:function(){this._initVar();this._bindEvent();this._createModule();this._bindModuleEvent();this._bindGatewayEvent()},_initVar:function(){this._oPreview=null;this._bMoveNewDoc=false;this._oCanvasFrame=null;this._oTopManage=null;this._oMetaData=null;this._oDocToolbar=null;this._oLoadDocumentManage=null;this._oTemplateDocumentManage=null;this._oPublishDocumentManage=null;this._oCurrentOpenManage=null;this._isSE3Blog=$SE_CONFIG.ENV_SETTING.SERVICE_NAME===$SE_CONFIG.SERVICE_TYPE.BLOG},_bindEvent:function(){var a=$("#se_top_setting_btn"),b=a.parent(),c=$("#se_top_setting_contents");var d=$SE_CONFIG.SERVICE_CONFIG.TOP_MENU_DATA;d=d||{};this._afterOpenOnMoreBtn=function(a){a.preventDefault();var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.IS_CHANGE_DOCUMENT);if(b&&!confirm(se.i18n.getMsg("MSG_NEW_DOCUMENT"))){return}var c=function(){var a="";$SE_CONFIG.ENV_SETTING.IS_ALLOW_EMPTY_CHECK=false;a="/editor"+($SE_CONFIG.ENV_SETTING.IS_CARD_DOC?"?docType=card":"");if($SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){a+="?locale="+$SE_CONFIG.ENV_SETTING.I18N_LOCALE}location.href=a}.bind(this);if(b){this.oApp.exec("DATA_SAVE_TEMP_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,false,c])}else{c()}};d.serviceType=$SE_CONFIG.ENV_SETTING.SERVICE_NAME;a.on("click",function(a){a.stopPropagation();if(b[0].classList.contains("is-active")){$SE_MODAL.close()}else{$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.POPUP,{content:se.editor.template.control["top-setting.hbs"](d),animate:false,afterOpen:function(){b.addClass("is-active");$("#se_btn_newdoc").on("click",this._afterOpenOnMoreBtn.bind(this))}.bind(this),afterClose:function(){c.css("padding",null);b.removeClass("is-active")}.bind(this)},c);$SE_MODAL.open()}}.bind(this));if($SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){$("#se_btn_newdoc").on("click",this._afterOpenOnMoreBtn.bind(this))}this._bindAccessibilityKeyEvent()},_createModule:function(){if(!$SE_CONFIG.ENV_SETTING.IS_CARD_DOC){this._oPreview=new se.PreviewPanel;this._oCanvasFrame=new se.CanvasFrameHandler}this._oDocToolbar=new se.DocumentToolbar($("#se_doctoolbar"));this._oSaveDocumentManage=new se.SaveDocumentManage;this._oTemplateDocumentManage=new se.TemplateDocumentManage},_bindModuleEvent:function(){if(!$SE_CONFIG.ENV_SETTING.IS_CARD_DOC){this._oPreview.on("onChangePreview",function(a){this._oCanvasFrame.changePreview(a.sType,a.sSize);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TABLE.CHANGE_PREVIEW,a)}.bind(this))}this._oDocToolbar.on("onChangeDocAlign",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.APPLY_DOC_STYLE,{align:a.sAlign})}.bind(this));this._oDocToolbar.on("onChangeDocFont",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.APPLY_DOC_STYLE,{fontFamily:a.sFont})}.bind(this));this._oDocToolbar.on("onAddCard",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.ADD_CARD,a.sCategory)}.bind(this));this._oDocToolbar.on("onTempSave",function(a){this.oApp.exec("DATA_SAVE_TEMP_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,false,a.fCallback])}.bind(this));this._oSaveDocumentManage.on("onOpen",function(a){}.bind(this));this._oSaveDocumentManage.on("onClose",function(a){}.bind(this));this._oSaveDocumentManage.on("onSaveTempDocument",function(a){this.oApp.exec("DATA_SAVE_TEMP_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,a.bSaveNow,a.fCallback])}.bind(this));this._oSaveDocumentManage.on("onLoadDocList",function(a){this.oApp.exec("DATA_LOAD_MANAGE_DOCUMENT_LIST",[a.sType,a.nPage])}.bind(this));this._oSaveDocumentManage.on("onLoadDoc",function(a){this.oApp.exec("DATA_READ_MANAGE_DOCUMENT",[a.sType,a.sDocId])}.bind(this));this._oSaveDocumentManage.on("onDeleteDoc",function(a){this._deleteListDocumentExcute(a.sType,a.sDocId)}.bind(this));this._oSaveDocumentManage.on("onDeleteAllDocs",function(){this._deleteAllTemporaryDocumentsExcute()}.bind(this));this._oTemplateDocumentManage.on("onOpen",function(a){}.bind(this));this._oTemplateDocumentManage.on("onClose",function(a){}.bind(this));this._oTemplateDocumentManage.on("onSaveTemplate",function(a){this._saveTemplateDocument()}.bind(this));this._oTemplateDocumentManage.on("onSaveTempDocument",function(a){this.oApp.exec("DATA_SAVE_TEMP_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,a.bSaveNow,a.fCallback])}.bind(this));this._oTemplateDocumentManage.on("onLoadDocList",function(a){this.oApp.exec("DATA_LOAD_MANAGE_DOCUMENT_LIST",[a.sType,a.nPage])}.bind(this));this._oTemplateDocumentManage.on("onLoadDoc",function(a){this.oApp.exec("DATA_READ_MANAGE_DOCUMENT",[a.sType,a.sDocId])}.bind(this));this._oTemplateDocumentManage.on("onDeleteDoc",function(a){this._deleteListDocumentExcute(a.sType,a.sDocId)}.bind(this))},_bindAccessibilityKeyEvent:function(){$("#se_top_menu_area").on("keydown",".access_hot_key",function(a){$SE_EVENT_UTIL.onAccessibilityKeyDown(a)})},_bindGatewayEvent:function(){},_deleteListDocumentExcute:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_DOC_ID);var d=se.i18n.getMsg("MSG_DELETE_DOC");if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV&&c===b){d=se.i18n.getMsg("MSG_DELETE_RESERV_CURRENT_DOC");this._bMoveNewDoc=true}else if(a===$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE){d=se.i18n.getMsg("MSG_DELETE_USER_TEMPLATE")}if(confirm(d)){this.oApp.exec("DATA_DELETE_MANAGE_DOCUMENT",[a,b])}else{this._bMoveNewDoc=false}},_deleteAllTemporaryDocumentsExcute:function(){var a=se.i18n.getMsg("MSG_DELETE_ALL_TEMP_DOCS");if(confirm(a)){this.oApp.exec("DATA_DELETE_ALL_TEMPORARY_DOCUMENTS")}else{this._bMoveNewDoc=false}},_saveTemplateDocument:function(){if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.VALIDATE_DOCUMENT,true,true,function(){this._oTemplateDocumentManage.close()}.bind(this))){this.oApp.exec("DATA_SAVE_MANAGE_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE])}},_publishDocument:function(a){this.oApp.exec("DATA_SAVE_PUBLISH_DOCUMENT",[a])},setMetaData:function(a){this._oMetaData=a},_getManageInstance:function(a){if(a===$SE_CONFIG.MANAGE_DOC_TYPE.TEMP||a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV){return this._oSaveDocumentManage}else if(a===$SE_CONFIG.MANAGE_DOC_TYPE.USER_TEMPLATE||a===$SE_CONFIG.MANAGE_DOC_TYPE.BASE_TEMPLATE||a===$SE_CONFIG.MANAGE_DOC_TYPE.EVENT_TEMPLATE){return this._oTemplateDocumentManage}},$ON_ENABLE_PUBLISH_LAYER:function(){},$ON_TOP_SAVE_TEMP_DOCUMENT:function(a){this.oApp.exec("DATA_SAVE_TEMP_DOCUMENT",[$SE_CONFIG.MANAGE_DOC_TYPE.TEMP,a])},$ON_TOP_METADATA_UPDATE:function(a){if(this._isSE3Blog){var b=$SE_CONFIG.SERVICE_CONFIG||{};if(b.MRBLOG_DATA&&b.MRBLOG_DATA.talkCode){a.setMrBlogTalkCode(b.MRBLOG_DATA.talkCode)}var c=$SE_CONFIG.USER_INFO||{};if(c.TARGET_USER_ID){a.setTargetUserId(c.TARGET_USER_ID)}if(c.TARGET_CATEGORY){a.setTargetCategory(c.TARGET_CATEGORY)}}this._oMetaData=a},$ON_TOP_OPEN_INIT_TEMPLATE:function(a){this._oTemplateDocumentManage.open(true,a)},$ON_TOP_UPDATE_UNDO_REDO:function(a,b){},$ON_RESIZE_WINDOW:function(a){if(this._oCanvasFrame){this._oCanvasFrame.resizeWrapper(a)}},$ON_TOP_MANAGE_DOC_LIST_UPDATE:function(a,b){var c=this._getManageInstance(a);if(c){c.createManageDocList(a,b)}},$ON_TOP_MANAGE_DOC_DELETE:function(a,b){var c=this._getManageInstance(a);if(c){if(a===$SE_CONFIG.MANAGE_DOC_TYPE.RESERV&&this._bMoveNewDoc){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.IS_CHANGE_DOCUMENT);document.location="/editor"}else{c.deleteManageDoc(a,b)}}},$ON_TOP_TEMPORARY_ALL_DOCS_DELETE:function(){var a=this._getManageInstance($SE_CONFIG.MANAGE_DOC_TYPE.TEMP);if(a){a.deleteAllTemporaryDocuments()}},$ON_TOP_MANAGE_DOC_SAVED:function(a,b){var c=this._getManageInstance(a);if(c){c.saveManageDoc(b)}},$ON_TOP_CLEAR_TEMP_SAVE_TIMER:function(){var a=this._getManageInstance($SE_CONFIG.MANAGE_DOC_TYPE.TEMP);if(a){a.clearAutoSaveTimer()}},updateDirectoryBlogMetaFromMaterial:function(a){this._oPublishDocumentManage.updateDirectoryBlogMetaFromMaterial(a)},_historyExec:function(a){this.oApp.exec("HISTORY_EXEC",[a])},bindFrameWheelEvent:function(){this._oCanvasFrame.bindWheelEvent()},changePreviewSize:function(a){this._oPreview.changePreviewSize(a)},$ON_MSG_APP_READY:function(){}});$SE_SPELLER_API=se.defineStatic("se.SpellerAPI",function(){var a={};var b=function(){};var c={krDicExample:function(a,c){c=c||{};var d=typeof c.fSuccess==="function"?c.fSuccess:b;var e=typeof c.fFail==="function"?c.fFail:b;var f=$SE_CONFIG.API.WORD_KRDIC_EXAMPLE;$SE_AJAX.request(f,{type:"GET",timeout:6e4,data:{q:a,hl:"all.<strong>.</strong>"}},{fError:e,fFail:e,fSuccess:d})},spellCheck:function(a,c){c=c||{};var d=typeof c.fSuccess==="function"?c.fSuccess:b;var e=typeof c.fFail==="function"?c.fFail:b;var f=$SE_CONFIG.API.SPELLER_SPELLCHECK;$SE_AJAX.request(f,{type:"POST",timeout:6e4,data:{input:a}},{fError:e,fFail:e,fSuccess:d})},spellCheckNew:function(a,c){c=c||{};var d=typeof c.fSuccess==="function"?c.fSuccess:b;var e=typeof c.fFail==="function"?c.fFail:b;var f=$SE_CONFIG.API.SPELLER_SPELLCHECK_NEW;$SE_AJAX.request(f,{type:"POST",timeout:6e4,data:JSON.stringify({query:a})},{fError:e,fFail:e,fSuccess:d})},spellSuggest:function(c,d){d=d||{};var e=typeof d.fSuccess==="function"?d.fSuccess:b;var f=typeof d.fFail==="function"?d.fFail:b;var g=a[c];if(g&&g.isSuccess&&g.result){e(g);return}var h=$SE_CONFIG.API.SPELLER_SPELLSUGGEST;$SE_AJAX.request(h,{type:"GET",timeout:6e4,data:{errata:c}},{fError:f,fFail:f,fSuccess:function(b){a[c]=b;e(b)}})}};return c}());se.defineComponent("se.SpellerSuggestLayer",{construct:function(){this._initVar();this._assignElements()},_initVar:function(){this._CLASS={ERRATA:"speller_chk",CHECKED:"is-checked",ACTIVE:"is-active",DESC:"speller_desc",EXAMPLE:"speller_example",SELECTED:"__se_selected",LOADING:"is-loading"};this._SUGGEST_TYPE={ERRATADIC:"맞춤법 오류입니다.",KASPA:"띄어쓰기 오류입니다.",PATTERN:"사전에 없거나 표준어가 아닙니다.",DEFAULT:"사전에 없거나 표준어가 아닙니다.",1:"맞춤법 오류입니다.",2:"띄어쓰기 오류입니다.",3:"사전에 없거나 표준어가 아닙니다."};this._htCurrSuggest={};this._fixedErrataHistory={};this._originalFragmentsOfMarked={};var a=["se_input_tag","__se_toolbar","__se_nautosize_div","se_map","se_audio","se_file","se_oglink","se_subjectMatter","se_mrblogQuestion","se_anniversarySection","se_schedule","se_documentTitle_btn_wrap","se_code",this._CLASS.ERRATA];var b=new RegExp(a.join("|"));this._fnSkipMark=function(a){if(a.nodeName==="SCRIPT"){return false}if(b.test(a.className)){return false}return true};this._MAX_EXAMPLE_LENGTH=3;this._fOnFailModifyAll=this._onResponseSingleSpellSuggest.bind(this,false);this._fHideInnerSpellerLoadingLayer=this._hideInnerSpellerLoadingLayer.bind(this);this._modifyAllSuccess=true;this._nRemainingModifyCount=null;this._currentRecommendWord=""},_assignElements:function(){var a=$("#se_frame_layer");var b={loadingSrc:$SE_CONFIG.getCDNImgPath("loading_square.gif")};this._$elLayer=$(se.editor.template.control["speller-suggest-layer.hbs"](b)).appendTo(a);this._$elArrow=this._$elLayer.find("#se_speller_suggest_arrow");this._$elInput=this._$elLayer.find("input:text");this._$elList=this._$elLayer.find("#se_speller_suggest_list");this._$elDesc=this._$elLayer.find("#se_speller_suggest_desc");this._$elToolbar=this._$elLayer.find("#se_speller_suggest_toolbar");this._$elPageNum=this._$elLayer.find("#se_speller_suggest_pagenum");this._$elPageNav=this._$elLayer.find("#se_speller_suggest_pagenav");this._$elCanvasFrame=a.children("iframe");var c=this._$elCanvasFrame.get(0).contentWindow;this._$elCanvasWin=$(c);this._$elCanvasDoc=$(c.document);this._$elAllErrata=null;this._$elCurrErrata=null;this._$elInnerLoadingLayerWrapper=$("div.speller_section_wrap");this._$elInnerLoadingLayer=this._$elInnerLoadingLayerWrapper.find("div.txt_spellerLoading")},_assignErrataElements:function(){this._$elAllErrata=this._$elCanvasDoc.find("."+this._CLASS.ERRATA);this._$elCurrErrata=this._$elAllErrata.first()},_bindEvent:function(){this._$elToolbar.on("click.se_speller","button",this._onClickToolbarBtn.bind(this));this._$elList.on("click.se_speller","a",this._onClickSuggestWord.bind(this));this._$elDesc.on("mousewheel.se_speller",function(a){a.stopPropagation()}.bind(this));this._$elCanvasDoc.on("click.se_speller","."+this._CLASS.ERRATA,this._onClickErrata.bind(this));this._$elCanvasDoc.on("click.se_speller",function(a){a.preventDefault();this.hide();return false}.bind(this));this._$elCanvasDoc.on("scroll.se_speller",this._onResize.bind(this));this._$elCanvasWin.on("resize.se_speller",this._onResize.bind(this))},_onClickSuggestWord:function(a){a.preventDefault();this._currentRecommendWord="";var b=$(a.target);var c=$.trim($SE_COMMON_UTIL.getInnerText(b.get(0)));var d=$("a."+this._CLASS.SELECTED,this._$elList);if(d[0]==b[0]){return}d.removeClass(this._CLASS.SELECTED);b.addClass(this._CLASS.SELECTED);this._updateSuggestDesc(c);return false},_onClickToolbarBtn:function(a){var b=$(a.currentTarget).val();switch(b){case"modify":this.modify();break;case"modifyAll":this._modifyAll();break;case"prev":this.prev();break;case"next":this.next();break}},_applyInput:function(){var a=$.trim(this._$elInput.val());if(!a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_SPELLER_NOINPUT"));this._$elInput.focus();return false}var b=this._$elCurrErrata.get(0);var c=this._$elCurrErrata.text();this._fixedErrataHistory[c]=a;if(b){b.parentNode.replaceChild(document.createTextNode(a),b);return true}else{return false}},modify:function(){if(!this._applyInput()){return}var a=this._getNextErrata();this._resetErrata();if(this._$elAllErrata.length){this._move(a)}else{this.hide();this._confirmRetrySpeller()}},_modifyAll:function(){if(!this._applyInput()){return}this.hide();this._resetErrata();var a;var b;var c=this._$elAllErrata.get();var d=c.length;if(!d){this._confirmRetrySpeller();return}this._nRemainingModifyCount=d;this.trigger("showGlobalLoadingLayer");this._modifyAllSuccess=true;for(a=0;a<d;a++){b=c[a];var e=$.trim($SE_COMMON_UTIL.getInnerText(b));if(e){if(this._fixedErrataHistory[e]){this._modifyErrataFixed(b,e)}else{if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){this._onResponseSingleSpellSuggest(true,$(b),e)}else{$SE_SPELLER_API.spellSuggest(e,{fSuccess:this._onResponseSingleSpellSuggest.bind(this,true,$(b)),fFail:this._fOnFailModifyAll})}}}}this._hideAllLoadingLayer()},_fixErrata:function(a,b){if(a&&b){a.parentNode.replaceChild(document.createTextNode(b),a);this._resetErrata()}},_modifyErrataFixed:function(a,b){var c=this._fixedErrataHistory[b];if(c){this._fixErrata(a,c)}this._nRemainingModifyCount--;this._checkModifyAllDone()},_onResponseSingleSpellSuggest:function(a,b,c){if(a){var d;if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){d=this.getSuggestData(c)}else{d=this._getResultValue(c)}if(d&&b.length){var e=d.suggests&&d.suggests[0];if(e){this._fixErrata(b.get(0),e)}}}else{this._onFailModifyAll()}this._nRemainingModifyCount--;this._checkModifyAllDone()},_checkModifyAllDone:function(){if(this._nRemainingModifyCount<=0){this._hideAllLoadingLayer();if(this._modifyAllSuccess){this._confirmRetrySpeller()}this._fixedErrataHistory={}}},_confirmRetrySpeller:function(){setTimeout(function(){if(confirm(se.i18n.getMsg("MSG_SPELLER_RETRY_CONFIRM"))){this.trigger("retrySpeller")}}.bind(this),0)},_getResultValue:function(a){if(!a.isSuccess||!a.result){return}var b=a.result.resultvalue;if(b.constructor===Array){b=b[0]}return b},prev:function(){this._move(this._getPrevErrata())},next:function(){this._move(this._getNextErrata())},_move:function(a){if(!a||!a.length){this.hide();return}this.show(a);this._currentRecommendWord="";var b=$.trim($SE_COMMON_UTIL.getInnerText(a.get(0)));if(!b){return}if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){this._onSuccessSpellSuggest(a,b)}else{this._showInnerSpellerLoadingLayer();$SE_SPELLER_API.spellSuggest(b,{fSuccess:this._onSuccessSpellSuggest.bind(this,a),fFail:this._fHideInnerSpellerLoadingLayer})}},getSuggestData:function(a){var b;var c=[];var d=[];var e=[];b=this._spellerData.filter(function(b){return b.errata===a});b&&b[0].suggests.slice(0,2).forEach(function(a){c.push(a.term);d.push(a.type);e.push(a.desc)});return{errata:b.errata,suggests:c,suggestTypes:d,suggestReasons:e}},_showInnerSpellerLoadingLayer:function(){this._toggleInnerSpellerLoadingLayer(true)},_hideInnerSpellerLoadingLayer:function(){this._toggleInnerSpellerLoadingLayer(false)},_toggleInnerSpellerLoadingLayer:function(a){if(typeof a==="boolean"){this._$elInnerLoadingLayerWrapper.toggleClass(this._CLASS.LOADING,a)}else{this._$elInnerLoadingLayerWrapper.toggleClass(this._CLASS.LOADING)}},_onFailModifyAll:function(){this._modifyAllSuccess=false},_hideAllLoadingLayer:function(){this._hideInnerSpellerLoadingLayer();this.trigger("hideGlobalLoadingLayer")},_onSuccessSpellSuggest:function(a,b){this._hideInnerSpellerLoadingLayer();var c;if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){c=this.getSuggestData(b)}else{c=this._getResultValue(b)}if(a.length&&c){var d=c.suggests||[];var e=c.suggestTypes||[];var f=c.suggestReasons||[];this._htCurrSuggest={};$.each(d,function(a,b){d[a]=b;this._htCurrSuggest[b]={type:e[a]||"",desc:f[a]||""}}.bind(this));var g=se.editor.template.control["speller-suggest-list.hbs"]({list:d});this._$elList.html(g);this._updateSuggestDesc(d[0])}else{this._$elList.empty();this._updateSuggestDesc()}},_updateSuggestDesc:function(a){var b=this._htCurrSuggest[a]||{};this._clearDesc();this._currentRecommendWord=a;if(b.desc||b.type){this._$elInput.val(a).focus();var c=this._SUGGEST_TYPE[b.type]||"";var d=b.desc||c;this._$elDesc.append($('<div class="'+this._CLASS.DESC+'">'+d+"</div>"));this._requestKrDicExample(a)}else{this._$elInput.val("").focus();this._$elDesc.append($('<div class="'+this._CLASS.DESC+'">'+this._SUGGEST_TYPE.DEFAULT+"</div>"))}},_requestKrDicExample:function(a){if(!a){return}this._showInnerSpellerLoadingLayer();$SE_SPELLER_API.krDicExample(a,{fSuccess:this._onSuccessKrDicExample.bind(this),fFail:this._fHideInnerSpellerLoadingLayer})},_onSuccessKrDicExample:function(a){this._hideInnerSpellerLoadingLayer();if(!a||!a.isSuccess||!a.result||a.result.query!==this._currentRecommendWord){return}var b=a.result;var c=b.items;if(!c||!c.length){return}this._clearExample();var d=this._makeKrDicExampleHtml(c);this._$elDesc.append($(d))},_makeKrDicExampleHtml:function(a){var b,c,d,e;var f='<div class="'+this._CLASS.EXAMPLE+'">';for(b=0,c=Math.min(a.length,this._MAX_EXAMPLE_LENGTH);b<c;b++){d=a[b];e=d.body;if(e){f+="<p>"+e+"</p>"}}f+="</div>";return f},_onClickErrata:function(a){a.preventDefault();a.stopImmediatePropagation();var b=$(a.currentTarget);if(this.isVisible()&&b.is(this._$elCurrErrata)){return false}if(b.is("."+this._CLASS.ERRATA)){this.hide();this._move(b)}return false},_onResize:function(){if(this.isVisible()){this._placeLayer(this._$elCurrErrata)}},isVisible:function(){return this._$elLayer.hasClass("is-on")},show:function(a){if(!a.is(this._$elCurrErrata)){this._$elInput.val("");this._$elList.empty();this._clearDesc()}this._$elCurrErrata.removeClass(this._CLASS.ACTIVE);this._$elCurrErrata=a;this._$elCurrErrata.addClass(this._CLASS.ACTIVE);this._updatePageUI();if(this.isVisible()){this._scrollToLayer(a)}else{this._placeLayer(a)}this._$elLayer.addClass("is-on")},_clearDesc:function(){this._$elDesc.find("div."+this._CLASS.DESC).remove();this._clearExample()},_clearExample:function(){this._$elDesc.find("div."+this._CLASS.EXAMPLE).remove()},_getTargetOffset:function(a){var b=a.offset();b.width=a.width();b.height=a.height();b.lineHeight=parseInt(a.css("line-height"),10);return b},_calcLayerPosition:function(a){return{top:a.top+a.height+this._htFixedOffset.nArrowH-this._$elCanvasWin.scrollTop(),left:(this._$elLayer.parent().width()-this._htFixedOffset.nLayerW-this._htFixedOffset.nCanvasScrollW)/2}},_calcArrowPostion:function(a){var b=a.left+(a.width-this._htFixedOffset.nArrowW)/2;if(a.height>a.lineHeight){b=a.left}b+=this._$elCanvasFrame.offset().left;return{left:b}},_drawLayer:function(a){var b=this._calcLayerPosition(a);var c=this._calcArrowPostion(a);if(b.left>c.left){b.left=a.left}else if(b.left+this._htFixedOffset.nLayerW<c.left+this._htFixedOffset.nArrowW){b.left=a.left+a.width-this._htFixedOffset.nLayerW}c.left-=b.left;this._$elArrow.css({left:c.left+"px"});this._$elLayer.css({top:b.top+"px",left:b.left+"px",marginLeft:"0"})},_scrollToLayer:function(a){if(!a){return}var b=this._getTargetOffset(a);var c=b.top+b.height+this._htFixedOffset.nArrowH-parseInt(this._$elLayer.css("top"),10);this._scrollCanvas(c);this._drawLayer(b)},_scrollCanvas:function(a){this._$elCanvasWin.scrollTop(a)},_placeLayer:function(a){if(!a){return}var b=this._getTargetOffset(a);this._drawLayer(b)},_resetFixedOffset:function(){this._htFixedOffset={nArrowW:this._$elArrow.width(),nArrowH:this._$elArrow.height(),nLayerW:this._$elLayer.width(),nCanvasMaxH:this._$elCanvasDoc.find("#se_canvas_body").height(),nCanvasScrollW:this._$elCanvasFrame.width()-this._$elCanvasWin.width()}},hide:function(){this._clearShowFirst();this._$elLayer.removeClass("is-on");this._$elList.empty();this._clearDesc();if(this._$elCurrErrata&&this._$elCurrErrata.length){this._$elCurrErrata.removeClass(this._CLASS.ACTIVE)}},enable:function(){this._$elLayer.css("display","block");this._resetFixedOffset();this._bindEvent()},disable:function(){this.hide();this._unbindEvent();this._$elAllErrata=null;this._$elCurrErrata=null;this._$elLayer.css("display","none")},_getPageInfo:function(){var a=this._$elAllErrata;return{total:a.length,page:a.index(this._$elCurrErrata)+1}},_updatePageUI:function(){var a=this._getPageInfo();this._$elPageNum.html(se.editor.template.control["speller-suggest-page.hbs"](a));this._$elPageNav.toggle(a.total>1);this.trigger("changePageInfo",a)},setSpellerData:function(a){this._spellerData=a},_getErrata:function(a){return this._$elAllErrata.eq(a)},_getPrevErrata:function(){var a=this._getPageInfo(),b=a.page-1,c=b-1;if(c<0){c=a.total-1}return this._getErrata(c)},_getNextErrata:function(){var a=this._getPageInfo();var b=a.page-1;var c=b+1;if(c>=a.total){c=0}return this._getErrata(c)},_resetErrata:function(){this._assignErrataElements();this.trigger("changePageInfo",this._getPageInfo())},markErrata:function(a){var b=new selry.FindReplace(this._$elCanvasWin.get(0));a=_.uniq(a).sort(function(a,b){return b.length-a.length});for(var c=0,d;d=a[c];c++){var e=d;this._originalFragmentsOfMarked[e]=[];var f=this._originalFragmentsOfMarked[e];var g=this._replaceSelectionWithMarking.bind(this,d,f);b.replaceAll_js(e,g,true,true,this._fnSkipMark)}this._resetErrata();this._$elAllErrata.addClass(this._CLASS.CHECKED);return this._$elAllErrata.length},_replaceSelectionWithMarking:function(a,b,c){var d=this._generateMarkingHTML(a,b.length);var e=c.getRange();b.push(e.extractContents());c.pasteHTML(d)},_generateMarkingHTML:function(a,b){return'<span data-originaltext="'+$SE_STRING.replaceSpecialChar(a)+'"data-index="'+b+'" tabindex="0" class="'+this._CLASS.ERRATA+"\" onclick=\"clickcr(this, 'spc.word', '', '', event);\">"+$SE_STRING.replaceSpecialChar(a)+"</span>"},clearErrata:function(){if(!this._$elAllErrata){return}var a=this._originalFragmentsOfMarked;this._$elAllErrata.each(function(){var b=$(this);var c=b.data("originaltext");var d=b.data("index");var e=a[c][d];b.replaceWith(e)})},showFirst:function(a){if(!this._$elCurrErrata||!this._$elCurrErrata.length){return}this._clearShowFirst();if(a){this._nTimerShowFirst=setTimeout(this._showFirst.bind(this),a)}else{this._showFirst()}},_showFirst:function(){this._assignErrataElements();this._scrollCanvas(this._$elCurrErrata.offset().top-this._$elCanvasFrame.height()/2);this._move(this._$elCurrErrata)},_clearShowFirst:function(){if(this._nTimerShowFirst){clearTimeout(this._nTimerShowFirst);this._nTimerShowFirst=null}},_unbindEvent:function(){this._$elCanvasDoc.off(".se_speller");this._$elCanvasWin.off(".se_speller");this._$elToolbar.off();this._$elList.off();this._$elDesc.off()},destroy:function(){this.disable();this._$elLayer=null;this._$elArrow=null;this._$elList=null;this._$elDesc=null}});se.defineComponent("se.SpellerTopPanel",{construct:function(){this._initVar();this._assignElements();this._bindEvent()},_initVar:function(){},_assignElements:function(){this._$elPanel=$("#se_top_speller");this._$elMsg=$("#se_speller_msg");this._$elRetryBtn=$("#se_speller_retry_btn");this._$elStopBtn=$("#se_speller_stop_btn")},_bindEvent:function(){this._$elRetryBtn.on("click",function(a){a.preventDefault();this.trigger("retrySpeller");return false}.bind(this));this._$elStopBtn.on("click",function(a){a.preventDefault();this.trigger("stopSpeller");return false}.bind(this))},setMessage:function(a){this._$elMsg.html(a)},show:function(){this._$elPanel.addClass("is-on")},hide:function(){this._$elPanel.removeClass("is-on")},_unbindEvent:function(){this._$elRetryBtn.off();this._$elStopBtn.off()},destroy:function(){this._unbindEvent();this._$elPanel=null;this._$elMsg=null;this._$elRetryBtn=null;this._$elStopBtn=null}});se.defineController("se.SpellerController",{construct:function(){this._initVar();this._assignElements();this._applyCDN();this._bindEvent()},_initVar:function(){this._CLASS={CHECK_SPELL:"is-chkSpell",SPELLER_INPUT:"speller_target",ON:"is-on"};this._sCDNLoadingSrc=$SE_CONFIG.getCDNImgPath("loading_square.gif");this._fOnKeyupBody=this._onKeyupBody.bind(this);this._spellCheck=$SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller?$SE_SPELLER_API.spellCheckNew:$SE_SPELLER_API.spellCheck},_assignElements:function(){this._$elBtn=$("#se_top_speller_btn");this._$elGlobalLoadingLayer=$("div.pop_spellerLoading_wrap")},_applyCDN:function(){this._$elGlobalLoadingLayer.find("img").attr("src",this._sCDNLoadingSrc)},_bindEvent:function(){this._$elBtn.on("click",function(a){a.preventDefault();$SE_MODAL.close();this.oApp.exec("START_SPELLER");$(document.body).trigger("click");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.CLOSE);return false}.bind(this))},_createModule:function(){
this._oTopPanel=new se.SpellerTopPanel;this._oSuggestLayer=new se.SpellerSuggestLayer},_bindModuleEvent:function(){this._oTopPanel.on("retrySpeller",function(a){this.oApp.exec("RETRY_SPELLER")}.bind(this));this._oTopPanel.on("stopSpeller",function(a){this.oApp.exec("STOP_SPELLER")}.bind(this));this._oSuggestLayer.on("changePageInfo",function(a){this._oTopPanel.setMessage(se.i18n.getMsg("MSG_SPELLER_COUNT").replace("{=COUNT}",a.total))}.bind(this));this._oSuggestLayer.on("showGlobalLoadingLayer",function(a){this._showGlobalSpellerLoadingLayer()}.bind(this));this._oSuggestLayer.on("hideGlobalLoadingLayer",function(a){this._hideGlobalSpellerLoadingLayer()}.bind(this));this._oSuggestLayer.on("retrySpeller",function(a){this.oApp.exec("RETRY_SPELLER")}.bind(this))},$ON_START_SPELLER:function(){$SE_CONFIG.ENV_SETTING.IS_SPELLER_ON=true;$(".editor-wrap").addClass(this._CLASS.CHECK_SPELL);this._$elCanvasBody.find(".se_body_wrap").addClass(this._CLASS.CHECK_SPELL);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.READONLY,true);$SE_HOTKEY.pause();this._bindSpellerShortcut();this._oSuggestLayer.enable();this._requestSpellCheck(this._onSuccessStart.bind(this),function(){this.oApp.exec("STOP_SPELLER")}.bind(this))},_onSuccessStart:function(a){if(!this._validateSuccessData(a)){$SE_AJAX.showError();this.oApp.exec("STOP_SPELLER");return}if(this._markErrataOrStop(a)){this.oApp.exec("DISABLE_SIDE_PANEL");this._oTopPanel.show();this._oSuggestLayer.showFirst(400)}},$ON_RETRY_SPELLER:function(){this._oSuggestLayer.clearErrata();this._oSuggestLayer.hide();this._updateReadonly();this._requestSpellCheck(this._onSuccessRetry.bind(this))},_onSuccessRetry:function(a){if(!this._validateSuccessData(a)){this._oTopPanel.setMessage(se.i18n.getMsg("MSG_SPELLER_FAIL"));return}if(this._markErrataOrStop(a)){this._oSuggestLayer.showFirst(100)}},$ON_STOP_SPELLER:function(){$SE_CONFIG.ENV_SETTING.IS_SPELLER_ON=false;this._oSuggestLayer.clearErrata();this._oSuggestLayer.disable();this._hideGlobalSpellerLoadingLayer();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.READONLY,false);this._unbindSpellerShortcut();$SE_HOTKEY.unpause();this._$elCanvasBody.find(".se_body_wrap").removeClass(this._CLASS.CHECK_SPELL);$(".editor-wrap").removeClass(this._CLASS.CHECK_SPELL);this._oTopPanel.hide();this.oApp.exec("ENABLE_SIDE_PANEL")},_showGlobalSpellerLoadingLayer:function(){this._$elGlobalLoadingLayer.addClass(this._CLASS.ON)},_hideGlobalSpellerLoadingLayer:function(){this._$elGlobalLoadingLayer.removeClass(this._CLASS.ON)},_bindSpellerShortcut:function(){var a={"keydown.se_speller_shortcut":this._onKeydownBody.bind(this),"keyup.se_speller_shortcut":this._onKeyupBody.bind(this)};$("body").on(a);this._$elCanvasBody.on(a)},_unbindSpellerShortcut:function(){this._$elCanvasBody.off(".se_speller_shortcut");$("body").off(".se_speller_shortcut")},_onKeydownBody:function(a){var b=a.keyCode;switch(b){case $SE_CONFIG.TRIGGER.ENTER:{var c=$(a.target);this._bEnterToModify=this._oSuggestLayer.isVisible()&&c[0]&&(c.hasClass(this._CLASS.SPELLER_INPUT)||c.attr("tabindex"));break}case $SE_CONFIG.TRIGGER.ESC:{document.activeElement.blur();clickcr(a.target,"spc.end","","");this.oApp.exec("STOP_SPELLER");a.preventDefault();break}}},_onKeyupBody:function(a){var b=a.keyCode;switch(b){case $SE_CONFIG.TRIGGER.PREV:{if(a.ctrlKey){clickcr(a.target,"spc.prev","","");this._oSuggestLayer.prev()}break}case $SE_CONFIG.TRIGGER.NEXT:{if(a.ctrlKey){clickcr(a.target,"spc.next","","");this._oSuggestLayer.next()}break}case $SE_CONFIG.TRIGGER.ENTER:{if(this._bEnterToModify){clickcr(a.target,"spc.edit","","");this._oSuggestLayer.modify();this._bEnterToModify=false}break}}},setCanvasWindow:function(a){this._$elCanvasBody=$(a.document.body);this._createModule();this._bindModuleEvent()},_updateReadonly:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_COMP_VIEW_LIST);a.forEach(function(a){a.updateModel()})},_requestSpellCheck:function(a,b){this._showGlobalSpellerLoadingLayer();var c=this._aggregateText().trim();if(c){var d=function(){};a=typeof a!=="function"?d:a;b=typeof b!=="function"?d:b;var e={fSuccess:this._responseSpellCheck.bind(this,a),fFail:this._responseSpellCheck.bind(this,b)};this._spellCheck(c,e)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_SPELLER_NOCONTENT"));this.oApp.exec("STOP_SPELLER")}},_responseSpellCheck:function(a,b){this._hideGlobalSpellerLoadingLayer();if(!$SE_CONFIG.ENV_SETTING.IS_SPELLER_ON){return false}if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){this._oSuggestLayer.setSpellerData(b.result)}a(b);return true},_aggregateText:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.GET_PLAIN_TEXT,true);return a.join(" ")},_validateSuccessData:function(a){var b=true;if(!a||!a.isSuccess||!a.result){return false}return b},_markErrataOrStop:function(a){var b=this._getWordList(a)||[];if(this._oSuggestLayer.markErrata(b)>0){return true}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_SPELLER_NO_RESULT"));this.oApp.exec("STOP_SPELLER");return false},_getWordList:function(a){var b;if($SE_CONFIG.ENV_SETTING.WEB_CONFIG.newSpeller){b=a.result.map(function(a){return a.errata})}else{b=a.result.resultvalue}return b},_refineHTML2Text:function(a){a=a.replace(/<br\/?>/gi,"\n");a=a.replace(/<\/?(strong|b|ins|u|em|i|span|font|a|del|strike|s)( [^>]*)?>/gi,"");a=a.replace(/<\!--((?!-->)[\s\S])*-->/g,"");a=a.replace(/<title>((?!<\/title>)[\s\S])*<\/title>/gi,"");a=a.replace(/&nbsp;|<[^>]*>/g," ");a=a.replace(/\uFEFF/g,"");a=$SE_STRING.restoreSpecialChar(a);return a},_unbindEvent:function(){this._$elBtn.off()},destroy:function(){this._unbindSpellerShortcut();this._unbindEvent();this._oTopPanel.destroy();this._oSuggestLayer.destroy();this._oTopPanel=null;this._oSuggestLayer=null;this._$elBtn=null;this._$elGlobalLoadingLayer=null;this._$elCanvasBody=null}});
//# sourceMappingURL=blog_desktop_normal_editor_control_top.min.js.map