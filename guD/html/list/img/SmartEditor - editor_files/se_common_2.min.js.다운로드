/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineClass("se.ImageRepository",{API:{SESSION_KEY:"/PhotoUploader/SessionKey.json?uploaderType=simple",UPLOAD_COPYIMAGE:$SE_CONFIG.ENV_SETTING.PHOTO_UPLOADER_DOMAIN},DEFAULT_CALLBACK:{done:function(){},fail:function(){},always:function(){}},DEFAULT_AJAX_OPT:{cache:false,dataType:"json"},USER_ID:$SE_CONFIG.USER_INFO.id,SERVICE_ID:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,construct:function(){},ajax:function(a,b){var c=$.extend(true,{},this.DEFAULT_CALLBACK,b);var a=$.extend(true,{},this.DEFAULT_AJAX_OPT,a);$.ajax(a).done(c.done).fail(c.fail).always(function(a,b){if(b==="timeout"){c.fail()}c.always()}.bind(this))},getSessionKey:function(a){this.ajax({url:this.API.SESSION_KEY,data:{userId:this.USER_ID,serviceId:this.SERVICE_ID}},a)},uploadCopyImage:function(a,b,c,d){var e=[this.API.UPLOAD_COPYIMAGE,c,"simpleUpload",a].join("/");var f;try{f=decodeURIComponent(b)}catch(g){b=encodeURIComponent(b);f=decodeURIComponent(b)}var h={xhrFields:{withCredentials:true},crossDomain:true,type:"POST",url:e,dataType:"xml",data:{copyurl:f,extractExif:true,autorotate:true,extractAnimatedCnt:true,extractDominantColor:true,userId:this.USER_ID}};this.ajax(h,d)},uploadCloneImage:function(a,b,c,d){var e=[this.API.UPLOAD_COPYIMAGE,c,"simpleUpload",a].join("/");var f=decodeURIComponent(b);var g={type:"POST",url:e,dataType:"xml",data:{copyurl:f,extractExif:true,autorotate:true,extractAnimatedCnt:true,userId:this.USER_ID}};this.ajax(g,d)}});se.defineClass("se.ImageAttributeConverter",{IMAGE_DOMAIN:$SE_CONFIG.ENV_SETTING.IMAGE_DOMAIN,construct:function(){},convertToImage:function(a){var b=this.IMAGE_DOMAIN;var c=this._getDefaultCompJson(a);return $.extend(true,{},c,{path:a.url,width:a.width,height:a.height,fileSize:a.fileSize,domain:b,src:b+a.url,uploadedLocal:true,fileName:unescape(a.fileName),animationGIF:this._isAnimateImage(a.animatedCnt),index:Number(a.index)})},_getDefaultCompJson:function(a){var b=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.IMAGE);_.map(b,function(c,d){if(a[d]){b[d]=a[d]}});return b},_isAnimateImage:function(a){return parseInt(a,10)>1}});se.defineController("se.PhotoEditorController",{BUILD_TIME_STAMP:$SE_BUILD_CONFIG.TIME_STAMP,SERVICE_NAME:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,IMAGE_DOMAIN:$SE_CONFIG.ENV_SETTING.IMAGE_DOMAIN,EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN:$SE_CONFIG.ENV_SETTING.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN,construct:function(a,b){a=a||{};b=b||{};this._initVar(b);this._bindEvent();if(this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN){this._initPhotoEditor(a,b)}},_initVar:function(a){this._activatedComp=null;this.USER_ID=a.userId||$SE_CONFIG.USER_INFO.id},_bindEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.PHOTO_EDITOR.OPEN,this._open.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.PHOTO_EDITOR.IS_ACTIVE,this._isActive.bind(this))},_initPhotoEditor:function(a,b){var c=$SE_BUILD_CONFIG.BUILD_PROPERTY;var d={lang:$SE_CONFIG.ENV_SETTING.I18N_LOCALE,userId:this.USER_ID,serviceName:this.SERVICE_NAME,env:c==="stage"||c==="real"?"real":"dev"};var e=$.extend(true,{domain:this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN,imageDomain:this.IMAGE_DOMAIN,sslEnabled:document.location.protocol==="https:",autorotate:true,resourcePath:"/static/js/lib/phup.js/dist",extractAnimatedCnt:true},b);var f={url:"/PhotoUploader/SessionKey.json?uploaderType=simple"};var g=$.extend(true,{},$SE_CONFIG.SERVICE_CONFIG.PHOTO_EDITOR_OPT.CONFIG,{resizeCustom:true,filterPath:"/static/dist/editor/"+this.BUILD_TIME_STAMP+"/photoeditor-res/img/",nclicks:{use:true,clickcrFunction:window.clickcr},signature:{defaultText:this._getTextForSignature()},cors:true,phupOpts:e,sessionKeyOpts:f,setting:d,afterOpen:this._afterOpen.bind(this),afterClose:this._afterClose.bind(this),webglFilterEnable:$SE_CONFIG.ENV_SETTING.WEB_CONFIG.webglFilterEnable},a);if(!this.npe){this.npe=new PhotoEditorApp;this.npe.init(g)}},_getTextForSignature:function(){var a=$SE_CONFIG.SERVICE_CONFIG.PHOTO_EDITOR_OPT.SIGNATURE_TEXT||"";return a.replace("{USERID}",this.USER_ID)},_afterOpen:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);$SE_HOTKEY.pause()},_afterClose:function(){$SE_HOTKEY.unpause();if(this._activatedComp){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,this._activatedComp)}setTimeout(this._focusToCanvas,0)},_focusToCanvas:function(){var a=$("#se_canvas_frame")[0];if(a){a.contentWindow.focus()}},_open:function(a){if(!this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN){$SE_AJAX.showError();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END);return}var b;var c;var d;c=this._getActivatedCompKey();d=this._getImageDataFromComps();if(a){b=$.extend(true,{},a)}else{b=$.extend(true,{},{photos:d,done:this._doneEdit.bind(this),initKey:c},$SE_CONFIG.SERVICE_CONFIG.PHOTO_EDITOR_OPT.CONFIG)}this.npe.open(b);$SE_COMMON_UTIL.setCookie($SE_CONFIG.COOKIE_NAMES.PHOTO_EDITOR,"T",365*5)},_getActivatedCompKey:function(){var a=this._getActivatedComp();if(a.length){this._activatedComp=a[0];return this._activatedComp.getId()}return""},_getActivatedComp:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)},_updateList:function(a){this.npe.updatePhotos(this._convertToPhotoModelFrom(this._getImageData(a)))},_deletePropertyWith:function(a,b){var c=$.extend(true,{},b);$.each(a,function(a,b){if(c[b]){delete c[b]}});return c},_convertToPhotoModelFrom:function(a){return{key:a.compId,originalFileName:a.fileName,width:a.originalWidth,height:a.originalHeight,domain:a.domain,path:a.path,fileSize:a.fileSize,thumbnail:a.src,animationGIF:a.animationGIF,generationFormat:a.displayFormat||"normal",dominantColor:a.dominantColor||""}},_doneEdit:function(a){var b=[];$.each(a,function(a,c){var d=this._convertToImageModelFrom(c);b.push(d)}.bind(this));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_IMAGES,b)},_convertToImageModelFrom:function(a){var b=a.generationFormat;if(this._isPanoramaByPath(a.path)){a.generationFormat=$SE_CONFIG.IMAGE.FORMAT.PANORAMA}var c=a.domain+a.path;var d=this._deletePropertyWith(["modified","width","height"],a);return $.extend(true,d,{id:a.key,originalWidth:a.width,originalHeight:a.height,src:this._getSrcWithThumbnailType(c,b),uploadedLocal:true,represent:false})},_isPanoramaByPath:function(a){var b=new RegExp($SE_CONFIG.IMAGE.PATH.PREFIX+"\\w+");var c=b.exec(a);if(c){c=c[0].replace($SE_CONFIG.IMAGE.PATH.PREFIX,"");return $SE_CONFIG.IMAGE.PATH.PANORAMA===c}return false},_getSrcWithThumbnailType:function(a,b){var c=function(a){var b=$SE_CONFIG.ENV_SETTING.VR_THUMBNAIL_TYPE||"";if(a&&$SE_CONFIG.IMAGE.FORMAT.VR360_SUPPORT.indexOf(a)>=0&&b){return"?type="+b}var c=$SE_CONFIG.ENV_SETTING.THUMBNAIL_TYPE||"";if(c){return"?type="+c}return""};return a+c(b)},_getImageDataFromComps:function(){var a=this._getCompsFromViewList();var b=[];$.each(a,function(a,c){var d;if(c.getCompType()===$SE_CONFIG.COMP_TYPE.IMAGE){d=this._getImageData(c)}else if(c.getCompType()===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH){d=this._getImageDataCompBy(c)}if(d&&d.uploadedLocal){b.push(this._convertToPhotoModelFrom(d))}}.bind(this));return b},_getCompsFromViewList:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST)},_getImageData:function(a){return $.extend({},a.getModelDataAsJson(),{compId:a.getId()})},_getImageDataCompBy:function(a){return $.extend({},a.getImageDataAsJson(),{compId:a.getId()})},_isActive:function(){return this.npe.opened}});(function(){Handlebars.registerHelper("ifCond",function(a,b,c,d){switch(b){case"==":return a==c?d.fn(this):d.inverse(this);case"===":return a===c?d.fn(this):d.inverse(this);case"!=":return a!=c?d.fn(this):d.inverse(this);case"!==":return a!==c?d.fn(this):d.inverse(this);case"<":return a<c?d.fn(this):d.inverse(this);case"<=":return a<=c?d.fn(this):d.inverse(this);case">":return a>c?d.fn(this):d.inverse(this);case">=":return a>=c?d.fn(this):d.inverse(this);case"&&":return a&&c?d.fn(this):d.inverse(this);case"||":return a||c?d.fn(this):d.inverse(this);case"in":case"IN":return c.indexOf(a)>-1?d.fn(this):d.inverse(this);default:return d.inverse(this)}});Handlebars.registerHelper("checkImageComp",function(a){if(this["@ctype"]==$SE_CONFIG.COMP_TYPE.IMAGE){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("checkVideoComp",function(a){if(this["@ctype"]==$SE_CONFIG.COMP_TYPE.VIDEO){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("checkAudioComp",function(a){if(this["@ctype"]==$SE_CONFIG.COMP_TYPE.AUDIO){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("checkMapComp",function(a){if(this["@ctype"]==$SE_CONFIG.COMP_TYPE.MAP){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("checkDocumentTitleComp",function(a){if(this["@ctype"]==$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){return a.fn(this)}else{return a.inverse(this)}});Handlebars.registerHelper("math",function(a,b,c,d){a=parseFloat(a);c=parseFloat(c);return{"+":a+c,"-":a-c,"*":a*c,"/":a/c,"%":a%c}[b]});Handlebars.registerHelper("i18n",function(a,b,c){var d;if($SE_CONFIG.ENV_SETTING.IS_POST_SERVICE&&$SE_CONFIG.ENV_SETTING.DOC_TYPE==="card"){se.i18n.init($SE_CONFIG.ENV_SETTING.I18N_LOCALE,$SE_I18N_BUNDLES)}if(typeof b==="string"){d=se.i18n.getMsg(b,a)}else{d=se.i18n.getMsg(a)}return d});Handlebars.registerHelper("getStickerPos",function(a){var b=-(a.seq-1)%3*108;var c=-(Math.ceil(a.seq/3)-1)*100;var d=(!b?"0":b)+"px "+(!c?"0":c)+"px";return d})})();window.$SE_ALERT=se.defineStatic("se.AlertLayer",function(){var a={opened:function(){},closed:function(){}};var b;function c(c,d){if(!c){return}var f=se.editor.template.common["modal-upload-error-title-content.hbs"];b=$.extend({},a,d);$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:f(c),"class":"pop_dragDrop_wrap",close:false,buttons:[{text:"확인","class":"type1",click:function(a){e(a)}.bind(this)}]})}function d(){if(!b){return}$SE_MODAL.open();b.opened()}function e(){$SE_MODAL.close();b.closed()}return{init:c,open:d,close:e}}());se.defineClass("se.MediaContentsImagePositioner",{construct:function(){this._bindGatewayEvent()},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.IMAGE_POSITIONER.MOUNT_POSITIONER,this.activate.bind(this))},activate:function(a){if(!a||!a.image||!a.data){return}this._initVar();this._mount(a);this._createResizeFrame();this._assignElements();this._setFrameCursor();this._attachEvents();this._readonly(true);this._isActivated=true;this._popupToast(se.i18n.getMsg("MSG_IMAGE_POSITIONER_GUIDE"))},_initVar:function(){this._isActivated=false;this.CONST={TOAST_DURATION_MS:5e3,ATTRIBUTE:{WIDTH:"width",HEIGHT:"height"},BACKGROUND_POSITION_MIN:0,BACKGROUND_POSITION_MAX:100};this.GLOBAL_DOCUMENT=window.top.document;this._isCardDoc=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._htElement={};this._htImageData=null;this._elOriginalImage=null;this._htOriginalComputedStyle=null;this._elClone=null;this._htResizedMetric={width:null,height:null};this._htCloneMetric={width:null,height:null,top:null,left:null};this._htInitialMousePosition={};this._oCloneTemplate=se.editor.template.common["image-positioner.hbs"];this._fnApplyCallback=null;this._bChangeHorizontalByPercent=true;this._bChangeVerticalByPercent=true;this._isJQueryAvailable=typeof $==="function"&&typeof $.fn==="object"&&typeof $.fn.addClass==="function";this._bLockVertical=false;this._bLockHorizontal=false;this._isBLOG=$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE},deactivate:function(a){if(!this._isActivated){return}a=a||{};var b=a.event;var c;if(b){c=b.target}if(c===this._elClone||c===this._htElement.elApplyBtn||c===this._htElement.elCancelBtn){return}this._unMount();this._readonly(false);this._detachEvents();this._unassignElements();this._removeResizeFrame();this._closeToast();this._isActivated=false},_mount:function(a){this._htImageData=a||{};this._elOriginalImage=this._getImage();this._registerCallback();this._getInitialMetric()},_readonly:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.READONLY,a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.READONLY,a);var b=[];var c=this.GLOBAL_DOCUMENT.body;b.push(c);var d;var e=this._htElement.elCanvasFrame;if(e){d=e.contentDocument.body}b.push(d);var f;var g;if(this._isJQueryAvailable){for(f=b.length;f--;){g=b[f];if(!g){continue}if(a){$(g).addClass("is-movingBg")}else{$(g).removeClass("is-movingBg")}}}},_getInitialMetric:function(){this._htOriginalComputedStyle=getComputedStyle(this._elOriginalImage);this._getCloneMetric();this._getResizedMetric();this._determineChangeByPercent();this._determineLockMoving()},_registerCallback:function(){this._fnApplyCallback=this._htImageData.callback},_determineChangeByPercent:function(){var a=this._getWidth();var b=this._getHeight();this._bChangeHorizontalByPercent=a/100>1;this._bChangeVerticalByPercent=b/100>1;this._bChangeHorizontalByPercent=false;this._bChangeVerticalByPercent=false},_determineLockMoving:function(){var a=parseFloat(this._htCloneMetric.width,10)/parseFloat(this._htCloneMetric.height,10);var b=this._htResizedMetric.width/this._htResizedMetric.height;if(a>b){this._bLockHorizontal=true}else if(a<b){this._bLockVertical=true}else if(a===b){this._bLockHorizontal=true;this._bLockVertical=true}},_setFrameCursor:function(){var a="default";if(this._bLockHorizontal&&!this._bLockVertical){a="ns-resize"}else if(!this._bLockHorizontal&&this._bLockVertical){a="ew-resize"}this._elClone.style.cursor=a;this._htElement.elResizeMouseMoveHelper.style.cursor=a},_getCloneMetric:function(){var a=this._htOriginalComputedStyle.src;this._htCloneMetric.backgroundImage=a?'url("'+a+'")':this._htOriginalComputedStyle["background-image"];this._htCloneMetric.width=this._htOriginalComputedStyle.width;this._htCloneMetric.height=this._htOriginalComputedStyle.height;this._htCloneMetric.zIndex=this._htOriginalComputedStyle.zIndex;var b=this._htOriginalComputedStyle["background-position-x"];var c=this._htOriginalComputedStyle["background-position-y"];this._htCloneMetric.backgroundPositionX=isNaN(parseFloat(b,10))?"50%":b;this._htCloneMetric.backgroundPositionY=isNaN(parseFloat(c,10))?"50%":c},_getResizedMetric:function(){var a=this._getWidth()/this._getHeight();var b=parseFloat(this._htCloneMetric.width,10);var c=parseFloat(this._htCloneMetric.height,10);var d=b/c;var e=b;var f=c;if(a>d){e=c*a}else if(a<d){f=b/a}this._htResizedMetric.width=e;this._htResizedMetric.height=f},_getData:function(){return this._htImageData.data||{}},_getWidth:function(){return this._getData().width},_getHeight:function(){return this._getData().height},_getCompId:function(){return this._htImageData.compId},_getImage:function(){return this._htImageData.image},_getBackgroundPositionX:function(){return this._getData().backgroundPositionX},_getBackgroundPositionY:function(){return this._getData().backgroundPositionY},_getSrc:function(){return this._getData().src},_createResizeFrame:function(){this._htCloneMetric.zIndex="500";var a=this._process(this._htCloneMetric);var b=document.createElement("div");b.innerHTML=a;this._elCloneWrapper=b.firstChild;this._elClone=this._elCloneWrapper.querySelector("div.__se_resize_frame");this._elClone.style.backgroundImage=this._htCloneMetric.backgroundImage;this._elOriginalImage.parentNode.appendChild(this._elCloneWrapper)},_removeResizeFrame:function(){this._elCloneWrapper.parentNode.removeChild(this._elCloneWrapper)},_process:function(){var a=this._oCloneTemplate(this._htCloneMetric);return a},_assignElements:function(){this._htElement.elApplyBtn=this._elCloneWrapper.querySelector(".__se_resize_apply_btn");this._htElement.elCancelBtn=this._elCloneWrapper.querySelector(".__se_resize_cancel_btn");this._htElement.elResizeMouseMoveHelper=this._elCloneWrapper.querySelector(".__se_resize_mousemove_helper");var a=".se_movingBg_dim";this._htElement.aelDimmedLayer=[];var b=this.GLOBAL_DOCUMENT.querySelector(a);if(b){this._htElement.aelDimmedLayer.push(b)}var c;var d=this.GLOBAL_DOCUMENT.querySelector("#se_canvas_frame");if(d){c=d.contentDocument.querySelector(a)}if(c){this._htElement.aelDimmedLayer.push(c)}this._htElement.elCanvasFrame=d},_unassignElements:function(){this._htElement={}},_attachEvents:function(){this._htElement.elApplyBtn.onclick=this._onClickApplyBtn.bind(this);this._htElement.elCancelBtn.onclick=this._onClickCancelBtn.bind(this);this._elClone.onmousedown=this._onMouseDownClone.bind(this);var a=this._onMouseDownDimmedLayer.bind(this);var b=this._htElement.aelDimmedLayer;var c;var d;for(c=b.length;c--;){d=b[c];d.onmousedown=a}},_detachEvents:function(){this._htElement.elApplyBtn.onclick=null;this._htElement.elCancelBtn.onclick=null;this._elClone.onmousedown=null},_onClickApplyBtn:function(a){if(this._isBLOG){window.top.clickcr(a.target,"ttl.moveok","","")}this._apply();this.deactivate()},_onClickCancelBtn:function(a){if(this._isBLOG){window.top.clickcr(a.target,"ttl.movecancel","","")}this.deactivate()},_onMouseDownDimmedLayer:function(){this.deactivate()},_onMouseDownClone:function(){this._htInitialMousePosition={};this.GLOBAL_DOCUMENT.body.appendChild(this._htElement.elResizeMouseMoveHelper);this._htElement.elResizeMouseMoveHelper.style.display="block";this._htElement.elResizeMouseMoveHelper.onmousemove=this._onMouseMoveResizeHelper.bind(this);this._htElement.elResizeMouseMoveHelper.onmouseup=this._onMouseUpResizeHelper.bind(this);return false},_onMouseMoveResizeHelper:function(a){var b=a.clientX;var c=a.clientY;if(typeof this._htInitialMousePosition.x==="undefined"){this._htInitialMousePosition.x=b}if(typeof this._htInitialMousePosition.y==="undefined"){this._htInitialMousePosition.y=c}var d=this._htInitialMousePosition.x-b;var e=this._htInitialMousePosition.y-c;var f=this._bChangeHorizontalByPercent?d:d/parseFloat(this._htResizedMetric.width,10)*100;var g=this._bChangeVerticalByPercent?e:e/parseFloat(this._htResizedMetric.height,10)*100;var h=parseFloat(this._htCloneMetric.backgroundPositionX,10)+f;var i=parseFloat(this._htCloneMetric.backgroundPositionY,10)+g;var j=this.CONST.BACKGROUND_POSITION_MIN;var k=this.CONST.BACKGROUND_POSITION_MAX;if(h>k){h=k}else if(h<j){h=j}if(i>k){i=k}else if(i<j){i=j}if(!this._bLockHorizontal){this._elClone.style.backgroundPositionX=""+h+"%"}if(!this._bLockVertical){this._elClone.style.backgroundPositionY=""+i+"%"}},_onMouseUpResizeHelper:function(){this._htElement.elResizeMouseMoveHelper.onmousemove=null;this._htElement.elResizeMouseMoveHelper.onmouseup=null;this._htElement.elResizeMouseMoveHelper.style.display="none";this._elCloneWrapper.appendChild(this._htElement.elResizeMouseMoveHelper);this._htCloneMetric.backgroundPositionX=this._elClone.style.backgroundPositionX;this._htCloneMetric.backgroundPositionY=this._elClone.style.backgroundPositionY},_apply:function(){var a=this._elClone.style.backgroundPositionX;var b=this._elClone.style.backgroundPositionY;var c=this._getCompId();this._setImageBackgroundMetric(a,b,c)},_getConvertedOffsetCenterRatio:function(a,b,c){var d=parseFloat(a,10);var e=(d-50)/100;var f=parseFloat(this._htResizedMetric[b],10);var g=parseFloat(this._htCloneMetric[b],10);var h=c?1:(f-g)/f;return e*h},_setImageBackgroundMetric:function(a,b,c){var d={nOffsetCenterXRatio:this._getConvertedOffsetCenterRatio(a,this.CONST.ATTRIBUTE.WIDTH,this._bLockHorizontal),nOffsetCenterYRatio:this._getConvertedOffsetCenterRatio(b,this.CONST.ATTRIBUTE.HEIGHT,this._bLockVertical),sBackgroundPositionX:a,sBackgroundPositionY:b,sCompId:c};var e=this._fnApplyCallback;if(typeof e==="function"){e(d)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.BACKGROUND.SET_IMAGE_BACKGROUND_METRIC,d)}},_closeToast:function(){if(this._isCardDoc){var a=$(this.GLOBAL_DOCUMENT).find("body");a.ntoast("closeToast")}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.CLOSE_TOAST)}},_popupToast:function(a){var b=this.CONST.TOAST_DURATION_MS;if(this._isCardDoc){var c=$(this.GLOBAL_DOCUMENT).find("body");c.ntoast("setMessage",a);c.ntoast("popupToast",b)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,a,b)}},_unMount:function(){this._elOriginalImage=null;this._htImageData=null}});function addFileList(a){$SE_MEDIA.execCallback($SE_CONFIG.COMP_TYPE.FILE,a)}attachArea={beginImgInsert:function(){},finishImgInsert:function(){},newPhotoFile:function(a,b,c,d,e,f,g,h){},allPhotoFile:function(a,b){var c=[],d;var e=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.IMAGE);var f=new RegExp(".(gif)$","i");var g=function(a){var b=a.toLowerCase();var c=f.test(b);return c};$.each(a,function(a,b){c.push($.extend(true,{},e,{path:b.sFileURL,width:b.nWidth,height:b.nHeight,backgroundPositionX:"50%",backgroundPositionY:"50%",offsetCenterXRatio:0,offsetCenterYRatio:0,fileSize:b.nFileSize,domain:$SE_CONFIG.ENV_SETTING.IMAGE_DOMAIN,src:$SE_CONFIG.ENV_SETTING.IMAGE_DOMAIN+b.sFileURL,alt:unescape(b.sFileName),uploadedLocal:true,isGifFile:g(b.sFileName)}))});if(c.length===1){d=c[0]}else{d=c}$SE_MEDIA.execCallback($SE_CONFIG.COMP_TYPE.IMAGE,d)},newStoryPhotoFile:function(a,b,c,d,e,f,g,h,i){}};function insertVideoByMultiUploader(a){var b=c(a);b.forEach(function(a){insertMultimedia(a.vid,a)});function c(a){var b=[];a.forEach(function(a){if(a.thumbnails){var c=a.videoInfo;var d=a.thumbnails.filter(function(a){return a.type==="COVER"})[0];b.push({vid:a.vid,encodeType:a.encodeType,thumbnail:d.url,moviefilesize:c.fileSize,playtime:c.duration,width:c.width,height:c.height,originthumbnail:d.url})}});return b}}function insertMultimedia(a,b){var c={thumbnail:{src:b.thumbnail,alt:b.thumbnail},vid:a,fileSize:parseInt(b.moviefilesize,10),playTime:parseFloat(b.playtime),uploadedLocal:true};if(b.screensize){var d=b.screensize.split("x");c.width=parseInt(d[0],10);c.height=parseInt(d[1],10)}if(b.width&&b.height){c.width=b.width;c.height=b.height}if(b.encodeType&&b.encodeType.toString()==="360"){c.generationFormat="vr360"}if(c.width<=c.height){c.thumbnail.src=b.originthumbnail}c=$.extend(true,{},$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.VIDEO),c);$SE_MEDIA.execCallback($SE_CONFIG.COMP_TYPE.VIDEO,c)}function insertMultimediaUrlData(a){var b=null;if(a.linkInfo){b=a.linkInfo}else{b=a}var c={fileSize:0,vid:b.videoId||"",template:a.sData,uploadedLocal:true};if(b.vendor){c.vendor=b.vendor}c.thumbnail={src:b.thumbnail||"",alt:b.title||""};c.caption=$SE_COMMON_UTIL.unescapeHtml(c.thumbnail.alt);if(b.videoTemplateSource){c.source=b.videoTemplateSource}if(b.vendor==="youtube"){c.thumbnail.src=c.thumbnail.src.replace("maxresdefault","0")}c=$.extend(true,{},$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.VIDEO),c);$SE_MEDIA.execCallback($SE_CONFIG.COMP_TYPE.VIDEO,c)}NPHOTO_MINI={onSubmit:function(a){var b=a&&JSON.parse(a);$SE_MEDIA.execCallback($SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS,b)}};SNS={addImageUrls:function(a){var b=a.split(",");$SE_MEDIA.execCallback($SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS,b)}};window.maxFileCount=50;window.$SE_MEDIA=se.defineStatic("se.MediaAttachManager",function(){var a=$SE_CONFIG.ENV_SETTING.SERVICE_NAME;var b=$SE_CONFIG.USER_INFO.id;var c=function(a,b){this._sName=a;this._fnGetURL=b};c.prototype={isOpened:function(){return this._oWin&&!this._oWin.closed},open:function(a,b){this._fCallback=a;if(!this.isOpened()){var c=this._fnGetURL(b||{});this._oWin=window.open(c,this._sName,p(this._sName))}setTimeout(function(){try{this._oWin.focus()}catch(a){}}.bind(this),100);return this._oWin},close:function(){if(this.isOpened()){this._oWin.close()}},callback:function(a){if(typeof this._fCallback==="function"){this._fCallback(a)}}};var d={_bPaused:false,_htPopup:{},_addPopup:function(a,b){this._htPopup[a]=new c(a,b)},open:function(a,b,c){var d=this._htPopup[a];if(!d){return}return d.open(b,c)},execCallback:function(a,b){if(this._bPaused){alert(se.i18n.getMsg("MSG_MEDIA_CALLBACK_UNAVAILABLE"));return}var c=this._htPopup[a];if(!c){return}c.callback(b)},pause:function(){this._bPaused=true},unpause:function(){this._bPaused=false},closeAll:function(){for(var a in this._htPopup){this._htPopup[a].close()}}};var e={DEFAULT_OPTS:{BASE_EDIT:{mode:"base_edit",maxFileCount:50},REEDIT:{mode:"reedit",useEditFlag:true,maxFileCount:1}},getOptionParam:function(a){var b=this._makeOptionParams(a);var c=[];$.each(b,function(a,b){c.push(a+"="+b)});return encodeURIComponent(c.join("&"))},_makeOptionParams:function(a){var b;if(a&&a.image){b=$.extend({},this.DEFAULT_OPTS.REEDIT,this._makeReEditOption(a.image),{signatureDefaultText:a.signatureDefaultText})}else{b=$.extend({},this.DEFAULT_OPTS.BASE_EDIT,a)}return b},_makeReEditOption:function(a){var b={width:this._getWidth(a),copyurl:this._getCopyurl(a)};if(a.alt){b.imageFileName=encodeURIComponent(this._revisionFileName(a.alt,a.path))}return b},_revisionFileName:function(a,b){var c=new RegExp("(.jpeg|.gif|.png|.jpg|.bmp)$","g");var d=a.toLowerCase().match(c);var e=b.toLowerCase().match(c);if(!d||d.length==0){a+=e[0]}return a},_getWidth:function(a){return a.width>2880?-1:a.width},_getCopyurl:function(a){var b=a.src||"";var c=a.uploadedLocal;if(c){b=this._getOriginURL(b)}else{b=""}return b},_getOriginURL:function(a){var b=a.split("?");if(b.length>1){return b[0]}return a}};function f(c){var d=e.getOptionParam(c);return["/PhotoUploader",a,b].join("/")+"?option="+d}function g(){if($SE_CONFIG.SERVICE_CONFIG.VIDEOINFRA_CONFIG.USE_VOD_UPLOADER){return $SE_CONFIG.SERVICE_CONFIG.VIDEOINFRA_CONFIG.UPLOADER_PATH}var c="vr";if($SE_CONFIG.ENV_SETTING.DOC_TYPE===$SE_CONFIG.DOC_TYPE.CARD){c="normal"}return["/VideoUploader",a,b].join("/")+"?uploadType="+c}function h(){return["/FileUploader/ndrive",a].join("/")}function i(a){j(a.nMaxImageCount);return k(a.sType)}function j(a){window.maxFileCount=a}function k(a){if(a==="cloud"){return location.protocol+"//"+m()+"photo.cloud.naver.com/v2/mini?"+l()}return location.protocol+"//"+n()+".upphoto.naver.com/sns/view.nhn#"+a}function l(){return["mediaType=I","maxCount="+window.maxFileCount].join("&")}function m(){var a=$SE_CONFIG.ENV_SETTING.BUILD_PROPERTY;var b;switch(a){case"stage":b="stage.";break;case"real":b="";break;default:b="qa."}return b}function n(){if(a===$SE_CONFIG.SERVICE_TYPE.BLOG){return"blog"}else if(a===$SE_CONFIG.SERVICE_TYPE.POST){return"ecommerce"}}function o(a){return $SE_STRING.composeURLWithParamSet("/editor/attachLocation",a)}function p(a){var b={width:860,height:640};if(a===$SE_CONFIG.COMP_TYPE.MAP){b.width=$SE_CONFIG.MAP.POPUP_SIZE.WIDTH;b.height=$SE_CONFIG.MAP.POPUP_SIZE.HEIGHT}if(a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS){b.height=610;b.width=870}var c=(screen.availWidth-b.width)/2;var d=(screen.availHeight-b.height)/2;return"top="+d+",left="+c+",width="+b.width+",height="+b.height+",scrollbars=yes,resizable=yes,status=yes"}var q=$SE_CONFIG.COMP_INSERT_ITEM_TYPE;d._addPopup(q.IMAGE,f);d._addPopup(q.VIDEO,g);d._addPopup(q.FILE,h);d._addPopup(q.MAP,o);d._addPopup(q.CLOUD_SNS,i);return d}());se.defineClass("se.UploaderValidator",{construct:function(a){this._acceptExtensions=a.EXTENSION;this._acceptExtensionReg=this._getAcceptExtensionPattern()},_getAcceptExtensionPattern:function(){if(this._acceptExtensions instanceof RegExp){return this._acceptExtensions}if(_.isArray(this._acceptExtensions)){var a="("+this._acceptExtensions.join("|")+")$";return new RegExp(a,"g")}return null},_isNotAcceptExtension:function(a){var b=this._acceptExtensionReg;if(b===null){return false}var c=a.name||"";if(c.toLowerCase().match(b)===null){return true}return false},filterOut:function(a){var b=[];var c=[];$.each(a,function(a,d){if(this._isNotAcceptExtension(d)){b.push(d)}else{c.push(d)}}.bind(this));return{invalidFile:b,validFile:c}}});se.defineClass("se.LogCollector",{ERROR_MAP:{UNSUPPORTED_IMAGE:"UNSUPPORTED",UNSUPPORTED_EXTENSION:"UNSUPPORTED",UNSUPPORTED_IMAGE_STOP:"UNSUPPORTED_STOP",LIMITATION_BY_SESSION_COUNT:"LIMITATION_COUNT",LIMITATION_BY_SESSION_SIZE:"LIMITATION_SIZE",LIMITATION_BY_IMAGE:"LIMITATION_SIZE"},construct:function(a){this._callback=$.extend({},this.DEFAULT_CALLBACK,a);this._initVal();this._attachEvent()},_initVal:function(){this._logs=[]},_attachEvent:function(){},update:function(a){this._logs.push(a)},clear:function(){this._logs.length=0},getLogInfoWith:function(a){var b=[];var c=a||"IMAGE_UPLOAD_ERROR_";$.each(this._logs,function(a,d){var e=this._getCodeTypeWith(c,d.code);var f=se.i18n.getMsg(e);if(f&&f.TITLE&&f.CONTENT){b.push({errorTitle:f.TITLE,errorContent:f.CONTENT,fileName:d.name,errorCode:d.code,errorKey:e})}}.bind(this));return b},_getCodeTypeWith:function(a,b){return a+(this.ERROR_MAP[b]||"UNKNOWN")}});se.defineComponent("se.DropZone",{DROP_ZONE:{DROP:"DROP_ZONE.DROP"},TYPE:{SINGLE:"single",MULTIPLE:"multiple"},construct:function(a,b,c){this._uploader=b;this._type=this.TYPE[c]?this.TYPE[c]:this.TYPE.MULTIPLE;this._template=this._getTemplateBy();this._$target=a instanceof jQuery?a:$("body");this._initVal()},_getTemplateBy:function(){var a=this._type;var b="common-drop-zone-"+a+".hbs";return se.editor.template.common[b]},_initVal:function(){this._$frame=$("#se_canvas_frame");this._$window=$(window);this._$multipleTarget=$("#se_components_wrapper");this._$documentTitle=null;this._eventNamespace=_.uniqueId(".DropZone_")},_attachEvent:function(){this._$target.on("dragenter"+this._eventNamespace,this._onDragEnter.bind(this));this._$target.on("dragover"+this._eventNamespace,this._onDragOver.bind(this));this._$target.on("drop"+this._eventNamespace,this._onDrop.bind(this));this._$target.on("dragleave"+this._eventNamespace,this._onDragLeave.bind(this))},_detachEvent:function(){this._$target.off(this._eventNamespace)},activateDropEvent:function(){this._attachEvent()},deactivateDropEvent:function(){this._detachEvent()},_appendDropZone:function(){if(!this._$dropZone){this._$target=this._$target.append(this._template());this._$dropZone=this._$target.find(".se_dropzone")}},_showDropZone:function(){if(this._isMultipleDropOnIE11()){this._$target.css("position","static")}this._appendDropZone();var a=this._getOffsetTop();var b=this._getScrollTop();var c=this._getDocumentTitleMargin();this._$dropZone.addClass("is-on");if(a===0){return}if(b>=a-c){this._$dropZone.css("top",0)}else{this._$dropZone.css("top",a-b-c)}},_getDocumentTitleMargin:function(){var a=0;this._$documentTitle=$(".se_documentTitle");if(this._$documentTitle.length>0){a=parseInt(this._$documentTitle.css("marginBottom").replace("px",""),10)}return a},_getOffsetTop:function(){if(this._type===this.TYPE.MULTIPLE){return this._$multipleTarget.offset().top}return this._$target.offset().top},_getScrollTop:function(){return this._$window.scrollTop()||this._$frame.contents().scrollTop()},_hideDropZone:function(){if(!this._$dropZone){return}if(this._isMultipleDropOnIE11()){this._$target.removeAttr("style")}this._$dropZone.removeClass("is-on");this._$dropZone.remove();this._$dropZone=null},_isNotFileType:function(a){return _.indexOf(a,"Files")<0},_isMultipleDropOnIE11:function(){var a=eg.agent().browser;var b=this._type===this.TYPE.MULTIPLE;var c=a.name==="ie"&&parseInt(a.version,10)>=11;return b&&c},_onDragOver:function(a){a.preventDefault();if(eg.agent().browser.name==="ie"){window.focus()}},_onDragEnter:function(a){a.stopPropagation();this._enterTarget=a.target;var b=a.originalEvent.dataTransfer.types;if(this._isNotFileType(b)){return}this._showDropZone()},_onDragLeave:function(a){if(this._enterTarget===a.target){this._hideDropZone()}},_onDrop:function(a){a.preventDefault();a.stopPropagation();this._hideDropZone();var b=a.originalEvent.dataTransfer;var c=b.files;var d=b.types;if(this._isNotFileType(d)){return}if(this._type===this.TYPE.SINGLE){c=[c[0]]}this._uploader&&this._uploader.upload(c);clickcr(this._$target,this._getNClickCode(),"","")},_getNClickCode:function(){if(this._$target.get(0).id==="se_title_wrapper"){return"ttl.photodrop"}if(this._$target.get(0).id==="se_components_wrapper"){return"pht.newdrop"}},destroy:function(){this._detachEvent()}});window.$SE_FILE_VALIDATOR=se.defineStatic("se.FileValidator",function(){var a;var b;var c;var d;var e;var f;var g;var h;var i;function j(){g=0;h=0;i=0;a=$SE_CONFIG.SERVICE_CONFIG.LIMITED_FILE_INFO;
b=a.COUNT||1;c=a.SIZE||0;d=q(c);f=c*b;e=q(f)}function k(){g=0;var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_COMPONENTS_DATA);a.forEach(function(a){if(a["@ctype"]===$SE_CONFIG.COMP_TYPE.FILE){g++;h+=parseFloat(a.fileSize)}},this);i=q(h)}function l(){if(g>=b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_CAN_NOT_UPLOAD_MAX_FILE_LENGTH").replace("{=MAXLENGTH}",b));return false}return true}function m(){if(h>=f){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_CAN_NOT_UPLOAD_MAX_FILE_SIZE").replace("{=MAXSIZE}",e));return false}return true}function n(a){if(a>c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_EXCEED_MAX_SIZE").replace("{=MAXSIZE}",d));return false}return true}function o(a){if(this.validateTotalFile()===false){return}h+=a.fileSize;g++}function p(a){h-=a.fileSize;g--}function q(a){return a/Math.pow(1024,2)}function r(a){return n(a.fileSize)}function s(){if(l()&&m()){return true}return false}function t(){return h}function u(){return g}return{init:j,updateTotalFileStatus:k,validateFile:r,validateTotalFile:s,addTotalFile:o,subtractTotalFile:p,getTotalFileSize:t,getTotalFileCount:u}}());se.defineClass("se.FileUploader",{DEFAULT_CALLBACKS:{success:function(){},error:function(){},complete:function(){},change:function(){},progressall:function(){},add:function(){}},construct:function(a,b){this._sGuideType=a;this._initVar();this._setCallback(b);this._removeEmptyFileInput();this._$elFileUploader=this._getInput();this._$elFileUploader.fileupload({singleFileUploads:false,replaceFileInput:false,autoUpload:false,sequentialUploads:true,dataType:"json",change:this._change.bind(this),success:this._success.bind(this),error:this._error.bind(this),complete:this._complete.bind(this),progressall:this._progressall.bind(this),add:this._add.bind(this)})},_initVar:function(){this._oComponent=null},_getInput:function(){var a=$('<input type="file" name="file" class="blind">');$("body").append(a);return a},_removeEmptyFileInput:function(){if($(":file").length>0){$.each($(":file"),function(a,b){if($(b).val()===""){$(b).off();$(b).remove()}})}},setFileUploader:function(a,b){this._htFileSetting=b;this._$elFileUploader.prop("accept",this._htFileSetting.accept);this._$elFileUploader.prop("multiple",this._htFileSetting.multiple);this._$elFileUploader.trigger("click")},_setCallback:function(a){this._htCallbacks=$.extend(this.DEFAULT_CALLBACKS,a)},_change:function(a,b){var c=b.files;var d=null;if(c.length<1){return}if(this._isValidateFiles(c)===false){this._$elFileUploader.val("");return}this._oComponent=this._htCallbacks.change();var e=this._getFileUploadRequest();for(var f=0;f<c.length;f++){d=c[f];e.files=d;this._jqXHR=this._$elFileUploader.fileupload("send",e)}},_getFileUploadRequest:function(){var a={url:this._htFileSetting.url};if(this._htFileSetting.data){a.formData=this._htFileSetting.data}return a},_isValidateFiles:function(a){var b=null;var c=false;var d=false;for(var e=0;e<a.length;e++){b=a[e];d=this._isOverMaxFileSize(b);c=this._isMachFileType(b)}if(c===false){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_UNSUPPORTED_FILE"));return false}if(d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_EXCEED_MAX_SIZE").replace("{=MAXSIZE}",this._htFileSetting.maxSizeMB));return false}return true},_isOverMaxFileSize:function(a){if(a.size>this._htFileSetting.maxSize){return true}return false},_isMachFileType:function(a){if(this._htFileSetting.pattern===""){return true}if(a.name.toLowerCase().match(this._htFileSetting.pattern)===null){return false}return true},_add:function(){if(this._oComponent){this._oComponent.bindFileUploadAbort(this._abort.bind(this))}},_success:function(a){if(a.isSuccess===false){this._showError(a);return}if(this._oComponent&&a.result){var b=a.result;b.uploadedLocal=true;this._oComponent.reRenderBy(b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPEND_EMPTY_LINE_AT_LAST,this._oComponent.getId())}this._htCallbacks.success(a)},_abort:function(){if(this._jqXHR){this._jqXHR.abort()}},_error:function(a){if(a.statusText==="abort"){return}var b=this._htCallbacks.error;var c=se.i18n.getMsg("MSG_AJAX_FILE_ERROR_CONTENT");var d=this._oComponent;var e=se.editor.template.common["modal-file-error-content.hbs"];if(a.errorMsg&&a.errorMsg!==""){c=a.errorMsg}$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:e({errorMsg:c}),"class":"pop_demoErr_wrap",dimmed:true,buttons:[{text:"확인","class":"type2",click:function(a){a.stopPropagation();$SE_MODAL.close()}}],beforeClose:function(){if(d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)}b(a)}});$SE_MODAL.open()},_complete:function(a){this._htCallbacks.complete(a.responseJSON);this._$elFileUploader.val("");this._$elFileUploader.remove()},_showError:function(a){if(a.errorCode==207){if(this._oComponent){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)}$SE_COMMON_UTIL.alertNaverLogin()}else{this._error(a)}},_progressall:function(a,b){var c=parseInt(b.loaded/b.total*100,10);if(this._oComponent){this._oComponent.updateProgress(c)}this._htCallbacks.progressall(c);var d=this;setTimeout(function(){d._$elFileUploader.trigger("stop")},5e3)},destroy:function(){this._$elFileUploader.fileupload("destroy");this._$elFileUploader.remove();this._$elFileUploader=null}});se.defineComponent("se.LocalFileDialog",{FILE_DIALOG:{CHANGE:"FILE_DIALOG.CHANGE"},DEFAULT_OPTIONS:{accept:[".jpg",".jpeg",".gif",".png",".bmp"].join(", "),multiple:false},construct:function(a,b,c){this._uploader=b;this._initVal(a,c);this._attachEvent()},_initVal:function(a,b){this._$inputFile=this._getInputFile($.extend(true,{},this.DEFAULT_OPTIONS,a),b)},_attachEvent:function(){this._$inputFile.on("change",this._onChangeInput.bind(this))},_getInputFile:function(a,b){var c=b instanceof jQuery?b:$("body");var d;d=$('<input type="file" name="file" class="blind">');d.prop("accept",a.accept);d.prop("multiple",a.multiple);c.append(d);return d},open:function(){this._$inputFile.trigger("click")},_onChangeInput:function(a){var b=a.target.files;this._uploader&&this._uploader.upload(b);this.trigger(this.FILE_DIALOG.CHANGE,b);this._$inputFile.val("");this.destroy()},destroy:function(){this._$inputFile.off();this._$inputFile.remove()}});$SE_IMAGE_REPOSITORY_SERVICE=se.defineStatic("se.ImageRepositoryService",function(){var a;var b;var c=function(){a=new se.ImageAttributeConverter;b=new se.ImageRepository};var d=function(a){return b.getSessionKey(a)};var e=function(a,c,d,e){return b.uploadCopyImage(a,c,d,e)};var f=function(a,c,d,e){return b.uploadCloneImage(a,c,d,e)};var g=function(b){return a.convertToImage(b)};c();return{getSessionKey:d,uploadCopyImage:e,uploadCloneImage:f,convertToImage:g}}());se.defineClass("se.ImageFileUploader",{USER_ID:$SE_CONFIG.USER_INFO.id,SERVICE_NAME:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN:$SE_CONFIG.ENV_SETTING.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN,DEFAULT_CALLBACK:{error:function(){},success:function(){},complete:function(){},completeAll:function(){},start:function(){},uploading:function(){}},construct:function(a,b){this._afterCallback=$.extend({},this.DEFAULT_CALLBACK,a);this._sessionKey=null;if(this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN){this._phupUploader=this._getSimplePhup(b);this._base64PhupUploader=this._getBASE64Phup(b)}},_getSimplePhup:function(a){var b=this._makePhupOpt(a);return phup.getUploader("SIMPLE",this._phupUploadComplete.bind(this),b)},_getBASE64Phup:function(a){var b=this._makePhupOpt(a);return phup.getUploader("BASE64",this._phupUploadComplete.bind(this),b)},_makePhupOpt:function(a){return $.extend(true,{domain:this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN,getSessionKey:function(a){a(this._sessionKey)}.bind(this),userId:this.USER_ID,sslEnabled:document.location.protocol==="https:",autorotate:true,resourcePath:"/static/js/lib/phup.js/dist",extractAnimatedCnt:true,onstart:function(a){var b=a.xhr;b.onerror=this._updateUploadCount.bind(this);b.onabort=this._updateUploadCount.bind(this)}.bind(this)},a)},upload:function(a){if(!this.EXCEPT_PROTOCOL_PHOTO_UPLOADER_DOMAIN){$SE_AJAX.showError();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END);return}this._files=a;this._totalCount=a.length||0;this._completedCount=0;this._errorCount=0;this._getSessionKey()},_getSessionKey:function(){$SE_IMAGE_REPOSITORY_SERVICE.getSessionKey({done:this._successGetSessionKeyCallback.bind(this),fail:this._failGetSessionKeyCallback.bind(this)})},_failGetSessionKeyCallback:function(){$SE_AJAX.showError();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END)},_successGetSessionKeyCallback:function(a){var b=a.result;if(b.sessionKey){this._sessionKey=b.sessionKey;$.each(this._files,this._uploadPhupUploader.bind(this))}},_uploadPhupUploader:function(a,b){if(b instanceof Blob){this._phupUploader.upload({file:b,index:a});this._afterCallback.uploading(b)}else{this._base64PhupUploader.upload(b)}},_phupUploadComplete:function(a){if(this._isError(a)){this._error(a)}else{this._success(a)}},_isError:function(a){return a.code!=="IMAGE"},_error:function(a){this._afterCallback.error(this._getFileWithName(a));this._complete()},_getFileWithName:function(a){var b=this._files[a.index].name;return $.extend({},a,{name:b})},_success:function(a){var b=a;if(this._afterCallback.filter){b=this._afterCallback.filter(a)}this._afterCallback.success(b);this._complete()},_complete:function(){this._completedCount++;if(this._totalCount===this._completedCount){this._completeAll()}this._afterCallback.complete()},_completeAll:function(){this._afterCallback.completeAll()},_updateUploadCount:function(){if(this._errorCount){this._errorCount++}if(this._completedCount){this._completedCount++}}});se.defineComponent("se.ExternalImageUploader",{construct:function(a){var b={uploadType:"copy"};this.option=$.extend(true,b,a);this.option.isFromImageSearch=typeof this.option.isFromImageSearch===undefined?false:this.option.isFromImageSearch;this.x2js=new X2JS},_getSessionKey:function(){$SE_IMAGE_REPOSITORY_SERVICE.getSessionKey({done:this._successGetSessionKey.bind(this),fail:this._failGetSessionKey.bind(this)})},_failGetSessionKey:function(){$SE_AJAX.showError();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END)},_successGetSessionKey:function(a){var b=a.result;if(b.sessionKey){this._uploadImage(b.sessionKey)}},upload:function(a,b,c){this._aCompData=[];this._htPayload=b;this._fCallback=c;this._images=a;this._totalCount=a.length||0;this._completedCount=0;this._nFailCount=0;this._getSessionKey()},_uploadImage:function(a){var b=this.option.uploadType;if(b==="copy"){this._requestUploadCopyImage(a)}else if(b==="clone"){this._requestUploadCloneImage(a)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.START,this._totalCount)},_requestUploadCopyImage:function(a){var b={done:this._success.bind(this),fail:this._error.bind(this)};$.each(this._images,function(c,d){$SE_IMAGE_REPOSITORY_SERVICE.uploadCopyImage(c,d,a,b)}.bind(this))},_requestUploadCloneImage:function(a){var b={done:this._success.bind(this),fail:this._error.bind(this)};$.each(this._images,function(c,d){$SE_IMAGE_REPOSITORY_SERVICE.uploadCloneImage(c,d,a,b)}.bind(this))},_error:function(){this._nFailCount++;this._complete()},_success:function(a,b,c){var d=this.x2js.xml_str2json(c.responseText);var e;if(d.result&&d.result.isSuccess==="false"){this._error();return}e=$SE_IMAGE_REPOSITORY_SERVICE.convertToImage(d.item);if(this.option.isFromImageSearch){e.caption=this.option.caption;e.captionLink=this.option.captionLink}this._aCompData.push(e);if(!this.option.isFromImageSearch){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.UPLOADING,e)}this._complete()},_insertImage:function(){var a=_.sortBy(this._aCompData,"index");var b=a.length;var c=0;if(!b){return}if(this._fCallback&&!this.option.isFromImageSearch){this._fCallback(a[0]);return}var d=$.extend(true,this._htPayload,{compData:a,shouldFocus:true});d.callbacks={onLoaded:function(){c++;if(b===c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_STICKY_TOOLBAR);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.SHOW)}}};$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,d);if(this._fCallback&&this.option.isFromImageSearch){var e=a[0];this._fCallback(e)}},_complete:function(){this._completedCount++;if(this.isUploadComplete()){this._completeAll()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.UPLOADED)},isUploadComplete:function(){return this._totalCount===this._completedCount},_processFailImage:function(){var a=this._nFailCount;if(a===0){return}if(this.hasOn("onAfterUploadFail")){this.trigger("onAfterUploadFail",{failCount:a});return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("IMAGE_UPLOAD_ERROR_FAIL").replace("{=FAIL_COUNT}",a))},_completeAll:function(){this._insertImage();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_STICKY_TOOLBAR);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END);this._processFailImage()}});se.defineComponent("se.ImageFileUploaderComponent",{IMAGE_FILE_UPLOADER:{ERROR:"IMAGE_FILE_UPLOADER.ERROR",SUCCESS:"IMAGE_FILE_UPLOADER.SUCCESS",COMPLETE:"IMAGE_FILE_UPLOADER.COMPLETE",COMPLETE_ALL:"IMAGE_FILE_UPLOADER.COMPLETE_ALL"},TOTAL_COUNT:Infinity,construct:function(a,b){this._initVal(a);this._attachEvent();this._imageFileUploader=new se.ImageFileUploader({error:this._errorImageFileUploader.bind(this),success:this._successImageFileUploader.bind(this),complete:this._completeImageFileUploader.bind(this),completeAll:this._completeAllImageFileUploader.bind(this),filter:this._convertImageModelJsonBy.bind(this),uploading:this._uploadingImageFileUploader.bind(this)});b=b||$SE_CONFIG.EXTENSION.IMAGE;this._isImageStop=_.isEqual(b,$SE_CONFIG.EXTENSION.IMAGE_STOP);this._logCollector=new se.LogCollector;this._uploaderValidator=new se.UploaderValidator({EXTENSION:b});this._setTotalCount()},_initVal:function(a){this._uploadImage=[];this.EVENT_HUB_COMMAND=$SE_EVENT_HUB.MSG.COMMAND;var b={error:function(){},success:function(){},complete:function(){},completeAll:function(){var a=this;var b=a.getErrors();if(b&&$SE_CONFIG.ENV_SETTING.SERVICE_NAME===$SE_CONFIG.SERVICE_TYPE.GP&&$SE_MODAL.isOpen()){alert(b.errors[0].errorContent)}else{$SE_ALERT.init(b,{closed:function(){a.clearErrorLog()}});setTimeout(function(){$SE_ALERT.open()},500)}}.bind(this),uploading:function(){}};this._afterCallback=$.extend({},b,a)},_attachEvent:function(){},_errorImageFileUploader:function(a){this._updateLogCollector(a);this.trigger(this.IMAGE_FILE_UPLOADER.ERROR);this._afterCallback.error()},_successImageFileUploader:function(a){$SE_EVENT_HUB.trigger(this.EVENT_HUB_COMMAND.UPLOAD_STATUS_BAR.UPLOADING,a);this.trigger(this.IMAGE_FILE_UPLOADER.SUCCESS,a);this._afterCallback.success(a);this._uploadImage.push(a)},_completeImageFileUploader:function(){this.trigger(this.IMAGE_FILE_UPLOADER.COMPLETE);$SE_EVENT_HUB.trigger(this.EVENT_HUB_COMMAND.UPLOAD_STATUS_BAR.UPLOADED);this._afterCallback.complete()},_completeAllImageFileUploader:function(){$SE_EVENT_HUB.trigger(this.EVENT_HUB_COMMAND.UPLOAD_STATUS_BAR.END);var a=_.sortBy(this._uploadImage,"index");var b={};var c=a.length;var d=0;b.compData=a;b.callbacks={onLoaded:function(){d++;if(c===d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_STICKY_TOOLBAR);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.SHOW)}}};this.trigger(this.IMAGE_FILE_UPLOADER.COMPLETE_ALL,b);this._afterCallback.completeAll(b);this._uploadImage.length=0},_uploadingImageFileUploader:function(a){this._afterCallback.uploading()},_convertImageModelJsonBy:function(a){return $SE_IMAGE_REPOSITORY_SERVICE.convertToImage(a)},upload:function(a){var b=this._uploaderValidator.filterOut(a);this._uploadImageFileUploader(b.validFile);this._addLogCollectorUnsupportedExt(b.invalidFile);if(b.validFile.length<1&&b.invalidFile.length>0){this._afterCallback.completeAll()}},uploadBase64:function(a){$SE_EVENT_HUB.trigger(this.EVENT_HUB_COMMAND.UPLOAD_STATUS_BAR.START,a.length);this._imageFileUploader.upload(a)},_uploadImageFileUploader:function(a){a=this._addLogCollectorLimitationCountError(a);if(!a||a.length<1){return}$SE_EVENT_HUB.trigger(this.EVENT_HUB_COMMAND.UPLOAD_STATUS_BAR.START,a.length);this._imageFileUploader.upload(a)},_addLogCollectorLimitationCountError:function(a){if(this.TOTAL_COUNT===Infinity){return a}var b=a.splice(this.TOTAL_COUNT)||[];$.each(b,function(a,b){this._updateLogCollector({index:a,code:"LIMITATION_BY_SESSION_COUNT",name:b.name})}.bind(this));return a},_addLogCollectorUnsupportedExt:function(a){var b=this._isImageStop?"UNSUPPORTED_IMAGE_STOP":"UNSUPPORTED_EXTENSION";$.each(a,function(a,c){this._updateLogCollector({index:a,code:b,name:c.name})}.bind(this))},_updateLogCollector:function(a){this._logCollector.update(a)},getErrors:function(){var a=this._logCollector.getLogInfoWith();var b=a.length;var c=false;var d=false;var e=false;var f=false;var g=$SE_CONFIG.SERVICE_CONFIG.IMAGE_MAX_SIZE;if(b<1){return false}$.each(a,function(a,b){var h=b.errorKey;if(this._hasUnknownCode(h)){c=true}if(this._hasUnsupported(h)){d=true}if(this._hasLimitationCount(h)){e=true}if(this._hasLimitationSize(h)){f=true;b.errorContent=b.errorContent.replace("{{=imageMaxSize}}",g)}}.bind(this));return{count:b,errors:a,isImageStop:this._isImageStop,hasUnknown:c,hasImageUnsupported:d,hasLimitationCount:e,hasLimitationSize:f,imageMaxSize:g}},_hasUnknownCode:function(a){return a.indexOf("UNKNOWN")>-1},_hasUnsupported:function(a){return a.indexOf("UNSUPPORTED")>-1},_hasLimitationCount:function(a){return a.indexOf("LIMITATION_COUNT")>-1},_hasLimitationSize:function(a){return a.indexOf("LIMITATION_SIZE")>-1},clearErrorLog:function(){this._logCollector.clear()},_setTotalCount:function(){var a=window.navigator.userAgent.toLocaleLowerCase()||"";if(a.indexOf("windows")>-1){this.TOTAL_COUNT=50}}});se.defineComponent("se.FileUploadComponent",{SERVICE_NAME:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,LIMITED_FILE_INFO:{SIZE:Infinity,COUNT:Infinity},LIMITED_AUDIO_INFO:{SIZE:Infinity,COUNT:Infinity},construct:function(a,b){this._initFileSetting();if(a===$SE_CONFIG.FILE_TYPE.FILE){this._exceptFileDataBy(this.SERVICE_NAME)}this._fileUploader=new se.FileUploader(a,b);this._fileUploader.setFileUploader(a,this._getSettingBy(a));return this._fileUploader},_getSettingBy:function(a){return this.SETTING_FILEUPLOADER_TYPE[a]},_initFileSetting:function(){var a=$SE_CONFIG.SERVICE_CONFIG;this.LIMITED_FILE_INFO=$.extend({},this.LIMITED_FILE_INFO,a.LIMITED_FILE_INFO);this.LIMITED_AUDIO_INFO=$.extend({},this.LIMITED_AUDIO_INFO,a.LIMITED_AUDIO_INFO);this.SETTING_FILEUPLOADER_TYPE={};this.SETTING_FILEUPLOADER_TYPE[$SE_CONFIG.FILE_TYPE.AUDIO]={url:"/audio/upload.json",accept:[".mp3",".wav",".m4a",".wma"].join(", "),pattern:new RegExp("(mp3|wav|m4a|wma)$","g"),multiple:false,maxSize:this.LIMITED_AUDIO_INFO.SIZE,maxSizeMB:this._fromByteToMB(this.LIMITED_AUDIO_INFO.SIZE)};this.SETTING_FILEUPLOADER_TYPE[$SE_CONFIG.FILE_TYPE.FILE]={url:"/file/"+this.SERVICE_NAME+"/upload.json",accept:"*/*",pattern:"",multiple:false,maxSize:this.LIMITED_FILE_INFO.SIZE,maxSizeMB:this._fromByteToMB(this.LIMITED_FILE_INFO.SIZE)}},_fromByteToMB:function(a){return a/Math.pow(1024,2)},_exceptFileDataBy:function(a){if(a===$SE_CONFIG.SERVICE_TYPE.BLOG){this.SETTING_FILEUPLOADER_TYPE[$SE_CONFIG.FILE_TYPE.FILE].data={blogId:$SE_CONFIG.USER_INFO.id}}else{delete this.SETTING_FILEUPLOADER_TYPE[$SE_CONFIG.FILE_TYPE.FILE].data}},destroy:function(){this._fileUploader.destroy()}});se.defineComponent("se.UploadStatusBar",{construct:function(a){this._initTarget(a);this._initVal();this._bindEvent()},_initTarget:function(a){var b=a instanceof jQuery?a:$("body");var c=se.editor.template.common["upload-status-bar.hbs"];b.append(c());this.$el=b.find(".__se_upload_status_bar")},_initVal:function(){this.$uploadStatusBar=this.$el.find(".__se_uploadStatusBar");this.$progress=this.$el.find(".__se_progress");this.$fileName=this.$el.find(".__se_file_name");this.$fileSize=this.$el.find(".__se_file_size");this.$uploadingFileCount=this.$el.find(".__se_uploaded_cnt");this.$totalFileCount=this.$el.find(".__se_total_cnt");this._updatedCount=0;this._totalCount=0},_bindEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.START,this.start.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END,this.end.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.UPLOADING,this.uploading.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.UPLOADED,this.uploaded.bind(this))},showLoading:function(){this.$uploadStatusBar.addClass("is-loading")},hideLoading:function(){this.$uploadStatusBar.removeClass("is-loading")},show:function(){this.$el.addClass("is-on")},hide:function(){this.$el.removeClass("is-on")},start:function(a){this._totalCount=a;this._updatedCount=0;this._initFileInfo();this.show();this.showLoading()},end:function(){this.hide()},uploading:function(a){this._updateFileInfo(a);this.hideLoading()},uploaded:function(){this._updatedCount++;this._updateProgressStatus()},_initFileInfo:function(){this.$fileName.text("업로드 중입니다");this.$fileSize.text("");this.$totalFileCount.text(this._totalCount);this._updateProgressStatus()},_updateProgressStatus:function(){this.$progress.css("width",this._getProgressPercent()+"%");this.$uploadingFileCount.text(this._updatedCount)},_updateFileInfo:function(a){if(!a){return}this.$fileName.text(a.fileName);this.$fileSize.text(this._getMBByByte(a.fileSize)+" MB")},_getProgressPercent:function(){return this._updatedCount/this._totalCount*100},_getMBByByte:function(a){a=Number(a);var b=a/Math.pow(1024,2);return b.toFixed(2)},destroy:function(){this.$el.remove()}});$SE_UPLOADER_FACTORY=se.defineStatic("se.UploaderFactory",function(){var a=null;function b(b,c){if(b===$SE_CONFIG.COMP_TYPE.IMAGE){a=new se.ImageFileUploaderComponent}else{a=new se.FileUploadComponent(b,c)}return a}function c(){if(a===null){return}a.destroy();a=null}return{getInstance:b,destroy:c}}());se.defineClass("se.TagsInput",{construct:function(a){a=a||{};this._initVal();this._render(a.$parent,a.template);this._initialize();this._assignElement();this.bindEvent();this._bindGatewayEvent()},_initVal:function(){this._bPass=false;this._sCashedText="";this._bCanvas=!$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._bReadonly=false;this._bShouldRefresh=true;this._maxTagCounts=$SE_CONFIG.SERVICE_CONFIG.MAX_TAG_COUNTS;this._$elinputHolder=null;this._$elInput=null;this._$elAutoComp=null;this._$elFakeInput=null},_assignElement:function(){this._$elinputHolder=$("span.se_tag_input_holder");this._$elInput=this._$elinputHolder.find("input.ui-widget-content");this._$elAutoComp=$(".tagit-autocomplete");this._$elFakeInput=$("#input_tag");this._$tagitWrapper=this._$elinputHolder.find(".tagit-new")},_render:function(a,b){if(!a||!b){return}a.append(b({maxTagCounts:this._maxTagCounts}))},_initialize:function(){$("#input_tag").tagit({animate:false,autocomplete:{source:this._autoComplete.bind(this),open:this._replaceAutoList.bind(this)},tagLimit:this._maxTagCounts,placeholderText:se.i18n.getMsg("MSG_TAGIT_PLACEHOLDER").replace("{=MAXCOUNT}",this._maxTagCounts),beforeTagAdded:this._checkInputLength.bind(this),afterTagAdded:this._hideInput.bind(this),beforeTagRemoved:this._removeBySelect.bind(this),afterTagRemoved:this._hideInput.bind(this,true),preprocessTag:this._checkSpeacialChar.bind(this),onTagClicked:this._selectTag,onTagExists:this._existTag.bind(this)})},bindEvent:function(){this._$elInput.on("mousedown",this._onMouseDownTagInput.bind(this)).on("keydown",this._onKeyDownTagInput.bind(this)).on("input",this._checkInputLength.bind(this)).on("focus",this._onFocusTagInput.bind(this));this._$elinputHolder.on("click","li.tagit-choice",this.focusInput.bind(this));this._$elAutoComp.on("mousedown",this._stopPropagation);this._$elFakeInput.on("keydown",this._removeByDelKey)},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.CLEAR_AUTO_LAYER,this.clearAutoLayer.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.READONLY,this.readonly.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.GET_TAG_LIST,this.getTagList.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.SET_TAG_LIST,this.setTagList.bind(this))},unbindEvent:function(){this._$elInput.off("mousedown",this._onMouseDownTagInput.bind(this)).off("keydown",this._onKeyDownTagInput.bind(this)).off("input",this._checkInputLength.bind(this)).off("focus",this._onFocusTagInput.bind(this));this._$elinputHolder.on("click","li.tagit-choice",this.focusInput.bind(this));this._$elAutoComp.off("mousedown",this._stopPropagation);this._$elFakeInput.off("keydown",this._removeByDelKey)},_stopPropagation:function(a){a.stopPropagation()},_onFocusTagInput:function(){this._bPass=true},_onKeyDownTagInput:function(a){this.nCursorIndex=$SE_COMMON_UTIL.getCaretPosition(a.target);this._bShouldRefresh=true;if(a.keyCode===38||a.keyCode===40){this._bShouldRefresh=false}if(a.keyCode===13&&this._$elInput.val()===""){return false}},_onMouseDownTagInput:function(a){if(this._bPass){a.stopPropagation()}},_setDefaultTags:function(a){if($SE_CONFIG.ENV_SETTING.SERVICE_NAME==="post"&&a){this.setTagList(a)}},focusInput:function(){this._$elFakeInput.focus()},_autoComplete:function(a,b){if(!this._bShouldRefresh){return}var c={type:"GET",data:{serviceId:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,query:a.term,locale:$SE_CONFIG.ENV_SETTING.I18N_LOCALE}};var d=$SE_CONFIG.SERVICE_CONFIG.MAX_TAG_LENGTH||20;$SE_AJAX.request($SE_CONFIG.API.TAG_AUTOCOMPLETE,c,{fSuccess:function(a,c,e){var f=a.result.items;var g;if($SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){g=this._getGPAutocompleteWords(f,d)}else{g=this._getAutocompleteWords(f,d)}b($.map(g,function(a){return{value:a}}))}.bind(this)})},_getGPAutocompleteWords:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){for(var f=0,g=a[d].length;f<g;f++){if(a[d][f][0].length>b){continue}c.push(a[d][f])}}return c},_getAutocompleteWords:function(a,b){var c=[];for(var d=0,e=a.length;d<e;d++){for(var f=0,g=a[d].length;f<g;f++){if(a[d][f][0][0].length>b){continue}c.push(a[d][f][0])}}return c},_replaceAutoList:function(){var a=this._$elAutoComp.position(),b=a.left,c=a.top,d=window.navigator.userAgent,e=d.indexOf("MSIE ")>0,f=e||!!d.match(/Trident.*rv\:11\./)?$(document.documentElement):$(document.body);this._$elAutoComp.css({top:c+10+"px"});if(this._$elAutoComp.css("top").split("px")[0]*1+this._$elAutoComp.height()>f.innerHeight()){f.animate({scrollTop:document.body.scrollHeight},500)}},_removeBySelect:function(a,b){var c="";if($(".se_tag_input_holder").find(".remove").length){c=$(".se_tag_input_holder").find(".remove").find(".tagit-label").text();if(c===b.tagLabel)return;a.preventDefault();$("#input_tag").tagit("removeTagByLabel",c)}},_removeByDelKey:function(a){if((a.keyCode===46||a.keyCode===8)&&$(".se_tag_input_holder").find(".remove").length){var b=$(".se_tag_input_holder").find(".remove").find(".tagit-label").text();$("#input_tag").tagit("removeTagByLabel",b)}},_checkSpeacialChar:function(a){if(!a){return""}a=a.replace(/(\s*)/g,"");var b=a.match($SE_STRING.checkSpeacialChar());if(!b||b[0]!==a){this._popupToast(se.i18n.getMsg("MSG_SPECIAL_CHAR_DENIAL"));return""}return a},_selectTag:function(a,b){var c=b.tag[0].classList;if(c.contains("remove")&&c.contains("ui-state-highlight")){b.tag.removeClass("remove ui-state-highlight");return}$(".tagit-choice").removeClass("remove ui-state-highlight");b.tag.addClass("remove ui-state-highlight");$(".tagit-choice").blur()},_existTag:function(){this._popupToast(se.i18n.getMsg("MSG_DUPLICATED_TAG"));this._$elInput.val("");return false},_excessTag:function(){if(!this._bPass){return}this._popupToast(se.i18n.getMsg("MSG_EXCEED_MAX_TAG_COUNT").replace("{=MAXCOUNT}",this._maxTagCounts));this._$elInput.val("")},_hideInput:function(a){if(!this._$elInput){this._assignElement()}if(this.getTagList().length>=this._maxTagCounts){if(!a){this._excessTag()}this._$elInput.attr("placeholder","")}else{this._$elInput.attr("placeholder",se.i18n.getMsg("MSG_TAGIT_PLACEHOLDER").replace("{=MAXCOUNT}",this._maxTagCounts))}},_getLimitedText:function(a,b){var c=0,d=a.length-this._sCashedText.length,e,f;for(c=0;c<b;c++){if(this._sCashedText.charAt(c)!=a.charAt(c)){break}}e=b-this._sCashedText.length;if(c!=b){this.nCursorIndex=c+e}f=a.substr(0,c+e)+a.substr(c+d);return f.substr(0,b)},_popupToast:function(a){if(this._bCanvas){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,a)}else{$(document.body).ntoast("setMessage",a);$(document.body).ntoast("popupToast")}},_toggleHashTagPlaceholder:function(){var a=this._$tagitWrapper;var b=this._$elInput.val();var c="is-focused";if(b!==""){a.addClass(c)}else{a.removeClass(c)}},_checkInputLength:function(a,b){if(this.getTagList().length>=this._maxTagCounts){this._excessTag();this._$elInput.attr("placeholder","")}var c=a.target;var d=$SE_CONFIG.SERVICE_CONFIG.MAX_TAG_LENGTH||20;var e=b?b.tagLabel:this._$elInput.val();var f;this._toggleHashTagPlaceholder();if(e.length>d){f=this._getLimitedText(e,d);this._popupToast(se.i18n.getMsg("MSG_MAX_TAG_LENGTH").replace("{=MAXLENGTH}",d));this._replaceInputText(f);$SE_COMMON_UTIL.setCaretPosition(c,c.value.length)}else{f=e}this._sCashedText=f},_replaceInputText:function(a){var b=this._$elInput;var c=$SE_COMMON_UTIL.detectIE()!==false;if(c!==false){b.data("autocomplete-open",true);b.attr("disabled",true)}b.val(a);if(c!==false){b.attr("disabled",false);setTimeout($.proxy(function(){b.data("autocomplete-open",false)},this),0);b.focus()}},getTagList:function(){var a=$(".se_tag_input_holder").find(".tagit-label"),b=[];for(var c=0;c<a.length;c++){b.push($(a[c]).text())}return b},setTagList:function(a){$("#input_tag").tagit("removeAll");if(!a){return}for(var b=0;b<a.length;b++){$("#input_tag").tagit("createTag",a[b])}},readonly:function(a){a=a===false?false:true;if(this._bReadonly===a){return}if(a){this._$elInput.hide().attr("readonly",true)}else{this._$elInput.attr("readonly",false).show()}this._bReadonly=a},clearAutoLayer:function(){this._bPass=false;setTimeout(function(){this._$elAutoComp.css("display","none")}.bind(this),300)}});window.$SE_MODAL=se.defineStatic("se.ModalManager",function(){var a=null;var b={};var c=false;var d;function e(c,e,g){if(a){h()}b=$.extend({},e);delete b.class;delete b.dimmed;if(g instanceof jQuery===false){g=$("body")}d=e.onClickDimmed||h;a=f(c,e);g.append(a);a.on("dragover drop",function(a){a.preventDefault()});return a}function f(a,c){var d=se.editor.template.common["modal-type-"+a+".hbs"];var e=d(c.templateData||{});var f=$(e).nmodallayer(b);if(c.dimmed===true){f.find(".__se_dim").removeClass("dim_invisible")}if(c.class&&c.class!==""){f.addClass(c.class)}f.addClass("__se_pop_type_"+a);return f}function g(){if(a===null){return}$SE_EVENT_UTIL.offBodyClickClose();if($SE_HOTKEY)$SE_HOTKEY.pause();i();a.nmodallayer("open");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.HIDE_IECURSOR);c=true}function h(){if(a===null){return}j();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.SHOW_IECURSOR);a.nmodallayer("close");a.remove();a=null;if($SE_HOTKEY)$SE_HOTKEY.unpause();c=false}function i(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"click.bodyclick",m);var b=function(a){a.preventDefault();a.stopPropagation()};a.find(".__se_dim").on("click",l).on("mousedown",b);a.find(".__se_pop_close").on("click",k).on("mousedown",b);a.on("keydown",function(a){a.stopPropagation()}).on("click",function(a){a.stopPropagation()})}function j(){a.find(".__se_dim").off();a.find(".__se_pop_close").off();a.off();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UNBIND_GLOBAL_EVENT_HANDLER,"click.bodyclick");
}function k(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE);h();a.stopPropagation()}function l(a){d();a.stopPropagation()}function m(b){if(a.find(b.target).length<1){d()}}function n(){return c}function o(){a=null;c=false}return{create:e,open:g,close:h,distroy:o,isOpen:n}}());
//# sourceMappingURL=se_common_2.min.js.map