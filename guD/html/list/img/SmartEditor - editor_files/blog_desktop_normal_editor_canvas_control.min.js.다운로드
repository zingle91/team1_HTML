/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineStatic("se.ComponentComposer",function(){var a={};a[$SE_CONFIG.COMP_TYPE.IMAGE]={};a[$SE_CONFIG.COMP_TYPE.IMAGE][$SE_CONFIG.COMP_TYPE.IMAGE]=d;a[$SE_CONFIG.COMP_TYPE.IMAGE][$SE_CONFIG.COMP_TYPE.IMAGE_STRIP]=e;function b(a){var b=c(a.htTargetComp,a.htBaseComp);var d=b(a.htTargetComp,a.htBaseComp,a.nInsertIndex);if(a.persistCompId!==true){delete d.compId}return d}function c(b,c){var d=a[b["@ctype"]][c["@ctype"]];return d}function d(a,b,c){var d=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.IMAGE_STRIP),e=[b];e.splice(c,0,a);d.components=e;var f=a.caption&&a.caption.length>0?true:false;var g=b.caption&&b.caption.length>0?true:false;if(f&&g){d.caption=b.caption;d.captionLink=b.captionLink?b.captionLink:""}else{d.caption=f?a.caption:b.caption;d.captionLink=a.captionLink?a.captionLink:b.captionLink}return d}function e(a,b,c){var d=b;var e=b.components;e.splice(c,0,a);d.components=e;if(!b.caption||b.caption.length===0){if(a.caption&&a.caption.length>0){d.caption=a.caption}}return d}function f(a){var b=a.data("image-id")==null?null:parseInt(a.data("image-id"));var c=a.data("js-image-dragarea");var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a.data("comp-id"));var e=d.getModelDataAsJson();e=b==null?e:e.components[b];if(c==null){return null}return e}function g(a){if(!a.htTargetComp.components){return a.htTargetComp}var b=$.extend({},a.htTargetComp);b.components.splice(a.nRemoveIndex,1);if(a.persistCompId!==true){delete b.compId}if(b["@type"]==="imageStrip"&&b.components.length<=1){b=b.components[0]}return b}function h(a){if(!a.htTargetComp.components){return a.htTargetComp}var b=$.extend({},a.htTargetComp);b.components.splice(a.nInsertIndex,0,a.htCompToInsert);if(a.persistCompId!==true){delete b.compId}return b}return{getMergedComponentData:b,getRemovedComponentData:g,getInsertedComponentData:h,getCompDataFromDraggable:f}}());$SE_COMPONENT_FACTORY=se.defineStatic("se.ComponentFactory",function(){var a=null;var b=$SE_CONFIG.SERVICE_CONFIG.NAMESPACE_PREFIX||"";var c=function(){if(!a){a=new se.CanvasCommonToolbar("basic",$SE_CONFIG.SERVICE_CONFIG.DESKTOP_TOOLBAR.buttons)}return a};var d=function(a,c){var d=a["@ctype"];var e=$SE_STRING.capitalize(d);return se[b+e+c]||se[e+c]};var e=function(a,b){var e=null;if(!a){return e}var g=d(a,"CompView");var h=f(a);if(g){e=new g(h,c(),b);if(a.compId){e.setId(a.compId)}}return e};var f=function(a){if(!a){return null}var b=null;var c=JSON.parse(JSON.stringify(a));var e=d(c,"Model");if(e){b=new e(c)}return b};var g=function(a){var b=$SE_MODEL_DATA_COORD.getDefaultCompData(a);return b};return{getDataModelInstance:f,getComponentData:g,getComponentInstance:e}}());se.defineComponent("se.ComponentListView",{construct:function(){this._initVar();this._assignElements();this._createModules();this._bindEvents();this._bindGatewayEvent();this.applySortable()},_initVar:function(){this._htComponentMap={};this._htParagraphMap={};this._bIsEventFromMouseDown=false},_assignElements:function(){this._$elTitleWrapper=$("#se_title_wrapper");this._$elComponentsWrapper=$("#se_components_wrapper");this._$elBodyWrapper=$("#se_canvas_body")},_createModules:function(){this._oComponentSelector=new se.ComponentSelector;this._oInsertResolver=new se.InsertResolver;this._oDragPresenter=new se.DragPresenter},_bindEvents:function(){this._$elBodyWrapper.on("mousedown",".se_component .se_sectionArea",this._onMouseDownComponent.bind(this)).on("mouseup",".se_component .se_sectionArea",this._onMouseUpComponent.bind(this)).on("mousedown",".se_component .se_textView",this._onMouseDownTextView.bind(this)).on("drop","[contenteditable], textarea",this._onDropEditableArea.bind(this));this._$elComponentsWrapper.on("mousedown","[contenteditable], textarea",this._onMouseDownEditableArea.bind(this));this._$elBodyWrapper.nautosize()},_unbindEvents:function(){this._$elBodyWrapper.off();this._$elComponentsWrapper.off();if(this._$elBodyWrapper.data("plugin_nautosize")){this._$elBodyWrapper.nautosize("destroy")}},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESIZE,this.resize.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE,this.updateAutoSize.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS,this.findActivatedComponents.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_REPRESENTATIVE_MATERIAL,this.updateRepresentativeMaterial.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_FIRST_MATERIAL,this.getFirstMaterial.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED,this.focusOutFocused.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_BY_COMP_TYPE,this.focusByCompType.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESELECT_ALL,this.deselectAll.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_STICKY_TOOLBAR,this.resetStickyToolbar.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CURRENT_FOCUSED,this.currentFocused.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,this.findComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_SUB_COMPONENT_BY_ID,this.findSubComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_SUB_COMPONENT_ID,this.findComponentBySubComponentId.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,this.findComponentBefore.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,this.findComponentAfter.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_FIRST_COMPONENT,this.findFirstCompoment.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_THEME,this.applyTheme.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.BIND_DRAG_OUT_SIDE_EVENT,this.bindDragOutsideEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UNBIND_DRAG_OUT_SIDE_EVENT,this.unbindDragOutsideEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.START_DRAG_MODE,this.startDragMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FINISH_DRAG_MODE,this.finishDragMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.REPLACE_COMPONENT,this.replaceComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.WRAP_COMPONENT,this.wrapComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED,this.findActivated.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.INSERT_COMPONENT,this.insertComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPEND_EMPTY_LINE_WITH_FOCUS,this.appendEmptyLineWithFocus.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPEND_EMPTY_LINE_AT_LAST,this.appendEmptyLineAtLast.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CAN_DELETE_CURRENT_TARGET,this.canDeleteCurrentTarget.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DELETE_TARGETS,this.findDeleteTargets.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_COMPONENT,this.deleteComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_COMPONENT_BY_ID,this.deleteComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_LIBRARIES_WITH_COMP,this.deleteLibrariesWithComp.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST,this.getCompViewList.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.IS_MAX_MEDIATAG_COMPONENT,this.isMaxMediaTagComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.GET_PLAIN_TEXT,this.getPlainText.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY_SORTABLE,this.destroySortable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY_SELECTABLE,this.destroySelectable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_SELECTABLE,this.applySelectable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_SORTABLE,this.applySortable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UNBIND_EVENT,this._unbindEvents.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.BIND_EVENT,this._bindEvents.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMPONENT_MAP,this.getComponentMap.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET,this.reset.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_DIRECTORY_META,this.updateDirectoryMeta.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SET_COMPONENT_MAP,this.setComponentMap.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,this.focusIn.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DOCUMENT_TITLE,this.findDocumentTitle.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.MOVE_FOCUS_WITH_KEY,this.moveFocusWithKey.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT,this.select.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.ATTACH_DRAGGABLE_TO_SUB_COMPONENT,this._attachDraggableToSubComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_DOC_STYLE,this.applyDocStyle.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY,this.destroy.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_SELECTED_COMPONENTS,this.getSelectedComponents.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CACHE_CURRENT_OFFSETS,this.cacheCurrentOffsets.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_CURRENT_OFFSETS_CACHE,this.resetCurrentOffsetsCache.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_OFFSET_CACHE,this.getOffsetCache.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT_ALL,this.selectAll.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE_OF_ALL,this.updateAutoSizeOfAll.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_IMAGES,this.updateImages.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.IS_ADD_COMPONENT_AVAILABLE,this.isAddComponentAvailable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RERENDER_FORCE_ORDER,this._rerenderForceOrder.bind(this))},updateAutoSize:function(a){this._$elBodyWrapper.nautosize("update",a)},applySortable:function(){this._oDragPresenter.applySortable()},destroySortable:function(){this._oDragPresenter._destroySortable()},applySelectable:function(){this._oComponentSelector._applySelectable()},destroySelectable:function(){this._oComponentSelector._destroySelectable()},_onDropEditableArea:function(a){a.preventDefault()},_onMouseDownTextView:function(a){if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CURRENT_EDITING_MODE)===$SE_CONFIG.EDITING_MODE.SELECT){a.preventDefault()}},_onMouseDownEditableArea:function(a){var b=this._findComponentByEvent(a);if(a.shiftKey&&this.isFocusedComponent(b)){a.stopPropagation()}if(a.target.classList.contains("__scrollable")===false){$SE_SCROLL_HELPER.activate()}},_onMouseUpComponent:function(a){var b=$(a.target);if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CURRENT_EDITING_MODE)===$SE_CONFIG.EDITING_MODE.DRAG||a.which!==1){return}this.finishDragMode();if(this._isEventFromScrollable(b)===false){if(this._isMultiSelected()===false||this._bIsEventFromMouseDown===true){return}}if(this._isSelectMode()){this._selectAsSpecialKey(a)}else{this._processAsComponentType(a)}},_isEventFromScrollable:function(a){return a.is(".__scrollable")},_isSelectMode:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CURRENT_EDITING_MODE)===$SE_CONFIG.EDITING_MODE.SELECT},_onMouseDownComponent:function(a){a.stopPropagation();var b=$(a.target);if(this._isEventFromToolbar(b)){a.preventDefault();return}this._bIsEventFromMouseDown=false;if(this._isMultiSelected()||a.which!==1||this._isEventFromScrollable(b)){return}if(this._isSelectMode()){this._selectAsSpecialKey(a)}else{this._processAsComponentType(a)}this._bIsEventFromMouseDown=true},_isMultiSelected:function(){return this.findActivatedComponents().length>=2},_focusInComponent:function(a,b){if(this.isFocusedComponent(a)){return}var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CURRENT_EDITING_MODE);var d=this.currentFocused();if(c===$SE_CONFIG.EDITING_MODE.NORMAL){this.focusIn(a,{from:d?d.getId():null,trigger:$SE_CONFIG.TRIGGER.CLICK,action:$SE_CONFIG.ACTION.MOVE,$event:b})}},_processAsComponentType:function(a){var b=$(a.target);var c=this._findComponentByEvent(a);var d=b.is("[contenteditable], input, textarea, .__focusable");if(!d){d=b.parents(".__focusable").length>0}if(c.isTextEditable()&&d===false){this._selectComponent(c)}else{this._focusInComponent(c,a)}},_selectComponent:function(a){this.deselectAll();this.focusOutFocused();this.select(a)},_getComponentIndex:function(a){var b=this._$elComponentsWrapper.find(".se_component");for(var c=0;c<b.length;c++){if(b.get(c).id===a){return c}}},_handleCurrentFocused:function(a){if(a&&a.isDocumentTitle()){this.focusOutFocused()}else{this.changeToSelected(a)}},_multiSelectWithShift:function(a){var b=this._oComponentSelector.getSelectedIndex();var c=this.currentFocused();var d=this._getComponentIndex(a.getId());var e=null;if(c&&c.isDocumentTitle()===false){e=this._getComponentIndex(c.getId());this._oComponentSelector.saveFirstSelectedIndex(e)}if(b.start==null){b.start=d;this._handleCurrentFocused(c)}else{this.focusOutFocused()}b.end=d;this._oComponentSelector.multiSelect(b.start,b.end)},_selectAsSpecialKey:function(a){var b=this._findComponentByEvent(a);if(b.isDocumentTitle()){return}if(a.shiftKey){this._multiSelectWithShift(b)}else{this._toggleComponentSelected(b)}},_toggleComponentSelected:function(a){if(a.isDocumentTitle()){return}var b=this.currentFocused();if(b&&b.isDocumentTitle()){this.focusOutFocused()}else{this.changeToSelected(b)}if(b!==a){this.toggleSelected(a)}},_findComponentByEvent:function(a){var b=$(a.target);var c=b.parents(".se_component");if(c.length===0){return}return this.findComponentById(c[0].id)},_isEventFromToolbar:function(a){return a.parents(".__se_toolbar").length>0},_isEventFromDocumentTitle:function(a){return $(a.currentTarget).parents(".se_documentTitle").length>0},_isNotCurrentFocused:function(a){return a!==document.activeElement},_attachDraggableToSubComponent:function(a){a.forEach(function(a){this._oDragPresenter.applyDraggable(a.getContainerWrappingElement())}.bind(this))},_detachDraggableToSubComponent:function(a){a.forEach(function(a){this._oDragPresenter.destroyDraggable(a.getContainerWrappingElement())}.bind(this))},destroyDraggable:function(a){this._detachDraggableToSubComponent(a)},applyDraggable:function(a){this._attachDraggableToSubComponent(a)},_destroyById:function(a,b){var c=this.findComponentById(a);if(c){if(c.getCompType()==$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){c.delImg();return}if(this.isFocusedComponent(c)){this.focusOutFocused()}c.destroy();delete this._htComponentMap[a];delete this._htParagraphMap[a]}else{c=this.findComponentBySubComponentId(a);if(c){c.removeSubComponentWithCompId(a,b)}}},_findUniqueParagraph:function(){var a=Object.keys(this._htParagraphMap);var b=Object.keys(this._htComponentMap).filter(function(a){return a.indexOf("documentTitle")===-1}).length;if(a.length===1&&b===1){return this._htParagraphMap[a[0]]}return null},_putIntoParagraphMap:function(a){if(a.isParagraph()||a.isWrappingParagraph()){this._htParagraphMap[a.getId()]=a}},_putIntoComponentMap:function(a){if($.isArray(a)){a.forEach(function(a){this._htComponentMap[a.getId()]=a;this._putIntoParagraphMap(a)}.bind(this))}else{this._htComponentMap[a.getId()]=a;this._putIntoParagraphMap(a)}},_getComponentWrappingElement:function(a){var b=this.findComponentById(a);if(!b){return null}return b.getContainerWrappingElement()},_hasNoComponent:function(){return this._$elComponentsWrapper.find(".se_component").length===0},_hasNoLastParagraph:function(){var a=this._$elComponentsWrapper.find(".se_component").last()[0].id;var b=this.findComponentById(a);return b.isParagraph()===false},_hasOnlyParagraph:function(){var a=this._$elComponentsWrapper.find(".se_component");return a.length===1&&a.is(".se_paragraph")},bindDragOutsideEvent:function(){this._oDragPresenter.bindDragOutsideEvent()},unbindDragOutsideEvent:function(){this._oDragPresenter.unbindDragOutsideEvent()},toggleSelected:function(a){this._oComponentSelector.toggleSelected(a)},changeToSelected:function(a){this._oComponentSelector.changeToSelected(a)},select:function(a){this._oComponentSelector.select(a)},selectAll:function(){var a=this.getCompViewList();a.forEach(function(a){if(this.isFocusedComponent(a)){this.changeToSelected(a)}if(a.getCompType()!==$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){this._oComponentSelector.select(a)}}.bind(this))},deselect:function(a){this._oComponentSelector.deselect(a)},focusIn:function(a,b){if(!a){return}this._oComponentSelector.focusIn(a,b)},currentFocused:function(){return this._oComponentSelector.currentFocused()},focusByCompType:function(a){var b=this.getCompViewList();b.forEach(function(b){if(b.getCompType()===a){this.focusOutFocused();this.focusIn(b);return true}},this)},hasFocused:function(){return this._oComponentSelector.currentFocused()!=null},focusOutFocused:function(){this._oComponentSelector.focusOutFocused()},_insertDefaultComponent:function(a){a.compData=$SE_CONFIG.COMP_TYPE.PARAGRAPH;a.bPushHistory=false;var b=this.insertComponent($.extend(true,{shouldFocus:false,action:$SE_CONFIG.ACTION.DELETE},a))[0];this._oComponentSelector.focusIn(b,a)},_decideActionOrigin:function(a){if(a.length>1){return"multiSelect"}else{return this.findComponentById(a[0]).getCompType()}},_appendNewParagraph:function(a){var b={action:$SE_CONFIG.ACTION.INSERT,trigger:$SE_CONFIG.TRIGGER.ENTER,compData:$SE_CONFIG.COMP_TYPE.PARAGRAPH,insertType:$SE_CONFIG.INSERT_TYPE.DEFAULT,target:a,shouldFocus:true};return this.insertComponent(b)},_isRequestWithDelete:function(a){return a&&a.trigger===$SE_CONFIG.TRIGGER.DELETE},_isRequestWithBackspace:function(a){return a&&a.trigger===$SE_CONFIG.TRIGGER.BACKSPACE},_withoutLastParagraph:function(a,b){if(b===$SE_CONFIG.TRIGGER.DELETE||b===$SE_CONFIG.TRIGGER.BACKSPACE){var c=this._$elComponentsWrapper.find(".se_component").last();var d=c[0].id;var e=this.findComponentById(d);if(e.isParagraph()){a=_.without(a,d);e.empty()}}return a},_getTargetIdsToDelete:function(){var a=[];if(this.hasFocused()){a=[this.currentFocused().getId()]}else{a=this._oComponentSelector.findSelectedIds()}return a},_decideDeleteComponent:function(a,b){if(a.isParagraph()&&b.isSectionTitle()){return[b.getId()]}if(a.isSectionTitle()&&b.isParagraph()){return[a.getId()]}return[a.getId()]},_getDeleteTargetOnEditable:function(a){var b=this.currentFocused();var c=this.findComponentBefore(b.getId());var d=this.findComponentAfter(b.getId());if(this._isRequestWithDelete(a)){return this._decideDeleteComponent(b,d)}if(this._isRequestWithBackspace(a)){return this._decideDeleteComponent(b,c)}},_getDeleteTarget:function(a){var b=this.currentFocused();var c=this.findComponentBefore(b.getId());var d=this.findComponentAfter(b.getId());if(this._isRequestWithDelete(a)){return[d.getId()]}if(this._isRequestWithBackspace(a)){return[c.getId()]}},findDeleteTargets:function(a){if(!a){return this._getTargetIdsToDelete()}var b=[];if(a.action===$SE_CONFIG.ACTION.DELETE_ON_EDITABLE){b=this._getDeleteTargetOnEditable(a)}else if(a.action===$SE_CONFIG.ACTION.DELETE){b=this._getDeleteTarget(a)}else{b=this._getTargetIdsToDelete()}return b},isBetweenParagraph:function(a,b){return a&&a.isParagraph()&&b&&b.isParagraph()},isFocusedComponent:function(a){return this._oComponentSelector.isFocusedComponent(a)},_findClosestUpwardParagraph:function(a){var b=this.getCompViewList();var c=null;var d=a.target;if(a.insertType==="InsertGuide"){d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a.insertPos.to)}else if(a.insertType==="InsertPointMarker"){d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.FIND_INSERT_POINT_MARKER_COMPONENT)}b.some(function(a){if(a.isParagraph()||a.isWrappingParagraph()){c=a}if(d==a){return true}});return c},_addClosestUpwardParagraphStyle:function(a){var b=this._findClosestUpwardParagraph(a);if(b){a.lastStyle=b.getLastStyle()}},_updateComp:function(a){var b=this.findComponentById(a.id);var c=b.getModel();if(c.isWrappingParagraph()){c.updateSubComp("wrapComp",a)}else{c.updateWith(a)}b.update();return b},_findPivotComp:function(a){var b=this.findComponentBefore(a);if(b){return b}else{return this.findFirstCompoment()}},_makeSortedImageList:function(a,b){var c=0;return a.map(function(a){var d=_.findIndex(b,a)>-1;if(d){return b[c++]}else{return a}})},_rerenderCompList:function(a){if(!a.length){return}var b=_.first(a);var c=this._findPivotComp(b.getId());a.reduce(function(a,b){if(!b||b===a){return a}b.moveToAfter(a);return b},c)},_reorderImageComp:function(a,b,c){var d=_.indexOf(a,_.first(b));var e=_.indexOf(a,_.last(b));var f=a.slice(d,e+1);var g=this._makeSortedImageList(f,c);this._rerenderCompList(g)},updateImages:function(a){var b=this.getCompViewList();var c=a.map(this._updateComp.bind(this));var d=_.filter(b,function(a){return a.isImageSortable()});this._reorderImageComp(b,d,c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ADD_LIBRARY_RESOURCE,c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY)},insertComponent:function(a){a=this._filterCompViewOverMaxCount(a);if(!$SE_CONFIG.SERVICE_CONFIG.IS_INSERT_COMPONENT_INTO_PARAGRAPH&&!this._isInsertComponentIntoParagraph(a.target)){this._toastInsertComponentIntoParagraph(a.compData);return}var b=this._insertComps(a);this._doAfterInsertComponent(b,a);return b},_isInsertComponentIntoParagraph:function(a){if(!a){return true}else{return a.isCursorAtStart()||a.isCursorAtEnd()}},_toastInsertComponentIntoParagraph:function(a){if(typeof a==="string"||!a){return}var b,c,d;b=this._getBlockCompName(a);if(b===""){return}c={"{{=compTypeName}}":b};d=se.i18n.getMsg("MSG_IS_INSERT_INTO_PARAGRAPH_AVAILABLE");d=$SE_STRING.replaceStrings(d,c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,d)},_getBlockCompName:function(a){var b={};var c=[];b[$SE_CONFIG.COMP_TYPE.IMAGE]="사진";b[$SE_CONFIG.COMP_TYPE.VIDEO]="동영상";b[$SE_CONFIG.COMP_TYPE.MAP]="장소";a.forEach(function(a){var d=b[a["@ctype"]];if(d){c.push(d)}});return _.uniq(c).join(", ")},_filterCompViewOverMaxCount:function(a){a=a||[];var b=this._getExceptCompType();var c=typeof a.compData==="string";var d=decodeURIComponent(a.compData);if(c&&$SE_COMMON_UTIL.isJSON(d)){a.compData=[JSON.parse(d)]}else if(c){if(b.indexOf(a.compData)!==-1){a.compData=[]}return a}else if(!_.isArray(a.compData)){a.compData=[a.compData]}a.compData=a.compData.filter(function(a){return b.indexOf(a["@ctype"])===-1});return a},_getExceptCompType:function(){var a=$SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_MAX_COUNT||{};var b=[];$.each(a,function(a,c){if(c<=this._getCompViewCountBy(a)){b.push(a)}}.bind(this));return b},_isAddClosestParagraphStyle:function(a){return a.action!==$SE_CONFIG.ACTION.REPLACE||a.compData["@ctype"]===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH},_insertComps:function(a){if(this._isAddClosestParagraphStyle(a)){this._addClosestUpwardParagraphStyle(a)}return this._oInsertResolver.insertComponent(a)},findActivated:function(){return this._oComponentSelector.findActivated()},appendEmptyLineWithFocus:function(a){var b=a?this.findComponentById(a):this.findActivated();if(b.isWrappingParagraph()){b.focus("aroundSlot",{trigger:$SE_CONFIG.TRIGGER.ENTER,action:$SE_CONFIG.ACTION.MOVE});return}this._appendTextEditableWithFocus(a,function(a){return a&&a.isParagraph()})},_appendTextEditableWithFocus:function(a,b){var c=a?this.findComponentById(a):this.findActivated();var d=a||c.getId();var e=this.findComponentAfter(d);if(c.isDocumentTitle()){e=this.findFirstCompoment()}if(b(e)){this.focusIn(e,{from:d,trigger:$SE_CONFIG.TRIGGER.ENTER,action:$SE_CONFIG.ACTION.MOVE})}else{return this._appendNewParagraph(c)}},appendEmptyLineAtLast:function(a){if(!this.findComponentAfter(a)){this._insertDefaultComponent({})}},_appendMergeTarget:function(a,b,c){if(c===$SE_CONFIG.TRIGGER.BACKSPACE){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_AFTER_COMP,a,$SE_CONFIG.TRIGGER.DELETE)}else if(c===$SE_CONFIG.TRIGGER.DELETE){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_BEFORE_COMP,b,$SE_CONFIG.TRIGGER.BACKSPACE)}},_shouldMergeContents:function(a,b,c){if(!a||!b){return false}if(this.isBetweenParagraph(a,b)===false){return false}var d={};c.forEach(function(a){d[a]=true});var e=a.getContainerWrappingElement();var f=b.getContainerWrappingElement();var g=f.prev();while(true){if(g[0].id===e[0].id){break}if(d[g[0].id]===undefined){return false}g=g.prev()}return true},_showUniqueParagraphPlaceholder:function(){var a=this._findUniqueParagraph();if(a){a.enablePlaceholder()}else if(this._oUniqueParagraph){this._oUniqueParagraph.disablePlaceholder()}this._oUniqueParagraph=a},updateAutoSizeOfAll:function(a){a.forEach(function(a){if(a.canAutoSize()){this.updateAutoSize(a.getContainerWrappingElement())}}.bind(this))},_doAfterInsertComponent:function(a,b){var c=a.length;var d=null;if(c===0){return}if(b.shouldFocus){d=a[c-1];d.setHistoryTransaction(true);this.focusIn(d,b);d.setHistoryTransaction(false)}this._putIntoComponentMap(a);this._attachDraggableToSubComponent(a);this._showUniqueParagraphPlaceholder();this._applyLastTextEditableRule(a,b);this.updateAutoSizeOfAll(a);this.updateDirectoryMeta(b)},_rerenderForceOrder:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DELETE_LAST_HISTORY);this._rerenderCompList(this._reorderCompViewList(this.getCompViewList(),a));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);var b=this.currentFocused();this.focusOutFocused();this._focusInComponent(b)},_keepTextEditableAfterPaste:function(a,b){if(a.isTextEditable()){this.focusIn(a,b)}else{this._appendTextEditableWithFocus(a.getId(),function(a){return a&&a.isTextEditable()})}},_keepLastParagraphAfterInsert:function(a){var b=$SE_CONFIG.COMP_TYPE;var c=a.getCompType();var d=a.getId();var e=c===b.PARAGRAPH||c===b.SECTION_TITLE||c===b.QUOTATION||c===b.AUDIO||c===b.CODE||c===b.TABLE||c===b.WRAPPING_PARAGRAPH||c===b.FILE&&a.isNDriveType()===false;if(e){return}if(!this.findComponentAfter(d)){this.appendEmptyLineWithFocus(d)}},_applyLastTextEditableRule:function(a,b){if(b&&b.skipLastEditableRule){return}var c=a.length-1;var d=a[c];if(b.action===$SE_CONFIG.ACTION.PASTE){this._keepTextEditableAfterPaste(d,b)}else{this._keepLastParagraphAfterInsert(d)}},updateDirectoryMeta:function(a){if($SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){if($SE_CONFIG.SERVICE_CONFIG.SKIP_ADD_MATERIAL_BLOG_ON_INIT){delete $SE_CONFIG.SERVICE_CONFIG.SKIP_ADD_MATERIAL_BLOG_ON_INIT;return}if(a&&!se.MaterialPublisher.bCompDataHasMaterial(a.compData)){return}this.updateRepresentativeMaterial()}},updateRepresentativeMaterial:function(){if(!$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){return}var a=this.getCompViewList({compType:$SE_CONFIG.COMP_TYPE.MATERIAL});if(!a||!a[0]){return}var b;var c;var d;for(var e=0,b=a.length;e<b;e++){c=a[e];d=c.getModelDataAsJson();if(d.type!=="news"){se.MaterialPublisher.updateDirectoryMeta(d);break}}},getFirstMaterial:function(){if(!$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE){return}var a=this.getCompViewList({compType:$SE_CONFIG.COMP_TYPE.MATERIAL});if(!a||!a[0]){return}var b;var c;var d;for(var e=0,b=a.length;e<b;e++){c=a[e];d=c.getModelDataAsJson();if(d.type!=="news"){return d}}},_doAfterDeleteComponent:function(a){if(this._hasNoComponent()){this._insertDefaultComponent(a)}else{this._showUniqueParagraphPlaceholder()}},_isLastComponent:function(a){var b=this._$elComponentsWrapper[0].getElementsByClassName("__se_component");return b[b.length-1].id===a.getId()},_isLastParagraph:function(a){return a.isParagraph()&&this._isLastComponent(a)},_shouldKeepComponent:function(a,b){return this._isLastParagraph(a)&&b!==$SE_CONFIG.TRIGGER.TRASH},_filterRemainComponentId:function(a,b,c){if(c.length===1&&this._shouldKeepComponent(a,b)){c=_.without(c,a.getId());a.empty();this.focusIn(a)}return c},_deleteCompAndMerge:function(a,b){var c=this.findComponentBefore(b[0]);var d=this.findComponentAfter(b[b.length-1]);this._oComponentSelector.moveToNextTarget(a);this.deleteComponentsByIds(b);if(this._shouldMergeContents(c,d,b)){this._appendMergeTarget(c,d,a.trigger)}},_deleteSingleSlotAndMerge:function(a,b){var c=this.findActivated();var d=this.findComponentBefore(b[0]);c.deleteSingleSlot();var e=this.findActivated();if(this._shouldMergeContents(d,e,b)){this._appendMergeTarget(d,e,a.trigger)}},_createDeletePayload:function(a,b){if(!a||typeof a!=="object"){return{from:this._decideActionOrigin(b),trigger:a,action:$SE_CONFIG.ACTION.DELETE}}return a},_deleteAndMoveToFocus:function(a,b){var c=this._createDeletePayload(b,a);var d=this.findActivated();var e=this._filterRemainComponentId(d,c.trigger,a);if(d.shouldDeleteSingleSlot()){this._deleteSingleSlotAndMerge(c,e)}else{this._deleteCompAndMerge(c,e)}this._doAfterDeleteComponent(c);return e},deleteComponent:function(a,b){if(a.length===0){return}return this._deleteAndMoveToFocus(a,b)},deleteComponents:function(a){var b={};this.deleteComponentsByIds(a);this._doAfterDeleteComponent(b)},canDeleteCurrentTarget:function(){var a=this.findActivated();if(!a||a.isDocumentTitle()){return false}return true},resetStickyToolbar:function(){if(this.hasFocused()){this.currentFocused().enableStickyToolbar()}},deleteComponentById:function(a){var b=false;this._destroyById(a,b)},deleteLibrariesWithComp:function(a){var b=a.slice(0);var c=false;b.forEach(function(a,b){var d=this.findComponentById(a);if(d&&d.getCompType()===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH){d.deleteSubCompWithLibrary()}else{this._destroyById(a,c)}}.bind(this))},deleteComponentsByIds:function(a){var b=a.slice(0);var c=false;for(var d in b){this._destroyById(b[d],c)}},replaceComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);a.insertType=$SE_CONFIG.INSERT_TYPE.DEFAULT;a.action=$SE_CONFIG.ACTION.REPLACE;var b=$.extend(true,{},a);b.shouldFocus=false;var c=this._replaceComp(a.target,b);this._doAfterInsertComponent(c,a);return c},_replaceComp:function(a,b){var c=this._insertComps(b);this._destroyById(a.getId(),false);return c},_destoryIfParagraph:function(a){if(a.isParagraph()){this._destroyById(a.getId(),false)}},_makePayloadForWrapping:function(a,b,c,d){var e=b.getModelDataAsJson();e.id=a;return{insertType:$SE_CONFIG.INSERT_TYPE.DEFAULT,action:$SE_CONFIG.ACTION.REPLACE,target:b,shouldFocus:true,compData:{"@ctype":$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH,layout:c,wrapComp:e,paragraph:d.isParagraph()?d.getModelDataAsJson():null}}},wrapComponent:function(a,b){var c=this.findComponentById(a);var d=this.findComponentAfter(a);if(d==null){d=$SE_COMPONENT_FACTORY.getComponentInstance($SE_COMPONENT_FACTORY.getComponentData($SE_CONFIG.COMP_TYPE.PARAGRAPH))}var e=this._makePayloadForWrapping(a,c,b,d);var f=this._replaceComp(c,e);this._destoryIfParagraph(d);this._doAfterInsertComponent(f,e);return f},decompose:function(a,b,c){this.insertComponent({target:a,compData:b,insertType:$SE_CONFIG.INSERT_TYPE.DEFAULT,shouldFocus:false,bPushHistory:false
});return this.replaceComponent({target:a,compData:c,shouldFocus:true,shouldUpdateLibrary:false,skipLastEditableRule:true,bPushHistory:false})},getPlainText:function(a){var b=[];this.getCompViewList().forEach(function(c){var d=c.getCompType();if(a||d!==$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){b.push(c.getPlainText())}});return b},getCompViewList:function(a){a=a||{};var b=a.compType;var c="__se_component";if(b){if(b===$SE_CONFIG.COMP_TYPE.MATERIAL){b="subjectMatter"}c+=" se_"+b}var d=this._$elBodyWrapper[0].getElementsByClassName(c);var e=[];var f=null;$.each(d,function(a,b){if(!$(b).hasClass("__se_drag_helper")){f=this.findComponentById(b.id);if(!f){return}e.push(f)}}.bind(this));return e},_reorderCompViewList:function(a,b){a=a.filter(function(a){return!a.isDocumentTitle()});var c=$SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_FORCE_ORDER;var d,e;if(!c){return a}d=this._splitReorderData(a);e=this._mergeReorderData(d);if(b){this._toastReorder(e.isAllowMove)}return e.compViewList},_splitReorderData:function(a){var b={compViewList:$.extend(true,[],a),orderCompTypes:$SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_FORCE_ORDER,orderCompViewList:{},orderCompViewFirstIndexList:{}};b.compViewList=b.compViewList.filter(function(a,c){var d=a.getModel().getCompType();if(b.orderCompTypes.indexOf(d)===-1){return true}if(!b.orderCompViewList.hasOwnProperty(d)){b.orderCompViewList[d]=[];b.orderCompViewFirstIndexList[d]=c}b.orderCompViewList[d].push(a)}.bind(this));return b},_mergeReorderData:function(a){var b=true;a.orderCompTypes.forEach(function(c){if(!a.orderCompViewFirstIndexList.hasOwnProperty(c)){return}b=b&&a.compViewList.length===a.orderCompViewFirstIndexList[c];a.compViewList=a.compViewList.concat(a.orderCompViewList[c])}.bind(this));return{compViewList:a.compViewList,isAllowMove:b}},_toastReorder:function(a){if(!a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_NOT_ALLOW_MOVE_PLACE"))}},_getCompViewCountBy:function(a){var b=this.getCompViewList();var c={};b.forEach(function(a){var b=a.getModel().getCompType();c.hasOwnProperty(b)?c[b]++:c[b]=1});return c[a]||0},isAddComponentAvailable:function(a){var b=$SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_MAX_COUNT[a];var c=this._getCompViewCountBy(a);return b===undefined?true:b>c},isMaxMediaTagComponent:function(){var a=this.getCompViewList().filter(function(a){return a.getModel()._getJsonData().mediaTags}).length;return a>=$SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG.COUNT_COMP},findFirstCompoment:function(){var a=this._$elComponentsWrapper.find(".__se_component").get(0);return this.findComponentById(a.id)},deselectAll:function(){this._oComponentSelector.deselectAll()},getSelectedComponents:function(){var a=[];this._oComponentSelector.findSelectedElements().each(function(b,c){var d=this.findComponentById(c.id);if(d){a.push(d)}}.bind(this));return _.uniq(a)},findActivatedComponents:function(){var a=[];var b=this.currentFocused();if(b&&!b.isDocumentTitle()){a.push(b)}else{a=this.getSelectedComponents()}return a},findComponentById:function(a){var b=this._htComponentMap[a];var a=null;if(b){a=b.getId()}return a?b:null},findSubComponentById:function(a){var b;for(var c in this._htComponentMap){b=this._htComponentMap[c].getModelDataAsJson();if(b.components){for(var d in b.components){if(b.components[d].compId===a){return b.components[d]}}}}return null},findComponentBySubComponentId:function(a){var b;for(var c in this._htComponentMap){var d=this._htComponentMap[c];var e=d.getModelDataAsJson().components;if(e&&e.length>0){for(var f in e){if(e[f].compId===a){b=d;break}}if(b){break}}}return b},findComponentBefore:function(a,b){var c=this._getComponentWrappingElement(a);var d=c;b=b||1;while(b-->0){if(!d){return null}d=d.prev()}var a=d.length>0?d[0].getAttribute("id"):undefined;return this.findComponentById(a)},findComponentAfter:function(a){var b=this._getComponentWrappingElement(a);if(!b){return null}var c=b.next();var a=c.length>0?c[0].getAttribute("id"):undefined;return this.findComponentById(a)},findDocumentTitle:function(){var a=this._$elTitleWrapper.find(".se_component");if(a.length===0){return null}return this.findComponentById(a[0].getAttribute("id"))},moveFocusWithKey:function(a,b){return this._oComponentSelector.moveFocusWithKey(a,b)},setComponentMap:function(a){this._htComponentMap=a;this._htParagraphMap={};Object.keys(a).forEach(function(a){if(a.indexOf("paragraph")>-1){this._htParagraphMap[a]=this.findComponentById(a)}}.bind(this))},getComponentMap:function(){return this._htComponentMap},destroyAllComponents:function(){Object.keys(this._htComponentMap).forEach(this.deleteComponentById.bind(this))},resize:function(){Object.keys(this._htComponentMap).forEach(function(a){this.findComponentById(a).resize()}.bind(this));this.updateAutoSize()},applyTheme:function(a,b){var c=true;if(!a){a=$SE_CONFIG.SERVICE_CONFIG.DEFAULT_THEME}if(!b){b=a;c=false}var d=$SE_STYLE_HELPER.getClassBy(this._$elBodyWrapper,/se_theme_\w+/);this._$elBodyWrapper.removeClass(d);this._$elBodyWrapper.addClass("se_theme_"+b);this._changeCompThemeStyle(b,c);this._closeToolbarDropDown();if(c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY)}},_closeToolbarDropDown:function(){var a=this.currentFocused();if(a){a.closeCurrentActiveDropdown()}},_isRemoveJustifyStyle:function(a,b){var c=a.getCompType();return(c===$SE_CONFIG.COMP_TYPE.FILE||c===$SE_CONFIG.COMP_TYPE.AUDIO||c===$SE_CONFIG.COMP_TYPE.VIDEO||c===$SE_CONFIG.COMP_TYPE.IMAGE||c===$SE_CONFIG.COMP_TYPE.OGLINK||c===$SE_CONFIG.COMP_TYPE.MATERIAL||c===$SE_CONFIG.COMP_TYPE.STICKER||c===$SE_CONFIG.COMP_TYPE.MAP||c===$SE_CONFIG.COMP_TYPE.SCHEDULE||c===$SE_CONFIG.COMP_TYPE.IMAGE_STRIP)&&b.align&&b.align==="justify"},applyDocStyle:function(a){var b;var c;var d;var e;var f=this.getCompViewList();f.forEach(function(f){b=f.getModel();d=_.clone(a);if(f.isWrappingParagraph()){b=b.getParagraph()}if(this._isRemoveJustifyStyle(f,d)){delete d.align}if(this._isRemoveAlignAtImage(f)){delete d.align}c=_.clone(b.getComponentStyle());for(e in d){if(_.has(c,e)){c[e]=d[e]}}f.updateStyle(c)},this);this._closeToolbarDropDown();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY)},_isRemoveAlignAtImage:function(a){return a.getCompType()===$SE_CONFIG.COMP_TYPE.IMAGE&&a.getModel().isMoreThanMaxWidth()},_changeCompThemeStyle:function(a,b){var c=this.getCompViewList();var d=$SE_MODEL_DATA_COORD.getThemeCompStyle(a);var e=d.componentBase;var f;var g;var h;var i;c.forEach(function(c){f=d[c.getCompType()];g=c.getModel();h=g.getComponentStyle();i=_.clone(f||e);if(!b){i=_.extend(i,h)}c.updateStyle(i,b);c.refineDataByTheme(a)},this)},startDragMode:function(){this._$elComponentsWrapper.addClass("is-draging")},finishDragMode:function(){this._$elComponentsWrapper.removeClass("is-draging")},reset:function(a,b){this.setComponentMap(a);this.applyTheme(b);this._showUniqueParagraphPlaceholder()},cacheCurrentOffsets:function(){this._oDragPresenter.cacheCurrentOffsets()},resetCurrentOffsetsCache:function(){this._oDragPresenter.resetCurrentOffsetsCache()},getOffsetCache:function(a){return this._oDragPresenter.getOffsetCache(a)},destroy:function(){this.destroyAllComponents();this._unbindEvents();this._oComponentSelector.destroy();this._oDragPresenter.destroy();this._$elTitleWrapper.remove();this._$elComponentsWrapper.remove();this._$elBodyWrapper.remove();this._oComponentSelector=null;this._oDragPresenter=null;this._oDraggingUi=null;this._htComponentMap=null;this._htParagraphMap=null;this._$elTitleWrapper=null;this._$elComponentsWrapper=null;this._$elBodyWrapper=null}});se.defineComponent("se.InsertPointMarkerView",{construct:function(){this._initVar();this._bindGatewayEvent();this._readyInsertPointsPool()},_initVar:function(){this._oServiceConfig=$SE_CONFIG.SERVICE_CONFIG;this._bIsFreeze=true;this._fInsertPointTemplate=se.editor.template.canvas["insert-point.hbs"];this._$elComponentsWrapper=$("#se_components_wrapper");this._$elSpareInsertPoint=$(this._fInsertPointTemplate(this._oServiceConfig.INSERT_POINT_COMP));this._$elActivatedInsertPointMarker=null;this._$elCurrentComponent=null;this._$elTargetCompToInsert=null;this._aInsertPointPools=[];this._nBusyIndex=0},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.BIND_EVENT,this.bindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.PAUSE,this.bindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.UNBIND_EVENT,this.unbindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.RESUME,this.bindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL,this.detachAll.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_INSERT_PANEL,this.hideInsertPanel.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.TARGET_COMPONENT_TO_INSERT,this.targetComponentToInsert.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HAS_ACTIVATED_INSERT_POINT_MARKER,this.hasActivatedInsertPointMarker.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_ALL,this.hideAll.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.SHOW_DEFAULT,this.showDefault.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DESTROY,this.destroy.bind(this))},_readyInsertPointsPool:function(){this._aInsertPointPools=[this._$elSpareInsertPoint.clone(),this._$elSpareInsertPoint.clone(),this._$elSpareInsertPoint.clone()];this._$elSpareInsertPoint.addClass("is-hover").find(".__se_marker_btn, .__se_btn_panel").remove()},bindEvent:function(){this.unbindEvent();this.showDefault();$(document).on("click.isp-pm",".__se_marker_btn",this._onClickPointMarker.bind(this)).on("click.isp-ip",".__se_insert_point .__se_add_component_btn",this._onClickInsertPanel.bind(this)).on("click.isp-at",".__se_insert_point .__se_addText_btn",this._onClickAddText.bind(this)).on("mousedown.isp-at",".__se_insert_point .__se_addText_btn",this._onMouseDownAddText.bind(this)).on("mousedown.isp-om",".__se_marker_btn",this._onMouseDownPointMarker.bind(this)).on("mousedown.isp-ip",".__se_insert_point .__se_add_component_btn",this._onMouseDownInsertPanel.bind(this)).on("mousemove.isp-mw",$SE_COMMON_UTIL.throttle(this._onMouseMoveComponentWrapper,100,this));this._bIsFreeze=false},unbindEvent:function(){this.detachAll();$(document).off("click.isp-pm").off("click.isp-ip").off("click.isp-at").off("mousedown.isp-at").off("mousedown.isp-om").off("mousedown.isp-ip").off("mousemove.isp-mw");this._bIsFreeze=true},_onMouseMoveComponentWrapper:function(a){if(!a.target||!a.target.classList||a.target.classList.contains("__se_marker_btn")){return}var b=a.pageY;var c=this._componentElementFromEvent(a);var d=this._findComponentElement(c);if(this._isInvalidToPutInsertPoint(d)){d=this._findEdgeComponentElementByPageY(b)}var e=this._calculateCursorPositionCode(d,b);var f=this._findRealTargetToPut(d,e);if(this._bIsFreeze){return}this.showAt(f)},_isInvalidToPutInsertPoint:function(a){var b=0;return a.length===b||a[0].classList.contains("se_documentTitle")},_isUpperOnCanvas:function(a){return se.util.Scroll.isMousePointerAbove(this._$elComponentsWrapper,a)},_onClickPointMarker:function(a){this.toggleInsertPanel($(a.target).parents(".__se_insert_point"));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);return false},_onClickInsertPanel:function(a){this._doActionByCompType($(a.target).data("role"));return false},_onMouseDownAddText:function(a){var b=$(a.target).parents(".__se_component");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.APPEND_EMPTY_LINE_WITH_FOCUS,b[0].id);return false},_onClickAddText:function(){return false},_doActionByCompType:function(a){var b=this.currentActivated();var c={compData:a,shouldFocus:true,insertType:$SE_CONFIG.INSERT_TYPE.INSERT_POINT_MARKER};if(a===$SE_CONFIG.COMP_TYPE.VIDEO||a===$SE_CONFIG.COMP_TYPE.MAP){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.FILE_DIALOG.INSERT_COMPONENT_WITH_POPUP,c)}else if(this._isLayerType(a)){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,c)}else if(a===$SE_CONFIG.COMP_TYPE.IMAGE){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT_LIST_WITH_FILEDIALOGUE,c)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,c)}this._concealInsertPointMarker(b);this.hideAll()},_isLayerType:function(a){return a===$SE_CONFIG.COMP_TYPE.STICKER||a===$SE_CONFIG.COMP_TYPE.MATERIAL||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.STOREFARMIMAGE||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CONVERT_HTML},_concealInsertPointMarker:function(a){a[0].style.display="none";setTimeout(function(){a[0].style.display=""},500)},_onMouseDownPointMarker:function(){return false},_onMouseDownInsertPanel:function(){return false},_findEdgeComponentElementByPageY:function(a){if(this._isUpperOnCanvas(a)){return $('.se_component:not(".se_documentTitle")').first()}else{return $(".se_component").last()}},_findComponentElement:function(a){var b=a;if(a.length>0&&a[0].classList.contains("se_component")===false){b=a.parents(".se_component")}return b},_appendInsertPoint:function(a){var b=a[0];var c=this.getIdleInsertPoint();if(b.id==="se_components_wrapper"||b.classList.contains("se_documentTitle")){this._$elComponentsWrapper.before(c)}else{a.find(".se_sectionArea").after(c)}},_cacheCurrentComponent:function(a){this._$elCurrentComponent=a},_hasAlreadyInsertPoint:function(a){return this._$elCurrentComponent&&this._$elCurrentComponent[0]===a[0]},_isInsertPanelOpened:function(a){var b=a[0];var c=null;if(b.classList.contains("se_component")){c=b.querySelector(".__se_insert_point.is-active")}return c!==null},_shouldSkipShowAt:function(a){return this._hasAlreadyInsertPoint(a)||this._hasAlreadyInsertPoint($(document.querySelector(".se_component.is-focused")))},_handleInvisibleInsertBar:function(a){if(this._isOnBetweenNotEditable(a)){a.find(".se_sectionArea").after(this._$elSpareInsertPoint)}else{this._$elSpareInsertPoint.detach()}},_isOnBetweenNotEditable:function(a){var b=a[0];if(b.id!=="se_components_wrapper"&&!b.classList.contains("se_documentTitle")){var c=a[0].id;var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,c);var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,c);return d&&e&&(!d.isTextEditable()&&!e.isTextEditable())}return false},_handleToDisplayInsertBar:function(a){var b=this.getIdleInsertPoint()[0];var c=b.getElementsByClassName("__se_addText_btn")[0];if(!c){return}if(this._isOnBetweenNotEditable(a)){c.style.display=""}else{c.style.display="none"}},showAt:function(a){if(this._shouldSkipShowAt(a)){this._handleInvisibleInsertBar(a);return}if(this._isInsertPanelOpened(a)){this._giveRestToBusyInsertPoint();return}this._handleToDisplayInsertBar(a);this._appendInsertPoint(a);this._replaceCurrentInsertPointWithNext();this._cacheCurrentComponent(a)},showDefault:function(){var a=this._findDefaultTarget();if(a.length>0){this.hideAll();this.showAt(a)}},_findDefaultTarget:function(){var a=document.querySelector(".se_component.is-focused");var b=null;if(!a){b=document.querySelectorAll(".se_component");a=b[b.length-1]}return $(a)},getBusyInsertPoint:function(){return this._aInsertPointPools[this._nBusyIndex]},getIdleInsertPoint:function(){return this._aInsertPointPools[this._getNextCandidateIndex()]},_findNextInsertPointMarkerIndex:function(a){a=a+1;if(a===this._aInsertPointPools.length){a=0}return a},_isFreezingInsertPointMarker:function(a){return this._$elActivatedInsertPointMarker&&this._$elActivatedInsertPointMarker.get(0)===this._aInsertPointPools[a].get(0)},_getNextCandidateIndex:function(){var a=this._findNextInsertPointMarkerIndex(this._nBusyIndex);if(this._isFreezingInsertPointMarker(a)){a=this._findNextInsertPointMarkerIndex(a)}return a},_findRealTargetToPut:function(a,b){var c=a;if(b===$SE_CONFIG.POSITION.TOP){c=a.prev()}if(c.length===0){c=this._$elComponentsWrapper}return c},_replaceCurrentInsertPointWithNext:function(){var a=this.getBusyInsertPoint().get(0);var b=this.getIdleInsertPoint().get(0);if(a!==(this._$elActivatedInsertPointMarker&&this._$elActivatedInsertPointMarker[0])){a.classList.remove("is-hover");if(a.parentNode){a.parentNode.removeChild(a)}}b.classList.add("is-hover");this._nBusyIndex=this._getNextCandidateIndex()},_calculateCursorPositionCode:function(a,b){if(se.util.Scroll.isMousePointerAbove(a.find(".se_sectionArea"),b)){return $SE_CONFIG.POSITION.TOP}else{return $SE_CONFIG.POSITION.BOTTOM}},_componentElementByPositionY:function(a){return $(".se_component").filter(function(b,c){var d=$(c);var e=d.offset().top;var f=e+d.outerHeight(true)+20;return e<=a&&f>=a})},_isComponentsWrapperElement:function(a){return a[0]&&a[0].id==="se_components_wrapper"},_componentElementFromEvent:function(a){var b=40;var c=a.clientX;if(c<=b){c=b+1}var d=$(document.elementFromPoint(c,a.clientY));var e=a.pageY;if(this._isComponentsWrapperElement(d)){d=this._componentElementByPositionY(e)}return d},_cacheActivated:function(a){this._$elActivatedInsertPointMarker=a;if(a){this._$elTargetCompToInsert=a.parents(".se_component")}},toggleInsertPanel:function(a){a.toggleClass("is-active");if(a[0].classList.contains("is-active")){clickcr(this,"ipt.open","","");this._clearActivatedInsertPointMarker();this._cacheActivated(a)}else{clickcr(this,"ipt.close","","");this._cacheActivated(null)}},_closeInsertPanel:function(){var a=null;if(this.hasActivatedInsertPointMarker()){a=this._$elActivatedInsertPointMarker.get(0);a.classList.remove("is-active");this._$elActivatedInsertPointMarker=null}},hideInsertPanel:function(){var a=this.getBusyInsertPoint().get(0);if(a.classList.contains("is-active")){this._closeInsertPanel()}else{this._clearActivatedInsertPointMarker()}},_clearActivatedInsertPointMarker:function(){var a=null;if(this.hasActivatedInsertPointMarker()){a=this._$elActivatedInsertPointMarker.get(0);a.classList.remove("is-hover");a.classList.remove("is-active");this._$elActivatedInsertPointMarker=null}},detachAll:function(){this._aInsertPointPools.forEach(function(a){a.detach()});this._$elSpareInsertPoint.detach()},_giveRestToBusyInsertPoint:function(){var a=this.getBusyInsertPoint();if(a){a.get(0).classList.remove("is-hover")}},hideAll:function(){this._giveRestToBusyInsertPoint();this._clearActivatedInsertPointMarker();this._cacheCurrentComponent(null)},hasActivatedInsertPointMarker:function(){return this._$elActivatedInsertPointMarker!==null},currentActivated:function(){return this._$elActivatedInsertPointMarker},targetComponentToInsert:function(){return this._$elTargetCompToInsert},destroy:function(){this.unbindEvent();this._aInsertPointPools.forEach(function(a){a.remove()});this._fInsertPointTemplate=null;this._$elComponentsWrapper=null;this._$elSpareInsertPoint=null;this._$elActivatedInsertPointMarker=null;this._$elCurrentComponent=null;this._$elTargetCompToInsert=null;this._aInsertPointPools=null;this._nBusyIndex=null}});se.defineComponent("se.ComponentSelector",{construct:function(){this._assignElements();this._applySelectable();this._nFirstSelectedIndex=null},_assignElements:function(){this._$elBodyWrapper=$("#se_canvas_body")},_applySelectable:function(){this._$elBodyWrapper.on("mousedown",function(){window.focus()});this._$elBodyWrapper.selectable({filter:"#se_components_wrapper .__se_component",cancel:"input, textarea, button, select, option, .se_editable, .selectable, .__se_sortable_item, .__se_cancel_selectable",start:this._onStartSelectable.bind(this),selected:this._onSelected.bind(this),stop:this._onStopSelectable.bind(this),distance:1,delay:150})},_destroySelectable:function(){if(this._$elBodyWrapper.data("selectable")){this._$elBodyWrapper.selectable("destroy")}},_onStartSelectable:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_SELECTING_MODE);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.PAUSE)},_onSelected:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b.selected.id);c.select()},_onStopSelectable:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.RESUME)},_saveCurrentFocused:function(a){this._oCurrentFocused=a},_clearCurrentFocused:function(){this._saveCurrentFocused(null)},_findBeforeToMove:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,a);if(!b){b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,a)}return b},_findNextToMove:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,a);if(!b){b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,a)}return b},_findNextTarget:function(a,b){if(!a){return null}var c=b.trigger;var d=b.from;var e=null;var f=a.getId();var g=$SE_CONFIG.TRIGGER;if(d==="multiSelect"&&c===g.BACKSPACE){f=this._findFirstSelected().getId()}if(c===g.BACKSPACE){e=this._findBeforeToMove(f)}else if(c===g.DELETE){e=this._findNextToMove(f)}else if(c===g.TRASH){e=this._findNextToMove(f)}return e},_findLastSelected:function(){var a=this.currentSelected();return a[a.length-1]},_findFirstSelected:function(){return this.currentSelected()[0]},moveToNextTarget:function(a){var b=this.findActivated();var c=this._findNextTarget(b,a);if(!c){return}this.focusIn(c,a)},findActivated:function(){var a=this.currentFocused();if(!a){a=this._findLastSelected(a)}return a},currentSelected:function(){return this.findSelectedIds().map(function(a){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a)}.bind(this))},changeToSelected:function(a){if(!a){return}this.focusOut(a);this.toggleSelected(a)},isFocusedComponent:function(a){return this._oCurrentFocused===a},focusOutFocused:function(){if(this._oCurrentFocused){this.focusOut(this._oCurrentFocused)}},currentFocused:function(){return this._oCurrentFocused},_shouldFocusOut:function(a){if(!a){return false}return a.trigger!==$SE_CONFIG.TRIGGER.ENTER&&a.action!==$SE_CONFIG.ACTION.RESTORE},_shouldSkipFocusIn:function(a){return a.isDestroyed()||this.isFocusedComponent(a)},focusIn:function(a,b){if(this._shouldSkipFocusIn(a)){return}if(this._shouldFocusOut(b)){this.focusOutFocused()}if(this._isBrowserFocusable(a)===false){$SE_FOCUS_HELPER.blurFromActiveElement()}a.focusIn(b);this._saveCurrentFocused(a);this._nFirstSelectedIndex=null},_isBrowserFocusable:function(a){return a.isTextEditable()||a.isDocumentTitle()},focusOut:function(a){a.focusOut();this._clearCurrentFocused()},select:function(a){if(a){a.select()}},deselect:function(a){a.deselect()},multiSelect:function(a,b){var c=Math.min(a,b);var d=Math.max(a,b);this._$elBodyWrapper.find(".se_component:not(.se_documentTitle)").each(function(a,b){if(a>=c&&a<=d){this.select($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b.id))}else{this.deselect($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b.id))}}.bind(this))},deselectAll:function(){this.findSelectedElements().each(function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b.id).deselect()}.bind(this));this._nFirstSelectedIndex=null},toggleSelected:function(a){a.toggleSelected()},findSelectedElements:function(){return $(document).find(".ui-selected:not(.se_documentTitle)")},findSelectedIds:function(){var a=this.findSelectedElements();return a.toArray().map(function(a){return a.id}.bind(this))},_moveFocusUpward:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,a);if(!b){b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DOCUMENT_TITLE)}return b},_moveFocusDownward:function(a,b){var c=null;if(a.isDocumentTitle()){c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_FIRST_COMPONENT)}else{c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,b)}return c},_findNextTargetByKey:function(a,b,c){var d=a.getId();var e=null;switch(b){case $SE_CONFIG.TRIGGER.UP:if(a.canMoveUpward(c)){e=this._moveFocusUpward(d)}break;case $SE_CONFIG.TRIGGER.DOWN:if(a.canMoveDownward(c)){e=this._moveFocusDownward(a,d)}break;case $SE_CONFIG.TRIGGER.LEFT:if(a.isCursorAtStart(c)){e=this._moveFocusUpward(d)}break;case $SE_CONFIG.TRIGGER.RIGHT:if(a.isCursorAtEnd(c)){e=this._moveFocusDownward(a,d)}break}return e},moveFocusWithKey:function(a,b){var c=this.currentFocused();if(!c){return null}var d=this._findNextTargetByKey(c,a,b);var e={from:c.getCompType(),trigger:a,action:$SE_CONFIG.ACTION.MOVE};if(d){this.focusIn(d,e)}return d},getSelectedIndex:function(){var a=this._nFirstSelectedIndex!=null?this._nFirstSelectedIndex:null;var b=null;var c=null;var d=false;this._$elBodyWrapper.find(".se_component:not(.se_documentTitle)").each(function(e,f){c=f.classList.contains("ui-selected")||f.classList.contains("is-focused");d=a==null&&c;if(d){a=e}if(c){b=e}});return{start:a,end:b}},saveFirstSelectedIndex:function(a){this._nFirstSelectedIndex=a},destroy:function(){this._destroySelectable()}});se.defineComponent("se.DragPresenter",{construct:function(){this._assignElements();this._initVariables()},_assignElements:function(){this._$elBodyWrapper=$("#se_canvas_body");this._$elComponentsWrapper=$("#se_components_wrapper")},_initVariables:function(){this._htElementOffsetCache={};this._fExecuteStartDragWithDebounce=_.debounce(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.START_DRAG)},1)},_bindDragEvents:function(){$(document).on("mouseleave.dragpresenter",this._onMouseLeaveWhileDragging.bind(this)).on("mouseenter.dragpresenter",this._onMouseEnterWhileDragging.bind(this))},_unbindDragEvents:function(){$(document).off("mouseleave.dragpresenter").off("mouseenter.dragpresenter")},_cancelSortable:function(){if(this._oDraggingUi&&this._oDraggingUi.placeholder){this._$elComponentsWrapper.sortable("cancel")}else{$(document).trigger("mouseup")}},_destroySortable:function(){if(this._$elComponentsWrapper){this._$elComponentsWrapper.sortable("destroy")}},_resetStickyToolbar:function(a){a.forEach(function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a);b.enableStickyToolbar()})},_computeDragSymbolPosition:function(a,b,c){var d=a.outerWidth(true),e=a.outerHeight(true),f=a.offset(),g=(b-f.left)/d,h=(c-f.top)/e;return{left:d*g,top:e*h}},_onMouseUpOutsideWhileDragging:function(){this._cancelSortable()},_onMouseLeaveWhileDragging:function(){this._bPreventDragging=true;var a=this._asDraggingItemIds;if(a){a.forEach(function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a).getContainerElement().classList.remove("is-dragObj")})}else{this._oDraggingUi.item[0].classList.remove("is-dragObj")}this._oDraggingUi.helper[0].style.display="none";$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET);return false},_onMouseEnterWhileDragging:function(){var a=this._asDraggingItemIds;this._bPreventDragging=false;if(a){a.forEach(function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a).getContainerElement().classList.add("is-dragObj")})}else{this._oDraggingUi.item[0].classList.add("is-dragObj")}this._oDraggingUi.helper[0].style.display="";$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_DRAGGING_MODE);return false},_decideDragComps:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS);if(b.length===0){b.push($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a))}return b},_onStartSort:function(a,b){this._fExecuteStartDragWithDebounce.call(this);var c=this._decideDragComps(b.item[0].id);var d=c.map(function(a){var b=a.getContainerElement();var c=b.classList;this._addDraggingClass(b);c.remove("is-focused");c.remove("is-selected");return b.id}.bind(this));this._bPreventDragging=false;this._oDraggingUi=b;this._asDraggingItemIds=d;b.item[0].style.display="";b.placeholder[0].style.display="none";$(document).scrollTop(this._nCachedScrollTopBeforeSort);this._bindDragEvents();this.cacheCurrentOffsets()},cacheCurrentOffsets:function(){this.resetCurrentOffsetsCache();var a=function(a,b){var c=b.getAttribute("data-comp-id")||b.getAttribute("id")||$(b).closest(".__se_component")[0].getAttribute("id");var d=$(b).offset();var e=window.getComputedStyle(b);var f=parseInt(e.getPropertyValue("width"),10);var g;var h=d.left;var i;if(b.classList.contains("se_image")){i=b.querySelector(".se_viewArea");g=window.getComputedStyle(i);f=parseInt(g.getPropertyValue("width"),10);h=$(i).offset().left}var j=b.offsetTop;var k=b.offsetHeight;var l=parseInt(e.getPropertyValue("margin-top"),10);var m=parseInt(e.getPropertyValue("margin-bottom"),10);var n=k+l+m;var o=j+n;var p=(j+o)/2;var q={top:d.top,left:h,marginTop:l,paddingTop:parseInt(e.getPropertyValue("padding-top"),10),height:parseInt(e.getPropertyValue("height"),10),marginLeft:parseInt(e.getPropertyValue("margin-left"),10),paddingLeft:parseInt(e.getPropertyValue("padding-left"),10),width:f,mid:p};if(this._htElementOffsetCache[c]===undefined&&c!==undefined){this._htElementOffsetCache[c]=q}}.bind(this);this._$elComponentsWrapper.find(".se_imageStripView .__subComp").each(a);this._$elComponentsWrapper.find(".__se_component:not(.is-componentDragging, .__se_drag_helper)").each(a)},resetCurrentOffsetsCache:function(){this._htElementOffsetCache={}},getOffsetCache:function(a){var b,c;if(typeof a==="String"){b=a}else{b=a.getAttribute("id")||a.getAttribute("data-comp-id")||$(a).closest(".__se_component")[0].getAttribute("id")}c=this._htElementOffsetCache[b];return c},_onDragging:function(a){if(this._bPreventDragging===true){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RENDER_INSERT_GUIDE_WITH_COORDINATE,a.pageX,a.pageY)},_onUpdateSort:function(){if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.IS_INSERT_GUIDE_SHOWN)===false){this._cancelSortable()}},_clearCacheResources:function(){this._oDraggingUi=null;this._asDraggingItemIds=null},_clearJqueryResources:function(){var a=$.ui.ddmanager.current.offsetParent.prevObject[0];a.innerHTML="";a=null;$.ui.ddmanager.current.offsetParent.prevObject=null},_onStopSort:function(a){var b=this._asDraggingItemIds;var c=document.querySelectorAll(".__se_drag_item");var d=null;for(var e=0;e<c.length;e++){d=c[e];d.style.opacity="";this._removeDraggingClass(d)}this._clearCacheResources();this._clearJqueryResources();this._unbindDragEvents();this.resetCurrentOffsetsCache();if(!a.originalEvent){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.STOP_DRAG);return}if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.IS_INSERT_GUIDE_SHOWN)){this._handleToArrange(b)}else{this._cancelSortable();this._resetStickyToolbar(b)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.COMPLETE_DRAG);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.STOP_DRAG)},_onStartDrag:function(a,b){var c=a.target;b.item=$(c);this._bPreventDragging=false;this._oDraggingUi=b;this._asDraggingItemIds=null;this._addDraggingClass(c);this._hideDelBtn(c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.START_DRAG);this._bindDragEvents();this.cacheCurrentOffsets()},_addDraggingClass:function(a){a.classList.add("is-dragObj");a.classList.add("__se_drag_item")},_hideDelBtn:function(a){a.classList.add("se_drag_item")},_onStopDrag:function(a){var b=this._oDraggingUi.item;var c=b[0]||a.target;this._removeDraggingClass(c);this._showDelBtn(c);if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.IS_INSERT_GUIDE_SHOWN)){this._transformFromComposable(b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.COMPLETE_DRAG);
}this._clearCacheResources();this._clearJqueryResources();this._unbindDragEvents();this.resetCurrentOffsetsCache();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.STOP_DRAG)},_removeDraggingClass:function(a){a.classList.remove("is-dragObj");a.classList.remove("__se_drag_item")},_showDelBtn:function(a){a.classList.remove("se_drag_item")},_addSubComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY);var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a.from).getModelDataAsJson();var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a.to);var d=false;var e=[c.addSubComponent(b,a.position,d)];$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ENABLE_CHANGE_LIBRARY);return e},_activateComponent:function(a){var b=a[0];var c=a.length>1;if(c){a.forEach(function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT,a)});return}if(b.isTextEditable()){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,b,{trigger:$SE_CONFIG.TRIGGER.DRAG,action:$SE_CONFIG.ACTION.MOVE})}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT,b)}},_sortComponents:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET);var c=b.to;var d=b.position;var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,c);return a.map(function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a);if(b!==0){d="below"}c.moveToByPosition(e,d);e=c;return c})},_composeComponent:function(a,b){if(this._isCompositing(a)){return this._addSubComponent(a)}else{return this._sortComponents(b)}},_handleToArrange:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET);var c=this._composeComponent(b,a);this._activateComponent(c);if(c.length===1){$SE_ANIMATION_HELPER.animatesDrop(c[0].getContainerWrappingElement())}},_isCompositing:function(a){return a.type==="composite"},_moveSubComponent:function(a,b,c,d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY);var e=c.addSubComponent(a.extractSubComponent(b),d,false,true);$SE_ANIMATION_HELPER.animatesDrop(e.getContainerWrappingElement());$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ENABLE_CHANGE_LIBRARY)},_composeFromComposable:function(a,b){var c=a.from;var d=a.to;var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,c);var f=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,d);var g=a.position;if(c===d){e.switchSubComponent(b,g);setTimeout(function(){this.applyDraggable(e.getContainerWrappingElement())}.bind(this),1)}else{this._moveSubComponent(e,b,f,g)}},_subtractFromComposable:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a.from);var d=c.divideSubComponent(b);$SE_ANIMATION_HELPER.animatesDrop(d.getContainerWrappingElement())},_transformFromComposable:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET);var c=parseInt(a[0].getAttribute("data-sub-position"));if(this._isCompositing(b)){this._composeFromComposable(b,c)}else{this._subtractFromComposable(b,c)}},_generateSortHelper:function(a,b){this._nCachedScrollTopBeforeSort=$(document).scrollTop();var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_SELECTED_COMPONENTS);if(c.length===0){return this._generateSingleHelper(a,b)}else{return this._generateMultiHelper(a,b,c)}},_addClassForHelper:function(a){var b=a.classList;b.add("is-componentDragging");b.add("__se_drag_helper")},_removeInsertPointNode:function(a){var b=a.querySelectorAll(".__se_insert_point");if(b.length>0){_.each(b,function(a){a.parentNode.removeChild(a);a=null})}},_removeNeedlessClass:function(a){var b=a.getElementsByClassName("se_sectionArea")[0];var c=null;if(b){c=b.classList;c.remove("is-dragPosition");c.remove("is-dragPositionBottom");c.remove("is-dragPositionTop");b=null}},_removeCanptionNode:function(a){var b=a.getElementsByClassName("__se_caption_wrap")[0];if(b){b.parentNode.removeChild(b);b=null}},_removeToolbarNode:function(a){var b=a.getElementsByClassName("__se_toolbar")[0];if(b){b.parentNode.removeChild(b);b=null}},_removeImageDeleteNode:function(a){var b=a.getElementsByClassName("se_btn_deleteImage")[0];if(b){b.parentNode.removeChild(b);b=null}},_correctDragHelperPos:function(a,b,c){var d=this._computeDragSymbolPosition(a,b.pageX,b.pageY);var e=d.left+"px "+d.top+"px";c.style.transformOrigin=e;c.style["-webkit-transformOrigin"]=e},_copyTextAreaValue:function(a,b){var c=a.getElementsByTagName("textarea")[0];if(c){c.value=b.getElementsByTagName("textarea")[0].value}},_generateMultiHelper:function(a,b,c){var d=$("<DIV>");var e=d[0];this._correctDragHelperPos(b,a,e);this._addClassForHelper(e);c.forEach(this._makeMultipleHelper.bind(this,d));this._removeCanptionNode(e);this._removeInsertPointNode(e);return d},_makeMultipleHelper:function(a,b){var c=b.getContainerWrappingElement().clone()[0];this._copyTextAreaValue(c,b.getContainerElement());this._removeToolbarNode(c);c.classList.add("__se_drag_helper");a.append(c)},_generateSingleHelper:function(a,b){var c=b[0].cloneNode(true);this._correctDragHelperPos(b,a,c);this._addClassForHelper(c);this._copyTextAreaValue(c,b[0]);this._removeNeedlessClass(c);this._removeCanptionNode(c);this._removeInsertPointNode(c);return $(c)},_generateDraggableHelper:function(a){var b=$(a.currentTarget);var c=b.clone();var d=c[0];d.classList.add("is-componentDragging");d.style.zIndex="2147483647";this._correctDragHelperPos(b,a,d);this._removeImageDeleteNode(d);this._removeNeedlessClass(d);this._removeCanptionNode(d);return c},applySortable:function(){this._$elComponentsWrapper.sortable({handle:".se_sectionArea",item:".se_sectionArea",cancel:".__se_caption_wrap, .__se_nested_sortable, .__drag_cancel",placeholder:"ui-sortable-placeholder",helper:this._generateSortHelper.bind(this),revert:false,scroll:false,start:this._onStartSort.bind(this),sort:this._onDragging.bind(this),update:this._onUpdateSort.bind(this),stop:this._onStopSort.bind(this),delay:100})},applyDraggable:function(a){a.find(".__se_sortable_item").draggable({helper:this._generateDraggableHelper.bind(this),revert:false,scroll:false,start:this._onStartDrag.bind(this),drag:this._onDragging.bind(this),stop:this._onStopDrag.bind(this),delay:100})},destroyDraggable:function(a){a.find(".__se_sortable_item.ui-draggable:not(.is-componentDragging)").draggable("destroy")},bindDragOutsideEvent:function(){$(window.parent).on("mouseup.dragpresenter",this._onMouseUpOutsideWhileDragging.bind(this))},unbindDragOutsideEvent:function(){$(window.parent).off("mouseup.dragpresenter")},destroy:function(){this._destroySortable();this._unbindDragEvents();this.unbindDragOutsideEvent();this._$elBodyWrapper=null;this._$elComponentsWrapper=null}});se.defineComponent("se.InsertResolver",{construct:function(){},_isSplitComponent:function(a){return a&&a.canSplitted()},_decideInsertType:function(a){if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HAS_ACTIVATED_INSERT_POINT_MARKER)){return $SE_CONFIG.INSERT_TYPE.INSERT_POINT_MARKER}else if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.IS_INSERT_GUIDE_SHOWN)){return $SE_CONFIG.INSERT_TYPE.INSERT_GUIDE}else if(this._isSplitComponent(a)){return $SE_CONFIG.INSERT_TYPE.SPLIT}else{return $SE_CONFIG.INSERT_TYPE.DEFAULT}},insertComponent:function(a){var b=a.compData;var c=a.target;var d=a.insertType||this._decideInsertType(c);var e=a.insertPos;var f=a.bFromLibrary;if(e&&typeof e==="string"){e=JSON.parse($SE_STRING.restoreSpecialChar(e))}if(typeof b==="string"){var g;var h;try{g=decodeURIComponent(b);h=JSON.parse(g)}catch(i){h=null}if(h!==null){b=h}}var j=new se[d+"Action"];return j.execute({compData:b,lastStyle:a.lastStyle,target:c,insertPos:e,bFromLibrary:f,callbacks:a.callbacks})}});se.defineStatic("se.MaterialPublisher",function(){var a={FIND:"find",UPDATE:"update"};var b={};b.book=function(a){var b=c(a);var e=a.subId;var f=d(a,{sId:e});b=$.extend(true,b,f);b.bookThemeInfoPk=e;b.sendToNaverBookYn=true;return b};b.broadcast=function(a){var b=c(a);var e=d(a);b=$.extend(true,b,e);return b};b.movie=function(a){var b=c(a);var e=a.id;var f=d(a);b=$.extend(true,b,f);b.movieThemeInfoPk=e;return b};b.music=function(a){var b=c(a);var e=a.id;var f=d(a);b=$.extend(true,b,f);b.musicThemeInfoPk=e;b.sendToNaverMusicYn=true;return b};b.shopping=function(a){var b=c(a);var e=d(a);b=$.extend(true,b,e);return b};function c(a){var b=e(a);var c=b.DIRECTORY_SEQUENCE;var d=parseInt(c,10);var f=a.title;var g=a.type==="book"?a.subId:a.id;var h={directoryId:g,directoryTitle:f,directorySeq:d};return h}function d(a,b){b=b||{};var c=e(a);var d=c.DIRECTORY_SEQUENCE;var f=a.title;var g=b.sId||a.id;var h={directoryDetail:{directorySeq:d,version:$SE_CONFIG.BLOG_META.DIRECTORY_DATA.VERSION,type:c.TYPE,addInputName:c.INPUT_NAME,contents:{code:g,codeName:c.CODE_NAME,name:f,removeReInput:false}},themeSourceCode:c.THEME_SOURCE_CODE};return h}function e(a){var b=a.type.toUpperCase();var c=$SE_CONFIG.BLOG_META.DIRECTORY_DATA[b];return c}function f(b){h(b,{mode:a.UPDATE})}function g(b){return h(b,{mode:a.FIND})}function h(b,c){if(!b){return}c=c||{};var d=c.mode;var e,f,g;var h;if(Array.isArray(b)){for(e=0,f=b.length;e<f;e++){g=b[e];if(i(g)){h=g;break}}}else if($.isPlainObject(b)){if(i(b)){h=b}}if(d===a.FIND){return h?true:false}else if(d===a.UPDATE){j(h)}}function i(a){if(a&&a["@ctype"]===$SE_CONFIG.COMP_TYPE.MATERIAL){return true}}function j(a){if(!a){return}var c=a.type;var d=b[c];if(typeof d!=="function"){return}var e=d(a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DIRECTORY_BLOG_META_FROM_MATERIAL,e)}return{bCompDataHasMaterial:g,isMaterialModelJson:i,updateDirectoryMeta:f}}());se.defineComponent("se.EditAreaWatcher",{construct:function(){this._initVar();this._bindGatewayEvent();this._parseKeyCode()},_initVar:function(){this._nTimer=-1;this._nIntervalTimer=300;this._oComp=null;this._sStrData=null;this._$elEditorble=null;this._elInactive=null;this._fIsUndo=null;this._fIsRedo=null;this._fIsEnter=null;this._fIsSoftEnter=null;this._fIsDelete=null;this._fIsBackspace=null;this._htOption=null;this._bSelectAllClick=false;this._bActivate=false;this._PASTE_KEY=["ctrl+v","command+v"]},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this.activate.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this.deactivate.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.HIDE_IECURSOR,this.hideIECursor.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.SHOW_IECURSOR,this.showIECursor.bind(this))},_parseKeyCode:function(){this._fIsPaste=this._getProxyKeyFunc(this._PASTE_KEY);this._fIsUndo=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.UNDO.keySet);this._fIsSelectAll=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.SELECT_ALL.keySet);this._fIsRedo=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.REDO.keySet);this._fIsEnter=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.ENTER.keySet);this._fIsSoftEnter=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.SOFT_ENTER.keySet);this._fIsDelete=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.DELETE.keySet);this._fIsBackspace=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.BACKSPACE.keySet);this._fIsInsertCompParagraph=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_PARAGRAPH.keySet);this._fIsInsertCompQuotation=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_QUOTATION.keySet);this._fIsInsertCompHorizontalLine=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_HORIZONTAL_LINE.keySet);this._fIsInsertCompImage=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_IMAGE.keySet);this._fIsInsertCompVideo=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_VIDEO.keySet);this._fIsInsertCompMap=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_MAP.keySet);this._fIsInsertCompMaterial=this._getProxyKeyFunc($SE_CONFIG.HOTKEY.INSERT_COMP_MATERIAL.keySet)},redefineCharCode:function(a,b){var c=String.fromCharCode(a).toLowerCase();if(b===46&&c==="."){c="del"}return c},_getProxyKeyFunc:function(a){var b=$.proxy(function(a,b){var c=null,d=null,e=true,f=a.split("+");var g,h;if(f.length>1){g=true;h=f.slice(0,f.length-1);d=f[f.length-1].trim().toLowerCase()}else{d=f[0].trim().toLowerCase()}if(g){e=false;var i={};h.forEach(function(a){i[a]=a}.bind(this));if(i["ctrl"]&&b.ctrlKey){delete i["ctrl"]}if(i["shift"]&&b.shiftKey){delete i["shift"]}if(i["alt"]&&b.altKey){delete i["alt"]}if(i["command"]&&b.metaKey){delete i["command"]}e=_.isEqual({},i)}if(e&&(d===this.redefineCharCode(b.which,b.keyCode)||d==="enter"&&b.keyCode===13||d==="delete"&&b.keyCode===46||d==="del"&&b.keyCode===46||d==="backspace"&&b.keyCode===8)){return true}return false},this);return $.proxy(function(a,c){var d=false;if($.isArray(a)){a.forEach(function(a){if(!d){d=b(a,c)}},this)}else{d=b(a,c)}return d},this,a)},activate:function(a,b){clearTimeout(this._nTimer);this._htOption=b||{};this._oComp=a;this._bActivate=true;this._bSelectAllClick=false;this._serachEditElements();this._bindKeyEvent()},_isSelectPressed:function(a){return a===16||a===17||a===91},_isArrowPressed:function(a){var b=a.keyCode;var c=$(a.target).parents(".se_component");var d=c.attr("id");var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,d);if(!e){return false}if(e.isTextEditable()===false&&e.isDocumentTitle()===false){return false}return $SE_COMMON_UTIL.isArrowKeyCode(b)},_isTabPressed:function(a){return a===$SE_CONFIG.TRIGGER.TAB},_isMetaKeyPressed:function(a){return a.ctrlKey||a.metaKey||a.shiftKey},_serachEditElements:function(){var a=this._oComp.getContainerWrappingElement();if(!a){a=$(document.body)}var b=a.find(".se_viewArea,.se_editView");this._$elEditorble=b.find("input[type='text'],textarea,[contenteditable='true']");this._$elMediaTagWrap=b.find(".__se_mediaTag_wrap")},_startTimer:function(a){var b="";if(!this._$elEditorble){return}this._$elEditorble.each(function(a,c){if(c.isContentEditable){b+=c.innerHTML}else{b+=c.value}});if(a===this._oComp.getId()&&this._sStrData!==b){this._oComp.executeCompHistory()}this._sStrData=b},_isInsertCompKeyPressed:function(a){var b=null;if(this._fIsInsertCompParagraph(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_PARAGRAPH.ns}else if(this._fIsInsertCompQuotation(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_QUOTATION.ns}else if(this._fIsInsertCompHorizontalLine(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_HORIZONTAL_LINE.ns}else if(this._fIsInsertCompImage(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_IMAGE.ns}else if(this._fIsInsertCompVideo(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_VIDEO.ns}else if(this._fIsInsertCompMap(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_MAP.ns}else if(this._fIsInsertCompMaterial(a)){b=$SE_CONFIG.HOTKEY.INSERT_COMP_MATERIAL.ns}if(b){$SE_HOTKEY.execShortcut(b,a);return true}return false},_bindKeyEvent:function(){this._unbindKeyEvent();var a=".watcher#"+this._oComp.getId();this._$elEditorble.on("focus"+a,function(a){if(this._elInactive!==a.target){this._clearIECursor()}$SE_HOTKEY.pause()}.bind(this));this._$elEditorble.on("blur"+a,function(a){if(this._elInactive){return}$SE_HOTKEY.unpause()}.bind(this));this._$elEditorble.on("keydown"+a,function(a){if(this._nTimer>-1){clearTimeout(this._nTimer)}if(this._isTabPressed(a.keyCode)){this._bSelectAllClick=false;return false}if(this._isSelectPressed(a.keyCode)){$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.ENTER_SELECTING.ns,a)}if(this._isArrowPressed(a)){$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.FOCUS_MOVE.ns,a)}if(this._fIsRedo(a)){a.preventDefault();a.stopPropagation();$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.REDO.ns,a);this._sStrData=null;this._bSelectAllClick=false;return}else if(this._fIsUndo(a)){a.preventDefault();a.stopPropagation();$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.UNDO.ns,a);this._sStrData=null;this._bSelectAllClick=false;return}else if(this._isInsertCompKeyPressed(a)){a.preventDefault();a.stopPropagation();this._bSelectAllClick=false}else if(this._fIsSelectAll(a)){if(!this._bSelectAllClick){this._bSelectAllClick=true;return}else{a.preventDefault();a.stopPropagation();$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.SELECT_ALL.ns,a);this._bSelectAllClick=false;return}}else if(!this._fIsSoftEnter(a)&&this._fIsEnter(a)&&this._htOption.fEnter){var b=this._htOption.fEnter(a);if(b!==true){a.preventDefault();a.stopPropagation()}}else if(this._fIsDelete(a)&&this._htOption.fDelete){this._htOption.fDelete(a);return}else if(this._fIsBackspace(a)&&this._htOption.fBackspace){this._htOption.fBackspace(a);return}if(this._bSelectAllClick){this._bSelectAllClick=false}if(!this._bActivate){return}if(this._fIsPaste(a)===false&&this._isMetaKeyPressed(a)){return}this._nTimer=setTimeout($.proxy(this._startTimer,this,this._oComp.getId()),this._nIntervalTimer)}.bind(this));this._$elEditorble.on("keyup"+a,function(a){if(this._isSelectPressed(a.keyCode)){$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.EXIT_SELECTING.ns,a)}}.bind(this));this._$elMediaTagWrap&&this._$elMediaTagWrap.on("keydown"+a,function(a){if(this._fIsRedo(a)){a.preventDefault();a.stopPropagation();$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.REDO.ns,a);this._sStrData=null;this._bSelectAllClick=false;return}else if(this._fIsUndo(a)){a.preventDefault();a.stopPropagation();$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.UNDO.ns,a);this._sStrData=null;this._bSelectAllClick=false;return}}.bind(this))},_unbindKeyEvent:function(){if(this._$elEditorble){var a=".watcher#"+this._oComp.getId();this._$elEditorble.off("keydown"+a);this._$elEditorble.off("keyup"+a);this._$elEditorble.off("focus"+a);this._$elEditorble.off("blur"+a);this._$elEditorble.off("keyup"+a)}this._$elMediaTagWrap&&this._$elMediaTagWrap.off("keydown"+a)},deactivate:function(a){if(a&&this._oComp&&a.getId()!==this._oComp.getId()){return}this._unbindKeyEvent();clearTimeout(this._nTimer);this._nTimer=null;this._htOption={};this._oComp=null;this._sStrData=null;this._$elEditorble=null;this._bSelectAllClick=false;this._bActivate=false;this._clearIECursor();$SE_HOTKEY.unpause()},_usableSetActive:function(){return this._$elEditorble&&this._$elEditorble.get(0)&&!!this._$elEditorble.get(0).setActive},hideIECursor:function(){if(!this._usableSetActive()){return}if(this._$elEditorble.is(":hidden")){return}this._$elEditorble.map(function(a,b){if(document.activeElement===b){this._elInactive=b}}.bind(this));this._elInactive=this._elInactive||this._$elEditorble.get(0);selry.getSelection().save();document.body.setActive();this._attachEventForIECursor();$SE_HOTKEY.pause()},showIECursor:function(){if(!this._usableSetActive()){return}if(this._elInactive){selry.getSelection().restore();this._elInactive.setActive();this._clearIECursor()}},_clearIECursor:function(){this._detachEventForIECursor();this._elInactive=null},_attachEventForIECursor:function(){this._detachEventForIECursor();$(document.body).on("keydown.__IECursor",function(a){if(a.target===document.body){this.showIECursor()}}.bind(this))},_detachEventForIECursor:function(){$(document.body).off(".__IECursor")},destroy:function(){}});se.defineClass("se.InsertGuideAction",se.InsertDefaultAction,{construct:function(){},execute:function(a){var b=this._getComponentData(a.compData,a.lastStyle);var c=this._getComponentInstance(b,a.callbacks);var d=a.insertPos||$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET);var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,d.to);var f=d.position;var g=null;if(d.type==="composite"){g=c[0]._oModel.getJson();return[e.addSubComponent(g,f,a.bFromLibrary)]}else{return c.map(function(a){if(f==="above"){a.renderAbove(e)}else{a.renderBelow(e);e=a}return a}.bind(this))}}});se.defineClass("se.InsertPointMarkerAction",se.InsertDefaultAction,{construct:function(){},_insertBelow:function(a,b){return a.map(function(a){a.renderBelow(b);b=a;return a}.bind(this))},_prependTo:function(a,b){var c=a[0];var d=a.slice(1);c.prependTo(b);var e=this._insertBelow(d,c);e.push(c);return e},execute:function(a){var b=this._getComponentData(a.compData,a.lastStyle);var c=this._getComponentInstance(b,a.callbacks);var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.FIND_INSERT_POINT_MARKER_COMPONENT);if(d){return this._insertBelow(c,d)}else{return this._prependTo(c,this._$elComponentsWrapper)}}});se.defineClass("se.SplitAction",se.InsertDefaultAction,{construct:function(){},_appendSplittedComponent:function(a,b){b.disableSplit();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DISABLED_PUSH_HISTORY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:a,shouldFocus:false});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ENABLED_PUSH_HISTORY);b.enableSplit()},_splitComponent:function(a,b){var c=b.adviseInsertViewComp(a);if(c.htData){this._appendSplittedComponent(c.htData,b)}return c.sInsertType},_appendBefore:function(a,b){var c=a.map(function(a){a.renderAbove(b);return a}.bind(this));return c},_appendAfter:function(a,b){var c=a.map(function(a){a.renderBelow(b);b=a;return a}.bind(this));return c},_makeCompDataArray:function(a){return[].concat(this._getComponentData(a.compData,a.lastStyle))},execute:function(a){var b=this._makeCompDataArray(a);var c=this._getComponentInstance(b,a.callbacks);var d=a.target;var e=this._splitComponent(b,d);if(e==="before"){return this._appendBefore(c,d)}else if(e==="after"||e==="split"){return this._appendAfter(c,d)}return[d]}});se.defineClass("se.ComponentGuideLineResolver",se.GuideLineResolver,{construct:function(){},_findComposableSlot:function(a,b,c,d){var e=a[0].id;if(e===b[0].id){return{target:"cancel"}}var f=this._decideComposableSlot(a,c,d);var g=f.target;var h=this._findNext(b)[0];if(g==="top"&&h&&e===h.id){return{target:"cancel"}}h=this._findPrev(b)[0];if(g==="bottom"&&h&&e===h.id){return{target:"cancel"}}return f},_filterAdjacentBottom:function(a,b){if(this._isOnMe(this._findPrev(a),b)){return{target:"cancel"}}else{return{target:"top"}}},_filterAdjacentTop:function(a,b){if(this._isOnMe(this._findNext(a),b)){return{target:"cancel"}}else{return{target:"bottom"}}},_isOnMe:function(a,b){if(a.length===0||b.length===0){return}return a[0].id===b[0].id},adviceInsertSlot:function(a,b,c,d){var e=b;var f=this._isComposable(a,b);var g=this._isOnMe(a,b);if(f){return this._findComposableSlot(a,e,c,d)}if(g){return{target:"cancel"}}if(se.util.Scroll.isMousePointerAboveForGuideline(a,d)){return this._filterAdjacentBottom(a,e)}else{return this._filterAdjacentTop(a,e)}}});se.defineClass("se.MultiDragGuideLineResolver",se.GuideLineResolver,{construct:function(){},_findCompareTarget:function(a,b,c){if(c==="bottom"&&a.is(this._findPrev(b.first()))){a=this._findNext(a)}if(c==="top"&&a.is(this._findNext(b.last()))){a=this._findPrev(a)}return a},_collectAbove:function(a,b,c){var d=[];var e=c[0].id;while(a-->0){c=this._findPrev(c);if(c.length===0){break}if(e===c[0].id){++a;continue}d.push(c[0].id)}return d},_collectBelow:function(a,b,c){var d=[];var e=c[0].id;while(a++<b-1){c=this._findNext(c);if(c.length===0){break}if(e===c[0].id){--a;continue}d.push(c[0].id)}return d},_isOnMe:function(a,b,c,d){var e=this._findCompareTarget(a,b,d);var f=e[0].id;var g=_.indexOf(c,f);var h=b.length;var i=false;var j=e[0].id;var k=[j];var l=null;var m=null;if(g>-1){l=this._collectAbove(g,h,e);m=this._collectBelow(g,h,e);k=k.concat(l).concat(m);i=_.difference(c,k).length===0}return i},adviceInsertSlot:function(a,b,c,d){var e=b;var f=null;var g=e.map(function(a,b){return b.id});if(se.util.Scroll.isMousePointerAboveForGuideline(a,d)){f="top"}else{f="bottom"}if(this._isOnMe(a,e,g,f)){f="cancel"}return{target:f}}});se.defineClass("se.SubComponentGuideLineResolver",se.GuideLineResolver,{construct:function(){},_isSubComponentDragging:function(a,b){return a.has(b).length>0},_isCurrentSlot:function(a,b){var c=b.index,d=b.target;if(d==="bottom"||d==="top"){return false}return c===-1||(a===c||a+1===c)},_applySlotRule:function(a,b,c){var d=parseInt(c[0].getAttribute("data-sub-position"),10),e=this._isSubComponentDragging(b,c);if(e&&this._isCurrentSlot(d,a)){return{target:"cancel"}}return a},_isOnMe:function(a,b){var c=a.has(b).length>0;return c},adviceInsertSlot:function(a,b,c,d){var e=this._isComposable(a,b),f=this._isOnMe(a,b),g=null;if(e||f){var h=this._decideComposableSlot(a,c,d);g=this._applySlotRule(h,a,b)}else{if(se.util.Scroll.isMousePointerAboveForGuideline(a,d)){g={target:"top"}}else{g={target:"bottom"}}}return g}});se.defineComponent("se.CanvasKeyActionHandler",{construct:function(){this._aCopyStack=null},copyComponent:function(){var a=null,b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CURRENT_FOCUSED);if(!b||b.isDocumentTitle()){return}a=b.getModelDataAsJson();delete a.compId;this._aCopyStack=[];this._aCopyStack.push(a)},pasteComponent:function(){this._aCopyStack.forEach(function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:a,shouldFocus:true})},this)},deleteComponent:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CURRENT_FOCUSED);if(b&&b.getCompType()==="table"){b.deleteTableByHotkey();return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,a)},insertComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,a)}});se.defineComponent("se.CanvasCopyPasteHandler",{_aBlock2BrTag:["div","p","li","dt","dd","blockquote","pre"],_aWhiteListTag:["span","br","b","i","strong","em","u","strike","a","sup","sub"],_aTableTags:["table","th","tr","td","caption","colgrop","col","thead","tbody","tfoot"],_aWhiteListTableStyle:["background","background-color","width","height","padding","margin","border-top","border-left","border-right","border-bottom","border","border-style","border-width","border-color"],_aBlackListTag:["head","style","link","script","object","embed","iframe","input","button"],_aBlackListAttr:["id","onclick","onload","onmousedown","unselectable"],_rxComment:/<!--(?:.|\s)*?-->/gi,_rxBR:/<br[^>]*\/?>/gi,_rxLtrimBR:/^(?:<br[^>]*\/?>)+/i,_rxRtrimBR:/(?:<br[^>]*\/?>)+$/i,_rxChromeFragment:/<!--StartFragment-->((?:.|\s)*)?<!--EndFragment-->/i,_rxBrokenStart:/^[^<]*>/,_rxBrokenEnd:/<[^>]*$/,_rxInvalidStart:/^(?:<\/[^<]*>)+/,_rxInvalidEnd:/(?:<[^(?:img|br|hr)][^>\/]*>)+$/,_sPastedLinkClass:"_se_pasted_link_tmp",OPT_DEFAULT:{aConvertTag:["img","h1","h2","h3","h4","h5","h6","hr"],aWhiteListStyle:["color","display","visibility"],bAutoOGLink:true},_TABLE_CLASS:{component:"se_table",selectedCell:"se_selectedCell"},construct:function(a){this._initVar(a);this._assignElements();this.bindEvent();this._bindGatewayEvent()},_initVar:function(a){this._htOption=$.extend({},this.OPT_DEFAULT,a);if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC){var b=function(){};this._onKeydown=this._onCopy=this._onCut=b}var c="<span> <!--SE_DATA",d="--></span>";this._sKey=""+(new Date).getTime()+Math.floor(Math.random()*100);this._DATA_PREFIX=c+this._sKey;this._DATA_SUFFIX=d;this._rxData=new RegExp("<span>(?:\\s*|&nbsp;)<!--SE_DATA(\\d*)(.*?)-->","i");var e=eg.agent();this._bUsePostPaste=e.os.name==="mac"&&e.browser.name==="safari"||e.browser.name==="firefox"||$SE_COMMON_UTIL.detectIE()>11;this._initPasteImageUploader();this._useTableComp=$SE_CONFIG.SERVICE_CONFIG.COMP_SET.indexOf($SE_CONFIG.COMP_INSERT_ITEM_TYPE.TABLE)>-1;this.urlInfoArray=[]},_initPasteImageUploader:function(){this._pasteImageUploader=new se.ImageFileUploaderComponent;this._pasteImageUploader.on("IMAGE_FILE_UPLOADER.COMPLETE_ALL",this._onCompletePasteImageUpload.bind(this))},_onCompletePasteImageUpload:function(a){this._insertComponent(a.compData,true)},_insertComponent:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{shouldFocus:b,compData:a,action:$SE_CONFIG.ACTION.PASTE,trigger:$SE_CONFIG.TRIGGER.PASTE})},_assignElements:function(){this._$el=$("body")},bindEvent:function(){if(window.clipboardData){this._$el.on({"keydown.se_CopyPasteHandler":this._onKeydown.bind(this)})}else{this._$el.on({"copy.se_CopyPasteHandler":this._onCopy.bind(this),"cut.se_CopyPasteHandler":this._onCut.bind(this)})}this._$el.on("paste.se_CopyPasteHandler",this._onPaste.bind(this))},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.UNBIND_EVENT,this.unbindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.BIND_EVENT,this.bindEvent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.DESTROY,this.destroy.bind(this))},unbindEvent:function(){this._$el.off(".se_CopyPasteHandler")},_onKeydown:function(a){var b=a.keyCode;if(this._isEditArea($(a.target))||!a.ctrlKey){return}if(b===86){this._fakePaste(a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);a.preventDefault()}else if(b===67){var c=true;this._fakeCopy($(a.target),c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);a.preventDefault()}else if(b===88){this._fakeCut($(a.target));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);a.preventDefault()}},_fakeCopy:function(a,b){if(!this._$elCopy){this._$elCopy=$('<div style="position:fixed;left:-9999px;width:0;height:0;font-size:0;line-height:0;z-index:-1"></div>').appendTo(this._$el)}var c="";if(this._isInTable(a)&&b){c=this._getFakeSelectedTable(a)}if(c===""){c=this._getSelectedComponentsData()}this._$elCopy.html(c);selry.getSelection().selectNodeContents(this._$elCopy.get(0));document.execCommand("copy");return c},_fakeCut:function(a){var b=this._fakeCopy(a);if(b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT)}},_copyComponentsData:function(a,b){var c=$(a.target),d;if(this._isEditArea(c)){return false}var e=a.originalEvent.clipboardData||window.clipboardData;if(this._isInTable(c)&&b){d=this._getFakeSelectedTable(c)}if(!d){d=this._getSelectedComponentsData()}try{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);e.setData("text/html",d)}catch(f){e.setData("Text",d)}a.preventDefault();return d},_getFakeSelectedTable:function(a){var b=this._TABLE_CLASS.selectedCell;var c=this._getTargetTable(a);var d=c.find("tr:has(td."+b+")");var e="";var f=$("<table></table>").append(d.clone());f.find("td:not(."+b+")").remove();f.removeClass(b);if(f.html()!==""){e=f.get(0).outerHTML}e=this._stripTags(e,this._getWhiteListTags());return e},_getTargetTable:function(a){var b=this._TABLE_CLASS.component;var c=a.parents("."+b);if(c.length<1){c=a.find("."+b)}return c},_onCopy:function(a){var b=true;this._copyComponentsData(a,b)},_onCut:function(a){var b=this._copyComponentsData(a);if(b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT)}},_isEditArea:function(a){return this._isTextInput(a)||this._isInContentEditable(a)},_isInTable:function(a){return a.parents("."+this._TABLE_CLASS.component)},_isTextInput:function(a){return a.is("input[type=text],textarea")},_isInContentEditable:function(a){var b=a.parents("."+this._TABLE_CLASS.component).find("."+this._TABLE_CLASS.selectedCell).length>0;var c=a.parents("[contenteditable=true]").andSelf().is("[contenteditable=true]");return c&&!b},_getEditable:function(a){var b=a.parents("[contenteditable=true]").andSelf();if(b.is("[contenteditable=true]")){return selry.edit(b.get(0))}return null},_extractModelDataToPaste:function(a){var b=a.getModelDataAsJson();if(a.isWrappingParagraph()){b=a.getCurrentSlotDataAsJson()}delete b.compId;if(b["@ctype"]==="imageStrip"){b.components.forEach(function(a){delete a.compId})}return b},_getSelectedComponentsData:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS);var b=[];$.each(a,function(a,c){if(c&&!c.isDocumentTitle()){var d=this._extractModelDataToPaste(c);b.push(d)}}.bind(this));var c=escape(JSON.stringify(b));
return this._DATA_PREFIX+c+this._DATA_SUFFIX},_fakePaste:function(a){this._$elPasteTarget=$(a.target);var b=this._getEditable(this._$elPasteTarget);if(b){b.saveSelection()}if(!this._$elPaste){this._$elPaste=$('<div style="position:fixed;left:-9999px;width:0;height:0;font-size:0;line-height:0;z-index:-1" contenteditable="true"></div>').appendTo(this._$el)}this._$elPaste.empty();this._$elPaste.focus();document.execCommand("paste")},_needToUseClipboard:function(a){return a&&a.items&&a.items.length<=1},_onPaste:function(a){if(this._isTextInput($(a.target))){return}if(this._bUsePostPaste){var b=a.originalEvent.clipboardData||window.clipboardData;if(this._needToUseClipboard(b)&&this._pasteImageFromClipboard(b)){a.preventDefault();return}this._processPostPaste(a);return}if(window.clipboardData){if(this._$elPasteTarget){setTimeout($.proxy(this._processFakePaste,this,this._$elPasteTarget),0);this._$elPasteTarget=null;return}this._fakePaste(a)}else{this._processPaste(a)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE);a.preventDefault()},_processFakePaste:function(a){var b=this._$elPaste.html();if(!this._pasteComponentsData(b)&&a){this._pasteHtml2Comp(b,this._getEditable(a))}this._$elPaste.empty()},_processPostPaste:function(a){var b=this._getEditable($(a.target));if(b){setTimeout(this._postPaste.bind(this,b),0)}},_postPaste:function(a){var b=a.getContents();document.execCommand("undo");var c=a.getContents();var d=this._getPasted(c,b);if(d){this._pasteHtml2Comp(d,a)}},_pasteImageFromDataURI:function(a){var b=a.getAttribute("src");var c=this._dataURItoBlob(b);if(c instanceof Blob){var d="image."+_.last(c.type.split("/"));try{var e=new File([c],d);this._pasteImageUploader.upload([e])}catch(f){var g={base64image:b.replace("data:image/png;base64,",""),imageFileName:d};this._pasteImageUploader.uploadBase64([g])}}},_dataURItoBlob:function(a){var b;if(a.split(",")[0].indexOf("base64")>=0){b=atob(a.split(",")[1])}else{b=unescape(a.split(",")[1])}var c=a.split(",")[0].split(":")[1].split(";")[0];var d=new Uint8Array(b.length);var e=b.length;for(var f=0;f<e;f++){d[f]=b.charCodeAt(f)}return new Blob([d],{type:c})},_getPasted:function(a,b){var c,d=b.length,e=d-a.length,f=-1,g;for(c=0;c<d;c++){if(b.charAt(c)!=a.charAt(c)){f=c;break}}if(f<0){return}for(c=d-1;c>f;c--){if(b.charAt(c)!=a.charAt(c-e)){g=c+1;break}}var h=b.substring(f,g),i;if(this._rxBrokenStart.test(h)){i=b.lastIndexOf("<",f);if(i<0){h="<"+h}else{f=i;h=b.substring(f,g)}}if(this._rxBrokenEnd.test(h)){i=b.indexOf(">",g);if(i<0){h=h+">"}else{g=i+1;h=b.substring(f,g)}}if(b.charAt(f-1)==="<"&&b.charAt(g)===">"){h="<"+h+">"}h=h.replace(this._rxInvalidStart,"").replace(this._rxInvalidEnd,"");return h},_hasType:function(a,b){if(a.contains){return a.contains(b)}if(a.indexOf){return a.indexOf(b)>-1}return false},_getType:function(a){var b="text/html",c="text/plain";if(this._hasType(a,b)){return b}if(this._hasType(a,c)){return c}return"Text"},_processPaste:function(a){var b=a.originalEvent.clipboardData||window.clipboardData,c=this._getType(b.types),d=b.getData(c)||"";if(this._pasteComponentsData(d)){a.preventDefault()}else if(!d&&this._pasteImageFromClipboard(b)){a.preventDefault()}else{if(c!=="text/html"){d=$SE_STRING.replaceSpecialChar(d);d=d.replace(/\n/g,"<br>").replace(/\u0020/g,"&nbsp;")}this._pasteHtml2Comp(d,this._getEditable($(a.target)))}},_pasteImageFromClipboard:function(a){if(!a){return false}var b=a.items;var c=[];var d=_.filter(b,function(a){return a.kind==="file"});_.each(d,function(a,b){var d=a.getAsFile();if(d instanceof File){c.push(d)}else if(d instanceof Blob){var e=new File([d],"image."+_.last(d.type.split("/")));c.push(e)}});if(c.length>0){this._pasteImageUploader.upload(c);return true}return false},_pasteComponentsData:function(a){if(this._rxData.test(a)){var b=RegExp.$1;a=unescape(RegExp.$2);var c=JSON.parse(a);if(this._sKey!==b){$.each(c,function(a,b){this._removeUploadedLocal(b)}.bind(this))}this._insertComponent(c,true);return true}return false},_removeUploadedLocal:function(a){var b=a["@ctype"];if(b===$SE_CONFIG.COMP_TYPE.IMAGE_STRIP){var c=a.components,d,e;for(d=c.length;d--;){e=c[d];this._removeUploadedLocal(e)}}else if(b===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH){this._removeUploadedLocal(a.wrapComp)}else{if(a.uploadedLocal){a.uploadedLocal=false}}},_pasteHtml2Comp:function(a,b){a=this._html2comp(a,b);if(a.constructor===Array){if(a.length<1){return}this._insertComponent(a,true)}else{b&&b.restoreSelection();this._pasteContWithExtraComp(a,b)}},_pasteContWithExtraComp:function(a,b){var c=$SE_STRING.getAllUrlPatternMatches(a,true);c=_.uniq(c);if(c.length>0){this._runExtraCompPasteProcess(c)}this._paste2canvas(a,b)},_runExtraCompPasteProcess:function(a){this.urlInfoArray=[];if($SE_CONFIG.SERVICE_CONFIG.FEATURES.PASTE_IMAGE===false){return}for(var b=0;b<a.length;b++){this.urlInfoArray.push([]);this._urlCheckerPromise(a,b).then(this._chkAllImageLoaded.bind(this)).catch(this._chkAllImageLoaded.bind(this))}},_urlCheckerPromise:function(a,b){return new Promise(function(c,d){var e=new Image;var f=a[b];var g={isImage:true,count:b,targetArray:a};e.onload=function(){g.isImage=true;c(g)};e.onerror=function(){g.isImage=false;d(g)};$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.START);e.src=f})},_chkAllImageLoaded:function(a){var b=a.isImage;var c=a.count;var d=a.targetArray;var e=d[c];var f=c===d.length-1;this.urlInfoArray[c]={url:e,isImage:b};if(f){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END);this._addExtraCompAfterPaste(this.urlInfoArray)}},_addExtraCompAfterPaste:function(a){var b={image:function(a){var b=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.IMAGE);var c=$.extend({},b,{src:a});clickcr(this,"txt.pasteimgurl","","","");this._insertComponent(c,true)}.bind(this),oglink:function(a){if(!$SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){clickcr(this,"txt.pasteogurl","","","");this._insertOG(a)}}.bind(this)};if(!a){return}var c=this._analyzeUrlType(a);if(c!==null&&b[c.urlType]){b[c.urlType](c.url)}},_analyzeUrlType:function(a){a=a||[];var b=_.first(a);var c=_.last(a);if(a.length===1&&b.isImage){return{urlType:"image",url:b.url}}if(_.findIndex(a,{isImage:true})<0){return{urlType:"oglink",url:c.url}}return null},_paste2canvas:function(a,b){var c=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.PARAGRAPH);var d;a=this._getHyperlinkedHTML(a);d=$.extend({},c,{value:a});b?b.pasteHTML(a,true):this._insertComponent(d)},_getWhiteListTags:function(){var a=this._aWhiteListTag;if(this._useTableComp){a=a.concat(this._aTableTags)}return a},_getConvertTags:function(){var a=this._htOption.aConvertTag;if(this._useTableComp){a.push("table")}if(!$SE_CONFIG.SERVICE_CONFIG.IS_PASTE_SECTION_TITLE){a=a.filter(function(a){return!a.match(/h[1-6]/)})}return a},_getCompByConvertTags:function(a){var b=$(a);if(b.parents("table").length>0){return}var c,d,e;var f=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.IMAGE),g=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.SECTION_TITLE),h=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.HORIZONTAL_LINE),i=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.TABLE);switch(a.tagName){case"TABLE":c=this._stripTags(a.outerHTML,this._getWhiteListTags()).replace(this._rxBR,"<br>");c=this._removeTableTags(c);e=$.extend({},i,{tableRows:c});break;case"IMG":if(this._isDataURIImage(a)===true){this._pasteImageFromDataURI(a)}else if(this._isExternalImage(a)){e=$.extend({},f,{src:b.attr("src")})}break;case"H1":case"H2":case"H3":case"H4":d=b.text();if(d){e=$.extend({},g,{title:d,componentStyle:{fontSize:"H1"}})}break;case"H5":d=b.text();if(d){e=$.extend({},g,{title:d,componentStyle:{fontSize:"H2"}})}break;case"H6":d=b.text();if(d){e=$.extend({},g,{title:d,componentStyle:{fontSize:"H3"}})}break;case"HR":e=h;break}return e},_html2comp:function(a,b){var c=this._getConvertTags();if(this._useTableComp){a=this._applyStyleTagToInline(a)}if(this._rxChromeFragment.test(a)){a=RegExp.$1}a=this._removeTag(a,this._aBlackListTag);a=this._injectBR(a,this._aBlock2BrTag);a=this._stripTags(a,this._getWhiteListTags().concat(c)).replace(this._rxBR,"<br>");a=this._removeAttr(a,this._aBlackListAttr);if(this._useTableComp){a=this._refineTableTag(a)}a=this._refineStyle(a);a=this._removeDropCap(a);a=$.trim(a);var d=$("<div>").html(a);var e=d.get(0);e.innerHTML=e.innerHTML.replace(this._rxComment,"");var f=d.find(c.join(",")).get();var g=f.length;if(this.isSingleTable(f)&&this._isTableEditable(b)){var h=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(h&&h.getCompType()===$SE_CONFIG.COMP_TYPE.TABLE){h.onPasteInTable(b,f);return[]}}if(g>0){var i=[],j=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.PARAGRAPH);var k=document.createRange(),l=$("<div>"),m;for(var n=0,o,p;o=f[n];n++){if(e.firstChild&&e.firstChild!==o){k.setStart(e.firstChild,0);k.setEnd(o,0);this._pushParagraphComp(i,l,k.extractContents(),j)}p=this._getCompByConvertTags(o,i);if(p){i.push(p)}$(o).remove();l.empty()}if(e.firstChild){k.setStart(e.firstChild,0);m=e.lastChild;k.setEnd(m,m.childNodes?m.childNodes.length:m.length);this._pushParagraphComp(i,l,k.extractContents(),j)}l.empty();return i}return this._getDOMFilteredHTML(d)},isSingleTable:function(a){var b=a.length===1;var c=a[0]&&a[0].tagName==="TABLE";if(b&&c){return true}return false},_isTableEditable:function(a){return a&&$(a.getElement()).hasClass("se_cellArea")},_fontToSpan:function(a){a=a||"";a=a.replace(/<\/?(\w+)[^>]*?>/gi,function(a,b){b=b.toLowerCase();var c=$(a).attr("color");if(b==="font"&&c){var d='<span style="color:'+c+'";>';return d}return a});return a},_applyStyleTagToInline:function(a){var b="",c;var d=this._extractStyle(a);a=this._fontToSpan(a);if(!d){return a}c=this._applyStyle(a,d);c.each(function(a,c){if(c.outerHTML){b=b.concat(c.outerHTML)}});return b},_getTmpDocument:function(){if(!this._oTmpDoc){var a=document.createElement("IFRAME");a.style.display="none";document.body.appendChild(a);var b=a.contentWindow.document;b.open();b.write("<html><head></head><body></body></html>");b.close();this._oTmpDoc=b}return this._oTmpDoc},_getCSSStyleRule:function(a){var b={};var c=a.length-1;for(var d=c,e;e=a[d];d--){if(e.type===CSSRule.STYLE_RULE){b[e.selectorText]=e.style}}return b},_extractStyle:function(a){if(!a){return}var b=null;var c=/<\/?style(?:\s+[^>]*)?>/gi;var d=/<style(?:\s+[^>]*)?>(?:.|\r|\n)*?<\/style>/gi;var e=a.match(d)||[];var f=e.join("\n");f=f.replace(c,"");if(f){var g=this._getTmpDocument();var h=g.getElementsByTagName("HEAD")[0];var i=g.createElement("STYLE");i.innerHTML=f;h.appendChild(i);b=this._getCSSStyleRule(i.sheet.cssRules);i.parentNode.removeChild(i)}return b},_applyStyleRuleToInline:function(a,b,c){var d=c.find(a);for(var e=0,f;f=d[e];e++){this._applyInlineStyle(f,b)}},_applyStyle:function(a,b){var c=$(a);for(var d in b){this._applyStyleRuleToInline(d,b[d],c)}return c},_applyInlineStyle:function(a,b){for(var c=0,d=b.length,e;c<d;c++){e=b[c];if(!a.style[e]){a.style[e]=b[e]}}},_getDOMFilteredHTML:function(a){var b=a.get(0);var c=Array.prototype.slice.call(b.getElementsByTagName("*"));for(var d=0,e;e=c[d];d++){if(this._filterInvalidParagraph.apply(e)){$(e).remove()}}var f=$.trim(a.html());return f.replace(this._rxLtrimBR,"").replace(this._rxRtrimBR,"")},_pushParagraphComp:function(a,b,c,d){var e=this._getDOMFilteredHTML(b.append(c));if(e){a.push($.extend({},d,{value:e}))}},_filterInvalidParagraph:function(){if(this.nodeType===3||this.nodeName==="BR"){return false}var a=$(this);if(!a.has("br").length&&!a.text()){return true}var b=this.style;if(b){if(b.display==="none"||b.visibility==="hidden"){return true}b.display="";b.visibility=""}return false},_isDataURIImage:function(a){var b=a.getAttribute("src");return/data:image\/png/.test(b)},_isExternalImage:function(a){if(!a||$SE_CONFIG.SERVICE_CONFIG.FEATURES.PASTE_IMAGE===false){return false}var b=a.getAttribute("src");if(!b||b.indexOf("data:")===0){return false}var c=a.style;if(c){if(parseInt(c.width,10)===0||parseInt(c.height,10)===0||c.display==="none"||c.visibility==="hidden"){return false}}if(parseInt(a.getAttribute("width"),10)===0||parseInt(a.getAttribute("height"),10)===0){return false}return true},_stripTags:function(a,b){a=a||"";if(!b||b.length<1){return a}a=a.replace(/<\/?(\w+)[^>]*?>/gi,function(a,c){c=c.toLowerCase();return b.indexOf(c)>-1?a:""});return a},_isTableTag:function(a){var b=a.replace("<","");return this._aTableTags.indexOf(b.toLocaleLowerCase())>-1},_removeTag:function(a,b){a=a||"";if(!b||b.length<1){return a}a=a.replace(new RegExp("<("+b.join("|")+")[^>]*>(?:.|\\n|\\r)*?</\\1>","ig"),"");return a},_injectBR:function(a,b){a=a||"";if(!b||b.length<1){return a}a=a.replace(new RegExp("([^\\s]\\s*)((?:</(?:"+b.join("|")+")>\\s*)+)","ig"),"$1<br>$2");return a},_refineTableTag:function(a){var b=false;var c=false;var d=new RegExp("<table");a=a.replace(new RegExp("(<\\w+[^>]*?)","ig"),function(a,e){var f=e;if(this._isTableTag(f)){b=true;if(d.test(f)){a="<table";c=true}}return a}.bind(this));if(b&&!c){a="<table>"+a+"</table>"}return a},_removeTableTags:function(a){var b=$("<div>").append(a);var c=b.find("table table");var d=c.length;for(var e=0,f;e<d;e++){f=c[e];if(f){$(f).replaceWith(this._stripTags(f.outerHTML,this._aWhiteListTag))}}return b.get(0).innerHTML},_refineStyle:function(a){a=a.replace(new RegExp("(<\\w+[^>]*?)style\\s*=\\s*(?:\"([^\"]*)\"|'([^']*)')","ig"),function(a,b,c,d){var e=c?'"':"'",f=c||d||"",g=f.split(";"),h="",i=[];var j=b.split(" ")[0];var k=this._htOption.aWhiteListStyle;if(this._isTableTag(j)){k=this._aWhiteListTableStyle.concat(k)}for(var l=0,m,n;m=g[l];l++){n=m.split(":");if(n.length>1&&k.indexOf($.trim(n[0]))>-1){i.push(m)}}if(i.length>0){h="style="+e+i.join(";")+e}return b+h}.bind(this));return a},_removeAttr:function(a,b){a=a||"";if(!b){return a}$.each([].concat(b),function(b,c){a=a.replace(new RegExp("(<\\w+[^>]*?)"+c+'\\s*="[^"]*?"',"ig"),"$1");a=a.replace(new RegExp("(<\\w+[^>]*?)"+c+"\\s*='[^']*?'","ig"),"$1");a=a.replace(new RegExp("(<\\w+[^>]*?)"+c+"\\s*=[^\\s]+?","ig"),"$1")});return a},_removeDropCap:function(a){a=$SE_HTML.removeAttrByBlackList(a,["unselectable"]);a=$SE_HTML.removeClassByList(a,["se_dropCap"]);return a},_getHyperlinkedHTML:function(a){var b=document.createElement("div");b.innerHTML=a;var c=$SE_COMMON_UTIL.getAllTextNodes(b,this._fnHyperlinkCandidateFilter.bind(this));var d=document.createRange();var e,f,g,h,i;var j,k,l,m,n,o;var p;if(c&&c.length>0){for(e=0,f=c.length;e<f;e++){g=c[e];h=g.nodeValue;i=$SE_STRING.getUrlPatternMatches(h);if(!i||i.length===0){continue}for(j=i.length;j--;){k=i[j];if(!k||!k[0]){continue}l=k[0];m=$SE_STRING.formatUrl(l);o={href:m,target:"_blank","class":$SE_CONFIG.HYPERLINK.CLASSNAME};n=document.createElement("A");for(p in o){n.setAttribute(p,o[p])}d.setStart(g,k.index);d.setEnd(g,k.index+l.length);n.appendChild(d.extractContents());d.insertNode(n)}}}var q=b.innerHTML;return q},_fnHyperlinkCandidateFilter:function(a){var b=a.nodeValue;if(!b){return false}var c=$SE_STRING.getUrlPattern();if(!c.test(b)){return false}var d=$(a);var e=d.parents("a");if(e[0]){return false}return true},_insertOG:function(a){if(!this._htOption.bAutoOGLink){return}a=$SE_STRING.restoreSpecialChar(a);var b=$SE_STRING.getUrlPatternMatches(a,true);if(!b||b.length===0){return}var c=b[b.length-1][0];$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ATTACH_LINK_FROM_PARAGRAPH,c)},destroy:function(){this.unbindEvent()}});se.defineComponent("se.FileDialogHandler",{construct:function(){this._bindGatewayEvent()},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.FILE_DIALOG.INSERT_COMPONENT_WITH_POPUP,this.insertComponentWithPopUp.bind(this))},insertViewCompListWithFileDialogue:function(a){var b=a.compData;var c=b.toUpperCase();var d=$SE_UPLOADER_FACTORY.getInstance($SE_CONFIG.FILE_TYPE[c]);var e=new se.LocalFileDialog({multiple:true},d);d.on("IMAGE_FILE_UPLOADER.COMPLETE_ALL",this._completeAllImageFileUploader.bind(this,a));if(this._isInsertGuideTypeAndIE(a.insertType)){setTimeout(function(){e.open()},100)}else{e.open()}},_completeAllImageFileUploader:function(a,b){var c=this._mergedPayloadFromCompActionPayloadWith(a,b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,c)},_mergedPayloadFromCompActionPayloadWith:function(a,b){return $.extend(true,{},a,b)},_isInsertGuideTypeAndIE:function(a){return a&&a==="InsertGuide"&&$SE_COMMON_UTIL.detectIE()},insertViewCompWithFileDialogue:function(a){var b=a.compData;var c=b.toUpperCase();return $SE_UPLOADER_FACTORY.getInstance($SE_CONFIG.FILE_TYPE[c],{change:$.proxy(function(){var b;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DISABLED_PUSH_HISTORY);b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,a)[0];$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ENABLED_PUSH_HISTORY);return b},this)})},insertComponentWithPopUp:function(a){var b=a.compData;var c=function(b){var c=typeof b==="string"?1:b.length;var d=0;a.compData=b;a.callbacks={onLoaded:function(){d++;if(c===d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_STICKY_TOOLBAR);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.SHOW)}}};$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,a)}.bind(this);var d;if(b===$SE_CONFIG.COMP_TYPE.MAP){d=$SE_CONFIG.SERVICE_CONFIG.MAP_OPT}$SE_MEDIA.open(b,c,d)}});$SE_CE_HELPER=se.defineStatic("se.CanvasContentEditableStyleHelper",function(){var a={align:/se_align-(\w+)?/i,fontSize:/se_fs_(T\d+)?/i,fontFamily:/se_ff_([\w-]+)?/i};var b={align:"se_align-",fontSize:"se_fs_",fontFamily:"se_ff_"};var c="sans-serif";var d=/rgba?\((\d+),\s*(\d+),\s*(\d+)(?:,\s*(\d+))?\)/i;var e=/(nanumgothic|nanummyeongjo|nanumbarungothic)/;var f=function(a,b){return{fontFamily:{attr:"class",filter:function(c,d){return k(b,d,"fontFamily")||a.fontFamily}.bind(this)},fontSize:{attr:"class",filter:function(c,d){return k(b,d,"fontSize")||a.fontSize}.bind(this)},fontColor:{css:"color",filter:function(a){return g(a)}.bind(this)},backgroundColor:{css:"backgroundColor",filter:function(a,c){return g(a)||j(b,c)}.bind(this)},bold:{filter:function(a,c){return l(b,c,["B","STRONG"])}.bind(this)},underline:{filter:function(a,c){return l(b,c,"U")}.bind(this)},italic:{filter:function(a,c){return l(b,c,["I","EM"])}.bind(this)},strikeThrough:{filter:function(a,c){return l(b,c,"STRIKE")}.bind(this)},lineHeight:{css:"lineHeight",filter:function(a,b){return o(b)}},superscript:{filter:function(a,c){return l(b,c,"SUP")}.bind(this)},subscript:{filter:function(a,c){return l(b,c,"SUB")}.bind(this)}}};var g=function(a){a=(a||"").match(d)||[];if(a.length>4&&(!a[4]||a[4]==="1")){return"#"+h(a[1])+h(a[2])+h(a[3])}return""};var h=function(a){var b=parseInt(a,10).toString(16);if(b.length<2){b="0"+b}return b};var i=function(a,b){var c=window.getComputedStyle?window.getComputedStyle(a,""):a.currentStyle;return c[b]};var j=function(a,b){if(a===b){return""}var c=b,d="";while((c=c.parentNode)&&c!==a){if(c.ownerDocument){d=g(i(c,"background-color"))}if(d){return d}}return d};var k=function(b,c,d){while(c&&c!==b){if(a[d].test(c.className)){return RegExp.$1}c=c.parentNode}};var l=function(a,b,c){var d=[].concat(c);while(b&&b!==a){if(d.indexOf(b.tagName)>-1){return true}b=b.parentNode}return false};var m=function(a,b,c){a.setStyle("className",function(a){a=a||"";return n(a,b,c)}.bind(this))};var n=function(c,d,e){var f=a[d];if(f&&e){var g=c.match(f);if(g){c=c.replace(g[0],b[d]+e)}else{c+=" "+b[d]+e}return c.trim()}};var o=function(a){a=a instanceof jQuery?a.get(0):a;var b=a.style.lineHeight;return b?parseInt(b,10):""};var p=function(a){if(!a){return c}var b=window.getComputedStyle(a.get(0)).fontFamily;var d=b.match(e)||"";return d[0]||c};return{COMPSTYLE_REGEXP:a,COMPSTYLE_PREFIX:b,rxRGBColor:d,getStyleMapper:f,getHexColor:g,getLineHeight:o,setInlineStyleByClass:m,replaceSyleClassName:n,extractFontFamily:p}}());window.$SE_TEXT_HELPER=se.defineStatic("se.editor.canvas.helper.TextHelper",function(){var a=function(a,c){var d=b(a);var e=d.prev+c+d.next;a.val(e)};var b=function(a){var b=a[0];var c=b.selectionStart;var d=b.selectionEnd;var e=a.val();return{prev:e.substring(0,c),next:e.substring(d)}};return{insertTextAtCaret:a,splitTitleAtCaret:b}}());window.$SE_FOCUS_HELPER=se.defineStatic("se.CanvasFocusHelper",function(){var a=function(){var a=$(window).width()/2;var b=$(document).scrollTop()+$(window).height()/2;var c=$('<input type="text" id="__fakeFocus__">').css({opacity:"0",position:"absolute"}).offset({left:a,top:b}).appendTo(document.body);c[0].focus();c.remove();c=null};var b=function(){if(!document.activeElement){return}if(document.activeElement===document.body){window.focus()}else if(document.activeElement.blur){document.activeElement.blur();window.focus()}};return{focusOutWithFake:a,blurFromActiveElement:b}}());$SE_SCROLL_HELPER=se.defineStatic("se.CanvasScrollHelper",function(){var a=50;var b=20;var c=0;var d=0;var e=0;var f=null;var g=null;var h=null;var i=null;var j=false;var k=function(){g=$(window);h=$(document);i=$(document.body);l()};var l=function(){c=a;d=g.height()-a;e=parseInt(i.css("paddingLeft"),10);f=r()};var m=function(a){if(c>a){h.scrollTop(h.scrollTop()-b)}else if(d<a){h.scrollTop(h.scrollTop()+b)}};var n=function(){j=true};var o=function(){j=false};var p=function(){q();if(j){return}h.on("mousemove.scrollhelper",function(a){m(a.clientY)})};var q=function(){h.off("mousemove.scrollhelper")};var r=function(){if(!g){k()}return{windowHeight:g.height(),gnbHeight:$(window.parent.document).find("#se_top_menu_area").outerHeight(true),toolbarHeight:$(".se_toolbar_container").outerHeight(true),canvasPaddingLeft:e}};var s=function(){if(f){return f}f=r();return f};var t=function(a,b){var c=f.windowHeight;var d=f.gnbHeight;var e=f.toolbarHeight;var g=h.scrollTop();var i=g+c-e;var j=-1;var k=b-e;if(g>=k){j=g-(g-k)-d;h.scrollTop(j)}else if(i<=k){j=g+(k+a-i)+d;if(a+d>c){h.scrollTop(b-e)}else{h.scrollTop(j)}}};return{initialize:k,getSizeStore:s,createNewSizeStore:r,update:l,changeScrollByCursorY:m,compromiseScrollHeight:t,activate:p,deactivate:q,pause:n,resume:o}}());window.$SE_ANIMATION_HELPER=se.defineStatic("se.CanvasAnimationHelper",function(){var a=function(a){var b=a.height();var c=a[0];var d=c.style;var e=c.classList;d.maxHeight=b*.8+"px";e.add("is-drop");setTimeout(function(){d.maxHeight=b+"px";setTimeout(function(){e.remove("is-drop");d.maxHeight="";c=null},400)},1)};return{animatesDrop:a}}());se.defineStatic("se.CanvasRectHelper",function(){var a=768;var b=425;function c(){return window.frameElement||document.documentElement}function d(){var a=c();return a.offsetWidth<=b}function e(){var b=c();return b.offsetWidth>a}function f(){var d=c();return d.offsetWidth<=a&&d.offsetWidth>b}return{isMobileViewPort:d,isDesktopViewPort:e,isTabletViewPort:f}}());window.$SE_TEXTAREA_HELPER=se.defineStatic("se.CanvasTextHelper",function(){var a=27.5;var b=function(b,c,d){var e=parseInt(c.css("lineHeight"),10)||a;var f=(b.height()-c.height())/2;var g=c.offset().top+c.height()-e-f;return d>=g};var c=function(b,c,d){var e=parseInt(c.css("lineHeight"),10)||a;var f=(b.height()-c.height())/2;var g=c.offset().top;d=d+f-e;return d<=g};var d=function(a){var b=a.selectionStart;var c=a.selectionEnd;return b===c&&b===0};var e=function(a,b){var c=a.selectionStart;var d=a.selectionEnd;return c===d&&b===c};return{hasNextLine:b,hasPrevLine:c,isCursorAtStart:d,isCursorAtEnd:e}}());
//# sourceMappingURL=blog_desktop_normal_editor_canvas_control.min.js.map