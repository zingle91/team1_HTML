/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineClass("se.AbstractSlot",{mixins:[],construct:function(){this.$el=null;this._extendFromMixins();this._initVar()},_extendFromMixins:function(){this.mixins.forEach(_.extendOwn.bind(this,this))},_callEventByName:function(a,b){var c=this._options.events||{};(c[a]||function(){}).apply(this,b)},_initVar:function(){AbstractMethodNotOverrideException("_initVar")},render:function(a){AbstractMethodNotOverrideException("render")},bindEvents:function(){AbstractMethodNotOverrideException("bindEvents")},unbindEvents:function(){AbstractMethodNotOverrideException("unbindEvents")},enableToolbar:function(){AbstractMethodNotOverrideException("enableToolbar")},focus:function(a){AbstractMethodNotOverrideException("focus")},blur:function(){AbstractMethodNotOverrideException("blur")},syncModel:function(){AbstractMethodNotOverrideException("syncModel")},repaint:function(){AbstractMethodNotOverrideException("repaint")},resize:function(){AbstractMethodNotOverrideException("resize")},updateStyle:function(a,b){AbstractMethodNotOverrideException("updateStyle")},height:function(){return AbstractMethodNotOverrideException("height")},destroy:function(){AbstractMethodNotOverrideException("destroy")},executeCompHistory:function(){AbstractMethodNotOverrideException("executeCompHistory")},readonly:function(a){AbstractMethodNotOverrideException("readonly")},changeLayout:function(){AbstractMethodNotOverrideException("changeLayout")},changeAlign:function(){AbstractMethodNotOverrideException("changeAlign")},pasteHTML:function(a){AbstractMethodNotOverrideException("pasteHTML",a)},isContain:function(a){return AbstractMethodNotOverrideException("$elTarget")},getPlainText:function(){return AbstractMethodNotOverrideException("getPlainText")},getTextContents:function(){return AbstractMethodNotOverrideException("getTextContents")},getModelDataAsJson:function(){this.syncModel();return this._oModel.getJsonWithCompId()},getCompType:function(){return this._oModel.getCompType()},getElement:function(){return this.$el},getModel:function(){return this._oModel},setModel:function(a){if(a){this._oModel=a}}});se.defineClass("se.CaptionSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.CaptionSubCompView",state:{},props:{},template:se.editor.template.canvas["captionView.hbs"]},construct:function(){this._initVar()},_initVar:function(){},updateHeight:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE,this._$caption);if(this.getValue()===""&&this._$caption.hasClass("placeholder")){this._$caption[0].style.height=""}},_onAfterRender:function(){this._$caption=this.$el.find(".__captionView");this.toggle();this.createPlaceholder();setTimeout(this.updateHeight.bind(this),50)},_bindEvents:function(){this._$caption.on("click.captionView",this._onClick.bind(this));this._$caption.on("mouseup.captionView",this._onMouseUp.bind(this,this.events.mouseup));this._$caption.on("blur.captionView",this._onBlur.bind(this,this.events.blur));this._$caption.on("input.captionView",this._onInput.bind(this,this.events.input));this._$caption.on("keydown.captionView",this._onKeyDown.bind(this,this.events.keydown))},_unbindEvents:function(){this._$caption.off(".captionView")},enableEvents:function(){this._unbindEvents();this._bindEvents()},disableEvents:function(){this._unbindEvents()},_isKeyForPropagation:function(a){var b=a.which;return b===$SE_CONFIG.TRIGGER.BACKSPACE||b===$SE_CONFIG.TRIGGER.DELETE||b===$SE_CONFIG.TRIGGER.LEFT||b===$SE_CONFIG.TRIGGER.UP||b===$SE_CONFIG.TRIGGER.RIGHT||b===$SE_CONFIG.TRIGGER.DOWN},_onKeyDown:function(a,b){if(this._isKeyForPropagation(b)){b.stopImmediatePropagation()}},_onInput:function(a,b){this.executeCallback(a,b,this.state)},_onClick:function(){return false},_onBlur:function(a,b){this.executeCallback(a,b,this.state)},_onMouseUp:function(a,b){this.executeCallback(a,b,this.state);if(document.activeElement===this._$caption.get(0)){return}this._$caption.focus()},_updateValue:function(){this.state.caption=this.getValue()},blur:function(){this._updateValue();this._$caption.blur()},createPlaceholder:function(){this._$caption.placeholder()},destroyPlaceholder:function(){this._$caption.trigger("destroy.placeholder")},isEmpty:function(){return this.getValue()===""&&this.$el[0]},hideWithAsync:function(){clearTimeout(this._timeoutForHide);this._timeoutForHide=setTimeout(function(){if(this.$el){this._hide()}}.bind(this),1)},toggle:function(){if(!this.$el){return}if(this.isEmpty()){this.hideWithAsync()}else{this._show()}},focusIn:function(){this._show()},focusOut:function(){this.toggle()},_hide:function(){this.$el[0].style.display="none"},_show:function(){clearTimeout(this._timeoutForHide);this.$el[0].style.display="block"},setValue:function(a){if(!this._$caption){return}if(this._$caption.hasClass("placeholder")){this._$caption.removeClass("placeholder")}this._$caption.val(a);this.state.caption=a},getValue:function(){return this._$caption&&this._$caption.val()},pasteHTML:function(a){if(!a||a===""){return}var b=this._$caption;var c=b.get(0);if(document.activeElement!==c){c.focus()}var d=$SE_STRING.insertStringToInput(c,a);this.updateHeight();$SE_STRING.setCaretPosition(c,d)},height:function(){return parseInt(this.$el.css("padding-top")||0,10)+this._$caption.height()},_clear:function(){this.$el.off();this.$el.remove();this.$el=null;this._$caption=null},destroy:function(){this.destroyPlaceholder();this.disableEvents();this._clear()}});se.defineClass("se.EditableSubCompView",se.AbstractCompositeSubCompView,{DROPCAP_CLASS:"se_dropCap",MENTION_CLASS:"__se_mention",TEXT_NODE_TYPE:3,ELEMENT_NODE_TYPE:1,REGEX:{LAST_WORD:/\s+(@?\w+)$/,MENTION_START:/(?!(?:^)|(?:\s))@([0-9a-z\.\-_]{0,25}[^\s가-힣ㄱ-ㅎ]$)/i,MENTION:/^@([0-9a-z\.\-_]{0,25}[^\s가-힣ㄱ-ㅎ])/i,SPACE:/[\u0020\s]/},_HOTKEY_MAP:{"shift+85":"superscript","shift+89":"subscript",66:"bold",68:"strikeThrough",73:"italic",85:"underline"},"default":{name:"se.EditableSubCompView",state:{isEnabled:false,isInitialized:false,isFromMouseDown:false,hasFocus:false,hasSelection:false,isMentionLayerOpened:false},template:se.editor.template.canvas["editableView.hbs"]},construct:function(a){a=a||{};this.events=a.events||{};this.placeholder=a.placeholder||{value:se.i18n.getMsg("PARAGRAPH_PLACEHOLDER"),className:"is-empty"};this.defaultPlaceholder=this.placeholder;this.isIeMode=a.ieMode||false;this.$el=null;this.editable=null;this._timeoutForBlur=null;this._isAutoMentionAvailable=a.isAutoMentionAvailable||false},value:function(a){if(a===null||typeof a==="undefined"){return this.editable.getContents()}this.editable.setContents(a)},_removeLink:function(a){$(a).unwrap();this.selectNode(a)},_removeLinkIfExist:function(){var a=this.findAnchorAround();if(a&&(a=a.lastChild)){this._removeLink(a);return true}return false},toggleLink:function(a,b){var c=false;b=b||function(){};if(a){this.insertAnchorAtCursor(a);c=true}else if(a===""){c=this._removeLinkIfExist(b)}if(c){b.call(this)}},toggleDropCap:function(){if(this.unwrapDropCap()||this.isDropCapUsable()===false){return}var a=this._getDropCapTargetNode();this._wrapDropCap(a);this._setCaretAfterDropCap(a.parentNode)},getDropCapNodes:function(a){var b=a||this.editable.getElement();if(b.nodeType===3){return[]}var c=b.getElementsByClassName(this.DROPCAP_CLASS);return c},hasDropCap:function(a){var b=this.getDropCapNodes(a);return b.length>0},_getDropCapTargetNode:function(){var a=this.editable.getElement();var b=selry.getTextNodes(a);var c="";var d=b.length;for(var e=0;e<d;e++){c=b[e].nodeValue;b[e].nodeValue=this._removeZeroWidthWhiteSpace(c);if(b[e].nodeValue===""){this._removeEmptyTag(b[e].parentNode)}else{return b[e]}}},_removeEmptyTag:function(a){if($(a).is(":empty")){$(a).remove()}},_wrapDropCap:function(a){var b=a.nodeValue;var c=a.parentNode;var d=b.slice(0,1);var e=b.slice(1,b.length);var f=document.createTextNode(e);var g=null;if($SE_CONFIG.isEdgeBrowser){g=$("<span class='"+this.DROPCAP_CLASS+"'>"+d+"</span>").get(0)}else{g=$("<span class='"+this.DROPCAP_CLASS+"' unselectable='on'>"+d+"</span>").get(0)}c.replaceChild(f,a);c.insertBefore(g,f);return g},isDropCapUsable:function(){var a=this.editable.getElement();var b=this._removeZeroWidthWhiteSpace(a.innerText);if(/^[\n|\r]/.test(b)||b.trim().length<2){return false}var c=selry.getTextNodes(a);var d=c[0].nodeValue;if(c.length==1&&/^[\s]$/.test(d)||/^[\u00a0|\u0020]$/.test(d.slice(0,1))){return false}return true},_removeZeroWidthWhiteSpace:function(a){return a.replace(/[\u200B-\u200D\uFEFF]/g,"")},_setCaretAfterDropCap:function(a){var b=this.getDropCapNodes(a)[0];if(!b){return}var c=this._getNextNode(b);if(!c){this.unwrapDropCap();return}this.selectNode(c);this.editable.collapseToStart()},unwrapDropCap:function(a){var b=this.getDropCapNodes(a);var c=b.length;if(c<1){return false}var d=null;for(var e=0;e<c;e++){d=b[e];if(d.classList.length>1||$(d).attr("style")){$(d).removeClass(this.DROPCAP_CLASS);$(d).removeAttr("unselectable")}else{selry.unwrap(d)}return true}return false},unwrapDropCapByKeyBoard:function(){if(this._isPrevNodeIsDropCap()){return this.unwrapDropCap()}},_isPrevNodeIsDropCap:function(){var a=selry.getSelection();var b=a.getRange();var c=b.startContainer;var d=b.startOffset;var e=a._getActualStartNode(c,d);var f=selry.prevNear(e);if(f.textContent.length!==1){return false}var g=$(f).hasClass(this.DROPCAP_CLASS)?f:this.getDropCapNodes(f)[0];if(a.isCollapsed()&&g){return c===e&&d===0||c!==e&&d===1}},_onSelectionChange:function(){if(this._bComposing){return}var a=selry.getSelection();var b=a.getRange();var c=b.startContainer;if(c.nodeType===3){c=c.parentNode}if(!$(c).hasClass(this.DROPCAP_CLASS)){return}if(a.isCollapsed()){this._setCaretAfterDropCap()}else{var d=selry.nextNear(c);a.selectNodes(d,b.endContainer)}},addDropCapAttr:function(){if($SE_CONFIG.isEdgeBrowser){return}var a=$(this.getDropCapNodes()[0]);if(!a.attr("unselectable")){a.attr("unselectable","on")}},_onAfterRender:function(){this.$el.on("keydown",function(a){if(this.isInitialized()&&this.isEnabled()){this._autoHyperlink(a);this._hotkey(a);this._unwrapMention(a)}}.bind(this)).on("keyup",function(a){if(this.isInitialized()&&this.isEnabled()){this._autoMention(a)}}.bind(this)).on("mousedown",function(){if(this.isInitialized()&&this.isEnabled()){this.enable()}this.clearSelection();this.hidePlaceholder();this.state.isFromMouseDown=true;this.fixDropCap()}.bind(this)).on("blur",function(){this.fixDropCap()}.bind(this)).on("compositionstart",function(){this._bComposing=true}.bind(this)).on("compositionend",function(){this._bComposing=false}.bind(this)).on("DOMNodeInserted",function(a){if(a.target!==a.originalEvent.srcElement){return}var b=$(a.target);if(this._bComposing){this.$el.one("compositionend.__dirty",this._cleanDOMNode.bind(this,b,true))}else{this._cleanDOMNode(b)}}.bind(this));this._setMentionController()},fixDropCap:function(a){if(!this._hasInvalidDropCap()){return false}this.unwrapDropCap();var b=this._getDropCapTargetNode();var c=b.length-1;var d=this._wrapDropCap(b);if(a){var e=this._getNextNode(d);selry.getSelection().cursor(e,c)}return true},_hasInvalidDropCap:function(){if(!this.hasDropCap()){return false}var a=this.getDropCapNodes()[0];var b=a.innerText;return b&&b.length>1},fixDropCapAfterStyle:function(){if(this.getDropCapNodes().length<2){return false}var a=this.editable.getRange().startContainer;var b=this._findParentDropCap(a);if(!b){return false}if(a===b){a=b.firstChild}selry.unwrap(b);this.editable.selectNodeContents(a);this.editable.collapseToStart();return true},_findParentDropCap:function(a){var b=this.editable.getElement();while(a&&a!==b){if(a.className&&a.className.indexOf(this.DROPCAP_CLASS)>-1){return a}a=a.parentNode}return false},_bindEvents:function(a){this.$el.on({"focus.__editable":this._onFocus.bind(this,a.focus),"blur.__editable":this._onBlur.bind(this,a.blur),"keydown.__editable":this._onKeyDown.bind(this,a.keydown),"keyup.__editable":this._onKeyDown.bind(this,a.keyup),"mousedown.__editable":this._onMouseDown.bind(this,a.mousedown),"mouseup.__editable":this._onKeyDown.bind(this,a.mouseup)});this.$el.on("click.__editable","a",false);$(document).on("selectionchange.__editable",this._onSelectionChange.bind(this));this.$el.on("mscontrolselect.__editable","."+this.DROPCAP_CLASS,this._onMsControlSelect)},_onMsControlSelect:function(a){a.preventDefault()},_unbindEvents:function(){if(!this.$el){return}this.$el.off(".__editable");$(document).off(".__editable")},_onFocus:function(a,b){this.executeCallback(a,b,this.state)},_onBlur:function(a,b){this.executeCallback(a,b,this.state)},_handleKeyEventOnMentionLayer:function(a){if(!this.state.isMentionLayerOpened){return}if(a.type==="keydown"&&a.which===$SE_CONFIG.TRIGGER.ENTER){$SE_MENTION.onEnterMentionList(a);a.preventDefault();a.stopImmediatePropagation()}if(a.type==="keyup"){switch(a.which){case $SE_CONFIG.TRIGGER.DOWN:$SE_MENTION.onKeyDownMentionList();break;case $SE_CONFIG.TRIGGER.UP:$SE_MENTION.onKeyUpMentionList();break;default:break}}},_onKeyDown:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(c&&c.getCompType()==="table"&&b.type==="keydown"){switch(b.keyCode){case $SE_CONFIG.TRIGGER.DOWN:case $SE_CONFIG.TRIGGER.UP:case $SE_CONFIG.TRIGGER.LEFT:case $SE_CONFIG.TRIGGER.RIGHT:c.focusByArrowKey(b.keyCode);break;default:break}return}this._handleKeyEventOnMentionLayer(b);if(this.isCursorAtStart()){this._setCaretAfterDropCap()}this.executeCallback(a,b,this.state)},_onMouseDown:function(a,b){this.executeCallback(a,b,this.state)},_cleanDOMNode:function(a,b){if(a.is("font")){b?a.remove():selry.dom.unwrap(a.get(0))}else if(a.is("span[style]")){var c=a.get(0);var d=c.style.cssText;var e=d.split(";").filter(function(a){return/^\s*(color|background-color)/i.test(a)}).join(";");if(!e&&!c.className){b?a.remove():selry.dom.unwrap(c)}else if(d!==e){c.style.cssText=e}}},_hotkey:function(a){if(a.metaKey||a.ctrlKey){var b=a.which;if(a.shiftKey){b="shift+"+a.which}var c=this._HOTKEY_MAP[b];if(c){this.toggleStyle(c);a.preventDefault();a.stopPropagation()}}},toggleStyle:function(a){this.editable.command(a)},_wrapAnchorIfHasURL:function(){if(!this.editable||!this.editable.isCollapsed()){return}var a=this.editable.getRange();var b=a.startContainer;var c=a.startOffset;if(b.nodeType===3&&c>0&&!this.findAnchorAround()){var d=b.nodeValue.substring(0,c);var e=$SE_STRING.getUrlPatternMatches(d);if(!e||!e.length||!e[e.length-1]){return}var f=e[e.length-1];var g=f[0];a.setStart(b,f.index);a.setEnd(b,f.index+g.length);this.editable.getSelection().selectRange(a);var h=$SE_STRING.formatUrl(g);this.insertAnchorAtCursor(h);this.editable.collapseToEnd();return h}},insertAnchorAtCursor:function(a){this.editable.link({href:a,target:"_blank","class":$SE_CONFIG.HYPERLINK.CLASSNAME})},findAnchorAround:function(){return this.editable.findLinkAround()},selectAnchorAround:function(){var a=this.findAnchorAround();if(a){this.editable.selectNodeContents(a)}return a},_autoHyperlink:function(a){var b=a&&a.which;if(b!==13&&b!==32){return}var c=this._wrapAnchorIfHasURL();if(c){this.executeCallback(this.events.createdLink,c)}},_setMentionController:function(){if(this._isAutoMentionAvailable){$SE_MENTION.create({onClickMentionListItem:this._wrapMention.bind(this)},$("#se_canvas_wrapper"))}},_showMentionLayer:function(a,b){$SE_MENTION.show(a,b);this.state.isMentionLayerOpened=true},_hideMentionLayer:function(){$SE_MENTION.hide();this.state.isMentionLayerOpened=false},_unwrapMention:function(a){if(!this._isAutoMentionAvailable||this._shouldSkipUnwrapMention(a)){return}var b=this.findAnchorAround();selry.unwrap(b)},_shouldSkipUnwrapMention:function(a){var b=a.which;var c=this._isCompositedKeyEvent(a);var d=this._isPrintableKeyEvent(b);var e=this._isInMentionLink(b);return c||(d===false||e===false)},_setRangeToTextNodeEnd:function(a){if(!this._isTextNode(a)){return}var b=this.editable.getRange();b.setStart(a,a.length);b.setEnd(a,a.length);this.editable.getSelection().selectRange(b)},_getEndNodeFromRange:function(){var a=this.editable.getRange();var b=a.endContainer;var c=b;if(b.nodeType===this.ELEMENT_NODE_TYPE){c=b.childNodes[a.endOffset-1]}return c},_isTextNodeAfterNormalized:function(){if(!this.editable||!this.editable.isCollapsed()){return false}var a=this._getEndNodeFromRange();this._setRangeToTextNodeEnd(a);return this._isTextNode(this.editable.getRange().endContainer)},_isMentionLayerControlKey:function(a){return a===$SE_CONFIG.TRIGGER.DOWN||a===$SE_CONFIG.TRIGGER.UP||a===$SE_CONFIG.TRIGGER.ENTER},_autoMention:function(a){if(!this._isAutoMentionAvailable||this._isMentionLayerControlKey(a.which)){return}if(this._isMentionEditMode()){var b=this._getMentionQuery();var c=this._getCaretPosition();this._showMentionLayer(b,c)}else{this._hideMentionLayer()}},_getMentionQuery:function(){var a=this.getLastWord();var b=a.indexOf("@");var c=a.substr(b+1);return $.trim(c)},_getCaretPosition:function(){var a=this.editable.getRange().cloneRange();var b=a.getClientRects();var c=a.getBoundingClientRect();var d=c;if(c.top===0&&b.length>0){d=b[0]}if(c.top===0&&b.length===0){var e=document.body.createTextRange();d={top:e.boundingTop,left:e.boundingLeft,bottom:e.boundingTop+e.boundingHeight}}return d},_isCompositedKeyEvent:function(a){var b=a.metaKey;var c=a.ctrlKey;var d=a.shiftKey;return b||c||d},_isPrintableKeyEvent:function(a){return a==$SE_CONFIG.KEYCODE.SPACE||a==$SE_CONFIG.KEYCODE.ENTER||a==$SE_CONFIG.KEYCODE.BACKSPACE||a>47&&a<58||a>64&&a<91||a>95&&a<112||a>185&&a<193||a>218&&a<223},_isInMentionLink:function(a){var b=$(this.findAnchorAround());var c=this.editable.getRange();var d=c.endOffset;var e=b?b.hasClass(this.MENTION_CLASS):false;var f=d>0&&d<c.endContainer.length;var g=d===c.endContainer.length&&a===$SE_CONFIG.KEYCODE.BACKSPACE;return e&&(f||g)},_wrapMention:function(a){var b={ownerId:a.data("ownerid"),nickName:a.find(".__se_gpUser_name").text()};this._replaceMentionTextToLink(b);this._hideMentionLayer()},_getMentionLinkWithUser:function(a){var b=$("<a>",{text:"@"+a.nickName,href:"se3mention://"+a.ownerId,"class":this.MENTION_CLASS});return b.get(0)},_replaceMentionTextToLink:function(a){var b=this.editable.getRange().endContainer;if(!this._isTextNode(b)){var c=selry.getTextNodes(this.editable.getElement());b=c[c.length-1]}var d=this._getMentionLinkWithUser(a);this._replaceTextWithLink(b,d)},_replaceTextWithLink:function(a,b){var c=document.createRange();var d=document.createTextNode(" ");var e=a.nodeValue;var f=this.getLastWord().trim();var g=e.indexOf(f);var h=f.length;c.setStart(a,g);c.setEnd(a,g+h);this.editable.getSelection().selectRange(c);c.deleteContents();c.insertNode(d);c.insertNode(b);this.setCaretAfter(d)},_isMentionEditMode:function(){if(!this.editable||!this.editable.isCollapsed()){return false}var a=this.editable.getRange().endContainer;var b=this._isTextNode(a)||this._isTextNodeAfterNormalized();if(b&&!this.findAnchorAround()){return this._isMentionPattern()}return false},_isMentionPattern:function(){var a=this.editable.getRange().endContainer;var b=this.getLastWord();var c=this.REGEX.MENTION_START.test(b);var d=this.REGEX.MENTION.test(b.trim());var e=this._getNotEmptyPreviousSibling(a);if(d&&c){return true}if(d&&!c&&!e){return true}if(d&&!c&&this._isTextNode(e)){return this.REGEX.SPACE.test(e.nodeValue.slice(-1))}return false},_getNotEmptyPreviousSibling:function(a){var b=a.previousSibling;while(b&&b.nodeValue===""){b=b.previousSibling}return b},_isTextNode:function(a){if(!a){return false}return a.nodeType===this.TEXT_NODE_TYPE},getStringBeforeCaret:function(){var a=this.editable.getRange();var b=a.endContainer;var c=a.endOffset==0?b.length:a.endOffset;return b.nodeValue.substring(0,c)},getLastWord:function(){var a,b;var c=this.getStringBeforeCaret();if(c.indexOf(" ")<0){b=c}else{a=this.REGEX.LAST_WORD.exec(c);b=a?a[0]:""}return b},setCaretAfter:function(a){this.selectNode(a);this.editable.collapseToEnd()},enableEvents:function(){this._unbindEvents();this._bindEvents(this.events)},disableEvents:function(){this._unbindEvents()},setPlaceholder:function(a){this.placeholder=a||this.placeholder;this.editable.setOption({placeholder:this.placeholder})},hidePlaceholder:function(){this.editable.removePlaceholder()},showPlaceholder:function(){this.editable.resetPlaceholder()},disablePlaceholder:function(){if(this.isInitialized()===false){return}this.hidePlaceholder();this.setPlaceholder({value:""})},enablePlaceholder:function(a){if(this.isInitialized()===false){return}this.setPlaceholder(a||this.defaultPlaceholder);if(this.hasBrowserFocus()){this.hidePlaceholder()}else{this.showPlaceholder()}},_initialize:function(){this.editable=selry.edit(this.$el.get(0),{scrollWrapper:document});this.state.isInitialized=true},initEditable:function(){this._initialize();this.enableEvents();if(this.hasDropCap()){this.addDropCapAttr()}},isInitialized:function(){return this.state.isInitialized},isEnabled:function(){return this.state.isEnabled},enable:function(){if(this.state.isEnabled===false){this.initEditable()}this.editable.enable();this.state.isEnabled=true},disable:function(){if(!this.editable||this.state.isMentionLayerOpened){return}this.editable.disable();this.state.isEnabled=false},_fixIEFocus:function(){if(this.hasBrowserFocus()){return}var a=this.$el[0];if(a.setActive){a.setActive()}},focus:function(a){clearTimeout(this._timeoutForBlur);if(this.state.isFromMouseDown){this._fixIEFocus()}else{this.editable.focus()}if(!a){this._setCaretAfterDropCap()}this.state.hasFocus=true;this.state.isFromMouseDown=false},enableWithFocus:function(){var a=true;this.enable();this.focus(a)},_blurIfHasFocus:function(){if(this.isInitialized()&&this.hasBrowserFocus()){this.editable.blur()}},blur:function(){this._timeoutForBlur=setTimeout(this._blurIfHasFocus.bind(this),1);this.state.hasFocus=false},hasFocus:function(){return this.state.hasFocus},hasBrowserFocus:function(){return this.$el[0]===document.activeElement},extractStyles:function(a,b){return this.editable.getStyles(a,b)},extractTextRowAtCursor:function(){var a=document.createElement("div");this.editable.extendToLine();var b=this.editable.cloneContents();var c=$(b);var d=c.has("[contenteditable]").length;if(d){this.editable.selectNodeContents(this.getElement());a.innerHTML=c.find("[contenteditable]").get(0).innerHTML}else{a.appendChild(b)}var e=this.$el.html()===a.innerHTML||d;if(this.hasDropCap(a)){this.unwrapDropCap(a)}a.innerHTML=a.innerHTML.replace(/\n|\r/g," ").replace(/<br\/?>/gi,"\n");var f=$SE_COMMON_UTIL.getInnerText(a).replace(/\uFEFF/g,"").replace(/\s+$/,"");if(f===this.placeholder.value){f=""}return{text:f,isWhole:e}},_findLastChild:function(a){var b=selry.dom.last(a,true);var c=null;if(this._isNoText(b)){c=this._getPrevNode(b);if(c){return this._findLastChild(c)}}if(b.nodeType===3){b=b.parentNode}return b},_filterAnchorFontColor:function(a,b){if($(a).is("a")){b.fontColor=""}return b},_removeSameColor:function(a,b){if(a.fontColor===b.fontColor){a.fontColor=""}if(a.backgroundColor===b.backgroundColor){a.backgroundColor=""}return a},extractLastStyles:function(a){var b=this.getElement();var c=this._findLastChild(b);var d=this.extractStyles(c,a);var e=this._filterAnchorFontColor(c,d);var f=this._extractContainerStyles(a);return this._removeSameColor(e,f)},_extractContainerStyles:function(a){return this.extractStyles(this.getElement(),a)},_getPrevNode:function(a){if(!a||this.$el.is(a)){return null}if(a.previousSibling){return a.previousSibling}return this._getPrevNode(a.parentNode)},_getNextNode:function(a){if(!a||this.$el.is(a)){return null}if(a.nextSibling){return a.nextSibling}return this._getNextNode(a.parentNode)},_isNoText:function(a){if(a.nodeName==="BR"){return true}if(a.nodeType===3){var b=a.nodeValue||"";b=b.replace(/\u0020|\uFEFF/g,"");return!b}if(a.nodeType!==1){return true}if(a.innerHTML===""){return true}return false},_arrowDownForIE:function(){if(!this.isIeMode){return}var a=this.editable.getNextBR();if(!a){return}var b=this._getNextNode(a);if(b){b=selry.dom.first(b,true)}if(b&&$SE_COMMON_UTIL.getInnerText(b)==="\ufeff"){var c=this._getNextNode(b);if(!c||selry.dom.isEmptyTextNode(c)){this.selectNode(b);this.editable.collapseToStart();return true}}},selectNode:function(a){this.editable.selectNode(a)},changeMinHeight:function(a){var b=this.$el[0];b.style.minHeight=a+"px"},saveSelection:function(){if(this.state.hasSelection===false){this.editable.saveSelection();this.state.hasSelection=true}},saveSelectionWithBlur:function(){if(this.state.hasSelection===false){this.saveSelection();this.blur()}},clearSelection:function(){if(this.editable){this.editable.clearSelection()}this.state.hasSelection=false},restoreSelection:function(){if(this.state.hasSelection){this.editable.restoreSelection();this.state.hasSelection=false}},isCursorAtStart:function(){if(!this.editable.isCollapsed()){return false}var a=this.editable.getPrevChar("\ufeff");if(a){return false}var b=this.editable.getPrevBR();if(b){var c=this.editable.getElement();var d=selry.dom.first(c,true);var e=selry.dom.last(c,true);return d===e}else{return true}},isCursorAtEnd:function(){if(!this.editable.isCollapsed()){return false}var a=this.editable.getNextChar();var b=!a;if(b){var c=this.editable.getNextBR();b=!this.editable.getNextBR(c)}else if(a==="\ufeff"){var d=this.editable.getNextNode();d=selry.dom.nextNear(d);return!d||!selry.dom.contains(this.getElement(),d)}return b},cursorToStart:function(){var a=selry.dom.first(this.getElement(),true);if(a.nodeType===3){a=a.parentNode}this.editable.selectNodeContents(a);this.editable.collapseToStart()},cursorToDropCap:function(){this._setCaretAfterDropCap()},cursorToEnd:function(){var a=selry.dom.last(this.getElement(),true);if(a.nodeName==="BR"){var b=a.previousSibling;if(!b){this.selectNode(a);this.editable.collapseToStart();return}a=selry.dom.last(b,true)}if(a.nodeType===3){a=a.parentNode}this.editable.selectNodeContents(a);this.editable.collapseToEnd()},isCursorAtTop:function(){if(!this.value()){return true}var a=this._cloneSafeRange();var b=this.editable.getElement();var c;if(a.collapsed){var d=this._extendNextChar(a)||this._extendPrevChar(a);if(!d){c=document.createTextNode(" ");a.insertNode(c);a.selectNode(c)}}var e=a.getBoundingClientRect();var f=b.getBoundingClientRect();var g=this._getEditableOffset();var h=e.top-f.top-g<0;if(c&&c.parentNode){c.parentNode.removeChild(c)}return h},isCursorAtBottom:function(){if(!this.value()){return true}var a=this._cloneSafeRange();var b=this.editable.getElement();var c;if(a.collapsed){var d=this._arrowDownForIE();if(d){return false}var e=this._extendPrevChar(a)||this._extendNextChar(a);if(!e){c=document.createTextNode(" ");a.insertNode(c);a.selectNode(c)}}var f=a.getBoundingClientRect();var g=b.getBoundingClientRect();var h=this._getEditableOffset();var i=g.bottom-f.bottom-h<0;if(c&&c.parentNode){c.parentNode.removeChild(c)}return i},_getEditableOffset:function(){var a=$(this.editable.getElement());var b=10;var c=b;var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(d&&d.getCompType()===$SE_CONFIG.COMP_TYPE.TABLE){c+=d.getCellOffset()}return c},_cloneSafeRange:function(){return this._getSafeRange().cloneRange()},_getSafeRange:function(){var a=this.editable.getRange();if(a.commonAncestorContainer.nodeType===9){this.focus();a=this.editable.getRange()}return a},_extendNextChar:function(a){var b=a.endContainer;if(b.nodeType===3){for(var c=a.endOffset,d=b.nodeValue.length;c<d;c++){if(b.nodeValue[c]!=="\ufeff"){a.setEnd(b,c+1);return true}}}return false},_extendPrevChar:function(a){var b=a.startContainer;if(b.nodeType===3){for(var c=a.startOffset-1,d=b.nodeValue.length;c>-1;c--){if(b.nodeValue[c]!=="\ufeff"){a.setStart(b,c);return true}}}return false},getElement:function(){if(this.$el){return this.$el.get(0)}},divide:function(){return{head:this.editable,tail:this.editable.divide()}},prependEmptyLine:function(){var a="<br>";if(this.editable.getContents()===""){a+="<br>"}this.editable.pasteHTML(a)},prependHtml:function(a,b){this.cursorToStart();if(b){a+="<br>"}this.$el.prepend(a)},appendHtml:function(a,b){this.cursorToEnd();if(b){a="<br>"+a}this.$el.append(a)},hasEndBr:function(){return selry.dom.last(this.editable.getElement(),true).nodeName==="BR"},pasteHTML:function(a){this.editable.pasteHTML(a,true)},empty:function(){this.$el.html("")},pasteBeforeCursor:function(a){a=this._removeDropCap(a);this.editable.insertBR(true);this.editable.pasteHTML(a)},_removeDropCap:function(a){a=$SE_HTML.removeAttrByBlackList(a,["unselectable"]);a=$SE_HTML.removeClassByList(a,[this.DROPCAP_CLASS]);return a},addStyle:function(a,b){this.editable.setStyle(a,b)},removeStyle:function(a){this.editable.removeStyle(a)},_setEditable:function(a){this.editable=a;this.$el=$(a.getElement())},_resetEditable:function(a){this.disableEvents();this._setEditable(a);this.enableEvents()},destroy:function(){this.disable();this._detachAllEvents();this.clearSelection();this._clear();this.state.isInitialized=false}});se.defineClass("se.ImageSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.ImageSubCompView",state:{hasFocus:false,isError:false,width:0,height:0,originalWidth:0,originalHeight:0},props:{noImage:$SE_CONFIG.ENV_SETTING.EDITOR_DOMAIN+"/static/img/no_image.png"},template:se.editor.template.canvas["imageView.hbs"]},construct:function(){},_bindEvents:function(){this.$el.on("load",this._onLoadSuccess.bind(this)).on("error",this._onLoadFailed.bind(this));this.$el.on("dragstart",function(a){a.preventDefault()})},_unbindEvents:function(){this.$el.off()},enableEvents:function(){this._unbindEvents();this._bindEvents()},disableEvents:function(){this._unbindEvents()},_executeCallback:function(a){if(a){a.call(this,this.state)}},_changeWidth:function(a){this.state.width=a},_changeHeight:function(a){this.state.height=a},_changeOriginalWidth:function(a){this.state.originalWidth=a},_changeOriginalHeight:function(a){this.state.originalHeight=a},_hasNoSizeInfo:function(){return this.state.width===0&&this.state.height===0},changeSize:function(a,b){this._changeWidth(a);this._changeHeight(b)},changeOriginalSize:function(a,b){this._changeOriginalWidth(a);this._changeOriginalHeight(b)},_onLoadSuccess:function(a){if(this.state.isError){return}var b=$(a.currentTarget);var c=b.width()||b.get(0).naturalWidth;var d=b.height()||b.get(0).naturalHeight;if(this._hasNoSizeInfo()){this.changeSize(c,d);this.changeOriginalSize(c,d)}this._executeCallback(this.events.onLoadedSuccess)},changeSrc:function(a){if(a===this.$el.prop("src")){return}this.$el.prop("src",a);this.state.src=a},_deatchErrorEvent:function(){this.$el.off("error")},_onLoadFailed:function(a){var b=$(a.target);var c=480;var d=210;this.state.isError=true;b.trigger("load.imgchecker");this._deatchErrorEvent();this.changeSize(c,d);this.changeOriginalSize(c,d);this.changeSrc(this.props.noImage);this._executeCallback(this.events.onLoadedFailed)},_clear:function(){this.$el.off();this.$el.remove();this.$el=null},destroy:function(){this.disableEvents();this._clear()}});se.defineClass("se.TextSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.TextSubCompView",state:{componentStyle:{fontSize:"T3",fontFamily:"nanumgothic",align:"left"}},template:se.editor.template.canvas["textView.hbs"],subViews:{editableView:{selector:".__textArea",view:se.EditableSubCompView,strategy:"append"}}},construct:function(a){this.editableView=null;this.editableHelper=$SE_CE_HELPER},enableEvents:function(){this.subViews.forEach(function(a){a.enableEvents()})},disableEvents:function(){this.subViews.forEach(function(a){a.disableEvents()})},enableEditable:function(){this.editableView.enable()},focusToEditable:function(){this.editableView.focus()},blurFromEditable:function(){this.editableView.blur()},_setLineHeight:function(a){if(a==="190"){a=""}a=a&&a!==""?a+"%":"";this.$el.css("line-height",a)},setLineHeight:function(a){this._setLineHeight(a)},_setMinHeight:function(a){var b=this.$el[0];b.style.minHeight=a+"px"},changeMinHeight:function(a){this._setMinHeight(a);this.editableView.changeMinHeight(a);
},changeFontColor:function(a){if(a){this.editableView.addStyle("color",a)}else if(a===""){this.editableView.removeStyle("color")}},changeBackgroundColor:function(a){if(a){this.editableView.addStyle("background-color",a)}else if(a===""){this.editableView.removeStyle("background")}},toggleDropCap:function(){this.editableView.toggleDropCap()},getDropCapNodes:function(){return this.editableView.getDropCapNodes()},isDropCapUsable:function(){return this.editableView.isDropCapUsable()},unwrapDropCap:function(){return this.editableView.unwrapDropCap()},unwrapDropCapByKeyBoard:function(){return this.editableView.unwrapDropCapByKeyBoard()},fixDropCap:function(a){return this.editableView.fixDropCap(a)},fixDropCapAfterStyle:function(){return this.editableView.fixDropCapAfterStyle()},toggleLink:function(a,b){this.editableView.toggleLink(a,b)},selectAnchorAround:function(){var a=this.editableView.selectAnchorAround();this.editableView.saveSelection();return a},restoreSelection:function(){this.editableView.restoreSelection()},clearSelection:function(){this.editableView.clearSelection()},extractStyle:function(a,b){this.editableView.clearSelection();return this.editableView.extractStyles(a,b)},extractLastStyles:function(a){return this.editableView.extractLastStyles(a)},pasteHTML:function(a){this.editableView.pasteHTML(a)},empty:function(){this.editableView.empty("")},isEmpty:function(){return this.editableView.value()===""},toggleStyle:function(a){this.editableView.toggleStyle(a)},extractTextRowAtCursor:function(){return this.editableView.extractTextRowAtCursor()},enablePlaceholder:function(a){this.editableView.enablePlaceholder(a)},disablePlaceholder:function(){if(this.editableView){this.editableView.disablePlaceholder()}},disableEditable:function(){this.editableView.disable()},enableEditable:function(){this.editableView.enable()},value:function(a){if(a!==null&&typeof a!=="undefined"){return this.editableView.value(a)}return this.editableView.value()},hidePlaceholder:function(){this.editableView.hidePlaceholder()},showPlaceholder:function(){this.editableView.showPlaceholder()},_resetEditable:function(a){if(this.editableView.isInitialized()){this.editableView._resetEditable(a)}},_shouldSplit:function(a){return a.reduce(function(a,b){if(b["@ctype"]!==$SE_CONFIG.COMP_TYPE.PARAGRAPH){a=true}return a},false)},adviseSplit:function(a,b){if(!this.editableView.hasBrowserFocus()){this.editableView.enableWithFocus();this.restoreSelection()}if(this._shouldSplit(a)){return this.splitEditable(b)}var c=[];[].concat(a).forEach(function(a){if(a&&a.value){c.push(a.value)}});this.editableView.pasteBeforeCursor(c.join("<br>"));return{sInsertType:"none"}},_hasNoText:function(a){return!$SE_COMMON_UTIL.getInnerText(a).replace(/\uFEFF/g,"")&&!$(a).is(":has(br)")},_isEmpty:function(){var a=this.editableView.getElement();return this.isEmpty()||this._hasNoText(a)},_isEmptyEditable:function(a){var b=a.getElement();return!a.getContents()||this._hasNoText(b)},splitEditable:function(a){if(this._isEmpty()){return{sInsertType:"after"}}var b=this.editableView.divide();var c=b.head;var d=b.tail;if(!d){return{sInsertType:"after"}}var e=c.getElement();var f=d.getElement();if(this._isEmptyEditable(d)){f.parentNode.removeChild(f);return{sInsertType:"after"}}else if(this._isEmptyEditable(c)){e.parentNode.removeChild(e);this._resetEditable(d);if(f.firstChild&&!$(f.firstChild).text()){f.removeChild(f.firstChild)}return{sInsertType:"before"}}else{var g=this.editableView.getDropCapNodes(e)&&e.textContent.length===1;if(g){this.unwrapDropCap()}var h=f.innerHTML;var i=$.extend(a(),{compId:null,value:h,hasDropCap:false});f.parentNode.removeChild(f);return{htData:i,sInsertType:"split"}}},_bindEvents:function(){},_onAfterRender:function(){this.editableView.initEditable();this.editableView.disableEvents();this._bindEvents()},focusWithAction:function(a){this.editableView.hidePlaceholder();if(!a){return}var b=$SE_CONFIG.TRIGGER;switch(a.trigger){case b.BACKSPACE:case b.LEFT:case b.UP:case b.DRAG:case b.PASTE:case b.CHANGE:case b.CLICK:this.editableView.cursorToEnd();break;case b.DELETE:case b.RIGHT:case b.DOWN:case b.ENTER:if(this.editableView.hasDropCap()){this.editableView.cursorToDropCap()}else{this.editableView.cursorToStart()}break}},changeStyle:function(a,b){var c=this.$el[0].className||"";var d=this._replaceSyleClassName(c,a,b);if(d){this.$el[0].setAttribute("class",d);this.state.componentStyle[a]=b}},currentStyle:function(a){return this.state.componentStyle[a]},currentInlineStyle:function(a){return this.state.componentStyle[a]},isCursorAtStart:function(){return this.editableView.isCursorAtStart()},isCursorAtEnd:function(){return this.editableView.isCursorAtEnd()},isCursorAtTop:function(){return this.editableView.isCursorAtTop()},isCursorAtBottom:function(){return this.editableView.isCursorAtBottom()},getInheritBackgroundColor:function(a){return this.editableHelper.getInheritBackgroundColor(this.editableView.getElement(),a)},getStyleMapper:function(a){return this.editableHelper.getStyleMapper(a,this.editableView.getElement())},setInlineStyleByClass:function(a,b){this.editableHelper.setInlineStyleByClass(this.editableView.editable,a,b)},_replaceSyleClassName:function(a,b,c){return this.editableHelper.replaceSyleClassName(a,b,c)}});se.defineClass("se.MapSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.MapSubCompView",state:{staticMapReloadTrial:0,componentStyle:{align:"left"}},template:se.editor.template.canvas["mapView.hbs"]},construct:function(a){this._initVar()},_initVar:function(){this._htElement=_.extend({},this.elements);this._aHandledElementName=[]},_assignElements:function(){var a=this._htElement;var b=this.$el;a.$elStaticMapWrapper=b.find(".__se_map_info_wrapper")},_attachEventOnElement:function(a){var b=Array.prototype.slice;var c=this._htElement;var d=c["$el"+a];var e=b.call(arguments,1);if(!d||!d[0]){return}d.on.apply(d,e);this._aHandledElementName.push(a)},enableEvents:function(){this._detachEvents();this._attachDynamicEvents(this.events)},disableEvents:function(){this._detachEvents()},_attachDynamicEvents:function(a){},_detachEvents:function(){},_onUpdateStaticMapInModel:function(a,b){this._executeCallbackWithState(a,b)},_onSetLayoutType:function(a,b){this._executeCallbackWithState(a,b)},_executeCallbackWithState:function(a,b){this.executeCallback(a,b,this.state)},_toggleLayoutByTypeKey:function(a){var b=this._getCurrentTypeKey();var c=this._getReplacedTypeKey();if(b===c){return}var d=this.$el;var e={IMAGE:[this._staticMapView.getStaticMapWrapper()],TEXT:[$("i.ico_map_text",d)]};this.$el.trigger("setLayoutType");var f;var g;if(b){for(f=e[b].length;f--;){g=e[b][f];g.css("display","none")}}for(f=e[c].length;f--;){g=e[c][f];g.css("display","block")}this._setCurrentTypeKey(c);this._setReplacedTypeKey(null)},setLayoutType:function(a){var b=this.getTypeKeyByLayoutType(a);this._setReplacedTypeKey(b);this._toggleLayoutByTypeKey(b)},getTypeKeyByLayoutType:function(a){var b=a;switch(a){case $SE_CONFIG.MAP.LAYOUT_TYPE.IMAGE:{b=$SE_CONFIG.MAP.TYPE_KEY.IMAGE;break}case $SE_CONFIG.MAP.LAYOUT_TYPE.TEXT:{b=$SE_CONFIG.MAP.TYPE_KEY.TEXT;break}}return b},_getCurrentTypeKey:function(){var a=this.state.currentTypeKey;return a},_setCurrentTypeKey:function(a){this.state.currentTypeKey=a},_getReplacedTypeKey:function(){var a=this.state.replacedTypeKey;return a},_setReplacedTypeKey:function(a){this.state.replacedTypeKey=a},_bindEvents:function(){this.$el.on({updateStaticMapInModel:this._onUpdateStaticMapInModel.bind(this,this.events.updateStaticMapInModel),setLayoutType:this._onSetLayoutType.bind(this,this.events.setLayoutType)})},_onAfterRender:function(){this._assignElements();var a=this._makeStaticMapView();a.prependTo(this._htElement.$elStaticMapWrapper);this._staticMapView=a;var b=this.state.layout;var c=b===$SE_CONFIG.MAP.LAYOUT_TYPE.IMAGE;if(c){a.show()}},_makeStaticMapView:function(){return new se.StaticMapSubCompView({state:{thumbnailSrc:this.state.thumbnailSrc},props:{centerPos:this.state.centerPos,zoomLevel:this.state.zoomLevel,searchEngine:this.state.searchEngine},events:{updateStaticMapInModel:this._updateStaticMapInModel.bind(this)}})},_updateStaticMapInModel:function(a,b){this.state.thumbnailSrc=b.thumbnailSrc;this.$el.trigger("updateStaticMapInModel")}});se.defineClass("se.StaticMapSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.StaticMapSubCompView",state:{staticMapReloadTrial:0,thumbnailSrc:null},props:{centerPos:null,zoomLevel:null,searchEngine:null},events:{updateStaticMapInModel:function(){}},template:se.editor.template.canvas["staticMapView.hbs"]},construct:function(){this._initVar()},_initVar:function(){this._aHandledElementName=[]},_assignElements:function(){var a=this.$el;this.$elMapThumb=a.find(".__se_map_thumb");this.$elNoMapThumb=a.find(".__se_map_no_thumb")},enableEvents:function(){},disableEvents:function(){},_onUpdateStaticMapInModel:function(a,b){this._executeCallbackWithState(a,b)},_executeCallbackWithState:function(a,b){this.executeCallback(a,b,this.state)},_setThumbnailSrc:function(a){this.state.thumbnailSrc=a;this._updateStaticMapInModel();this._toggleStaticMapAndErrorGuide()},_bindEvents:function(){this.$el.on({updateStaticMapInModel:this._onUpdateStaticMapInModel.bind(this,this.events.updateStaticMapInModel)});this.$elMapThumb.on({load:this._onLoadStaticMap.bind(this),error:this._onErrorLoadStaticMap.bind(this)})},_onAfterRender:function(){this._assignElements();if(!this.$elMapThumb.attr("src")){this._setThumbnailSrc(null)}},_onLoadStaticMap:function(){var a=this.$elMapThumb.attr("src");var b=this.state.thumbnailSrc;if(b!==a){this._setThumbnailSrc(a)}},_onErrorLoadStaticMap:function(){this._retryLoadStaticMap()},_retryLoadStaticMap:function(){if(this.state.staticMapReloadTrial===$SE_CONFIG.MAP.STATIC_MAP.MAX_RELOAD_TRIAL){this._setThumbnailSrc(null);return}this.state.staticMapReloadTrial++;this._loadStaticMap()},_getProcessedThumbnailSrcWithProps:function(){var a=this.state.thumbnailSrc;var b=this.props;var c=b.searchEngine;var d;var e;if(b){d=b.centerPos;e=b.zoomLevel}var f;var g;if(d&&e){f={nLat:d.latitude,nLng:d.longitude,nWidth:$SE_CONFIG.MAP.STATIC_MAP.SIZE.WIDTH,nHeight:$SE_CONFIG.MAP.STATIC_MAP.SIZE.HEIGHT,sMarkerType:$SE_CONFIG.ENV_SETTING.IS_POST_SERVICE?"default2":"default",nZoom:e};g=$SE_CONFIG.MAP.STATIC_MAP.SRC[c];a=$SE_STRING.processTemplate(g,f)}return a},_loadStaticMap:function(){var a=this._getProcessedThumbnailSrcWithProps();var b=this.props.searchEngine;if(b===$SE_CONFIG.MAP.SEARCH_ENGINE.NAVER){this._updateThumbnailInElement(a)}else if(b===$SE_CONFIG.MAP.SEARCH_ENGINE.GOOGLE){this._requestStaticMap(a)}},_requestStaticMap:function(a){var b=this._onErrorLoadStaticMap.bind(this);$SE_AJAX.request(a,{fSuccess:this._onSuccessLoadStaticMap.bind(this),fFail:b,fError:b})},_onSuccessLoadStaticMap:function(a){if(a.isSuccess){var b=a.result.url;this._updateThumbnailInElement(b)}else{this._onErrorLoadStaticMap()}},_updateStaticMapInModel:function(){this.$el.trigger("updateStaticMapInModel")},getStaticMapWrapper:function(){return this.$el},show:function(){this.$el.show()},hide:function(){this.$el.hide()},_updateThumbnailInElement:function(a){this.$elMapThumb.attr("src",a)},_toggleStaticMapAndErrorGuide:function(){var a=this.state.thumbnailSrc;if(a){this._showStaticMap()}else{this._showStaticMapErrorGuide()}},_showStaticMap:function(){this.$elNoMapThumb.hide();this.$elMapThumb.show()},_showStaticMapErrorGuide:function(){this.$elMapThumb.hide();this.$elNoMapThumb.show()}});se.defineClass("se.QuotationSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.QuotationSubCompView",state:{fontSize:"T2",value:null},props:{},template:se.editor.template.canvas["quotationView.hbs"]},construct:function(a){this._initVar(a)},_initVar:function(a){this._$elViewArea=null;this._$elEditable=null},setState:function(a){var b;var c;var d;for(d in a){c=$SE_STRING.capitalize(d);b=this["_set"+c].bind(this);if(typeof b!=="function"){continue}b(a[d])}},_assignElements:function(){this._$elViewArea=this.$el;this._$elEditable=this.$el.find(".se_editable")},_createPlaceholder:function(){this.getEditable().placeholder()},destroyPlaceholder:function(){this.getEditable().trigger("destroy.placeholder")},isCursorAtStart:function(){return this._isCursorAtEdge();var a=this.getEditable().get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&b===0},isCursorAtEnd:function(){return this._isCursorAtEdge(true);var a=this.getEditable().get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&this.getValue().length===b},_isCursorAtEdge:function(a){var b=this.getEditable().get(0);var c=b.selectionStart;var d=b.selectionEnd;var e;if(a){e=this.getValue().length===c}else{e=c===0}return c===d&&e},_updateViewByValue:function(){var a=this.state.value;this.getEditable().val(a);this._updateAutoSize()},_updateValueFromView:function(){this.state.value=this._getValueFromEditable()},_getValueFromEditable:function(){return this.getEditable().val()},isExistText:function(){var a=this.getEditable();var b=a[0].classList;if(a.hasClass("is-empty")||a.val()===""||b.contains("placeholder")){return false}return true},_updateViewByFontSize:function(){var a=this.state.fontSize||this.default.state.fontSize;var b=this.getViewArea();var c=$SE_STYLE_HELPER.getClassBy(b,/se_fs_T\d{1,5}/);b.removeClass(c).addClass("se_fs_"+a);this._updateAutoSize()},_placeCursor:function(a){var b=0;if(a){b=this.getValue().length}this.focusEditable();this._setSelectionRange(b,b)},placeCursorAtStart:function(){this._placeCursor()},placeCursorAtEnd:function(){this._placeCursor(true)},_setSelectionRange:function(a,b){var c=this.getEditable();$SE_COMMON_UTIL.setSelectionRange(c[0],a,b)},getFirstLineTop:function(){return this.getEditable().offset().top},getLastLineBottom:function(a,b){var c=this.getEditable();return c.offset().top+c.height()-a-b},getLineHeightByInt:function(){var a=this.getEditable();var b=a.css("lineHeight")||"0";return parseInt(b,10)},_updateAutoSize:function(){this.$el.trigger("updateAutoSize")},updateHeight:function(){var a=this.getEditable();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE,a);if(this.getValue()===""&&a.hasClass("placeholder")){a[0].style.height=""}},pasteHTML:function(a){if(!a||a===""){return}var b=this.getEditable();var c=b.get(0);var d=$SE_STRING.insertStringToInput(c,a);this.setState({value:b.get(0).value});$SE_STRING.setCaretPosition(c,d)},getValue:function(){this._updateValueFromView();return this._getValueFromState()},_getValueFromState:function(){return this.state.value},_setValue:function(a){if(a===this.state.value){return false}this.state.value=a;this._updateViewByValue()},getFontSize:function(){return this.state.fontSize},_setFontSize:function(a){if(a===this.state.fontSize){return false}this.state.fontSize=a;this._updateViewByFontSize()},_addDataAttributeForAutosize:function(){this.getEditable().data("autosize",{allowEnter:true})},focusIn:function(a){var b=typeof a==="undefined";if(b||this._isFocusFromArrowKey(a)){this.focusEditable()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE,this._$elEditable)},_isFocusFromArrowKey:function(a){a=a||{};var b=a.trigger;var c=$SE_CONFIG.TRIGGER;return b===c.DOWN||b===c.UP||b===c.LEFT||b===c.RIGHT},blur:function(){this.blurEditable()},getEditable:function(){return this._$elEditable},focusEditable:function(){this.getEditable().focus()},blurEditable:function(){this.getEditable().blur()},getViewArea:function(){return this._$elViewArea},focusOut:function(){},_clear:function(){this._$elViewArea=null;this._$elEditable=null},_onAfterRender:function(){this._assignElements();this._addDataAttributeForAutosize();this._createPlaceholder();this.updateHeight()},_bindEvent:function(){var a=this.events;this.$el.on({"mousedown.subQuotationView":this._onMousedown.bind(this,a.mousedown),"closeToolbarLayer.subQuotationView":this._onCloseToolbarLayer.bind(this,a.closeToolbarLayer),"updateAutoSize.subQuotationView":this._onUpdateAutoSize.bind(this,a.updateAutoSize)});this._interceptKeydownForWrappingParagraph();this.getEditable().on({"click.subQuotationView":function(){this.$el.trigger("closeToolbarLayer")}.bind(this)})},_unbindEvent:function(){this.$el.off(".subQuotationView");this.getEditable().off(".subQuotationView")},_interceptKeydownForWrappingParagraph:function(){var a=this.getEditable();var b=this.events.keydown;if(b&&typeof b==="function"){a[0].onkeydown=this._onKeydown.bind(this,b)}},_bindEvents:function(a){},_executeCallback:function(a){var b=Array.prototype.slice.call(arguments);(a||function(){}).apply(this,b.slice(1))},_onUpdateAutoSize:function(a,b){this._executeCallback(a,b)},_onCloseToolbarLayer:function(a,b){this._executeCallback(a,b)},_onKeydown:function(a,b){this.executeCallback(a,b,this.state)},_onMousedown:function(a,b){this.executeCallback(a,b,this.state)},_onBlur:function(a,b){this._updateValueFromView()},_executeCallbackWithState:function(a,b){this._executeCallback(a,b,this.state)},height:function(){return this.$el.parent().outerHeight()+30},enableEvents:function(){this._unbindEvent();this._bindEvent()},disableEvents:function(){this._unbindEvent()},destroy:function(){this.destroyPlaceholder();this.disableEvents();this._clear()}});se.defineClass("se.WrappingImageSubCompView",se.AbstractCompositeSubCompView,{"default":{name:"se.WrappingImageSubCompView",state:{},template:se.editor.template.canvas["wrappingSubView.hbs"],subViews:{imageView:{selector:".__slotWrap",view:se.ImageSubCompView,strategy:"prepend"},captionView:{selector:".__slotWrap",view:se.CaptionSubCompView,strategy:"append"}}},construct:function(){this.captionView=null;this.imageView=null},_assignElements:function(){this._$elSelectionArea=this.$el.find(".se_sub_selectionArea")},_onAfterRender:function(){this._assignElements();this._marginTop=parseInt(this.$el.css("margin-top")||0,10)},_bindEvents:function(){var a=this.events;this.$el.on("mousedown",a.mousedown);this.$el.on("mousedown",".se_mediaImage",function(){this.captionView.blur()}.bind(this));this.$el.on("dblclick",a.dblclick)},_unbindEvents:function(){this.$el.off()},enableEvents:function(){this._unbindEvents();this._bindEvents();this.imageView.enableEvents();this.captionView.enableEvents()},disableEvents:function(){this._unbindEvents();this.imageView.disableEvents();this.captionView.disableEvents()},getCaptionValue:function(){return this.captionView.getValue()},setCaptionValue:function(a){return this.captionView.setValue(a)},changeImageMeta:function(a,b,c){this.imageView.changeSrc(a);this.imageView.changeSize(b,c)},blur:function(){if(this.captionView){this.captionView.focusOut();this._diminish()}},_diminish:function(){this.$el.removeClass("is-subFocused")},_highlight:function(){this.$el.addClass("is-subFocused")},focus:function(){if(this.captionView){$SE_FOCUS_HELPER.blurFromActiveElement();this.captionView.focusIn();this._highlight()}},_destroyCaption:function(){if(this.captionView){this.captionView.destroy();this.captionView=null}},_isRenderedInMemory:function(){return this.$el.parents("body").length===0},_calcSlotHeightAsRule:function(){return this._marginTop+this._$elSelectionArea.parent().height()},pasteHTML:function(a){this.captionView.pasteHTML(a)},updateHeight:function(){this.captionView.updateHeight()},height:function(){if(this._isRenderedInMemory()){return 0}return this._calcSlotHeightAsRule()},_destroyImage:function(){if(this.imageView){this.imageView.destroy();this.imageView=null}},destroy:function(){this._unbindEvents();this._destroyCaption();this._destroyImage()}});se.defineStatic("se.ParagraphCompMixin",function(){function a(a,f,g){var h=c(f,a);var i=a.extractStyle("start",h);if(!i){return}i.textAlign=d(a,"align")||"left";i.lineHeight=$SE_CE_HELPER.getLineHeight(a.$el);i.dropCapLetter=a.getDropCapNodes().length>0;if(a.isDropCapUsable()&&b(i.textAlign)){g.enableButton(["dropCapLetter"])}else{a.unwrapDropCap();g.disableButton(["dropCapLetter"])}g.changeBtnValue(e(i))}function b(a){return a==="left"||a==="justify"}function c(a,b){var c=a.getComponentStyle()||{};return b.getStyleMapper(c)}function d(a,b){return a.currentStyle(b)}function e(a){return{fontFamily:a.fontFamily,fontSize:a.fontSize,fontColor:a.fontColor,backgroundColor:a.backgroundColor,italic:a.italic,strikeThrough:a.strikeThrough,underline:a.underline,bold:a.bold,textAlignGroup:a.textAlign,textAlign:a.textAlign,link:"",lineHeight:a.lineHeight,dropCapLetter:a.dropCapLetter,superscript:a.superscript,subscript:a.subscript}}function f(a,b,c,d){var e="";if(c&&c.length){e+=' style="'+c.join(";")+'"'}if(d&&d.length){e+=' class="'+d.join(" ")+'"'}return"<"+b+e+">"+a+"</"+b+">"}return{setInitStyle:function(a){var b=a.getInitStyle();if(!b){return}var c=a.getValue()||"\ufeff";var d=a.getComponentStyle()||{};var e={bold:"B",underline:"U",italic:"I",strikeThrough:"STRIKE",superscript:"SUP",subscript:"SUB"};if(this._bIE){e.bold="STRONG";e.italic="EM"}var g=[];var h=[];var i;for(var j in b){i=b[j];if(i&&i!==d[j]){switch(j){case"bold":case"underline":case"italic":case"strikeThrough":case"superscript":case"subscript":c=f(c,e[j]);break;case"fontColor":g.push("color:"+i);break;case"backgroundColor":g.push("background-color:"+i);break;case"fontSize":case"fontFamily":h.push($SE_CE_HELPER.COMPSTYLE_PREFIX[j]+i);break;case"align":d.align=i;break;case"lineHeight":d.lineHeight=i;break}}}if(g.length||h.length){c=f(c,"SPAN",g,h)}a.setValue(c)},checkStyle:function(b,c){if(b&&b.which===229){return}var d=a.bind(this,this._textView,this._oModel,this._oToolbar);this.clearCheckStyle();if(c){this._nTimerCheckStyle=setTimeout(d,c)}else{d()}},clearCheckStyle:function(){clearTimeout(this._nTimerCheckStyle);this._nTimerCheckStyle=null},getLastStyle:function(){var a=c(this._oModel,this._textView);var b=this._textView.extractLastStyles(a);b.align=d(this._textView,"align")||"left";b.lineHeight=$SE_CE_HELPER.getLineHeight(this._textView.$el);return b},empty:function(){this._textView.empty();a(this._textView,this._oModel,this._oToolbar)},enablePlaceholder:function(){this._textView.enablePlaceholder()},disablePlaceholder:function(){if(this._textView){this._textView.disablePlaceholder()}},hidePlaceholder:function(){this._textView.hidePlaceholder()},showPlaceholder:function(){this._textView.showPlaceholder()},adviseInsertViewComp:function(a){var b=this._textView.adviseSplit(a,function(){this.syncModelWithSubview();return this.getModelDataAsJson()}.bind(this));this.syncModelWithSubview();return b},updateViewArea:function(a){$.each(a,function(a,b){this._textView.changeStyle(a,b);if(a==="lineHeight"){this._textView.setLineHeight(b)}if(a==="align"){this._updateDropCapByAlign(b)}}.bind(this))},toggleStyle:function(a){this._textView.toggleStyle(a);this._afterInlineStyle()},toggleDropCap:function(){this._textView.toggleDropCap();this._afterInlineStyle()},unwrapDropCapByKeyBoard:function(){var a=this._textView.unwrapDropCapByKeyBoard();if(a){this.updateDataModel();this._oToolbar.changeBtnValue({dropCap:false});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);return true}},removeEmptyDropCap:function(){var a=this._textView.getDropCapNodes();var b=a.length;if(b<1){return}for(var c=b-1;c>=0;c--){if(a[c].textContent===""){$(a[c]).remove()}}},putLinkInputAtCursor:function(){var a=this._textView.selectAnchorAround();if(a){this._oToolbar.changeBtnValue({link:$(a).attr("href")})}else{this._oToolbar.changeBtnValue({link:""})}},changeLineHeight:function(a){this._textView.setLineHeight(a);this._afterCompStyle()},changeFontSize:function(a,b){this._setInlineStyleByClass(a,b);this._afterInlineStyle()},changeFontColor:function(a){this._textView.changeFontColor(a);this._afterInlineStyle()},changeFontFamily:function(a,b){if(b){this._setInlineStyleByClass(a,b)}this._afterInlineStyle()},changeBackgroundColor:function(a){this._textView.changeBackgroundColor(a);this._afterInlineStyle()},changeAlign:function(a){this.updateViewArea({align:a});this._updateDropCapByAlign(a);this._afterCompStyle()},_updateDropCapByAlign:function(a){if(this._textView.isDropCapUsable()&&b(a)){this._oToolbar.enableButton(["dropCapLetter"])}else{this._textView.unwrapDropCap();this._oToolbar.changeBtnValue({dropCapLetter:false});this._oToolbar.disableButton(["dropCapLetter"])}},toggleLink:function(a){this._textView.toggleLink(a,this._afterInlineStyle.bind(this))},_setInlineStyleByClass:function(a,b){this._textView.setInlineStyleByClass(a,b)},_getCompStyleByClass:function(a){return this._textView.currentStyle(a)},_afterInlineStyle:function(){this._textView.fixDropCapAfterStyle();this.updateDataModel();this._requestCompHistory()},_afterCompStyle:function(){this.updateStyleModel();this.updateDataModel();this._requestCompHistory()},updateStyleModel:function(){var a=this._oModel.getComponentStyle();if(this._textView){$.each($SE_CE_HELPER.COMPSTYLE_REGEXP,$.proxy(function(b,c){a[b]=this._getCompStyleByClass(b)},this));a["lineHeight"]=$SE_CE_HELPER.getLineHeight(this._textView.$el)}this._oModel.setComponentStyle(a)},updateDataModel:function(){if(this._textView){var a=this._textView.getDropCapNodes().length>0;this._oModel.setValue(this._textView.value());this._oModel.setHasDropCap(a)}},syncModelWithSubview:function(){this.updateStyleModel();this.updateDataModel()},handleFontLevel:function(a,b){if(this.isHeaderFontSize(b)){this.convertLine2OtherComp($SE_CONFIG.COMP_TYPE.SECTION_TITLE,{componentStyle:{fontSize:b}})}else{this.changeFontSize(a,b)}},handleLinkInput:function(a){if(a===true){this.putLinkInputAtCursor()}else{this.toggleLink(a)}},getPlainText:function(){return $SE_HTML.toText(this.getTextContents())},getTextContents:function(){return this._textView.value()},pasteHTML:function(a){if(a===""){return}this._textView.pasteHTML(a)},focusTextView:function(a){this._textView.enableEditable();this._textView.focusToEditable();this._textView.focusWithAction(a)},prependContents:function(a,b){this._textView.prependContents(a,b)},getEditableView:function(){return this._textView.editableView},canSplitted:function(){return this._bEnableSplit},disableSplit:function(){this._bEnableSplit=false},enableSplit:function(){this._bEnableSplit=true},isCursorAtStart:function(){return this._textView.isCursorAtStart()},isCursorAtEnd:function(){return this._textView.isCursorAtEnd()},cursorToStart:function(){return this._textView.cursorToStart()},cursorToEnd:function(){return this._textView.cursorToEnd()},canMoveUpward:function(){return this._textView.isCursorAtTop()},canMoveDownward:function(){return this._textView.isCursorAtBottom()},disableAutoUrlDetectForIE:function(){try{document.execCommand("AutoUrlDetect",false,false)}catch(a){}},isHeaderFontSize:function(a){if(a&&a.indexOf("H")!=-1){return true}return false}}}());se.defineStatic("se.QuotationCompMixIn",function(){return{_PREFIX:"quotation_",_quotationView:null,_fontSizeChanged:true,TYPES:{DEFAULT:"default",LINE:"line",BUBBLE:"bubble",UNDERLINE:"underline",POSTIT:"postit",CORNER:"corner"},FONT_SIZES:{"default":"T2",line:"T3",bubble:"T3",underline:"T2",postit:"T2",corner:"T2"},supportThemeList:["default","transparent"],supportTypeList:["defulat","line","bubble"],updateUIWithModel:function(){this._changeQuotationLayout();this._setValue(this._getValueFromModel());this._setFontSize(this._getFontSizeFromModel());this._updateToolbar();this._updateAutoSize()},_getStyle:function(){var a=this._getComponentStyleFromModel();a.fontSize=this._getFontSize();return a},_getValueFromModel:function(){return this._oModel.getValue()},_getFontSizeFromModel:function(){return this._getComponentStyleFromModel().fontSize},_getLayoutFromModel:function(){return this._oModel.getLayout()},_onClickToolBar:function(a,b,c,d){this._handleByGroup(b,c,d)},_setQuotationLayout:function(a){this._oModel.setLayout(a)},_updateToolbar:function(){this._setActiveButton();this._setBtnState()},_setActiveButton:function(){this._oToolbar.changeActiveBtns(this._buttonSetPolicy.getButtonSet(this._oModel))},_getFontFamilyContainer:function(){return this._$elContainer||this._quotationView.getViewArea()},_setBtnState:function(){var a=this._getActiveButtonState();var b=this._getFontFamilyContainer();var c=$SE_CE_HELPER.extractFontFamily(b);this._oToolbar.changeBtnValue(a);this._oToolbar.changeFontFamily(c)},_getActiveButtonState:function(){var a={wrapAroundWithClear:this._layout||this.TYPES.DEFAULT};a.blockquote=this._getQuotationCurrentType();if(!this._fontSizeChanged){a.fontSizeParagraph=this.getQuotationDefaultFontSize(a.blockquote)}else{a.fontSizeParagraph=this._getFontSizeFromModel()}return a},_getComponentStyleFromModel:function(){var a=this._oModel.getComponentStyle();if(typeof a.fontSize==="undefined"){a.fontSize=this.getQuotationDefaultFontSize()}return a},_shouldPutCaretAtLast:function(a){return a.trigger===$SE_CONFIG.TRIGGER.BACKSPACE},_isFromDrag:function(a){return $SE_CONFIG.TRIGGER.DRAG===a},_getQuotationContainer:function(){return this._$elQuotationContainer},_setQuotationContainer:function(a){this._$elQuotationContainer=a},getLayoutClassContainer:function(){return this._$elLayoutClassContainer},_setLayoutClassContainer:function(a){this._$elLayoutClassContainer=a},_getQuotationCurrentType:function(){var a=new RegExp(this._PREFIX+"\\w+");var b=a.exec(this._$elLayoutClassContainer.attr("class"));if(b){b=b[0]}return this.getQuotationType(b)},_updateAutoSize:function(a){if(typeof this.updateAutoSize==="function"){var b=a?a.$elEditable:this._getEditable();this.updateAutoSize(b)}else{this._execQuotationSubCompView("updateHeight")}},_updateComponentStyle:function(){this._oModel.setComponentStyle(this._getStyle())},_updateValue:function(){this._setValueOnModel(this._getValue())},_closeToolbarLayer:function(){this._oToolbar.closeAllLayer()},_changeQuotationLayout:function(){var a=this.getQuotationLayoutClass(this._getQuotationCurrentType());var b=this._getLayoutFromModel();var c=this.getLayoutClassContainer();if(a===b){return}c.removeClass(a).addClass(b)},getQuotationContainer:function(){return this._$elQuotationContainer},getQuotationType:function(a){var b=this.TYPES.DEFAULT;if(a&&a.indexOf(this._PREFIX)!==-1){b=a.replace(this._PREFIX,"")}return b},getQuotationLayoutClass:function(a){var b=this.TYPES.DEFAULT;if(a&&a!==this.TYPES.DEFAULT){b=this._PREFIX+a}return b},getQuotationDefaultFontSize:function(a){return this.FONT_SIZES[a]||this.FONT_SIZES.default},canMoveUpward:function(){var a=this._getEditable().get(0);var b=this._getLineHeightByInt();var c=$SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top;var d=parseInt(this._getEditable().css("fontSize"),10);return b>c+d},canMoveDownward:function(){var a=this._getEditable().get(0);var b=this._getEditable().height();var c=this._getLineHeightByInt();var d=$SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top;var e=parseInt(this._getEditable().css("fontSize"),10);return b<d+c},isCursorAtStart:function(){return this._isCursorAtStart()},isCursorAtEnd:function(){return this._isCursorAtEnd()},_makeQuotationView:function(){this._quotationView=new se.QuotationSubCompView({template:se.editor.template.canvas["quotationView.hbs"],state:{fontSize:this._getFontSize(),value:this._getValueFromModel()},events:this._getEventsForQuotationView()});return this._quotationView},_execQuotationSubCompView:function(a,b){if(!this._quotationView){return}return this._quotationView[a].apply(this._quotationView,b)},_destroyQuotationView:function(){this._execQuotationSubCompView("destroy");this._quotationView=null},_focusInQuotationView:function(a){this._execQuotationSubCompView("focusIn",[a])},_focusOutQuotationView:function(){this._execQuotationSubCompView("focusOut")},_isCursorAtStart:function(){return this._execQuotationSubCompView("isCursorAtStart")},_isCursorAtEnd:function(){return this._execQuotationSubCompView("isCursorAtEnd")},_pasteHTML:function(a){this._execQuotationSubCompView("pasteHTML",[a])},_placeCursor:function(a){this._execQuotationSubCompView("placeCursor",[a])},_placeCursorAtStart:function(){this._execQuotationSubCompView("placeCursorAtStart")},_placeCursorAtEnd:function(){
this._execQuotationSubCompView("placeCursorAtEnd")},_getFirstLineTop:function(){return this._execQuotationSubCompView("getFirstLineTop")},_getLastLineBottom:function(a,b){return this._execQuotationSubCompView("getLastLineBottom",arguments)},_getLineHeightByInt:function(){return this._execQuotationSubCompView("getLineHeightByInt")},_getEditableHeight:function(){var a=this._getEditable();var b=0;if(a&&a[0]){b=a.height()}return b},_getFontSize:function(){var a;if(this._quotationView){a=this._execQuotationSubCompView("getFontSize")}else{a=this._getFontSizeFromModel()}if(!a){a=this.getQuotationDefaultFontSize()}return a},_setFontSize:function(a){this._execQuotationSubCompView("setState",[{fontSize:a}])},_setFontSizeOnModel:function(a){var b=this._getComponentStyleFromModel();b.fontSize=a;this._oModel.setComponentStyle(b)},_getValue:function(){return this._execQuotationSubCompView("getValue")},_setValue:function(a){this._execQuotationSubCompView("setState",[{value:a}])},_setValueOnModel:function(a){this._oModel.setValue(a)},_getEditable:function(){return this._execQuotationSubCompView("getEditable")},_focusEditable:function(){this._execQuotationSubCompView("focusEditable")},_getViewArea:function(){return this._execQuotationSubCompView("getViewArea")},_changeType:function(a){var b;this._setQuotationLayout(this.getQuotationLayoutClass(a));if(this._getQuotationCurrentType()!==a){this._fontSizeChanged=false}b=this.getQuotationDefaultFontSize(a);if(!this._fontSizeChanged){this._oToolbar.changeBtnValue({fontSizeParagraph:b});this._setFontSize(b)}}}}());se.defineStatic("se.ImageCompMixIn",function(){return{openFileDialog:function(a){var b=new se.ImageFileUploaderComponent({success:a});var c=new se.LocalFileDialog({multiple:false});c.on("FILE_DIALOG.CHANGE",function(a){b.upload(a);c.destroy()}.bind(this));c.open()},openPhotoEditor:function(){if(!$SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG||this._oModel.isEmptyMediaTag()||this._mediaTagManager.confirmOpenPhotoEditor()){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.PHOTO_EDITOR.OPEN)}},switchBetweenChangeAndEdit:function(a){if(this._canUsePhotoEditor()){this.openPhotoEditor()}else{this.changeImage(a)}},changeImage:function(a){if(!$SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG||this._oModel.isEmptyMediaTag()||this._mediaTagManager.confirmChangeImage()){a=a||this._changedImage.bind(this);this.openFileDialog(a)}},_canUsePhotoEditor:function(){var a=this._oModel.getUploadedLocal();var b=this._oModel.getAnimationGIF();var c=this._oModel.isVR360AvailableBy(this._oModel.getDisplayFormat());return a&&!b&&!c},_destroyUploadPopup:function(){this._oChildWindow.close();this._oChildWindow=null},closeUploadPopup:function(){if(this._oChildWindow){this._destroyUploadPopup()}},closeUploadPopupWithMessage:function(){if(this._oChildWindow){this._destroyUploadPopup();window.alert(se.i18n.getMsg("MSG_IMAGE_DELETED"))}},_updateImageModel:function(a,b,c){if(!this._oModel){return}if(a){this._oModel.changeDisplaySize(b,c)}else{this._oModel.replaceToError()}},_updateImageModelWithOriginal:function(a,b){if(!this._oModel){return}this._oModel.changeOriginalSize(a,b)},updateUIWithModel:function(a){this._changeCaption(a.getCaption());this._changeImage(a.getSrc(),a.getWidth(),a.getHeight());this._updateToolbar()},addLibraryResource:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ADD_LIBRARY_RESOURCE,this,false,true)},reRenderBy:function(a){this._updateUI(this.createNewModelWith(a));this.addLibraryResource()},createNewModelWith:function(a){var b=this._oModel;var c=$.extend({id:b.getCompId()},this._filterOriginalData(b.getJson()),this._filterNewData(a));var d=new se.ImageModel(c);if(b.getType()!==d.getType()){d.doSetAlign()}return d},_filterOriginalData:function(a){delete a.displayFormat;return a},_filterNewData:function(a){delete a.caption;delete a.componentStyle;delete a.link;a.represent=false;return a},getRepresent:function(){return this._oModel.getRepresent()},setRepresent:function(a){this._oModel.setRepresent(a)},_extractRepresentImageSrc:function(a){var b=this;var c=null;for(var d in a){if(b._isRepresentImage(a[d])){c=a[d].src;break}}return c},_isRepresentImage:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_LIBRARY_MAP);var c=b[a.src];var d=c&&c.oModel&&c.oModel.represent===true?true:false;return d},putLinktOnToolbar:function(a){this._oToolbar.changeBtnValue({link:a||""})},handleClickLink:function(a){if(typeof a==="boolean"){this.putLinktOnToolbar(this._oModel.getLink())}else{this.linkWith(a)}},linkWith:function(a){this._oModel.setLink(a);this.putLinktOnToolbar(a)}}}());se.defineStatic("se.TableCore",function(){return{merge:function(){if(this.aSelectedCells.length===0||this.aSelectedCells.length==1){return}this._removeClassFromSelection();var a,b,c;b=this.aSelectedCells[0];var d=this.elSelectionStartTable;var e,f;var g,h=this.aSelectedCells[0];e=parseInt(h.style.height||h.getAttribute("height"),10);f=parseInt(h.style.width||h.getAttribute("width"),10);for(a=this.htSelectionSPos.x+1;a<this.htSelectionEPos.x+1;a++){curTD=this.htMap[a][this.htSelectionSPos.y];if(curTD==h){continue}h=curTD;f+=parseInt(curTD.style.width||curTD.getAttribute("width"),10)}h=this.aSelectedCells[0];for(a=this.htSelectionSPos.y+1;a<this.htSelectionEPos.y+1;a++){curTD=this.htMap[this.htSelectionSPos.x][a];if(curTD==h){continue}h=curTD;e+=parseInt(curTD.style.height||curTD.getAttribute("height"),10)}if(f){b.style.width=f+"px"}if(e){b.style.height=e+"px"}b.setAttribute("colSpan",this.htSelectionEPos.x-this.htSelectionSPos.x+1);b.setAttribute("rowSpan",this.htSelectionEPos.y-this.htSelectionSPos.y+1);for(a=1;a<this.aSelectedCells.length;a++){c=this.aSelectedCells[a];var i=$(c).find(".__se_editable_value").get(0);if(c.parentNode){if(!this.isBlankNode(i)){b.innerHTML+=c.innerHTML}c.parentNode.removeChild(c)}}$(b).html(this._drawEditableHtml(this._getCompileValue(b)));this.htMap=this._getCellMapping(this.elSelectionStartTable);this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},isBlankNode:function(a){var b=this.isBlankTextNode;var c=function(a){if(!a){return true}if(b(a)){return true}if(a.tagName=="BR"){return true}if(a.innerHTML=="&nbsp;"||a.innerHTML==""){return true}return false};var d=function(a){if(a.tagName=="IMG"||a.tagName=="IFRAME"){return false}if(c(a)){return true}if(a.tagName=="P"){for(var d=a.childNodes.length-1;d>=0;d--){var e=a.childNodes[d];if(b(e)){e.parentNode.removeChild(e)}}if(a.childNodes.length==1){if(a.firstChild.tagName=="IMG"||a.firstChild.tagName=="IFRAME"){return false}if(c(a.firstChild)){return true}}}return false};if(d(a)){return true}for(var e=0,f=a.childNodes.length;e<f;e++){var g=a.childNodes[e];if(!d(g)){return false}}return true},isBlankTextNode:function(a){var b;if(a.nodeType==3){b=a.nodeValue;b=b.replace(unescape("%uFEFF"),"");if(b==""){return true}}return false},split:function(a){if(a==="row"){this._splitRow()}else if(a==="column"){this._splitColumn()}},_splitRow:function(a){var b,c,d,d;var e,f,g,h;if(this.aSelectedCells.length===0){return}var i=$(">TBODY>TR",this.elSelectionStartTable);this._removeClassFromSelection();var j=0;var k;for(var l=0,m=this.aSelectedCells.length;l<m;l++){e=this.aSelectedCells[l];b=parseInt(e.getAttribute("rowSpan"),10)||1;if(b>1){continue}g=this._getBasisCellPosition(e);k=i[g.y];h=document.createElement("TR");k.parentNode.insertBefore(h,k.nextSibling);j++;for(var n=0;n<this.htMap.length;){e=this.htMap[n][g.y];b=parseInt(e.getAttribute("rowSpan"),10)||1;e.setAttribute("rowSpan",b+1);n+=parseInt(e.getAttribute("colSpan"),10)||1}}i=$(">TBODY>TR",this.elSelectionStartTable);var o,p;for(var l=0,m=this.aSelectedCells.length;l<m;l++){e=this.aSelectedCells[l];b=parseInt(e.getAttribute("rowSpan"),10)||1;c=(b/2).toFixed(0);e.setAttribute("rowSpan",c);f=this._shallowCloneTD(e);f.setAttribute("rowSpan",b-c);b=parseInt(e.getAttribute("colSpan"),10)||1;f.setAttribute("colSpan",b);d=e.height||e.style.height;if(d){d=this.parseIntOr0(d);e.removeAttribute("height");nNewHeight=(d/2).toFixed();e.style.height=nNewHeight+"px";f.style.height=d-nNewHeight+"px"}var q=$(i).index(e.parentNode);var r=parseInt(q,10)+parseInt(c,10);var s=i[r];var t=s.childNodes;var u=null;var v;o=this._getBasisCellPosition(e);for(var w=0,x=t.length;w<x;w++){v=t[w];p=this._getBasisCellPosition(v);if(o.x<p.x){u=v;break}}s.insertBefore(f,u);var y=eg.agent().browser;if(y.edge&&Math.floor(y.version)===12||y.ie&&(y.nativeVersion>=9||y.nativeVersion<=11)&&(y.version>=9||y.version<=11)){f.style.cssText=f.style.cssText}}this._reassignCellSizes(this.elSelectionStartTable);this.htMap=this._getCellMapping(this.elSelectionStartTable);this.htSelectionEPos.y+=j;this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},_reassignCellSizes:function(a){a=a.get(0);var b=new Array(2);b[0]=$(">TBODY>TR>TD",a);b[1]=$(">TBODY>TR>TH",a);var c=new Array(b[0].length+b[1].length);var d=0;var e=this.parseIntOr0(a.border);var f=this.parseIntOr0(a.cellPadding);for(var g=0;g<2;g++){for(var h=0;h<b[g].length;h++){var i=b[g][h];var j=$(i);var k=eg.agent().browser;var l,m,n,o;var p,q,r,s;var t,u;if(i.getComputedStyle){l=parseFloat(getComputedStyle(i).paddingLeft,10);m=parseFloat(getComputedStyle(i).paddingRight,10);n=parseFloat(getComputedStyle(i).paddingTop,10);o=parseFloat(getComputedStyle(i).paddingBottom,10);p=parseFloat(getComputedStyle(i).borderLeftWidth,10);q=parseFloat(getComputedStyle(i).borderRightWidth,10);r=parseFloat(getComputedStyle(i).borderTopWidth,10);s=parseFloat(getComputedStyle(i).borderBottomWidth,10)}else{l=this.parseIntOr0(i.style.paddingLeft);m=this.parseIntOr0(i.style.paddingRight);n=this.parseIntOr0(i.style.paddingTop);o=this.parseIntOr0(i.style.paddingBottom);p=this.parseBorder(j.css("borderLeftWidth"),j.css("borderLeftStyle"));q=this.parseBorder(j.css("borderRightWidth"),j.css("borderRightStyle"));r=this.parseBorder(j.css("borderTopWidth"),j.css("borderTopStyle"));s=this.parseBorder(j.css("borderBottomWidth"),j.css("borderBottomStyle"))}var v=$(i).attr("width");var w=$(i).attr("height");if(!v&&!w){t=i.style.width;u=i.style.height}else{t=i.offsetWidth-(l+m+p+q)+"px";u=i.offsetHeight-(n+o+r+s)+"px"}c[d++]=[i,t,u]}}var x=a._nWidth,y=a._nHeight,z=a._nResizedWidth,A=a._nResizedHeight,B=1,C=1;if(_.isNumber(x)&&_.isNumber(y)&&_.isNumber(z)&&_.isNumber(A)){B=z/x,C=A/y}if(a._nResizedWidth){nhn.husky.SE2M_Utils.deleteProperty(a,"_nResizedWidth")}if(a._nResizedHeight){nhn.husky.SE2M_Utils.deleteProperty(a,"_nResizedHeight")}for(var h=0;h<d;h++){var D=c[h];D[0].removeAttribute("width");D[0].removeAttribute("height");D[0].style.width=parseFloat(D[1],10)*B+"px";D[0].style.height=parseFloat(D[2],10)*C+"px"}var E=$(a);a._nWidth=E.width();a._nHeight=E.height();a.removeAttribute("width");a.removeAttribute("height");a.style.width="";a.style.height=""},parseBorder:function(a,b){if(b=="none"){return 0}var c=parseInt(a,10);if(isNaN(c)){if(typeof a=="string"){return 1}}return c},_shallowCloneTD:function(a){var b=a.cloneNode(false);b.innerHTML=this._drawEditableHtml();return b},_getCellMapping:function(a){var b=$(">TBODY>TR",a);var c=0;var d=b[0].childNodes;for(var e=0;e<d.length;e++){var f=d[e];if(!f.tagName||!f.tagName.match(/^TD|TH$/)){continue}if(f.getAttribute("colSpan")){c+=this.parseIntOr0(f.getAttribute("colSpan"))}else{c++}}var g=c;var h=b.length;var i=new Array(g);for(var j=0;j<g;j++){i[j]=new Array(h)}for(var k=0;k<h;k++){var l=b[k].childNodes[0];if(!l){continue}if(!l.tagName||!l.tagName.match(/^TD|TH$/)){l=this._getNextCell(l)}var j=-1;while(l){j++;if(!i[j]){i[j]=[]}if(i[j][k]){continue}var m=parseInt(l.getAttribute("rowSpan"),10)||1;var n=parseInt(l.getAttribute("colSpan"),10)||1;if(k+m>=h){m=h-k;l.setAttribute("rowSpan",m)}for(var o=0;o<m;o++){for(var p=0;p<n;p++){if(!i[j+p]){i[j+p]=[]}i[j+p][k+o]=l}}l=this._getNextCell(l)}}var q=false;var r=null;for(var k=0,s=0,t=i[0].length;k<t;k++,s++){r=null;if(!b[k].innerHTML.match(/TD|TH/i)){for(var j=0,u=i.length;j<u;j++){l=i[j][k];if(!l||l===r){continue}r=l;var m=parseInt(l.getAttribute("rowSpan"),10)||1;if(m>1){l.setAttribute("rowSpan",m-1)}}b[k].parentNode.removeChild(b[k]);if(this.htSelectionEPos&&this.htSelectionEPos.y>=s){s--;this.htSelectionEPos.y--}q=true}}if(q){return this._getCellMapping(a)}return i},_getBasisCellPosition:function(a){var b=0,c=0;for(b=0;b<this.htMap.length;b++){for(c=0;c<this.htMap[b].length;c++){if(this.htMap[b][c]==a){return{x:b,y:c,elCell:a}}}}return{x:0,y:0,elCell:a}},_getNextCell:function(a){while(a){a=a.nextSibling;if(a&&a.tagName&&a.tagName.match(/^TD|TH$/)){return a}}return null},parseIntOr0:function(a){a=parseInt(a,10);if(isNaN(a)){return 0}return a},_splitColumn:function(){var a,b,c,d;var e,f;if(this.aSelectedCells.length===0){return}this._removeClassFromSelection();var g=this.aSelectedCells[0];for(var h=0,i=this.aSelectedCells.length;h<i;h++){e=this.aSelectedCells[h];a=parseInt(e.getAttribute("colSpan"),10)||1;if(a>1){continue}var j=this._getBasisCellPosition(e);for(var k=0;k<this.htMap[0].length;){e=this.htMap[j.x][k];a=parseInt(e.getAttribute("colSpan"),10)||1;e.setAttribute("colSpan",a+1);k+=parseInt(e.getAttribute("rowSpan"),10)||1}}for(var h=0,i=this.aSelectedCells.length;h<i;h++){e=this.aSelectedCells[h];a=parseInt(e.getAttribute("colSpan"),10)||1;b=(a/2).toFixed(0);e.setAttribute("colSpan",b);f=this._shallowCloneTD(e);f.setAttribute("colSpan",a-b);g=f;a=parseInt(e.getAttribute("rowSpan"),10)||1;f.setAttribute("rowSpan",a);c=e.width||e.style.width||$(e).width();if(c){c=this.parseIntOr0(c);e.removeAttribute("width");d=(c/2).toFixed();e.style.width=d+"px";f.style.width=c-d+"px"}e.parentNode.insertBefore(f,e.nextSibling)}this._reassignCellSizes(this.elSelectionStartTable);this.htMap=this._getCellMapping(this.elSelectionStartTable);var j=this._getBasisCellPosition(g);this.htSelectionEPos.x=j.x;this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},_expandAndSelect:function(a,b){var c,d,e,f,g;if(a.y>0){for(c=a.x;c<=b.x;c++){e=this.htMap[c][a.y];if(this.htMap[c][a.y-1]==e){f=a.y-2;while(f>=0&&this.htMap[c][f]==e){f--}a.y=f+1;this._expandAndSelect(a,b);return}}}if(a.x>0){for(d=a.y;d<=b.y;d++){e=this.htMap[a.x][d];if(this.htMap[a.x-1][d]==e){f=a.x-2;while(f>=0&&this.htMap[f][d]==e){f--}a.x=f+1;this._expandAndSelect(a,b);return}}}if(b.y<this.htMap[0].length-1){for(c=a.x;c<=b.x;c++){e=this.htMap[c][b.y];if(this.htMap[c][b.y+1]==e){f=b.y+2;while(f<this.htMap[0].length&&this.htMap[c][f]==e){f++}b.y=f-1;this._expandAndSelect(a,b);return}}}if(b.x<this.htMap.length-1){for(d=a.y;d<=b.y;d++){e=this.htMap[b.x][d];if(this.htMap[b.x+1][d]==e){f=b.x+2;while(f<this.htMap.length&&this.htMap[f][d]==e){f++}b.x=f-1;this._expandAndSelect(a,b);return}}}},_getSelectedCells:function(a,b){this._expandAndSelect(a,b);var c=a.x;var d=a.y;var e=b.x;var f=b.y;this.htSelectionSPos=a;this.htSelectionEPos=b;var g=[];for(var h=d;h<=f;h++){for(var i=c;i<=e;i++){if($.inArray(this.htMap[i][h],g)!==-1){continue}g[g.length]=this.htMap[i][h]}}return g},_selectCells:function(a,b){this.aSelectedCells=this._getSelectedCells(a,b);this._addClassToSelection();this._$tableWrap.addClass(this.TABLE_CONFIG.REMOVE_SELECTION_RANGE_CLASS_NAME)},_addClassToSelection:function(){$(this.aSelectedCells).each(function(a,b){$(b).addClass(this.TABLE_CONFIG.SELECT_CELL_CLASSNAME)}.bind(this))},_removeClassFromSelection:function(){$(this.aSelectedCells).each(function(a,b){$(b).removeClass(this.TABLE_CONFIG.SELECT_CELL_CLASSNAME)}.bind(this))},_deselectCells:function(){this._removeClassFromSelection();this.aSelectedCells=[];this.htSelectionSPos={x:-1,y:-1};this.htSelectionEPos={x:-1,y:-1};this._$tableWrap.removeClass(this.TABLE_CONFIG.REMOVE_SELECTION_RANGE_CLASS_NAME)},insertColumn:function(){if(this.aSelectedCells.length===0){return}this._selectAll_Column();this._insertColumnAfter(this.htSelectionEPos.x)},_insertColumnAfter:function(){this._removeClassFromSelection();var a=$(">TBODY>TR",this.elSelectionStartTable);var b;var c="_tmp_inserted";var d,e,f,g;for(var h=0,i=this.htMap[0].length;h<i;h++){f=a[h];d=this.htMap[this.htSelectionEPos.x][h];e=this._shallowCloneTD(d);var j=parseInt(d.getAttribute("rowSpan"));if(j>1){e.setAttribute("rowSpan",1);e.style.height=""}j=parseInt(d.getAttribute("colSpan"));if(j>1){e.setAttribute("colSpan",1);e.style.width=""}g=null;for(var k=this.htSelectionEPos.x;k>=this.htSelectionSPos.x;k--){if(this.htMap[k][h].parentNode==f){g=this.htMap[k][h].nextSibling;break}}f.insertBefore(e,g)}for(var l=0,m=this.aSelectedCells.length;l<m;l++){this.aSelectedCells[l].removeAttribute(c)}var n=this.htSelectionEPos.x-this.htSelectionSPos.x+1;this.htSelectionSPos.x+=n;this.htSelectionEPos.x+=1;this.htMap=this._getCellMapping(this.elSelectionStartTable);this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},insertRow:function(){if(this.aSelectedCells.length===0){return}this._insertRowBelow(this.htSelectionEPos.y)},_insertRowBelow:function(){this._removeClassFromSelection();var a;var b=this.htMap[0][0].parentNode.parentNode;var c=$(">TR",b);var d=c[this.htSelectionEPos.y+1]||null;a=this._getTRCloneWithAllTD(this.htSelectionSPos.y);b.insertBefore(a,d);var e=this.htSelectionEPos.y-this.htSelectionSPos.y+1;this.htSelectionSPos.y+=e;this.htSelectionEPos.y+=1;this.htMap=this._getCellMapping(this.elSelectionStartTable);this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},_selectAll_Row:function(a){if(typeof a==="number"){this.htSelectionSPos={x:0,y:a};this.htSelectionEPos={x:this.htMap.length-1,y:a}}else{this.htSelectionSPos.x=0;this.htSelectionEPos.x=this.htMap.length-1}this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},_selectAll_Column:function(a){if(typeof a==="number"){this.htSelectionSPos={x:a,y:0};this.htSelectionEPos={x:a,y:this.htMap[0].length-1}}else{this.htSelectionSPos.y=0;this.htSelectionEPos.y=this.htMap[0].length-1}this._selectCells(this.htSelectionSPos,this.htSelectionEPos)},_getTRCloneWithAllTD:function(a){var b=this.htMap[0][a].parentNode.cloneNode(false);var c,d;for(var e=0,f=this.htMap.length;e<f;e++){c=this.htMap[e][a];if(this._rxCellNames.test(c.tagName)){d=this._shallowCloneTD(c);d.setAttribute("rowSpan",1);d.setAttribute("colSpan",1);d.style.width="";d.style.height=this.TABLE_CONFIG.DEFAULT_CELL_HEIGHT+"px";b.insertBefore(d,null)}}return b},deleteRow:function(){if(this.aSelectedCells.length===0){return}this._selectAll_Row();this._deleteSelectedCells()},deleteColumn:function(){if(this.aSelectedCells.length===0){return}this._selectAll_Column();this._deleteSelectedCells()},_deleteSelectedCells:function(){var a;for(var b=0,c=this.aSelectedCells.length;b<c;b++){a=this.aSelectedCells[b];a.parentNode.removeChild(a)}var d=$(">TBODY>TR",this.elSelectionStartTable);var e=this.htSelectionEPos.x-this.htSelectionSPos.x+1;var f=this.htMap.length;if(e==f){for(var b=0,c=d.length;b<c;b++){a=d[b];if(!this.htMap[0][b]||!this.htMap[0][b].parentNode||this.htMap[0][b].parentNode.tagName!=="TR"){a.parentNode.removeChild(a)}}d=$(">TBODY>TR",this.elSelectionStartTable)}if(d.length<1){this.elSelectionStartTable.parentNode.removeChild(this.elSelectionStartTable)}this._updateSelection();this.htMap=this._getCellMapping(this.elSelectionStartTable)},_updateSelection:function(){this.aSelectedCells=$(this.aSelectedCells).filter(function(a,b){return b.parentNode!==null&&b.parentNode.parentNode!==null})},_selectBetweenCells:function(a,b){this._deselectCells();var c=this._getBasisCellPosition(a);var d=this._getBasisCellPosition(b);this._setEndPos(c);this._setEndPos(d);var e={},f={};e.x=Math.min(c.x,c.ex,d.x,d.ex);e.y=Math.min(c.y,c.ey,d.y,d.ey);f.x=Math.max(c.x,c.ex,d.x,d.ex);f.y=Math.max(c.y,c.ey,d.y,d.ey);this._selectCells(e,f)},_setEndPos:function(a){var b,c;b=parseInt(a.elCell.getAttribute("colSpan"),10)||1;c=parseInt(a.elCell.getAttribute("rowSpan"),10)||1;a.ex=a.x+b-1;a.ey=a.y+c-1},_getAllAffectedCells:function(a,b,c,d){if(!d){return[]}var e=this._getCellMapping(d);var f=e.length;var g=e[0].length;var h=[];var i=[];var j;var k=-1,l=-1;if(c==1){for(var m=0;m<g;m++){if(h.length>0&&h[h.length-1]==e[a][m]){continue}h[h.length]=e[a][m];var n=parseInt($(e[a][m]).width());if(k==-1||k>n){k=n}}if(e.length>a+1){for(var m=0;m<g;m++){if(i.length>0&&i[i.length-1]==e[a+1][m]){continue}i[i.length]=e[a+1][m];var n=parseInt($(e[a+1][m]).width());if(l==-1||l>n){l=n}}}j={aCellsBefore:h,aCellsAfter:i,nMinBefore:k,nMinAfter:l}}else{for(var o=0;o<f;o++){if(h.length>0&&h[h.length-1]==e[o][b]){continue}h[h.length]=e[o][b];if(k==-1||k>e[o][b].style.height){k=e[o][b].style.height}}j={aCellsBefore:h,aCellsAfter:i,nMinBefore:k,nMinAfter:l}}return j}}}());se.defineClass("se.AroundParagraphSlot",se.AbstractSlot,{mixins:[se.ParagraphCompMixin],construct:function(a,b){this._options=b||{};this._oModel=a;this._oToolbar=this._options.toolbar;this._buttonSetPolicy=this._options.buttonSetPolicy;this.disableAutoUrlDetectForIE();this._initVar();if(this._oModel){this.setInitStyle(this._oModel)}},_initVar:function(){this._bIE=$SE_COMMON_UTIL.detectIE();this._hasFocus=false;this._fOnClickToolbar=this._onClickToolbar.bind(this)},bindEvents:function(){this._textView.enableEvents()},unbindEvents:function(){if(this._textView){this._textView.disableEvents()}},_renderAndAppendTo:function(a){var b=this._composeSubViews(a);return b.$el},render:function(a){var b=this._renderAndAppendTo(a);this.bindEvents();return b},_setTextView:function(a){this._textView=a},_composeSubViews:function(a){var b=this._makeEditableView();var c=this._makeTextView(b);c.appendTo(a);this._setTextView(c);return c},_onFocusEditableView:function(){if(this._textView.isEmpty()){this._textView.value("\ufeff")}},_onBlurEditableView:function(){this.syncModelWithSubview()},_onKeyupEditableView:function(a,b){if(b.isInitialized){this.checkStyle()}},_onMouseupEditableView:function(a){this.checkStyle(a,500)},_onMousedownEditableView:function(a,b){if(b.isInitialized){this._oToolbar.closeActiveButton()}this._callEventByName("mousedown")},_onCreatedLink:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ATTACH_LINK_FROM_PARAGRAPH,a)},_makeEditableView:function(){return new se.EditableSubCompView({ieMode:this._bIE,state:{value:this._oModel.getValue()},template:se.editor.template.canvas["editableView.hbs"],events:{focus:this._onFocusEditableView.bind(this),blur:this._onBlurEditableView.bind(this),keyup:this._onKeyupEditableView.bind(this),mouseup:this._onMouseupEditableView.bind(this),mousedown:this._onMousedownEditableView.bind(this),createdLink:this._onCreatedLink.bind(this)}})},_makeTextView:function(a){return new se.TextSubCompView({state:{componentStyle:this._oModel.getComponentStyle()},subViews:{editableView:{selector:".__textArea",view:a,strategy:"append"}}})},_executeEditByGroup:function(a,b){switch(a){case"bold":case"underline":case"italic":case"strikeThrough":this.toggleStyle(a);break;case"superscript":case"subscript":this.toggleStyle(a);this.checkStyle({});break;case"fontSize":this.handleFontLevel(a,b);break;case"fontColor":this.changeFontColor(b);break;case"fontFamily":this.changeFontFamily(a,b);break;case"backgroundColor":this.changeBackgroundColor(b);break;case"textAlign":case"textAlignGroup":this.changeAlign(b);break;case"lineHeight":this.changeLineHeight(b);break;case"link":this.handleLinkInput(b);break;case"blockquote1":this.convertLine2OtherComp($SE_CONFIG.COMP_TYPE.QUOTATION);break;case"specialLetter":if(typeof b!=="string"){return}this.pasteHTML(b);break;case"dropCapLetter":this.toggleDropCap();break;case"delete":this._callEventByName("onDecomposed",[a,"aroundSlot"]);break}},_generateDefaultCompData:function(a,b){return $.extend(true,$SE_MODEL_DATA_COORD.getDefaultCompData(a),b)},_joinCompDataWithLineInfo:function(a,b,c){if(a===$SE_CONFIG.COMP_TYPE.SECTION_TITLE){b.title=c.text}else if(a===$SE_CONFIG.COMP_TYPE.QUOTATION){b.value=c.text}return b},convertLine2OtherComp:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DISABLED_PUSH_HISTORY);var c=this._generateDefaultCompData(a,b);var d=this._textView.extractTextRowAtCursor();var e=this._joinCompDataWithLineInfo(a,c,d);var f=this.adviseInsertViewComp([e]);setTimeout(function(){this._callEventByName("onChangeText",[e,f])}.bind(this),1)},getModelDataAsJson:function(){return _.assign({},this._oModel.getJson(),{compId:this._sId,focusComp:this._bFocused})},_skipHandleToolbar:function(a,b,c){return this._oToolbar.hasSubPanel(a)&&!b&&c!=="input"},_onClickToolbar:function(a,b,c,d,e){this._textView.fixDropCap(true);if(this._skipHandleToolbar(b,d,e)){return}this._textView.restoreSelection();this._executeEditByGroup(b,c)},_changeButtonSet:function(){this._oToolbar.changeActiveBtns(this._buttonSetPolicy.getButtonSet(this._oModel))},_clearLinkOnToolbar:function(){this._oToolbar.changeBtnValue({link:""})},_attachToolbarEvents:function(){this._oToolbar.setBtnClickEventListener(this._fOnClickToolbar)},enableToolbar:function(){this._changeButtonSet();this._clearLinkOnToolbar();this._attachToolbarEvents()},_setHasFocus:function(a){this._hasFocus=a},focus:function(a){this.enableToolbar();this.focusTextView(a);this.checkStyle();this.enableSplit();this._setHasFocus(true)},_blurFromEditable:function(){this._textView.blurFromEditable();this.syncModelWithSubview()},blur:function(){this.disableSplit();this.clearCheckStyle();this.showPlaceholder();this._disableTextViewWithAsync()},_disableTextViewWithAsync:function(){if(this&&this._textView&&this._hasFocus){this._textView.disableEditable();this._blurFromEditable();this._setHasFocus(false)}},isEmpty:function(){return this.value()===""},value:function(a){if(a===undefined){return this._textView.value()}this._textView.value(a);this._oModel.setValue(a)},updatePlaceholder:function(){if(this.isEmpty()){this.showPlaceholder()}else{this.hidePlaceholder()}},repaint:function(a){this.setModel(a);this.value(this._oModel.getValue());this.updatePlaceholder();this.updateStyle(this._oModel.getComponentStyle())},_combineStyle:function(a,b,c){if(a){return c}else{return _.extend(b,c)}},updateStyle:function(a,b){var c=this._oModel.getComponentStyle();var d=this._combineStyle(b,c,a);this.updateViewArea(d);this.checkStyle()},readonly:function(a){if(a){this.unbindEvents();this._textView.disableEditable()}else{this.removeEmptyDropCap();this._textView.enableEditable();this.bindEvents()}},_requestCompHistory:function(){this._callEventByName("onChangeComponent",[this._oModel])},executeCompHistory:function(){this._callEventByName("onChangeComponent",[this._oModel])},_destoryTextView:function(){if(this._textView){this._textView.destroy();this._textView=null}},changeMinHeight:function(a){if(!this._textView||a===0){return}this._textView.changeMinHeight(a)},getPlainText:function(){return $SE_HTML.toText(this.getTextContents())},getTextContents:function(){return this._textView.value()},getContainerWrappingElement:function(){return this._textView.$el},getId:function(){return this._options.parentId},syncModel:function(){this._oModel.setValue(this._textView.value())},destroy:function(){this.clearCheckStyle();this.unbindEvents();this._destoryTextView()}});se.defineClass("se.WrapImageSlot",se.AbstractSlot,{mixins:[se.ImageCompMixIn],construct:function(a,b){this._options=b||{};this._oModel=a;this._oToolbar=b.toolbar;this._buttonSetPolicy=b.buttonSetPolicy;this._layout=this._options.layout||"inner-left";if(this._oModel.isVR360AvailableBy(this._oModel.getGenerationFormat())){this._oModel.setDisplayFormat($SE_CONFIG.IMAGE.FORMAT.NORMAL)}this._initVar()},_initVar:function(){this._hasFocus=false;this._fHandleClickToolbar=this.handleClickToolbar.bind(this);this._fOnChangedImage=this._onChangedImage.bind(this)},_createAndRenderViews:function(){this._wrappingSlotView=new se.WrappingImageSubCompView({events:{mousedown:this._onMouseDownWrappingSlotView.bind(this),dblclick:this._onDoubleClickImageSubCompView.bind(this)},state:{compType:"image"},subViews:{imageView:{selector:".__slotWrap",view:this._makeImageView(),strategy:"prepend"},captionView:{selector:".__slotWrap",view:this._makeCaptionView(),strategy:"append"}}});return this._wrappingSlotView},bindEvents:function(){this._wrappingSlotView.enableEvents()},unbindEvents:function(){this._wrappingSlotView.disableEvents()},render:function(a){var b=this._createAndRenderViews();this._appendTo(b,a)},prependTo:function(a){var b=this._createAndRenderViews();this._prependTo(b,a)},_appendTo:function(a,b){a.appendTo(b)},_prependTo:function(a,b){a.prependTo(b)},_makeImageView:function(){return new se.ImageSubCompView({template:se.editor.template.canvas["imageView.hbs"],state:{src:this._oModel.getSrc(),width:this._oModel.getWidth(),height:this._oModel.getHeight()},focus:this._hasFocus,events:{onLoadedSuccess:this._onLoadedSuccess.bind(this),onLoadedFailed:this._onLoadedFailed.bind(this)}})},_onMouseDownWrappingSlotView:function(){this._oToolbar.closeActiveButton();this._callEventByName("mousedown")},_onDoubleClickImageSubCompView:function(){this.switchBetweenChangeAndEdit(this._fOnChangedImage.bind(this))},_onLoadedSuccess:function(a){this._updateImageModel(true,a.width,a.height);this._callEventByName("onLoaded");if(this._oModel.isVR360ImageBy(this._oModel.getGenerationFormat())){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_IMAGE_SMALL_VR360_WARN"))}},_onLoadedFailed:function(){this._updateImageModel();this.updateUIWithModel(this._oModel)},_onBlurFromCaption:function(a,b){this._oModel.setCaption(b.caption)},_makeCaptionView:function(){return new se.CaptionSubCompView({template:se.editor.template.canvas["captionView.hbs"],state:{caption:this._oModel.getCaption(),placeholder:se.i18n.getMsg("MSG_IMAGE_PLACEHOLDER")},events:{blur:this._onBlurFromCaption.bind(this),input:this._onInputFromCaption.bind(this)}})},_onInputFromCaption:function(){this._callEventByName("onChangeText",[this._oModel])},_setLayout:function(a){this._layout=a},changeLayout:function(a){this._callEventByName("onChangeLayout",[a]);this._setLayout(a)},changeAlign:function(a,b){this._oModel.setAlign(b);if(this._oModel.isVR360AvailableBy(this._oModel.getGenerationFormat())){var c=this._oModel.getGenerationFormat();this._oModel.setDisplayFormat(c)}this._callEventByName("onDecomposed",[a,b])},_onClickResizeImage:function(a){if(a===null){return}if(a.type==="resize"){this._resizeImageView(a.mediaSize)}else if(a.type==="reset"){this._resetImageView()}},_resetImageView:function(){this._oModel.resetDisplaySize();this.changeAlign("imageAlign",this._oModel.getDefaultAlignWithWidth())},_resizeImageView:function(a){this._oModel.changeDisplaySize(a.width,a.height);this.changeAlign("imageAlign",this._oModel.getDefaultSmallImageAlign());this._oModel.setDisplayFormat($SE_CONFIG.IMAGE.FORMAT.NORMAL)},_handleByGroup:function(a,b){switch(a){case"image":this.openFileDialog(this._fOnChangedImage.bind(this));break;case"imageEdit":this.openPhotoEditor();break;case"link":this.handleClickLink(b);break;case"imageAlign":this.changeAlign(a,b);break;case"imageDisplay":this.changeAlign(a,b);break;case"wrapAround":this.changeLayout(b);break;case"delete":this._callEventByName("onDecomposed",[a,"wrapSlot"]);break;case"specialLetter":this._onClickSpecialLetter(b);break;case"mediaResize":this._onClickResizeImage(b);break}},_requestCompHistory:function(){this._callEventByName("onChangeComponent",[this._oModel])},_onClickSpecialLetter:function(a){if(typeof a!=="string"){return}this.pasteHTML(a)},_onChangedImage:function(a){a.displayFormat=$SE_CONFIG.IMAGE.FORMAT.NORMAL;var b=this.createNewModelWith(a);if(b.getCompType()==="image"&&b.isVR360AvailableBy(b.getGenerationFormat())){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_IMAGE_SMALL_VR360_WARN"))}this.setModel(b);this.updateUIWithModel(b);this._requestCompHistory();this._callEventByName("onChangeComponent",[this._oModel])},handleClickToolbar:function(a,b,c){this._handleByGroup(b,c)},_changeButtonSet:function(){this._oToolbar.changeActiveBtns(this._buttonSetPolicy.getButtonSet(this._oModel))},_changeButtonValues:function(){this._oToolbar.changeBtnValue({
link:this._oModel.getLink(),wrapAround:this._layout,imageAlign:"",imageDisplay:"",mediaResize:""})},_attachToolbarEvents:function(){this._oToolbar.setBtnClickEventListener(this._fHandleClickToolbar)},enableToolbar:function(){this._oToolbar.switchWrappingMode();this._changeButtonSet();this._changeButtonValues();this._attachToolbarEvents()},repaint:function(a,b){this.setModel(a);this._setLayout(b);this.updateUIWithModel(this._oModel)},_changeImage:function(a,b,c){this._oModel.setSrc(a);this._oModel.changeDisplaySize(b,c);this._wrappingSlotView.changeImageMeta(a,b,c)},_changeCaption:function(a){this._wrappingSlotView.setCaptionValue(a);this._oModel.setCaption(a)},_updateToolbar:function(){this._changeButtonSet();this._changeButtonValues()},updateStyle:function(){this._updateToolbar()},_focusToWrappingSlotView:function(){if(this._wrappingSlotView){this._wrappingSlotView.focus()}},focus:function(){this.enableToolbar();this._focusToWrappingSlotView()},_blurFromWrappingSlotView:function(){if(this._wrappingSlotView){this._wrappingSlotView.blur()}},blur:function(){this._blurFromWrappingSlotView();this._oToolbar.switchNormalMode()},height:function(){return this._wrappingSlotView.height()},resize:function(){this._wrappingSlotView.updateHeight()},syncModel:function(){this._oModel.setCaption(this._wrappingSlotView.getCaptionValue())},readonly:function(a){if(a){this.unbindEvents()}else{this.bindEvents()}},_destoryWrappingSlotView:function(){if(this._wrappingSlotView){this._wrappingSlotView.destroy()}},getPlainText:function(){return this._wrappingSlotView.getCaptionValue()},getTextContents:function(){return $SE_COMMON_UTIL.escapeHtml(this.getPlainText())},pasteHTML:function(a){this._wrappingSlotView.pasteHTML(a)},getModelDataAsJson:function(){this.syncModel();return this._oModel.getJsonWithCompId()},isContain:function(a){return this._wrappingSlotView.isContain(a)},destroy:function(){this.blur();this._destoryWrappingSlotView();this.closeUploadPopup()}});se.defineClass("se.WrapQuotationSlot",se.AbstractSlot,{mixins:[se.QuotationCompMixIn],construct:function(a,b){this._options=b||{};this._oModel=a;this._oToolbar=b.toolbar;this._buttonSetPolicy=b.buttonSetPolicy;this._layout=this._options.layout||"inner-left";this._initVar()},_initVar:function(){this._hasFocus=false;this._fHandleClickToolbar=this._onClickToolBar.bind(this);this._fWrappingSlotTemplate=se.editor.template.canvas["wrappingSubView.hbs"]},bindEvents:function(){this._execQuotationSubCompView("enableEvents")},unbindEvents:function(){this._execQuotationSubCompView("disableEvents")},render:function(a){this._renderWrappingSlot(a,true)},_renderWrappingSlot:function(a,b){var c=this._fWrappingSlotTemplate({compType:this._oModel.getCompType(),layout:this._oModel.getLayout()});var d=$(c);if(b){this._appendTo(d,a)}else{this._prependTo(d,a)}var e=d.find(".__slotWrap");this._renderSubViews(e);this._setQuotationContainer(d);this._setLayoutClassContainer(e);this._changeQuotationLayout();this._$elWrappingSlot=d},_renderSubViews:function(a){var b=this._makeQuotationView();this._appendTo(b,a);this._wrappingSlotView=b},isContain:function(a){return this._wrappingSlotView.isContain(a)},prependTo:function(a){this._renderWrappingSlot(a)},_appendTo:function(a,b){a.appendTo(b)},_prependTo:function(a,b){a.prependTo(b)},_onMousedown:function(){this._oToolbar.closeActiveButton();var a={trigger:$SE_CONFIG.TRIGGER.CLICK};this._callEventByName("mousedown",[a])},_onKeydown:function(a){var b=a.keyCode;var c=this._isArrowKeyCode(b);var d=this._isBackspaceKeyCode(b);var e=this._isDeleteKeyCode(b);var f=this._isEnterKeyCode(b);if(c||d||f||e){a.stopImmediatePropagation();this._handleArrowKey(a)}this._callEventByName("onChangeText",[this._oModel])},_handleArrowKey:function(a){var b=a.keyCode;var c=this._isCursorReadyToBeOutAtEdgeByKeyCode(b);if(!c){return}$SE_HOTKEY.execShortcut($SE_CONFIG.HOTKEY.FOCUS_MOVE.ns,a)},_isArrowKeyCode:function(a){return $SE_COMMON_UTIL.isArrowKeyCode(a)},_isBackspaceKeyCode:function(a){return a===$SE_CONFIG.TRIGGER.BACKSPACE},_isDeleteKeyCode:function(a){return a===$SE_CONFIG.TRIGGER.DELETE},_isEnterKeyCode:function(a){return a===$SE_CONFIG.TRIGGER.ENTER},_isCursorReadyToBeOutAtEdgeByKeyCode:function(a){var b=false;var c=$SE_CONFIG.TRIGGER;switch(a){case c.UP:{b=this.canMoveUpward();break}case c.DOWN:{b=this.canMoveDownward();break}case c.LEFT:{b=this.isCursorAtStart();break}case c.RIGHT:{b=this.isCursorAtEnd();break}}return b},_getEventsForQuotationView:function(){return{keydown:this._onKeydown.bind(this),mousedown:this._onMousedown.bind(this),closeToolbarLayer:this._closeToolbarLayer.bind(this),updateAutoSize:function(a){this._updateAutoSize(a)}.bind(this)}},setLayout:function(a){this._setWrappingParagraphLayout(a)},_setWrappingParagraphLayout:function(a){this._layout=a},changeLayout:function(a){this._changeLayout(a);this.setLayout(a)},_changeLayout:function(a){this._callEventByName("onChangeLayout",[a])},_handleByGroup:function(a,b,c){if(a==="wrapAroundWithClear"){if(b==="default"){this._decomposeByGroup(a)}this.changeLayout(b);return}else if(a==="delete"){this._decomposeByGroup(a);return}if(a==="blockquote"){this.updateUIByQuotationBtn(a,b)}else if(a==="specialLetter"){if(typeof b!=="string"){return}this._pasteHTML(b);this._requestCompHistory()}else if(a==="fontSizeParagraph"&&c){this._fontSizeChanged=true;this._updateUIByFontSizeBtn(b)}},_decomposeByGroup:function(a){this._callEventByName("onDecomposed",[a,"wrapSlot"])},updateUIByQuotationBtn:function(a,b){this._changeType(b);if(!this._fontSizeChanged){this._setFontSizeOnModel(this.getQuotationDefaultFontSize(b))}this._updateUIWIthModelAndHistory()},_updateUIByFontSizeBtn:function(a){this._setFontSizeOnModel(a);this._updateUIWIthModelAndHistory()},_updateUIWIthModelAndHistory:function(){this.updateUIWithModel();this._requestCompHistory()},_requestCompHistory:function(){this._callEventByName("onChangeComponent",[this._oModel])},_attachToolbarEvents:function(){this._oToolbar.setBtnClickEventListener(this._fHandleClickToolbar)},enableToolbar:function(){this._oToolbar.switchWrappingMode();this._updateToolbar();this._attachToolbarEvents()},repaint:function(a,b){a=a||this._oModel;b=b||a.getLayout();this.setModel(a);this.setLayout(b);this.updateUIWithModel()},changeCaption:function(a){this._quotationView.setCaptionValue(a);this._oModel.setCaption(a)},updateStyle:function(){this._updateToolbar()},_focusToWrappingSlotView:function(a){this._focusInQuotationView(a)},focus:function(a){this.enableToolbar();this._focusToWrappingSlotView(a)},_blurFromWrappingSlotView:function(){this._focusOutQuotationView(true)},blur:function(){this._blurFromWrappingSlotView();this._oToolbar.switchNormalMode()},height:function(){return this._wrappingSlotView.height()},resize:function(){this._execQuotationSubCompView("updateHeight")},syncModel:function(){this._setValueOnModel(this._getValue())},readonly:function(a){if(a){this.unbindEvents()}else{this.bindEvents()}},_destoryWrappingSlotView:function(){this._destroyQuotationView()},getPlainText:function(){return this._getValue()},getTextContents:function(){return $SE_COMMON_UTIL.escapeHtml(this.getPlainText())},getModelDataAsJson:function(){this.syncModel();var a=this._oModel.getJson();a.compId=this._oModel.getId();return a},destroy:function(){this.blur();this._destoryWrappingSlotView()}});window.$SE_STYLE_HELPER=se.defineStatic("se.CompStyleClassHelper",function(){var a=new RegExp("se_align-\\S+","g");function b(a,b){var c=a.get(0).className;return(c.match(b)||[]).join(" ")}function c(c){return b(c,a)}function d(a){return"se_align-"+a}function e(a){return a.replace("se_align-","")}function f(a,b){a.removeClass(c(a)).addClass(d(b))}function g(c){return b(c,a)}function h(a){return e(g(a))}function i(a,b){a.removeClass("se_ff se_ff_sans-serif se_ff_nanummyeongjo se_ff_nanumgothic se_ff_nanumbarungothic");a.addClass("se_ff_"+b)}function j(a){if(!a||a===""){return""}var b=a.match(/^rgba?[\s+]?\([\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?,[\s+]?(\d+)[\s+]?/i);return b&&b.length===4?"#"+("0"+parseInt(b[1],10).toString(16)).slice(-2)+("0"+parseInt(b[2],10).toString(16)).slice(-2)+("0"+parseInt(b[3],10).toString(16)).slice(-2):""}return{getClassBy:b,changeAlignClassName:f,getAlignForModel:h,changeFontFamily:i,getAlignPrefix:d,getClassNameByPattern:g,convertRgbToHex:j}}());se.defineClass("se.ParagraphCompView",se.BaseCompView,{construct:function(){_.extendOwn(this,se.ParagraphCompMixin);this.disableAutoUrlDetectForIE();this._initVar();this.setInitStyle(this._oModel)},_initVar:function(){this._onKeyDownDelete=this._onKeyDownDelete.bind(this,this.isCursorAtEnd.bind(this));this._onKeyDownBackspace=this._onKeyDownBackspace.bind(this,this.isCursorAtStart.bind(this))},_assignElements:function(){},_bindEventForEditable:function(){this._textView.enableEvents()},_unbindEventForEditable:function(){this._textView.disableEvents()},_bindEvent:function(){},_unbindEvent:function(){},_makeEditableView:function(){return new se.EditableSubCompView({ieMode:$SE_COMMON_UTIL.detectIE(),isAutoMentionAvailable:$SE_CONFIG.SERVICE_CONFIG.USE_AUTO_MENTION,state:{value:this._oModel.getValue()},template:se.editor.template.canvas["editableView.hbs"],events:{keyup:function(a,b){if(b.isInitialized){this.checkStyle()}}.bind(this),mouseup:function(a){this.checkStyle(a,500)}.bind(this),mousedown:function(a,b){if(b.isInitialized){this._oToolbar.closeActiveButton()}}.bind(this),createdLink:function(a){if(!$SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ATTACH_LINK_FROM_PARAGRAPH,a)}}}})},_makeTextView:function(a){return new se.TextSubCompView({subViews:{editableView:{selector:".__textArea",view:a,strategy:"append"}}})},_composeSubViews:function(a){var b=this._makeEditableView();var c=this._makeTextView(b);c.appendTo(a);this._textView=c},_executeEditByGroup:function(a,b){switch(a){case"bold":case"underline":case"italic":case"strikeThrough":this.toggleStyle(a);break;case"superscript":case"subscript":this.toggleStyle(a);this.checkStyle({});break;case"fontSize":this.handleFontLevel(a,b);break;case"fontColor":this.changeFontColor(b);break;case"fontFamily":this.changeFontFamily(a,b);break;case"backgroundColor":this.changeBackgroundColor(b);break;case"textAlign":case"textAlignGroup":this.changeAlign(b);break;case"lineHeight":this.changeLineHeight(b);break;case"link":this.handleLinkInput(b);break;case"blockquote1":this.convertLine2OtherComp($SE_CONFIG.COMP_TYPE.QUOTATION);break;case"specialLetter":if(typeof b!=="string"){return}this.pasteHTML(b);break;case"dropCapLetter":this.toggleDropCap();break;case"delete":setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);break}},_skipHandleToolbar:function(a,b,c){return this._oToolbar.hasSubPanel(a)&&!b&&c!=="input"},handleClickToolbar:function(a,b,c,d,e){this._textView.fixDropCap(true);if(this._skipHandleToolbar(b,d,e)){return}this._textView.restoreSelection();this._executeEditByGroup(b,c)},_IMPL_onAfterRender:function(){this._composeSubViews(this._$elContainer.find(".__editArea"));this._assignElements();this._bindEventForEditable();var a=this._oModel.getComponentStyle();this.updateViewArea(a)},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue({link:""});this._oToolbar.setBtnClickEventListener(this.handleClickToolbar.bind(this))},_getHexColor:function(a){return $SE_CE_HELPER.getHexColor(a)},isEmpty:function(){return this.getContainerWrappingElement().find(".is-empty").length>0},convertLine2OtherComp:function(a,b){var c=$.extend(true,$SE_MODEL_DATA_COORD.getDefaultCompData(a),b);var d=this._textView.extractTextRowAtCursor();if(a===$SE_CONFIG.COMP_TYPE.SECTION_TITLE){c.title=d.text}else if(a===$SE_CONFIG.COMP_TYPE.QUOTATION){c.value=d.text}if(d.isWhole){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{target:this,compData:c,shouldFocus:true})}.bind(this),1)}else{setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:c,shouldFocus:true})},1)}},getPlainText:function(){return $SE_HTML.toText(this.getTextContents())},getTextContents:function(){return this._textView.value()},_IMPL_onFocusIn:function(a){this._bindEvent();this._bindEventForEditable();this.focusTextView(a);this.checkStyle();this.enableSplit();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fDelete:this._onKeyDownDelete,fBackspace:this._onKeyDownBackspace})},_onKeyDownDelete:function(a,b){if(a.call(null)===false){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_AFTER_COMP,this,b.which);b.preventDefault();b.stopPropagation()},_onKeyDownBackspace:function(a,b){if(a.call(null)){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_BEFORE_COMP,this,b.which);b.preventDefault();b.stopPropagation()}else if(this.unwrapDropCapByKeyBoard()){b.preventDefault();b.stopPropagation()}},_IMPL_onFocusOut:function(){this.disableSplit();this.clearCheckStyle();this.showPlaceholder();setTimeout(function(){if(this&&this._textView&&!this.isFocused()){this._textView.disableEditable()}}.bind(this),0);this._unbindEvent();this._unbindEventForEditable();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onUpdateModel:function(){this.syncModelWithSubview()},_IMPL_onUpdateUI:function(){var a=this._oModel.getValue();if(a!==""){this.hidePlaceholder()}else{this.showPlaceholder()}this._textView.value(a);this.updateStyle(this._oModel.getComponentStyle())},_IMPL_onUpdateStyle:function(a,b){var c=this._oModel.getComponentStyle();if(b){c=a}else{c=_.extend(c,a)}this.updateViewArea(c);this.checkStyle()},_IMPL_onReadonly:function(a){if(a){this._unbindEvent();this._unbindEventForEditable();this._textView.disableEditable()}else{this.removeEmptyDropCap();this._textView.enableEditable();this._bindEventForEditable();this._bindEvent()}},_IMPL_onDestroyed:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this);this.clearCheckStyle();this._unbindEventForEditable();this._unbindEvent();this._textView.destroy();this._textView=null}});se.defineComponent("se.CanvasHistoryHandler",{construct:function(){this._initVar();this._bindGatewayEvent()},_initVar:function(){this._$elBase=$("#se_canvas_body");this._$elTitleWrapper=$("#se_title_wrapper");this._$elComponentsWrapper=$("#se_components_wrapper");this._elCanvasFragment=null;this._elTitleFragment=null},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_HISTORY.RESTORE_CANVAS,this.restoreCanvas.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_HISTORY.RESTORE_COMPONENT,this.restoreComponent.bind(this))},_prependCanvas:function(a){if(a.isDocumentTitle()){a.prependTo(this._elTitleFragment)}else{a.prependTo(this._elCanvasFragment)}},_getCompInstance:function(a){return $SE_COMPONENT_FACTORY.getComponentInstance(a)},_getModelInstance:function(a){return $SE_COMPONENT_FACTORY.getDataModelInstance(a)},_revertComponent:function(a,b){var c=a[b.compId];if(c){c.update(this._getModelInstance(b));c.focusOut();delete a[b.compId]}else{c=this._getCompInstance(b)}return c},restoreCanvas:function(a,b){var c={};var d=null;var e=null;var f=a.components;this._elCanvasFragment=document.createDocumentFragment();this._elTitleFragment=document.createDocumentFragment();this._$elBase.css("height",this._$elBase.height()+"px");var g=Array.prototype.slice.apply(f);g=g.reverse();g.forEach(function(a){d=this._revertComponent(b,a);c[d.getId()]=d;this._prependCanvas(d);if(a.focusComp){e=d}},this);this._$elTitleWrapper.get(0).innerHTML="";this._$elComponentsWrapper.get(0).innerHTML="";this._$elTitleWrapper.get(0).appendChild(this._elTitleFragment);this._$elComponentsWrapper.get(0).appendChild(this._elCanvasFragment);this._$elBase.css("height","auto");for(var h in b){b[h].destroy()}return{htComponentMap:c,oFocusComponent:e}},restoreComponent:function(a,b){var c=b.htCompMap;var d={};var e=a.compId;var f=c[e];if(f){f.update(this._getModelInstance(a))}d.htComponentMap=c;d.sFocusCompId=e;return d}});se.defineClass("se.DocumentTitleCompView",se.BaseCompView,{construct:function(){this._initVar();this._oHelper=this._initDocumentTitleTypeHelper();this._bindFunction()},_IMPL_onCreated:function(){this._oHelper&&this._oHelper.onCreated()},_IMPL_onUpdateModel:function(){var a=this._$elTitle.val();if(a.length>this._nTitleLength){a=a.substring(0,this._nTitleLength);this._$elTitle.val(a);this._onExceedTextLength()}var b=this._$elTitle[0].classList;if(b.contains("placeholder")){a=""}this._oModel.setTitle(a);this._oHelper&&this._oHelper.onUpdateModel()},_IMPL_onUpdateUI:function(){var a=this._oModel.getComponentStyle();this._$elTitle.val(this._oModel.getTitle());this._updateStyle(a);this._oHelper&&this._oHelper.onUpdateUI(this._oModel)},_IMPL_onUpdateStyle:function(a,b){var c=this._oModel.getComponentStyle();this._checkAlign(c,a);if(b){c=a}else{c=_.extend(c,a)}this._updateStyle(c);this._oHelper&&this._oHelper.onUpdateStyle(c,b)},_IMPL_onAfterRender:function(){this._assignElements();this._addDataAttributeForAutosize();this._createPlaceholder();this._oHelper&&this._oHelper.onAfterRender(this._$elContainer)},_IMPL_onAfterMountToolbar:function(){this._updateToolbarVal(this._oModel.getComponentStyle());this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this));this._oHelper&&this._oHelper.onAfterMountToolbar()},deactivateDropEvent:function(){this._oHelper&&this._oHelper.deactivateDropEvent()},activateDropEvent:function(){if(!$SE_CONFIG.SERVICE_CONFIG.IS_DROPZONE_DOCUMENT_TITLE_AVAILABLE){return}this._oHelper&&this._oHelper.activateDropEvent()},pasteHTML:function(a){if(a===""){return}var b=this._$elTitle.prop("selectionStart");var c=this._$elTitle.val();this._$elTitle.val(c.slice(0,b)+a+c.slice(b));$SE_STRING.setCaretPosition(this._$elTitle[0],b+1);this._$elTitle.trigger("input")},_IMPL_onDestroyed:function(){this._unbindEvent();this._destroyPlaceholder();this._$elTitle=null;this._$elViewArea=null;this._oHelper&&this._oHelper.onDestroyed();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this);if(this._bSuicidePrevention){this._removeSuicidePreventionLayer()}},_IMPL_onFocusIn:function(a){clearTimeout(this._timeForBlur);this._bindEvent();this._oHelper&&this._oHelper.onFocusIn(a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._fEnterHandler});this._actByPayLoad(a)},_blurIfHave:function(){if(this._isDestroyed){return}if(this._$elTitle[0]===document.activeElement){document.activeElement.blur()}},_IMPL_onFocusOut:function(){if(this._bSuicidePrevention){this._checkSuicidePrevention(this._$elTitle.val())}this._unbindEvent();this._oHelper&&this._oHelper.onFocusOut();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this);this._timeForBlur=setTimeout(this._blurIfHave.bind(this),1)},_IMPL_onRender:function(a,b){b.markupClass=this._oServiceConfig.TITLE.sMarkupClass;if(this._bSuicidePrevention){this._checkSuicidePrevention(b.title)}if(this._oHelper){return this._oHelper.onRender(a,b)}else{return a(b)}},_IMPL_onMounted:function(){this._oHelper&&this._oHelper.onMounted()},_IMPL_onResize:function(){this._oHelper&&this._oHelper.onResize()},_addDataAttributeForAutosize:function(){this._$elTitle.data("autosize",{allowEnter:this._bAllowEnter,maxLength:this._nTitleLength,onOverflow:this._fExceedTextLength})},_initVar:function(){this._oServiceConfig=$SE_CONFIG.SERVICE_CONFIG;this._nTitleLength=this._oServiceConfig.TITLE.nTextLength;this._bSuicidePrevention=this._oServiceConfig.TITLE.bSuicidePrevention;this._bSuicideAjax=false;this._oHelper=null;this._bAllowEnter=$SE_CONFIG.ENV_SETTING.SERVICE_NAME==="post";this._timeForBlur=null},_initDocumentTitleTypeHelper:function(){var a=this._oServiceConfig.TITLE.type;a=$SE_STRING.capitalize(a);if(a==="Basic"){return null}var b=new se["DocumentTitle"+a+"Helper"](this._oModel,this.getId());b.on("onAddLibrary",function(a){a.htJson["@ctype"]=$SE_CONFIG.COMP_TYPE.IMAGE;a.htJson.compId=this.getId();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ADD_LIBRARY_DATA,[a.htJson],false)}.bind(this));b.on("onRemoveLibrary",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{ids:[this.getId()]})}.bind(this));b.on("onRequestCompHistory",function(){this._requestCompHistory()}.bind(this));b.on("onFocusout",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED)}.bind(this));return b},_bindFunction:function(){this._fExceedTextLength=this._onExceedTextLength.bind(this);this._fCloseActiveDropDown=this._closeActiveDropDown.bind(this);this._fEnterHandler=this._onEnterKey.bind(this)},_assignElements:function(){this._$elTitle=$(".se_title TEXTAREA",this._$elContainer);this._$elViewArea=$(".se_viewArea",this._$elContainer);this._$elSectionArea=$(".se_sectionArea",this._$elContainer);this._$elBackgroundImgWrap=$(".se_background",this._$elContainer)},_bindEvent:function(){this._$elTitle.on("keydown",this._fCloseActiveDropDown);this._$elContainer.on("mousedown",this._fCloseActiveDropDown)},_unbindEvent:function(){this._$elTitle.off("keydown",this._fCloseActiveDropDown);this._$elContainer.off("mousedown",this._fCloseActiveDropDown)},_onExceedTextLength:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_EXCEED_MAX_TITLE_LENGTH").replace("{=MAXLENGTH}",this._nTitleLength))},_checkSuicidePrevention:function(a){var b=function(){this._bSuicideAjax=false}.bind(this);a=$.trim(a);if(!a){this._hideSuicidePreventionLayer();return}if(this._bSuicideAjax){return}else{this._bSuicideAjax=true}$SE_AJAX.request($SE_CONFIG.API.SUICIDE_PREVENTION,{type:"post",timeout:2e4,data:JSON.stringify({serviceId:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,word:a}),contentType:"application/json; charset=UTF-8",dataType:"json"},{fSuccess:function(a){if(a.result.isMatche){this._showSuicidePreventionLayer()}else{this._hideSuicidePreventionLayer()}this._bSuicideAjax=false}.bind(this),fFail:b,fError:b})},_showSuicidePreventionLayer:function(){if(!this._$elSuicidePrevention){this._$elSuicidePrevention=this._createSuicidePreventionLayer()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.SHOW_NOTICE,this._$elSuicidePrevention)},_hideSuicidePreventionLayer:function(){this._$elSuicidePrevention&&$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_NOTICE,this._$elSuicidePrevention)},_createSuicidePreventionLayer:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.CREATE_NOTICE,se.editor.template.common["prevent-suicide.hbs"]())},_removeSuicidePreventionLayer:function(){if(this._$elSuicidePrevention){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.REMOVE_NOTICE,this._$elSuicidePrevention);this._$elSuicidePrevention=null}},_closeActiveDropDown:function(a){if($(a.target).parents(".__se_fontFamily").length!==0){return}this._oToolbar.closeAllLayer()},_onClickToolbarBtn:function(a,b,c,d){a.preventDefault();switch(b){case"fontFamily":if(d){this.changeFontFamily(c)};break;case"fontSizeTitle":if(d){this.changeFontSize(c)};break;case"textAlignTitle":this.changeAlign(c);break;case"specialLetter":if(typeof c!=="string"){return}this.pasteHTML(c);break}},_updateStyle:function(a){if(a.fontFamily){this.changeFontFamily(a.fontFamily)}if(a.fontSize){this.changeFontSize(a.fontSize)}if(a.align){this.changeAlign(a.align)}this._updateToolbarVal(a)},_updateToolbarVal:function(a){this._oToolbar.changeBtnValue({fontFamily:a.fontFamily,fontSizeTitle:a.fontSize,textAlignTitle:a.align||"left"})},changeFontFamily:function(a){$SE_STYLE_HELPER.changeFontFamily(this._$elViewArea,a);this._oModel.changeComponentStyle("fontFamily",a);this.updateAutoSize(this._$elTitle);this._requestCompHistory()},changeFontSize:function(a){var b="se_fs_"+a;this._$elViewArea.removeClass("se_fs_D1 se_fs_D2 se_fs_D3");this._$elViewArea.addClass(b);this._oModel.changeComponentStyle("fontSize",a);this.updateAutoSize(this._$elTitle);this._requestCompHistory()},changeAlign:function(a){if(a==="right"||a==="justify"){return}$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionArea,a);this._oModel.changeComponentStyle("align",a);this.updateAutoSize(this._$elTitle);this._requestCompHistory()},isCursorAtStart:function(){var a=this._$elTitle.get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&b===0},isCursorAtEnd:function(){var a=this._$elTitle.get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&this.getPlainText().length===b},getPlainText:function(){return this._$elTitle.val()},canMoveUpward:function(){return false},canMoveDownward:function(){var a=parseInt(this._$elTitle.css("lineHeight"),10);var b=(this._$elTitle.height()-this._$elTitle.height())/2;var c=this._$elTitle.offset().top+this._$elTitle.height()-a-b;var d=this.currentCaretOffsetTop();return d>=c},currentCaretOffsetTop:function(){var a=this._$elTitle[0];var b=this._$elTitle.offset().top;return $SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top+b},_setCursorPosByTrigger:function(a){switch(a.trigger){case $SE_CONFIG.TRIGGER.UP:case $SE_CONFIG.TRIGGER.LEFT:this._placeCursorAtLast();break;default:if($SE_CONFIG.isEdgeBrowser===false){setTimeout(function(){this._$elTitle.focus()}.bind(this),0)}}},_actByPayLoad:function(a){if(!a){return}if(a.action===$SE_CONFIG.ACTION.DELETE){this._$elTitle.focus()}else{this._setCursorPosByTrigger(a)}},_placeCursorAtLast:function(){var a=this._$elTitle.val().length;this._$elTitle.focus();$SE_COMMON_UTIL.setSelectionRange(this._$elTitle[0],a,a)},_onEnterKey:function(){if(this._bAllowEnter&&!this.isCursorAtEnd()){return true}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.APPEND_EMPTY_LINE_WITH_FOCUS);return false}},saveSelection:function(){if(!this._bSavedCursor){this._nCursorIndex=$SE_COMMON_UTIL.getCaretPosition(this._$elTitle.get(0));this._$elTitle.blur();this._bSavedCursor=true}},restoreSelection:function(){if(this._bSavedCursor){this._$elTitle.focus();$SE_COMMON_UTIL.setCaretPosition(this._$elTitle.get(0),this._nCursorIndex);this._bSavedCursor=false}},getRepresent:function(){if(!this._oHelper){return false}return this._oHelper.getRepresent()},setRepresent:function(a){if(!this._oHelper){return false}this._oHelper.setRepresent(a)},delImg:function(){if(!this._oHelper){return false}this._oHelper._delImg()},setBackgroundMetric:function(a){var b=this._oModel;var c=b.getBackgroundImage();if(!c){return}b.setBackgroundMetric(a);this.update(b)},_createPlaceholder:function(){this._$elTitle.placeholder()},_destroyPlaceholder:function(){var a=this._$elTitle;a.trigger("destroy.placeholder")},_checkAlign:function(a,b){if(b.align==="right"||b.align==="justify"){b.align=a.align}}});se.defineComponent("se.DocumentTitleBackgroundHelper",{construct:function(a,b){this._oModel=a;this._sParentCompId=b;this._initVar();this._bindFunction();this._initImageUploadComponent();this._initDropZone()},_initImageUploadComponent:function(){this._imageFileUploaderComp=new se.ImageFileUploaderComponent({success:this.changeImage.bind(this)})},_initDropZone:function(){this._documentTitleDropZone=new se.DropZone($("#se_title_wrapper"),this._imageFileUploaderComp,"SINGLE")},deactivateDropEvent:function(){this._documentTitleDropZone.deactivateDropEvent()},activateDropEvent:function(){this._documentTitleDropZone.activateDropEvent()},onCreated:function(){},onUpdateModel:function(){},onUpdateUI:function(a){this._oModel=a;this._updateBackgroundImg()},onUpdateStyle:function(a,b){},onAfterRender:function(a){this._$elContainer=a;this._assignElements()},onAfterMountToolbar:function(){},onDestroyed:function(){this._unbindEvent();this._documentTitleDropZone.destroy();this._documentTitleDropZone=null;this._imageFileUploaderComp=null;this._$elBtnWrapper=null;this._$elBackgroundImgWrap=null},onFocusIn:function(){this._bindEvent()},onFocusOut:function(){this._unbindEvent()},onRender:function(a,b){var c;b.hasImg="";if(this._hasBackgoundImage(b)){b.hasImg="is-bg";c=this._oModel.getBackgroundImage();b.imageEditToggleClass=this._canEditImage(c)?"is-on":"";b.backgroundPositionX=c.backgroundPositionX;b.backgroundPositionY=c.backgroundPositionY}return a(b)},onMounted:function(){},onResize:function(){},_initVar:function(){this._sImgClass="is-bg";this._imageEditToggleClass="is-on";this._isBLOG=$SE_CONFIG.ENV_SETTING.IS_BLOG_SERVICE;this._isPositionerMode=false},_bindFunction:function(){this._fClickBtn=this._onClickBtn.bind(this)},_assignElements:function(){this._$elBtnWrapper=$(".se_documentTitle_btn_wrap",this._$elContainer);this._$elBtnEditImage=$(".se_editImage",this._$elBtnWrapper);this._$elBackgroundImgWrap=$(".se_background",this._$elContainer);this._$elImageEditorBtn=$(".se_btn_editImage",this._$elContainer)},_bindEvent:function(){this._$elBtnWrapper.on("click","a",this._fClickBtn)},_unbindEvent:function(){this._$elBtnWrapper.off("click")},_openUploadCloudSNSModal:function(a){a.stopPropagation();var b={compData:$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS,shouldFocus:true};var c={maxImageCount:1,fCallback:this.changeImage.bind(this)};$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,b,c)},_onClickImageEditBtn:function(){var a=this._oModel.getBackgroundImage();if(a&&this._canEditImage(a)){this._openPhotoEditor(a)}},_openPhotoEditor:function(a){var b=this._sParentCompId;var c={photos:{key:b,originalFileName:a.fileName,width:a.originalWidth,height:a.originalHeight,domain:a.domain,path:a.path,fileSize:a.fileSize,thumbnail:a.src},initKey:b,done:function(a){var b=a[0];var c={id:b.key,domain:b.domain,path:b.path,width:b.width,height:b.height,originalWidth:b.width,originalHeight:b.height,fileSize:b.fileSize,src:b.src,uploadedLocal:true,animationGIF:b.animationGIF};var d=$.extend(true,{},this._oModel.getBackgroundImage(),c);this.changeImage(d)}.bind(this)};$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.PHOTO_EDITOR.OPEN,c)},_openFileDialog:function(){var a=new se.LocalFileDialog({multiple:false},this._imageFileUploaderComp);a.open()},_getWidth:function(a){var b;if(!a){return-1}b=a.width;return b>2880?-1:b},_delImg:function(){this._oModel.setBackgroundImage(null);this._$elBackgroundImgWrap.css("background-image","");this._$elContainer.removeClass(this._sImgClass);this._$elBtnEditImage.removeClass(this._imageEditToggleClass);this.trigger("onRequestCompHistory")},changeImage:function(a){this._oModel.setBackgroundImage(a);var b=this._oModel.getBackgroundImage();var c=b.src;this._$elBackgroundImgWrap.css("background-image","url("+c+")");this._$elBackgroundImgWrap.css("background-position-x",b.backgroundPositionX);this._$elBackgroundImgWrap.css("background-position-y",b.backgroundPositionY);this._$elContainer.addClass(this._sImgClass);if(this._canEditImage(b)){this._$elBtnEditImage.addClass(this._imageEditToggleClass)}else{this._$elBtnEditImage.removeClass(this._imageEditToggleClass)}this._showTooltip();this.trigger("onAddLibrary",{htJson:b});this.trigger("onRequestCompHistory")},_onClickBtn:function(a){var b=$(a.target);if(b.length<1){return}var c=b[0].classList;if(c.contains("se_btn_changeImage")){clickcr(b,"ttl.photo","","");this._openFileDialog()}else if(c.contains("se_btn_trash")){clickcr(b,"ttl.pdel","","");this.trigger("onRemoveLibrary");this._delImg()}else if(c.contains("se_btn_movingBg")){clickcr(b,"ttl.move","","");this._mountPositioner()}else if(c.contains("se_btn_cloudSns")){clickcr(b,"ttl.sns","","");this._openUploadCloudSNSModal(a)}else if(c.contains("se_btn_editImage")){clickcr(b,"ttl.edit","","");this._onClickImageEditBtn()}this.trigger("onFocusout")},_showTooltip:function(){var a=this._$elBtnEditImage.hasClass("is-on");if(!a||this._oToolTip||$SE_COMMON_UTIL.getCookie($SE_CONFIG.COOKIE_NAMES.PHOTO_EDITOR)==="T"){return}this._createToolTip();this._oToolTip.ntooltip("openTooltip")},_createToolTip:function(){this._oToolTip=this._$elImageEditorBtn.ntooltip({type:"bottom",autoClose:true,message:"새로운 이미지편집기를<br>사용해 보세요!"})},_mountPositioner:function(){
$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.IMAGE_POSITIONER.MOUNT_POSITIONER,{compId:this._getParentCompId(),image:this._$elBackgroundImgWrap[0],data:this._getPositioningInfo()});this.deactivateDropEvent();this._isPositionerMode=true},_getParentCompId:function(){return this._sParentCompId},_getPositioningInfo:function(){return this._oModel.getPositioningInfo()},_updateBackgroundImg:function(){if(this._isPositionerMode){this.activateDropEvent();this._isPositionerMode=false}var a=this._oModel;var b=a.getBackgroundImage();if(b&&b.src){this.changeImage(b)}else{this._oModel.setBackgroundImage(null);this._$elBackgroundImgWrap.css("background-image","");this._$elContainer.removeClass(this._sImgClass);this._$elBtnEditImage.removeClass(this._imageEditToggleClass)}},_hasBackgoundImage:function(a){return $.trim(a.background.image&&a.background.image.src)!==""},getRepresent:function(){return this._oModel.getBackground().image.getRepresent()},setRepresent:function(a){this._oModel.getBackground().image.setRepresent(a)},_canEditImage:function(a){return a.uploadedLocal&&!a.animationGIF}});se.defineClass("se.ImageCompView",se.BaseCompView,{VR360:{MESSAGE:'<div class="ico_360vr __se_360vr_ico"><span class="blind">이 이미지는 360도 VR 이미지 입니다</span></div>',PANORAMA_BUTTON:'<div class="se_btn_360vr_toggle_wrap"><button type="button" class="se_btn_360vr_toggle __se_btn_360vr_toggle is-on"><span class="blind">360vr이미지 또는 파노라마 이미지 적용/해제</span></button></div>'},construct:function(a,b,c){_.extendOwn(this,se.ImageCompMixIn);this._oModel=a;this._oToolbar=b;this._callback=c||{onLoaded:function(){}}},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elCaptionWrap=this._$elContainer.find(".se_viewArea");this._$elImageArea=this._$elCaptionWrap.find(".__subComp");this._$elCaptionArea=this._$elCaptionWrap.find(".__se_caption_wrap");this._$elVR360Ico=null;this._$elPanoramaButton=null},_controlClassIfVR360:function(){this._setVR360UI();this._setPanoramaUI()},_setVR360UI:function(){if(this._oModel.isVR360AvailableBy(this._oModel.getDisplayFormat())){this._$elContainer.addClass("se_360vr");if(!this._$elVR360Ico){this._$elImageArea.append(this.VR360.MESSAGE);this._$elVR360Ico=this._$elImageArea.find(".__se_360vr_ico")}}else{this._$elContainer.removeClass("se_360vr");this._$elContainer.find(".__se_360vr_ico").remove();this._$elVR360Ico=null}},_setPanoramaUI:function(){if(this._oModel.isPanoramaImageBy(this._oModel.getGenerationFormat())){if(!this._$elPanoramaButton){this._$elImageArea.append(this.VR360.PANORAMA_BUTTON);this._$elPanoramaButton=this._$elCaptionWrap.find(".__se_btn_360vr_toggle")}if(this._oModel.getDisplayFormat()===$SE_CONFIG.IMAGE.FORMAT.PANORAMA){this._$elPanoramaButton.addClass("is-on")}else{this._$elPanoramaButton.removeClass("is-on")}}else{this._$elContainer.find(".se_btn_360vr_toggle_wrap").remove();this._$elPanoramaButton=null}},_bindEventsAtOnce:function(){this._$elSectionWrap.on("mousedown",this._onMouseDownSectionWrap.bind(this));this._$elImageArea.on("click",".__se_btn_360vr_toggle",this._onTogglePanoramaButton.bind(this))},_bindEvent:function(){this._$elImageArea.on("dblclick",this._onDoubleClickImageView.bind(this))},_onDoubleClickImageView:function(){this.switchBetweenChangeAndEdit(this._changedImage.bind(this))},_onTogglePanoramaButton:function(){var a=$SE_CONFIG.IMAGE.FORMAT.NORMAL;var b=$SE_CONFIG.IMAGE.FORMAT.PANORAMA;var c,d;if(this._oModel.getDisplayFormat()===a){this._resetImageView();this._oModel.setDisplayFormat(b);c=this._oModel.getJson();d=this._oModel.getSrcByFormat(c,b);this._$elContainer.addClass("se_360vr");this._$elPanoramaButton.addClass("is-on");clickcr(this,"pht.panoramaon","","")}else if(this._oModel.getDisplayFormat()===b){this._oModel.setDisplayFormat(a);c=this._oModel.getJson();d=this._oModel.getSrcByFormat(c,a);this._$elContainer.removeClass("se_360vr");this._$elPanoramaButton.removeClass("is-on");clickcr(this,"pht.panoramaoff","","")}this._oModel.setSrc(d);this.updateUIWithModel(this._oModel);this._requestCompHistory()},_unbindEvent:function(){this._$elImageArea.off("dblclick")},_onMouseDownSectionWrap:function(){this._oToolbar.closeActiveButton();this._captionView.blur()},changeToWrapComp:function(a){if(this._oModel.isVR360AvailableBy(this._oModel.getGenerationFormat())){this._warnSmallVR360()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.WRAP_COMPONENT,{id:this.getId(),layout:a})},_handleByGroup:function(a,b){switch(a){case"delete":this._handleClickDelete();break;case"link":this.handleClickLink(b);break;case"specialLetter":this._onClickSpecialLetter(b);break;case"image":this.changeImage();break;case"imageEdit":this.openPhotoEditor();break;case"imageAlign":this._onClickImageLayout(b);break;case"imageDisplay":this._onClickImageLayout(b);break;case"wrapAround":this._setTimeoutForIE(this.changeToWrapComp.bind(this,b));break;case"mediaResize":this._onClickResizeImage(b);break;case"mediaTag":this._mediaTagManager&&this._mediaTagManager.handleClickMediaTag(function(){this.toggleLinkToolbar();this._requestCompHistory()}.bind(this));break}},toggleLinkToolbar:function(){if(!this._mediaTagManager){return}if(this._oModel.isEmptyMediaTag()){this._oToolbar.enableButton(["link"])}else{this._oToolbar.disableButton(["link"])}},_handleClickDelete:function(){if(!this._mediaTagManager||this._oModel.isEmptyMediaTag()||this._mediaTagManager.confirmDeleteImage()){this._setTimeoutForIE(this._onClickDeleteBtn.bind(this),4)}},_onClickDeleteBtn:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},_onClickSpecialLetter:function(a){if(typeof a!=="string"){return}this.pasteHTML(a)},_onClickImageLayout:function(a){this._updateAlignDisplayBy(a);this._resizeTextArea();this._captionView.updateHeight();this._requestCompHistory()},_onClickResizeImage:function(a){if(a===null){return}if(this._mediaTagManager&&!this._oModel.isEmptyMediaTag()&&!this._mediaTagManager.confirmResizeImage()){return}this._requestCompHistory();this._mediaTagManager&&this._mediaTagManager.updateMediaTags([]);if(a.type==="resize"){this._resizeImageView(a.mediaSize)}else if(a.type==="reset"){this._resetImageView()}},_setTimeoutForIE:function(a,b){var c=b||1;setTimeout(a,c)},_resetImageView:function(){var a;this._oModel.resetDisplaySize();a=this._oModel.getDefaultAlignWithWidth();this._handleByGroup("imageAlign",a);this._updateToolbar(true)},_resizeImageView:function(a){var b=this._oModel;var c=b.getAlign();if(b.isBigImageAlign(c)||b.isJustifyAlign(c)){c=b.getDefaultSmallImageAlign()}b.changeDisplaySize(a.width,a.height);this._handleByGroup("imageAlign",c);this._updateToolbar(true)},handleClickToolbar:function(a,b,c){this._handleByGroup(b,c)},_makeImageView:function(){var a;if($SE_CONFIG.ENV_SETTING.IS_GP_SERVICE){a=$SE_CONFIG.ENV_SETTING.IMAGE_DOMAIN+this._oModel.getPath()}else{a=this._oModel.getSrc()}return new se.ImageSubCompView({template:se.editor.template.canvas["imageView.hbs"],state:{src:a,width:this._oModel.getWidth(),height:this._oModel.getHeight(),originalWidth:this._oModel.getOriginalWidth(),originalHeight:this._oModel.getOriginalHeight()},focus:this.isFocused(),events:{onLoadedSuccess:this._onLoadedSuccess.bind(this),onLoadedFailed:this._onLoadedFailed.bind(this)}})},_onLoadedSuccess:function(a){if(a.hasFocus){this.compromiseScrollHeight()}var b=this.getModel();if(b&&(b.getWidth()==0||b.getHeight()==0)){this._updateImageModel(true,a.width,a.height);this._updateImageModelWithOriginal(a.originalWidth,a.originalHeight)}this._resizeTextArea();this._callback.onLoaded.call(this)},_onLoadedFailed:function(){var a=this._oModel.getUploadedLocal();if(!a){this._updateImageModel();this._updateUI()}},_makeCaptionView:function(){return new se.CaptionSubCompView({template:se.editor.template.canvas["captionView.hbs"],state:{caption:this._oModel.getCaption(),placeholder:se.i18n.getMsg("MSG_IMAGE_PLACEHOLDER")}})},_updateToolbar:function(a){if(this._bFocused===false){return}var b=this._buttonSetPolicy.getButtonSet(this._oModel);this._oToolbar.changeActiveBtns(b);if(!a){b=b[3]}this._oToolbar.changeBtnValue(this._getActiveButton(b));this.toggleLinkToolbar()},_onEnterCaption:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.APPEND_EMPTY_LINE_WITH_FOCUS);return false},_IMPL_onAfterRender:function(){this._assignElements();this._controlClassIfVR360();this._bindEventsAtOnce();if($SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG){var a={$container:this._$elContainer,$imageWrap:this._$elImageArea};this._mediaTagManager=new se.MediaTagManager(this._oModel,a)}var b=this._makeImageView();var c=this._makeCaptionView();b.appendTo(this._$elImageArea);c.appendTo(this._$elCaptionArea);if(!$SE_CONFIG.SERVICE_CONFIG.IS_CAPTION_AVAILABLE){this._$elCaptionArea.css("display","none")}this._captionView=c;this._imageView=b;this._mediaTagManager&&this._mediaTagManager.init()},_IMPL_onAfterMountToolbar:function(){var a=this._buttonSetPolicy.getButtonSet(this._oModel);this._oToolbar.changeBtnValue(this._getActiveButton(a));this._oToolbar.setBtnClickEventListener(this.handleClickToolbar.bind(this))},_getActiveButton:function(a){var b={link:this._oModel.getLink()||"",wrapAround:""};var c=this._getActiveAlignButtonGroup(a);b[c]=this._oModel.getAlign();return b},_getActiveAlignButtonGroup:function(a){if(a instanceof Array===false){a=[a]}var b=-1;b=Math.max(_.indexOf(a,"imageAlign"),_.indexOf(a,"imageDisplay"));return a[b]},_changedImage:function(a){if(this.getId()===null){return}this._syncModelWithUI();this.reRenderBy(a);this._resizeTextArea();this._updateToolbar();this._updateAlignDisplayBy(this._oModel.getAlign());this._resetCaptionLink();if(this._mediaTagManager){this._oModel.resetMediaTags();this._mediaTagManager.init(this._oModel)}this._requestCompHistory()},_resetCaptionLink:function(){if(this._oModel.getCaptionLink()!==""){this._oModel.setCaptionLink("")}},_updateAlignDisplayBy:function(a){this._captionView.setValue(this._captionView.getValue());$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a);this._oModel.setAlign(a)},_workAroundIE10RenderingIssue:function(){setTimeout(function(){if(this._captionView){this._captionView.setValue(this._captionView.getValue())}}.bind(this),500)},_resizeTextArea:function(){if(!this._oModel){return}var a=this._oModel.getAlign();var b=this._$elCaptionWrap;if(a==="left"||a==="right"||a==="center"){var c=this._oModel.getWidth();if(b.css("maxWidth")===c){return}b.css("maxWidth",c)}else{b.css("maxWidth","")}},addSubComponent:function(a,b,c,d){var e=se.ComponentComposer;var f=this.getModelDataAsJson();var g=$.extend({},a);var h=g.compId;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT_BY_ID,h,true);if(!d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.REMOVE_LIBRARY_PANEL_DATA,[f],false)}if(!c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY)}var i=e.getMergedComponentData({htTargetComp:a,htBaseComp:f,nInsertIndex:b});var j=new se.ImageStripModel(i);this._filterCompData(j);var k=this._proceedReplacement(j.getJson());$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ENABLE_CHANGE_LIBRARY);clickcr(self,"sbs.generate","","");return k},_filterCompData:function(a){if(a.checkHasVR360Image()){this._warnSmallVR360()}a.changeDisplayFormatNormalComponents()},_warnSmallVR360:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_IMAGE_SMALL_VR360_WARN"))},_proceedReplacement:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{action:$SE_CONFIG.ACTION.COMPOSE,trigger:$SE_CONFIG.TRIGGER.DRAG,target:this,compData:a,shouldFocus:true,shouldUpdateLibrary:false})[0];return b},_IMPL_onResize:function(){this._resizeTextArea()},_syncModelWithUI:function(){this._oModel.setAlign($SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap));this._oModel.setCaption(this._captionView.getValue())},_changeImage:function(a,b,c){this._imageView.changeSrc(a);this._imageView.changeSize(b,c);this._imageView.changeOriginalSize(b,c);this._controlClassIfVR360()},_changeCaption:function(a){if(!this._captionView){return}this._captionView.setValue(a)},pasteHTML:function(a){this._captionView.pasteHTML(a)},_IMPL_onUpdateModel:function(){this._syncModelWithUI()},_updateUI:function(a){this.changeModel(a);this._updateAlignDisplayBy(this._oModel.getAlign());this.updateUIWithModel(this._oModel);this._resizeTextArea();this._captionView.updateHeight()},changeModel:function(a){if(a){this._oModel=a}},getPlainText:function(){return this._captionView.getValue()},_IMPL_onUpdateUI:function(a){a=a||this._oModel;this._updateUI(a);if(this._mediaTagManager&&this._mediaTagManager.isPointAvailable&&this._oModel.isModifyPhotoEditor()){this._oModel.resetMediaTags()}this._mediaTagManager&&this._mediaTagManager.init(this._oModel)},_IMPL_onUpdateStyle:function(a){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._oModel.setAlign(a.align);this._updateToolbar();this._resizeTextArea();this._workAroundIE10RenderingIssue()}},_deallocateVar:function(){this._$elSectionWrap=null},_destroy:function(){this._IMPL_onFocusOut();this._captionView.destroy();this._mediaTagManager&&this._mediaTagManager.destroy()},_IMPL_onDestroyed:function(){this._destroy();this._deallocateVar();this.closeUploadPopupWithMessage()},_IMPL_onFocusIn:function(){this._bindEvent();this._captionView.focusIn();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._onEnterCaption.bind(this)});this.toggleLinkToolbar()},_IMPL_onFocusOut:function(){this._captionView.focusOut();this._unbindEvent();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this);this._oToolbar.enableButton(["link"])}});se.defineClass("se.QuotationCompView",se.BaseCompView,{construct:function(a){_.extendOwn(this,se.QuotationCompMixIn);this._initVar();this._oModel=a},_initVar:function(){this._quotationView=null},_assignElements:function(){},_bindEvent:function(){this._quotationView.enableEvents()},_unbindEvent:function(){this._quotationView.disableEvents()},canMoveUpward:function(){var a=this._getLineHeightByInt();var b=this._getFirstLineTop();var c=this.currentCaretOffsetTop();c=this._fixCaretTop(c,a);return c<=b},canMoveDownward:function(){var a=this._getLineHeightByInt();var b=(this._getContainerHeight()-this._getEditableHeight())/2;var c=this._getLastLineBottom(a,b);var d=this.currentCaretOffsetTop();return d>=c},currentCaretOffsetTop:function(){var a=this._getEditable()[0];var b=this._getQuotationContainer().offset().top;return $SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top+b},getPlainText:function(){return this._getValue()},_IMPL_onAfterRender:function(){this._assignContainer();this._composeSubViews(this._getQuotationContainer().find(".__editArea"))},_IMPL_onAfterMountToolbar:function(){this._updateToolbar();this._oToolbar.setBtnClickEventListener(this._onClickToolBar.bind(this))},_IMPL_onRender:function(a,b){var c=$.extend(true,{},b);if(!c.componentStyle.fontSize){c.componentStyle.fontSize=this.getQuotationDefaultFontSize()}return a(c)},_IMPL_onUpdateModel:function(){this._updateModelFromSubView()},_IMPL_onUpdateUI:function(){this.updateUIWithModel()},_IMPL_onUpdateStyle:function(a,b){var c=this._getComponentStyleFromModel();if(b){c.fontColor=""}else{if(a.fontColor){c.fontColor=a.fontColor}}},_IMPL_onFocusIn:function(a){this._focusInQuotationView(a);this._bindEvent();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this);this._processByPayLoad(a)},_IMPL_onFocusOut:function(){this._unbindEvent();this._focusOutQuotationView();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._destroyQuotationView()},_IMPL_onRefineDataByTheme:function(a){var b=this.getQuotationType(this.getModel().getLayout());var c=this.supportThemeList.indexOf(a)>=0;var d=this.supportTypeList.indexOf(b)>=0;if(!c&&!d){this._changeType(this.TYPES.DEFAULT);this.updateModel();this.update()}},_handleByGroup:function(a,b,c){if(a==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}else if(a==="wrapAroundWithClear"){if(b==="default"){return}setTimeout(this.changeToWrapComp.bind(this,b),1);return}if(a==="blockquote"){this._changeType(b)}else if(a==="specialLetter"){if(typeof b!=="string"){return}this._pasteHTML(b);this.updateModel();this._requestCompHistory();return}else if(a==="fontSizeParagraph"&&c){this._fontSizeChanged=true;this._setFontSize(b)}this.updateModel();this.update();this._requestCompHistory()},_fixCaretTop:function(a,b){return a+(this._getContainerHeight()-this._getEditableHeight())/2-b},_getContainerHeight:function(){return this._getQuotationContainer().height()},_processByPayLoad:function(a){switch(a.action){case $SE_CONFIG.ACTION.MOVE:if(this._isFocusFromUp(a)){this._placeCursorAtStart()}else if(this._isFromDown(a)){this._placeCursorAtEnd()}else if(this._isFromDrag(a.trigger)){this._placeCursorAtStart()}break;case $SE_CONFIG.ACTION.PASTE:this._placeCursorAtEnd();break;default:if(this._shouldPutCaretAtLast(a)){this._placeCursorAtEnd()}else{this._focusEditable()}}},changeToWrapComp:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.WRAP_COMPONENT,{id:this.getId(),layout:a})},_assignContainer:function(){var a=this.getContainerWrappingElement();this._setQuotationContainer(a);this._setLayoutClassContainer(a)},_composeSubViews:function(a){var b=this._makeQuotationView();b.appendTo(a);this._quotationView=b},_getEventsForQuotationView:function(){return{mousedown:function(){this._onMousedown()}.bind(this),closeToolbarLayer:function(a){this._closeToolbarLayer()}.bind(this),updateAutoSize:function(a){this._updateAutoSize(a)}.bind(this)}},_onMousedown:function(){this._closeToolbarLayer()},_updateModelFromSubView:function(){this._updateComponentStyle();this._updateValue()}});se.defineClass("se.ScheduleCompView",se.BaseCompView,{construct:function(){this._initVar()},_initVar:function(){this._fTplViewArea=se.editor.template.canvas["schedule-component-viewArea.hbs"];Handlebars.registerPartial("schedule-component-viewArea",this._fTplViewArea)},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elViewArea=this._$elContainer.find(".se_viewArea")},_bindEvent:function(){this._$elContainer.on("dblclick",this._openScheduleLayer.bind(this))},_unbindEvent:function(){this._$elContainer.off("dblclick")},_convertDataForTpl:function(a){a=a||this._oModel.getJson();var b=JSON.parse(JSON.stringify(a));moment.locale($SE_CONFIG.LOCALE.KO,{meridiem:function(a,b,c){if(a<12){return"오전"}else{return"오후"}},weekdaysShort:"일.월.화.수.목.금.토".split(".")});var c=$SE_TIME_UTIL.getFormattedDateTimeForSchedule(b.startDateTime,b.endDateTime,b.isAllDay);if(c.endDate){if(c.startDate===c.endDate){if(!b.isAllDay){b.dateGroupClass="is-sameDate"}}else{b.dateGroupClass="is-endDate"}}if(c.diffFromNow<0){b.layout="default is-closed"}else if(c.dday>0&&c.dday<31){b.layout="default is-dDay"}b=_.extend(b,c);if(b.description){b.description=$SE_STRING.replaceSpecialChar(b.description).replace(/\n/gi,"<br/>")}b.detailExist=b.description||b.link;return b},_IMPL_onRender:function(a,b){return a(this._convertDataForTpl(b))},_IMPL_onAfterRender:function(){this._assignElements();this._createStaticMapView()},_createStaticMapView:function(){var a=this._oModel.getLocationMap();if(a){this._staticMapView=new se.StaticMapSubCompView({state:{thumbnailSrc:a.getThumbnailSrc()},props:{centerPos:a.getCenterPos(),zoomLevel:a.getZoomLevel(),searchEngine:a.getSearchEngine()}});this._staticMapView.appendTo(this._$elViewArea.find(".se_schedule_box"));this._staticMapView.show()}},_destroyStaticMapView:function(){if(this._staticMapView){this._staticMapView.destroy();this._staticMapView=null}},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getComponentStyle();this._updateToolbar(a.align);this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_updateToolbar:function(a){a=a||"left";this._oToolbar.changeActiveBtns(["schedule","componentAlign","delete"]);this._oToolbar.changeBtnValue({componentAlign:a})},_onClickToolbarBtn:function(a,b,c){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)}else if(b==="schedule"){this._openScheduleLayer()}else if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,c);this._IMPL_onUpdateModel();this._requestCompHistory()}},_openScheduleLayer:function(){clickcr(this._$elContainer,"scd.edit","","",null);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,{compData:this._oModel.getJson(),fCallback:this._onEdit.bind(this)})},_onEdit:function(a){this._oModel=new se.ScheduleModel(a.compData);this._IMPL_onUpdateUI();this._requestCompHistory()},_IMPL_onUpdateModel:function(){var a=this._oModel.getComponentStyle();var b=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);a.align=b;this._oModel.setComponentStyle(a)},_IMPL_onUpdateUI:function(){this._updateViewArea();this.updateStyle(this._oModel.getComponentStyle())},_updateViewArea:function(){this._destroyStaticMapView();var a=this._convertDataForTpl();this._$elContainer.removeClass("default is-dDay is-closed").addClass(a.layout);this._$elViewArea.html(this._fTplViewArea(a));this._createStaticMapView()},_IMPL_onUpdateStyle:function(a,b){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._updateToolbar(a.align);this._oModel.setComponentStyle(a)}},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()},_IMPL_onDestroyed:function(){this._destroyStaticMapView();this._$elSectionWrap=null;this._$elViewArea=null}});se.defineClass("se.MapCompView",se.BaseCompView,{construct:function(a){this._initVar();this._oModel=a},_initVar:function(){this._htElement={};this._aHandledElementName=[];this._oMapView=null},_assignElements:function(){var a={};var b=this._$elContainer;a.$elContainer=b;a.$elToorbarList=b.find(".se_toolbar_list");a.$elSectionWrap=b.find(".__se_section");this._htElement=a},_bindEvent:function(){},_unassignElements:function(){this._htElement=null},_unbindEvent:function(){var a;var b=this._aHandledElementName.length;var c;for(a=b;a--;){c=this._htElement["$el"+this._aHandledElementName[a]];c.off()}this._aHandledElementName=[]},_composeSubViews:function(a){var b=this._makeMapView();b.appendTo(a);this._oMapView=b},_makeMapView:function(){return new se.MapSubCompView({state:{searchEngine:this._oModel.getSearchEngine(),centerPos:this._oModel.getCenterPos().getJson(),zoomLevel:this._oModel.getZoomLevel(),objectId:this._oModel.getObjectId(),layout:this._oModel.getLayout(),thumbnailSrc:this._oModel.getThumbnailSrc(),title:this._oModel.getTitle(),address:this._oModel.getAddress()},events:{updateStaticMapInModel:function(a,b){this._updateStaticMapInModel(b)}.bind(this),setLayoutType:function(a,b){this._changeClassOnContainer(b)}.bind(this)}})},_onClickToolbarBtn:function(a,b,c){a.preventDefault();var d=$(a.currentTarget);var e=d.data("group");var f;var g;if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(e==="map"){f=d.data("value")}else if(e==="componentAlign"){g=c}if(f||g){this._changeLayoutByToolbar({nButtonStatus:f,sAlign:g})}},_setAlign:function(a,b){if(this._htElement.$elSectionWrap){$SE_STYLE_HELPER.changeAlignClassName(this._htElement.$elSectionWrap,a)}var c=b&&typeof b.bSkipUpdate!=="undefined"?b.bSkipUpdate:false;if(c){return}var d=this._oModel.getComponentStyle();d.align=a;var e=b&&typeof b.oModel!=="undefined"?b.oModel:this._oModel;e.setComponentStyle(d)},_changeClassOnContainer:function(a){var b=a.currentTypeKey;var c=a.replacedTypeKey;var d=this._htElement.$elContainer;if(!d||!d[0]){return}if(b){d.removeClass($SE_CONFIG.MAP.COMP_CLASS[b])}d.addClass($SE_CONFIG.MAP.COMP_CLASS[c])},_updateLibraryModel:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_LIBRARY_MODEL,[this._oModel.getJson()])},_updateStaticMapInModel:function(a){this._setThumbnail(a);this._updateLibraryModel()},_setThumbnail:function(a){var b=a.thumbnailSrc;this._oModel.setThumbnail(new se.SimpleThumbnailModel({"@ctype":"simpleThumbnail",src:b}));this._oModel.setThumbnailSrc(b)},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getLayout();var b=null;var c={};switch(a){case $SE_CONFIG.MAP.LAYOUT_TYPE.IMAGE:{b=$SE_CONFIG.MAP.TYPE_KEY.IMAGE;break}case $SE_CONFIG.MAP.LAYOUT_TYPE.TEXT:{b=$SE_CONFIG.MAP.TYPE_KEY.TEXT;var d=this._oModel.getComponentStyle().align||"left";c.componentAlign=d;break}}c.map=$SE_CONFIG.MAP.BUTTON_STATUS[b];this._oToolbar.changeBtnValue(c);this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onUpdateUI:function(){var a=this._oModel.getLayout();var b=this._oMapView.getTypeKeyByLayoutType(a);var c=["map","delete"];var d={};this._oMapView.setLayoutType(a);if(b===$SE_CONFIG.MAP.TYPE_KEY.TEXT){c.push("componentAlign");this._oToolbar.changeActiveBtns(c);var e=this._oModel.getComponentStyle().align||"left";d.componentAlign=e}this._oToolbar.changeActiveBtns(c);d.map=$SE_CONFIG.MAP.BUTTON_STATUS[b];this._oToolbar.changeBtnValue(d);this._setAlign(d.componentAlign,{bSkipUpdate:true})},_IMPL_onUpdateStyle:function(a,b){if(a.align){var c=a.align;this._setAlign(c);this._oToolbar.changeBtnValue({componentAlign:c})}},_IMPL_onUpdateModel:function(){},_IMPL_onAfterRender:function(){this._composeSubViews(this._$elContainer.find(".__editArea"));this._oMapView.setLayoutType(this._oModel.getLayout());this._assignElements()},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()},_IMPL_onDestroyed:function(){this._unbindEvent();this._unassignElements()},_changeLayoutByToolbar:function(a){var b=a.nButtonStatus||null;var c=a.sAlign||null;var d;var e=this._oModel.getJson();var f=$SE_COMPONENT_FACTORY.getDataModelInstance(e);if(b){var g;switch(b){case $SE_CONFIG.MAP.BUTTON_STATUS.IMAGE:{g=$SE_CONFIG.MAP.TYPE_KEY.IMAGE;break}case $SE_CONFIG.MAP.BUTTON_STATUS.TEXT:{g=$SE_CONFIG.MAP.TYPE_KEY.TEXT;break}}d=$SE_CONFIG.MAP.LAYOUT_TYPE[g];if(this._oModel.getLayout()===d){return}f.setLayout(d)}else if(c){this._setAlign(c,{oModel:f})}this.update(f);this._oModel=f;this._requestCompHistory()}});se.defineClass("se.SectionTitleCompView",se.BaseCompView,{construct:function(){this._onEnterInputTitle=this._onEnterInputTitle.bind(this);this._onKeyDownDelete=this._onKeyDownDelete.bind(this,this.isCursorAtEnd.bind(this));this._onKeyDownBackspace=this._onKeyDownBackspace.bind(this,this.isCursorAtStart.bind(this))},_assignElements:function(){this._$elSectionArea=this._$elContainer.find(".se_sectionArea");this._$elViewArea=this._$elContainer.find(".__se_viewArea");this._$elFontSize=this._$elContainer.find(".__se_font_size");this._$elTitleInput=this._$elContainer.find(".__se_title_input")},_bindEvent:function(){this._$elTitleInput.on("click."+this.getId(),function(){this._oToolbar.closeActiveButton()}.bind(this))},_unbindEvent:function(){this._$elTitleInput.off(this.getId())},_createPlaceholder:function(){this._$elTitleInput.placeholder()},_destroyPlaceholder:function(){var a=this._$elTitleInput;a.trigger("destroy.placeholder")},_appendContents:function(a){var b=this._$elTitleInput.val();var c=this._$elTitleInput[0];var d=$SE_COMMON_UTIL.getCaretPosition(c);if(a){this._$elTitleInput.val(b+a)}$SE_COMMON_UTIL.setSelectionRange(c,d,d)},_placeCursorAtLast:function(){var a=this._$elTitleInput.val().length;this._$elTitleInput.focus();$SE_COMMON_UTIL.setSelectionRange(this._$elTitleInput[0],a,a)},_placeCursorAtFirst:function(){this._$elTitleInput.focus();$SE_COMMON_UTIL.setSelectionRange(this._$elTitleInput[0],0,0)},_appendParagraph:function(){var a=this._$elTitleInput;var b=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.PARAGRAPH);var c=$SE_TEXT_HELPER.splitTitleAtCaret(a);a.val(c.prev);b.value=c.next;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:b,shouldFocus:true})},_hasNextParagraph:function(a){return a&&a.getCompType()===$SE_CONFIG.COMP_TYPE.PARAGRAPH},_moveFocusToNextParagraph:function(a){var b=this._$elTitleInput;var c=$SE_TEXT_HELPER.splitTitleAtCaret(b);b.val(c.prev);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,a,{from:$SE_CONFIG.COMP_TYPE.SECTION_TITLE,trigger:$SE_CONFIG.TRIGGER.ENTER,action:$SE_CONFIG.ACTION.MOVE,contents:c.next})},_focusNextParagraph:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,this.getId());this._requestCompHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DISABLED_PUSH_HISTORY);if(this._hasNextParagraph(a)){this._moveFocusToNextParagraph(a)}else{this._appendParagraph()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ENABLED_PUSH_HISTORY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY)},_onEnterInputTitle:function(){if(this.isCursorAtEnd()){this._focusNextParagraph();return false}return true},_deleteComponent:function(){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)},_onClickToolbarBtn:function(a,b,c,d){var e=$(a.target);switch(b){case"fontSize":if(!d){return}if(this._isHeaderFontSize(c)){this.changeHeadingLevel(c)}else{this._changeToParagraph(c)}break;case"fontFamily":if(d){this.changeFont(e.data("value"))}break;case"bold":this.applyBold(c);break;case"underline":this.applyUnderline(c);break;case"italic":this.applyItalic(c);break;case"fontColor":if(d){this.changeFontColor(c)}break;case"textAlign":case"textAlignGroup":if(!d){return false}this.changeAlign(c);break;case"lineHeight":if(!d){return false}this._changeLineHeight(c);break;case"specialLetter":if(typeof c!=="string"){return}this.pasteHTML(c);break;case"delete":this._deleteComponent();return}},isCursorAtStart:function(){var a=this._$elTitleInput.get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&b===0},isCursorAtEnd:function(){var a=this._$elTitleInput.get(0);var b=a.selectionStart;var c=a.selectionEnd;return b===c&&this.getPlainText().length===b},_changeLineHeight:function(a){var b=this._$elViewArea;if(a===""){b.css("lineHeight","")}else{b.css("lineHeight",a+"%")}this.updateAutoSize(this._$elTitleInput);this._setComponentStyle("lineHeight",a||"")},_getLineHeight:function(){var a=parseInt(this._$elTitleInput.css("lineHeight"),10);if(isNaN(a)){a=43}return a},_getFirstLineTop:function(){return this._$elTitleInput.offset().top},_getLastLineBottom:function(a,b){return this._$elTitleInput.offset().top+this._$elTitleInput.height()-a-b},_fixCaretTop:function(a,b){return a+(this._$elContainer.height()-this._$elTitleInput.height())/2-b},canMoveUpward:function(){var a=this._getLineHeight();var b=this._getFirstLineTop();var c=this.currentCaretOffsetTop();c=this._fixCaretTop(c,a);return c<=b},canMoveDownward:function(){var a=this._getLineHeight();var b=(this._$elContainer.height()-this._$elTitleInput.height())/2;var c=this._getLastLineBottom(a,b);var d=this.currentCaretOffsetTop();return d>=c},currentCaretOffsetTop:function(){var a=this._$elTitleInput[0];var b=this._$elTitleInput.offset().top;return $SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top+b},_isHeaderFontSize:function(a){if(a&&a.indexOf("H")!=-1){return true}return false},_changeToParagraph:function(a){var b=this._getConvertedParagraphData(a);setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{target:this,compData:b,trigger:$SE_CONFIG.TRIGGER.CHANGE,shouldFocus:true})}.bind(this),1)},_getConvertedParagraphData:function(a){
var b=this.getModelDataAsJson().title;var c=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.PARAGRAPH);var d=a===c.componentStyle.fontSize;var e=$SE_COMMON_UTIL.escapeHtml(b);if(e){e=e.replace(/(.+)(\n)?/g,function(b,c,e){return this._makeParagraphValue(c,a,d,e)}.bind(this))}else if(!d){e=this._makeParagraphValue("\ufeff",a,d)}c.value=e;return c},_makeParagraphValue:function(a,b,c,d){var e=d?"<br>":"";var f=c?"":' class="se_fs_'+b+'"';return"<span"+f+">"+a+e+"</span>"},_IMPL_onRender:function(a,b){var c=$.extend(true,{},b),d=c.componentStyle;d.fontBold=d.fontBold?"se_fw_bold":"";d.fontUnderline=d.fontUnderline?"underline":"inherit";d.fontItalic=d.fontItalic?"italic":"inherit";d.fontSize=d.fontSize;d.fontColor=d.fontColor||"";c.componentStyle=d;return a(c)},_addDataAttributeForAutosize:function(){this._$elTitleInput.data("autosize",{allowEnter:true})},_IMPL_onAfterRender:function(){this._assignElements();this._addDataAttributeForAutosize();this._createPlaceholder()},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue(this._makeBtnStates());this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onResize:function(){},_makeBtnStates:function(){var a=$.extend(true,{},this._oModel.getJson()),b=a.componentStyle,c={fontFamily:b.fontFamily,fontColor:b.fontColor,fontSize:b.fontSize,bold:b.fontBold,underline:b.fontUnderline,italic:b.fontItalic,lineHeight:b.lineHeight};if(se.CanvasRectHelper.isMobileViewPort()){c.textAlignGroupForSectionTitle=b.align}else{c.textAlignForSectionTitle=b.align}var d=$SE_STYLE_HELPER.convertRgbToHex(window.getComputedStyle(this._$elViewArea.get(0)).color);if(!c.fontColor||c.fontColor===""){c.fontColor=d}if(!c.lineHeight){c.lineHeight=""}return c},_shouldMergeWithNext:function(a){return a.trigger===$SE_CONFIG.TRIGGER.DELETE||a.trigger===$SE_CONFIG.TRIGGER.BACKSPACE},_shouldPutCaretAtLast:function(a){return a.trigger===$SE_CONFIG.TRIGGER.BACKSPACE},_isFromDrag:function(a){return $SE_CONFIG.TRIGGER.DRAG===a},_processByPayLoad:function(a){switch(a.action){case $SE_CONFIG.ACTION.DELETE_ON_EDITABLE:if(this._shouldMergeWithNext(a)){this._appendContents($("<div>").html(a.contents).text())}break;case $SE_CONFIG.ACTION.MOVE:if(this._isFocusFromUp(a)){this._placeCursorAtFirst()}else if(this._isFromDown(a)){this._placeCursorAtLast()}else if(this._isFromDrag(a.trigger)){this._placeCursorAtFirst()}break;case $SE_CONFIG.ACTION.RESTORE:case $SE_CONFIG.ACTION.REPLACE:case $SE_CONFIG.ACTION.INSERT:case $SE_CONFIG.ACTION.PASTE:this._placeCursorAtLast();break;default:if(this._shouldPutCaretAtLast(a)){this._placeCursorAtLast()}else{this._$elTitleInput.focus()}}},_activateEditableWatcher:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._onEnterInputTitle,fDelete:this._onKeyDownDelete,fBackspace:this._onKeyDownBackspace})},_deactivateEditableWatcher:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_onKeyDownDelete:function(a,b){if(a.call(null)===false){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_AFTER_COMP,this,b.which);b.preventDefault();b.stopPropagation()},_onKeyDownBackspace:function(a,b){if(a.call(null)===false){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_BEFORE_COMP,this,b.which);b.preventDefault();b.stopPropagation()},_IMPL_onFocusIn:function(a){a=a||{};this._processByPayLoad(a);this._bindEvent();this._activateEditableWatcher()},_IMPL_onFocusOut:function(){this._unbindEvent();this._deactivateEditableWatcher()},_IMPL_onDestroyed:function(){if(!this._$elTitleInput){return}this._destroyPlaceholder();this._IMPL_onFocusOut();this._$elTitleInput=null;this._$elViewArea=null},_IMPL_onUpdateModel:function(){var a=this._$elTitleInput.val();var b=this._$elTitleInput[0].classList;if(b.contains("placeholder")){a=""}this._oModel.setTitle(a)},_IMPL_onUpdateUI:function(){this._oToolbar.changeBtnValue(this._makeBtnStates());var a=$.extend(true,{},this._oModel.getJson()),b=a.componentStyle;if(b.fontSize)this.changeHeadingLevel(b.fontSize);if(b.fontFamily)this.changeFont(b.fontFamily);if(b.align)this.changeAlign(b.align);this.changeFontColor(b.fontColor||"");this.applyBold(b.fontBold||false);this.applyUnderline(b.fontUnderline||false);this.applyItalic(b.fontItalic||false);this._changeLineHeight(b.lineHeight||"");this._$elTitleInput.val(this._oModel.getTitle())},_IMPL_onUpdateStyle:function(a,b){var c=this._oModel.getComponentStyle();var d=null;this._checkAlign(c,a);if(b){d={fontFamily:a.fontFamily,fontColor:""};this.changeFontColor("");this.changeFont(a.fontFamily)}else{d={fontFamily:a.fontFamily,fontColor:a.fontColor};if(se.CanvasRectHelper.isMobileViewPort()){d.textAlignToggle=a.align}else{d.textAlign=a.align}if(a.fontColor)this.changeFontColor(a.fontColor);if(a.fontFamily)this.changeFont(a.fontFamily);if(a.align)this.changeAlign(a.align);if(a.lineHeight)this._changeLineHeight(a.lineHeight)}this._oToolbar.changeBtnValue(d)},_checkAlign:function(a,b){if(b.align==="justify"){b.align=a.align}},_setComponentStyle:function(a,b){var c=this._oModel.getComponentStyle();c[a]=b;this._requestCompHistory()},changeHeadingLevel:function(a){var b="se_fs_"+a;this._$elViewArea.removeClass("se_fs_H1 se_fs_H2 se_fs_H3");this._$elViewArea.addClass(b);this.updateAutoSize(this._$elTitleInput);this._setComponentStyle("fontSize",a)},changeFont:function(a){$SE_STYLE_HELPER.changeFontFamily(this._$elViewArea,a);this.updateAutoSize(this._$elTitleInput);this._setComponentStyle("fontFamily",a)},changeFontColor:function(a){this._$elViewArea.css("color",a);this._setComponentStyle("fontColor",a)},changeAlign:function(a){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionArea,a);this._setComponentStyle("align",a);this._$elViewArea.width(this._$elViewArea.width()-1);setTimeout(function(){this._$elViewArea.css("width","")}.bind(this),1)},applyBold:function(a){if(a){this._$elViewArea.addClass("se_fw_bold")}else{this._$elViewArea.removeClass("se_fw_bold")}this._setComponentStyle("fontBold",a)},applyUnderline:function(a){if(a){this._$elFontSize.css("text-decoration","underline")}else{this._$elFontSize.css("text-decoration","")}this._setComponentStyle("fontUnderline",a)},applyItalic:function(a){if(a){this._$elViewArea.css("font-style","italic")}else{this._$elViewArea.css("font-style","")}this._setComponentStyle("fontItalic",a)},getPlainText:function(){return this._$elTitleInput.val()},pasteHTML:function(a){if(!a||a===""){return}var b=this._$elTitleInput.get(0);var c=$SE_STRING.insertStringToInput(b,a);this.updateAutoSize(this._$elTitleInput);$SE_STRING.setCaretPosition(b,c)}});se.defineClass("se.VideoCompView",se.BaseCompView,{construct:function(a){this._initVar();this._oModel=a},_initVar:function(){this._oLoadImageEvent=null},_getLoadImageEvent:function(){if(this._oLoadImageEvent===null){this._oLoadImageEvent=this._$elImage.on("load",$.proxy(this._loadImage,this))}return this._oLoadImageEvent},_destroyLoadImageEvent:function(){this._$elImage.off();this._oLoadImageEvent=null},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elImage=this._$elContainer.find("img");this._$elViewArea=this._$elContainer.find(".__se_viewArea");this._$eCaptionWrap=this._$elContainer.find(".__se_caption_wrap")},_bindEvent:function(){this._$elSectionWrap.on("mousedown",this._onMouseDownSectionWrap.bind(this))},_unbindEvent:function(){},_onMouseDownSectionWrap:function(){this._captionView.setValue(this._captionView.getValue());this._captionView.blur()},_makeCaptionView:function(){return new se.CaptionSubCompView({template:se.editor.template.canvas["captionView.hbs"],state:{caption:this._oModel.getCaption(),placeholder:se.i18n.getMsg("MSG_VIDEO_PLACEHOLDER")}})},_onEnterCaption:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:$SE_CONFIG.COMP_TYPE.PARAGRAPH,shouldFocus:true})},_loadImage:function(a){this.compromiseScrollHeight()},getRepresent:function(){return this._oModel.getRepresent()},setRepresent:function(a){this._oModel.setRepresent(a)},_IMPL_onAfterRender:function(){this._assignElements();var a=this._makeCaptionView();a.appendTo(this._$eCaptionWrap);this._captionView=a;if(!$SE_CONFIG.SERVICE_CONFIG.IS_CAPTION_AVAILABLE){this._$eCaptionWrap.css("display","none")}if(this._oModel.isVertical()){this._$elContainer.addClass("se_video_h")}},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue(this._getActiveButtonValue());this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_getActiveButtonValue:function(){return{imageAlign:this._oModel.getAlign()}},_onClickToolbarBtn:function(a,b,c){this._handleByGroup(b,c)},_handleByGroup:function(a,b){switch(a){case"mediaResize":this._onClickResize(b);break;case"imageAlign":this._updateDisplayAlignWith(b);break;case"specialLetter":if(typeof b!=="string"){return}this._captionView.pasteHTML(b);break;case"delete":this._handleClickDelete();break}},_handleClickDelete:function(){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)},_onClickResize:function(a){if(a===null){return}if(a.type==="resize"){this._resizeVideoDisplay(a.mediaSize)}else if(a.type==="reset"){this._resetVideoDisplaySize()}},_resizeVideoDisplay:function(a){var b=this._oModel;var c=b.getAlign();var d=b.getDefaultVideoAlign();var e=c===d?b.getDefaultSmallVideoAlign():c;b.setDisplaySize(a.width,a.height);b.setResizedInfo(a.width,a.height);b.setIsResized(true);this._setThumbnailViewWidth(b.getDisplayWidth());this._handleByGroup("imageAlign",e);this._oToolbar.changeBtnValue(this._getActiveButtonValue());this._captionView.updateHeight();this._requestCompHistory()},_setThumbnailViewWidth:function(a){if(se.CanvasRectHelper.isDesktopViewPort()){this._$elViewArea.css("maxWidth",a+"px")}},_resetVideoDisplaySize:function(){this._setDefaultDisplaySize();this._oModel.setIsResized(false);var a=this._oModel.getDefaultVideoAlign();this._handleByGroup("imageAlign",a);this._oToolbar.changeBtnValue(this._getActiveButtonValue());this._requestCompHistory()},_updateDisplayAlignWith:function(a){var b=this._oModel;b.setAlign(a);this._updateUI();this._requestCompHistory()},_setDefaultDisplaySize:function(){var a=this._oModel;var b=a.getDefaultDisplaySize();a.setDisplaySize(b.width,b.height);this._setThumbnailViewWidth(b.width)},_updateUI:function(){var a,b;if(se.CanvasRectHelper.isMobileViewPort()||se.CanvasRectHelper.isTabletViewPort()){a=(window.frameElement||document.documentElement).offsetWidth+"px";b=this._oModel.getDefaultVideoAlign()}else{a=this._oModel.getDisplaySize().width;a=a?a+"px":"";b=this._oModel.getAlign()}this._$elViewArea.css("maxWidth",a);$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,b)},_IMPL_onResize:function(){this._updateUI()},_IMPL_onMounted:function(){this._getLoadImageEvent()},_IMPL_onUpdateModel:function(){this._oModel.setCaption(this._captionView.getValue())},_IMPL_onUpdateUI:function(){this._updateUI();this._oToolbar.changeBtnValue(this._getActiveButtonValue());this._captionView.updateHeight();this._captionView.setValue(this._oModel.getCaption())},_IMPL_onUpdateStyle:function(a){if(a.align){this._updateDisplayAlignWith(a.align)}},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._captionView.destroy();this._$elImage=null},_IMPL_onFocusIn:function(){this._bindEvent();this._getLoadImageEvent();this._captionView.focusIn();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._onEnterCaption.bind(this)})},_IMPL_onFocusOut:function(){this._destroyLoadImageEvent();this._captionView.focusOut();this._unbindEvent();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},getPlainText:function(){return this._captionView.getValue()}});se.defineClass("se.FileCompView",se.BaseCompView,{construct:function(){this._initVar()},_initVar:function(){this._isUploading=false},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elProgress=this._$elContainer.find(".__se_progress");this._$elFileName=this._$elContainer.find(".__se_name")},_bindEvent:function(){this._oToolbar.setBtnClickEventListener($.proxy(this._onClickToolbarBtn,this))},_unbindEvent:function(){},_onClickToolbarBtn:function(a,b){a.preventDefault();var c=$(a.currentTarget);var d=c.data("value");if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,d)}this._IMPL_onUpdateModel();this._requestCompHistory()},updateProgress:function(a){if(this._isUploading===false){this._isUploading=true}this._$elProgress.css({width:a+"%"})},reRenderBy:function(a){if(this.getId()===null){return}var b=$.extend({},this._oModel.getJson(),a);var c=new se.FileModel(b);this.update(c);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);this._$elSectionWrap.removeClass("is-loading");this._isUploading=false},getIsUploading:function(){return this._isUploading},bindFileUploadAbort:function(a){this._fnAbortUpload=a},isNDriveType:function(){return this._oModel.getFileType()==="ndrive"},_updateToolbar:function(){this._oToolbar.changeBtnValue({componentAlign:this._oModel.getAlign()})},_IMPL_onCreated:function(){},_IMPL_onMounted:function(){if(this._oModel.getFileName()===""){this._$elFileName.text(se.i18n.getMsg("MSG_FILE_UPLOADING"))}},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue({componentAlign:this._oModel.getAlign()});this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onUpdateModel:function(){this._oModel.setAlign($SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap));this._oModel.setFileName(this._$elFileName.text())},_IMPL_onUpdateUI:function(){var a=this._oModel;$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.getAlign());this._$elFileName.text(a.getFileName());this._updateToolbar()},_IMPL_onUpdateStyle:function(a,b){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._oModel.setAlign($SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap))}},_IMPL_onDestroyed:function(){if(typeof this._fnAbortUpload==="function"){this._fnAbortUpload()}this._$elSectionWrap=null;this._$elProgress=null;this._$elFileName=null;this._IMPL_onFocusOut()},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()}});se.defineClass("se.ImageStripCompView",se.BaseCompView,{construct:function(a){this._oModel=a},_initVar:function(){},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elCaptionWrap=this._$elContainer.find(".__se_caption_wrap");this._$elMediaAreaWrap=this._$elContainer.find(".se_mediaArea");this._$elImageStripView=this._$elContainer.find(".se_imageStripView")},_bindEvent:function(){this._$elSectionWrap.on("mousedown",this._onMouseDownSectionWrap.bind(this));this._$elMediaAreaWrap.on("click.deleteSubComponent",".se_btn_deleteImage",$.proxy(this._onClickDeleteSubCompBtn,undefined,this))},_bindImageEvents:function(){$.each(this._$elImageStripView.find("img"),function(a,b){b.onerror=this._errorImage.bind(this)}.bind(this))},_errorImage:function(a){var b=$(a.target);var c=$SE_CONFIG.ENV_SETTING.EDITOR_DOMAIN+"/static/img/no_image.png";b.trigger("load.imgchecker");b.attr("src",c);var d=b.parent().data("subPosition");var e=this._oModel.getComponents()[d];if(e){e.replaceToError();this._refreshView()}},_onMouseDownSectionWrap:function(){this._oToolbar.closeActiveButton();this._captionView.setValue(this._captionView.getValue());this._captionView.blur()},_onClickDeleteSubCompBtn:function(a){var b=parseInt($(this).closest(".__subComp").attr("data-sub-position"));a._removeSubComponent(b,true);clickcr(a,"sbs.x","","")},_onEnterCaption:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.APPEND_EMPTY_LINE_WITH_FOCUS);return false},_unbindEvent:function(){this._$elMediaAreaWrap&&this._$elMediaAreaWrap.off("click.deleteSubComponent")},_onClickToolbarBtn:function(a,b,c,d,e){a.preventDefault();if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}else if(b==="specialLetter"){if(typeof c!=="string"){return false}this.pasteHTML(c)}var f=$(a.currentTarget);if(b==="imageDisplay"){this._onClickDisplayBtn(f)}this._updateModel(this._oModel);this._requestCompHistory()},_onClickDisplayBtn:function(a){this._updateDisplay(a.data("value"))},_updateDisplay:function(a){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a)},_IMPL_onAfterRender:function(){this._assignElements();var a=this._makeCaptionView();a.appendTo(this._$elCaptionWrap);this._captionView=a;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.ATTACH_DRAGGABLE_TO_SUB_COMPONENT,[this])},_makeCaptionView:function(){return new se.CaptionSubCompView({template:se.editor.template.canvas["captionView.hbs"],state:{caption:this._oModel.getCaption(),placeholder:se.i18n.getMsg("MSG_IMAGE_PLACEHOLDER")}})},_IMPL_onAfterMountToolbar:function(){this._updateToolbar();this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onMounted:function(){this._bindImageEvents()},pasteHTML:function(a){this._captionView.pasteHTML(a)},_updateToolbar:function(){if(this._bFocused===false){return}this._oToolbar.changeBtnValue({imageDisplay:this._oModel.getAlign()})},_updateModel:function(a){this._updateStyle(a);this._updateCaption(a);this._updateToolbar()},_updateStyle:function(a){a.setAlign($SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap))},_updateCaption:function(a){a.setCaption(this._captionView.getValue())},_IMPL_onUpdateModel:function(){this._updateModel(this._oModel)},_IMPL_onUpdateUI:function(){var a=this._oModel;var b=a.getComponents().length;this._captionView.setValue(this._oModel.getCaption());this._updateDisplay(a.getAlign());this._updateToolbar();this._refreshView();this._$elContainer.removeClass("imageStrip2 imageStrip3");this._$elContainer.addClass("imageStrip"+b)},_refreshView:function(){var a=this._oModel;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DETACH_DRAGGABLE_TO_SUB_COMPONENT,[this]);a.issueSubCompId();a.updateWidthRatio();this._renderSubComponents();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.ATTACH_DRAGGABLE_TO_SUB_COMPONENT,[this])},_renderSubComponents:function(){var a=this._oModel;var b=a.getComponents();this._$elContainer.find(".__subComp_container").html("");var c="";b.forEach(function(a,b){var d=this._fSubCompTemplate(a,b);c+=d}.bind(this));this._$elContainer.find(".__subComp_container").get(0).innerHTML=c;this._bindImageEvents()},_fSubCompTemplate:function(a,b){return"<div class='__se_sortable_item __subComp se_imageStripArea' style='width:"+a.widthRatio+"%' data-sub-position='"+b+"' data-comp-id='"+a.compId+"'>"+"<img class='se_mediaImage' src='"+a.src+"' alt='"+a.caption+"' title='"+a.caption+"' >"+"<div class='se_imageStripSelection'></div><button type='button' class='se_btn_deleteImage'><span class='blind'>이미지삭제</span></button></div>"},_IMPL_onUpdateStyle:function(a,b){if(this._isValidStyle(a)){this._updateDisplay(a.align);this._updateStyle(this._oModel);this._updateToolbar()}},_isValidStyle:function(a){var b=a.align,c=false;switch(b){case"extend":case"justify":case"pagefull":c=true}return c},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._captionView.destroy();this._$elSectionWrap=null;this._$elCaptionWrap=null;this._$elMediaAreaWrap=null},_IMPL_onFocusIn:function(){this._bindEvent();this._captionView.focusIn();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._onEnterCaption.bind(this)})},_IMPL_onFocusOut:function(){this._captionView.focusOut();this._unbindEvent();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},getPlainText:function(){return this._captionView.getValue()},setRepresent:function(a,b){this._oModel.setRepresentBySubCompId(a,b)},addSubComponent:function(a,b){var c=se.ComponentComposer;var d=this.getModelDataAsJson();var e=$.extend({},a);var f=e.compId;if(d.components.length>=3){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT_BY_ID,f);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ADD_LIBRARY_DATA,{aModelData:[e],bReset:false});var g=c.getMergedComponentData({htTargetComp:a,htBaseComp:d,nInsertIndex:b});var h=new se.ImageStripModel(g);this._filterCompData(h);this.update(h);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,this,{action:$SE_CONFIG.ACTION.COMPOSE,trigger:$SE_CONFIG.TRIGGER.DRAG,itemIndex:b});return this},_filterCompData:function(a){if(a.checkHasVR360Image()){this._warnSmallVR360()}a.changeDisplayFormatNormalComponents()},_warnSmallVR360:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_IMAGE_SMALL_VR360_WARN"))},divideSubComponent:function(a){var b=this._oModel.getComponents();var c=this._getSubComponent(a);c.beforeFormat=this._oModel.getBeforeFormat(c.compId);this._filterDividingCompData(c);if(b.length===2){var d=1-a;delete b[d].displayFormat;clickcr(self,"sbs.cancel","","")}var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,{compData:c,shouldFocus:false})[0];this._removeSubComponent(a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,e);return e},_filterDividingCompData:function(a){delete a.compId;delete a.displayFormat},_getSubComponent:function(a){var b=$.extend({},this.getModelDataAsJson());return b.components[a]},switchSubComponent:function(a,b){var c=this._oModel.getComponents();var d=c[a];var e=b<a?b:b-1;c.splice(a,1);c.splice(e,0,d);this.update();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,this)},extractSubComponent:function(a){var b=$.extend({},this.getModelDataAsJson());var c=b.components[a];var d=b.components.length;if(d<3){clickcr(self,"sbs.cancel","","")}this._removeSubComponent(a);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY);return c},removeSubComponentWithCompId:function(a,b){var c=this._oModel.getComponents();var d=null;for(var e in c){if(c[e].compId===a){d=parseInt(e);break}}if(d!==undefined){this._removeSubComponent(d,b)}},_removeSubComponent:function(a,b){if(!this._oModel){return}var c=this._oModel.getComponents();var d=c.length;var e=c[a];var f=e.compId;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{ids:[f],subCompIds:this._getSubComponentIds([f])});if(d>=3){c.splice(a,1);this.update();if(b){this._requestCompHistory()}}else{var g=$.extend({},this.getModelDataAsJson()).components[a===1?0:1];g.beforeFormat=this._oModel.getBeforeFormat(g.compId);delete g.displayFormat;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{target:this,compData:g,shouldFocus:true,shouldUpdateLibrary:false,bPushHistory:b});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{ids:[g.compId]});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ENABLE_CHANGE_LIBRARY)}},getOwnSubCompIds:function(){var a=this._oModel.getComponents();var b=[];a.forEach(function(a){b.push(a.compId)});return b},_getSubComponentIds:function(a){var b=[];var c=true;var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.GET_COMPONENTS_DATA,c);d.forEach(function(c){a.forEach(function(a){if(c.compId===a){b.push(c.compId);return}if(c.components){c.components.forEach(function(c){if(c.compId===a){b.push(c.compId)}})}})});return b}});se.defineClass("se.HorizontalLineCompView",se.BaseCompView,{construct:function(){this._initVar()},_initVar:function(){this._currentLayout=this._oModel.getLayout()},_onClickToolBar:function(a,b,c){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(b!=="line"){return}this.changeLayout(c)},changeLayout:function(a){this._$elContainer.removeClass(this._currentLayout).addClass(a);this._currentLayout=a;this.updateModel();this._requestCompHistory()},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue({line:this._oModel.getLayout()});this._oToolbar.setBtnClickEventListener(this._onClickToolBar.bind(this))},_IMPL_onUpdateModel:function(){this._oModel.setLayout(this._currentLayout)},_IMPL_onUpdateUI:function(){this.changeLayout(this._oModel.getLayout());this._oToolbar.changeBtnValue({line:this._oModel.getLayout()})},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._currentLayout=null},_isCurrentLayoutAvailableInTheme:function(a){var b=this._currentLayout;return a==="default"||a==="transparent"||b==="default"||b==="line1"},_IMPL_onRefineDataByTheme:function(a){if(this._isCurrentLayoutAvailableInTheme(a)===false){this.changeLayout("default")}}});se.defineClass("se.OglinkCompView",se.BaseCompView,{NINE_TO_SIXTEEN_RATIO:9/16,construct:function(a){this._initVar();this._oModel=a},_initVar:function(){this._sDthumb=$SE_CONFIG.ENV_SETTING.DTHUMB_DOMAIN},_assignElements:function(){this._isDelete=false;this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elDeleteBtn=this._$elContainer.find(".se_btn_og_rmThumb");this._$elThumbnail=this._$elContainer.find(".se_og_thumb")},_bindEvent:function(){this._$elDeleteBtn.on("click",this._deleteThumb.bind(this))},_unbindEvent:function(){this._$elDeleteBtn.off()},_deleteThumb:function(){this._deleteThumbModel();this._updateThumbUI();this._requestCompHistory()},_deleteThumbModel:function(){this._oModel.setThumbnail(null)},_updateThumbUI:function(){if(this._oModel.getThumbnail()){this._$elThumbnail.css("display","")}else{this._$elThumbnail.css("display","none")}},_updateLayoutUI:function(a){var b=$SE_STYLE_HELPER.getClassBy(this._$elContainer,/og_bSize/)||"default";if(a!==b){this._$elContainer.removeClass(b).addClass(a)}},_updateStyleUI:function(a){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a);this._oToolbar.changeBtnValue({componentAlign:a||"left"})},_updateStyleModel:function(a){this._oModel.setComponentStyle(a)},_getUpdateStyle:function(a){var b=this._oModel.getComponentStyle();b.align=a;return b},_onClickToolbarBtn:function(a,b,c){a.preventDefault();var d=c;if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(b==="componentAlign"){this._updateStyleUI(d);this._updateStyleModel(this._getUpdateStyle(d))}this._requestCompHistory()},_isNMusic:function(a){return a.src.indexOf("http://musicmeta.phinf.naver.net")<0?false:true},_isVerticalRatio:function(a){return(a.width/a.height).toFixed(2)<=this.NINE_TO_SIXTEEN_RATIO?true:false},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){this._oToolbar.changeBtnValue({componentAlign:this._oModel.getComponentStyle().align||"left"});this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onDestroyed:function(){this._unbindEvent();this._$elSectionWrap=null;this._$elDeleteBtn=null;this._$elThumbnail=null},_setThumbnailSrc:function(a){if(!a.thumbnail){return}if(this._isVerticalRatio(a.thumbnail)){a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff250_444");a.isVerticalThumbnail=true}else if(a.layout==="default"||a.layout==="og_shoppingAffiliate"){a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff120")}else if(a.thumbnail.height===a.thumbnail.width&&!this._isNMusic(a.thumbnail)){a.thumbnail.src=this._makeDThumb(a.thumbnail,"w480")}else{a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff500_300")}},_IMPL_onRender:function(a,b){var c=$.extend(true,{},b);var d=c.thumbnail?c.thumbnail.src:"";this._setThumbnailSrc(c);if($SE_CONFIG.ENV_SETTING.IS_PHOLAR_SERVICE&&c.thumbnail){c.thumbnail.src=this._sDthumb+"/?src=%22"+encodeURIComponent(d)+"%22&type=ff500_300"}c.clickCode="ogl";return a(c)},_makeDThumb:function(a,b){var c=this._sDthumb+"/?src=%22"+encodeURIComponent(a.src)+"%22&type="+b;var d=new Image;d.onerror=this._deleteThumb.bind(this);d.src=c;return c},_IMPL_onUpdateModel:function(){var a=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);this._updateStyleModel(this._getUpdateStyle(a))},_IMPL_onUpdateUI:function(){this._updateThumbUI();this._updateLayoutUI(this._oModel.getLayout());this._updateStyleUI(this._oModel.getComponentStyle().align)},_IMPL_onUpdateStyle:function(a){var b=a.align;if(b){this._updateStyleUI(b);this._updateStyleModel(this._getUpdateStyle(b))}},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()}});se.defineClass("se.MaterialCompView",se.BaseCompView,{construct:function(a){this._initVar();this._bindFunction();this._registerHelper()},_initVar:function(){this._htOption={nWidth:$SE_CONFIG.OG.width,nHeight:$SE_CONFIG.OG.height};this._oLoadImageEvent=null;this.sDthumb=$SE_CONFIG.ENV_SETTING.DTHUMB_DOMAIN},_bindFunction:function(){this._fOnLoadImage=$.proxy(this._onLoadImage,this)},_registerHelper:function(){Handlebars.registerHelper("nameList",function(a){var b=[];if(!a){return""}if(typeof a==="string"){return a}for(var c=0,d=a.length;c<d;c++){b.push(a[c].value)}return b.join(", ")});Handlebars.registerHelper("view_shopping_content_text",$.proxy(function(a,b,c,d,e,f){var g="";if(a!=="shopping"){return false}if(b==1||b==4){return this._getCostCompareTemplate(f)}if(c==1&&d){return this._getNpayTemplate(d)+this._getCostTemplate(f)}if(d){return this._getNameTemplate(d)+this._getCostTemplate(f)}return g},this))},_getCostCompareTemplate:function(a){var b="",c="";b='<p class="subjectMatter_info_item">'+'<span class="subjectMatter_info_text se_cost"><em class="se_value">최저</em>'+a+"원</span>"+"</p>";c='<p class="subjectMatter_info_item">'+'<span class="subjectMatter_info_text se_cost_compare">가격비교 보기'+'<i class="se_ico_compareMore"></i>'+"</span>"+"</p>";return b+c},_getNpayTemplate:function(a){var b="";b='<p class="subjectMatter_info_item">'+'<span class="subjectMatter_info_text">'+a+"</span>"+'<i class="se_ico_npay">'+'<span class="blind">N Pay</span></i>'+"</p>";return b},_getNameTemplate:function(a){var b="";b='<p class="subjectMatter_info_item">'+'<span class="subjectMatter_info_text">'+a+"</span>"+"</p>";return b},_getCostTemplate:function(a){var b="";b='<p class="subjectMatter_info_item">'+'<span class="subjectMatter_info_text se_cost">'+a+"원</span>"+'<span class="subjectMatter_info_text se_cost_compare">구매하기<i class="se_ico_compareMore"></i></span>'+"</p>";return b},_IMPL_onCreated:function(){},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getComponentStyle();var b=a.align||"left";this._oToolbar.changeBtnValue({componentAlign:b});this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onUpdateModel:function(){this._oModel.setComponentStyle(this._getStyle())},_IMPL_onUpdateUI:function(){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,this._oModel.getComponentStyle().align);this._oToolbar.changeBtnValue({componentAlign:this._oModel.getComponentStyle().align||"left"})},_IMPL_onUpdateStyle:function(a,b){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._oModel.setComponentStyle(this._getStyle());this._oToolbar.changeBtnValue({componentAlign:this._oModel.getComponentStyle().align||"left"})}},_IMPL_onAfterActivate:function(){},_IMPL_onRender:function(a,b){var c;if(b.type=="news"){b.newsLayoutType=this._determineNewsLayoutType(b.thumbnail);if(b.newsLayoutType==1){b.sDthumb=this.sDthumb+"/?src="+b.thumbnail.src+"&type=ff120"}else if(b.newsLayoutType==2){b.sDthumb=this.sDthumb+"/?src="+b.thumbnail.src+"&type=ff500_300";
}}return a(b)},_IMPL_onUpdated:function(){},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._$elSectionWrap=null;this._$elSubjectMatter=null;this._htOption=null;this._oLoadImageEvent=null;this.sDthumb=null},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()},_IMPL_onMounted:function(){this._getLoadImageEvent()},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elSubjectMatter=this._$elContainer.find(".subjectMatter_item_content").filter(function(a){return $(this).css("display")=="block"})},_bindEvent:function(){this._getLoadImageEvent()},_unbindEvent:function(){this._destroyLoadImageEvent()},_getLoadImageEvent:function(){var a;if(this._oLoadImageEvent===null){if(a=this._$elSubjectMatter.find("img").get(0)){this._$elImage=$(a);this._oLoadImageEvent=this._$elImage.on("load",this._fOnLoadImage)}}return this._oLoadImageEvent},_destroyLoadImageEvent:function(){this._$elImage&&this._$elImage.off();this._oLoadImageEvent=null},_onClickToolbarBtn:function(a,b,c,d){a.preventDefault();if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,c)}this._IMPL_onUpdateModel();this._requestCompHistory()},_getStyle:function(){var a=this._oModel.getComponentStyle(),b=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);a.align=b;return a},_determineNewsLayoutType:function(a){var b=0;if(a&&a.src){b=1;if(a.width>=this._htOption.nWidth&&a.height>=this._htOption.nHeight){b=2}}return b},_onLoadImage:function(){this.compromiseScrollHeight()}});se.defineClass("se.StickerCompView",se.BaseCompView,{construct:function(a){this._initVar();this._bindFunction();this._oModel=a},_initVar:function(){this._sThumbType=this._oModel._htData.animated?"pa50_50":"p50_50"},_bindFunction:function(){this._fOnLoadSticker=$.proxy(this._onLoadSticker,this)},_IMPL_onAfterRender:function(){this._assignElements();this._$elSticker.one("load",this._fOnLoadSticker)},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getComponentStyle();var b=a.align;this._oToolbar.changeBtnValue({componentAlign:b});this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_IMPL_onUpdateModel:function(){this._oModel.setComponentStyle(this._getStyle())},_IMPL_onUpdateUI:function(){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,this._oModel.getComponentStyle().align);this._oToolbar.changeBtnValue({componentAlign:this._oModel.getComponentStyle().align})},_IMPL_onUpdateStyle:function(a){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._oModel.setComponentStyle(this._getStyle());this._oToolbar.changeBtnValue({componentAlign:a.align})}},_IMPL_onRender:function(a,b){b.imageUrl=b.original.src+"?type="+this._sThumbType;return a(b)},_IMPL_onDestroyed:function(){this._$elSectionWrap=null;this._$elSticker=null},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elSticker=this._$elContainer.find(".se_sticker_area img")},_onClickToolbarBtn:function(a,b,c){a.preventDefault();if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)}else if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,c);this._IMPL_onUpdateModel();this._requestCompHistory()}},_getStyle:function(){var a=this._oModel.getComponentStyle();a.align=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);return a},_onLoadSticker:function(){setTimeout(this.compromiseScrollHeight.bind(this),50)}});se.defineClass("se.TalktalkCompView",se.BaseCompView,{construct:function(){this._initVar()},_initVar:function(){this._fTplViewArea=se.editor.template.canvas["talktalk-component-viewArea.hbs"];Handlebars.registerPartial("talktalk-component-viewArea",this._fTplViewArea)},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section");this._$elViewArea=this._$elContainer.find(".se_viewArea")},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getComponentStyle();this._updateToolbar(a.align);this._oToolbar.setBtnClickEventListener(this._onClickToolbarBtn.bind(this))},_onClickToolbarBtn:function(a,b,c){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)}else if(b==="talktalk"){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,{compData:this._oModel.getJson(),fCallback:this._onEdit.bind(this)})}else if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,c);this._IMPL_onUpdateModel();this._requestCompHistory()}},_onEdit:function(a){this._oModel.setLayout(a.compData.layout);this._oModel.setAccountId(a.compData.accountId);this._oModel.setProfileName(a.compData.profileName);this._oModel.setImage(a.compData.image);this._IMPL_onUpdateUI();this._requestCompHistory()},_IMPL_onUpdateModel:function(){var a=this._oModel.getComponentStyle(),b=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);a.align=b;this._oModel.setComponentStyle(a)},_IMPL_onUpdateUI:function(){var a=this._oModel.getJson();this._$elContainer.removeClass("default custom").addClass(a.layout==="custom"?"custom":"default");this._updateViewArea(a);this.updateStyle(this._oModel.getComponentStyle())},_IMPL_onUpdateStyle:function(a,b){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._updateToolbar(a.align);this._oModel.setComponentStyle(a)}},_updateViewArea:function(a){this._$elViewArea.html(this._fTplViewArea(a))},_updateToolbar:function(a){a=a||"left";this._oToolbar.changeBtnValue({componentAlign:a})},_needHideAlign:function(){return this._oModel.getLayout()==="custom"&&this._oModel.getImage()&&this._oModel.getImage().isMoreThanMaxWidth()},_getToolbarBtnEntries:function(){if(this._needHideAlign()){return["talktalk","delete"]}else{return["talktalk","componentAlign","delete"]}},_IMPL_onDestroyed:function(){this._$elSectionWrap=null;this._$elViewArea=null}});se.defineClass("se.MrBlogCompView",se.BaseCompView,{construct:function(a){this._initVar()},_initVar:function(){},_assignElements:function(){},_bindEvent:function(){this._$elContainer.find(".se_mrblog_content").find("a").on("click",function(a){a.preventDefault()})},_unbindEvent:function(){},_onClickToolBar:function(a,b,c,d){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)}},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){this._oToolbar.setBtnClickEventListener(this._onClickToolBar.bind(this))},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut()},_IMPL_onRender:function(a,b){return a(b)},_IMPL_onUpdateModel:function(){},_IMPL_onUpdateUI:function(){},_IMPL_onUpdateStyle:function(a,b){},_IMPL_onFocusIn:function(){this._bindEvent()},_IMPL_onFocusOut:function(){this._unbindEvent()}});se.defineClass("se.AnniversarySectionCompView",se.BaseCompView,{construct:function(){},_assignElements:function(){this._$elSectionWrap=this._$elContainer.find(".__se_section")},_onClickToolbar:function(a,b,c,d){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4)}else if(b==="componentAlign"){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,c);this._IMPL_onUpdateModel();this._requestCompHistory()}},_getStyle:function(){var a=this._oModel.getComponentStyle();a.align=$SE_STYLE_HELPER.getAlignForModel(this._$elSectionWrap);return a},_IMPL_onAfterRender:function(){this._assignElements()},_IMPL_onAfterMountToolbar:function(){var a=this._oModel.getComponentStyle();var b=a.align;this._oToolbar.changeBtnValue({componentAlign:b});this._oToolbar.setBtnClickEventListener(this._onClickToolbar.bind(this))},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._$elSectionWrap=null},_IMPL_onRender:function(a,b){b.sinceDate=moment(b.sinceDate).format("YYYY.MM.DD.");return a(b)},_IMPL_onUpdateModel:function(){this._oModel.setComponentStyle(this._getStyle())},_IMPL_onUpdateUI:function(){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,this._oModel.getComponentStyle().align);this._oToolbar.changeBtnValue({componentAlign:this._oModel.getComponentStyle().align})},_IMPL_onUpdateStyle:function(a){if(a.align){$SE_STYLE_HELPER.changeAlignClassName(this._$elSectionWrap,a.align);this._oModel.setComponentStyle(this._getStyle());this._oToolbar.changeBtnValue({componentAlign:a.align})}}});se.defineClass("se.CodeCompView",se.BaseCompView,{MAX_SIZE:5e3,PREV_FONTSIZE_CLASS:"se_fs_",PREFIX_CLASS:"se_code_",PLACEHOLDER_CLASS:"placeholder",construct:function(){this._initVar();this._initPrism()},_initVar:function(){var a=this._oModel.getComponentStyle().fontSize;this._bIsViewMode=false;this._currentFontSizeClass=this._getFontSizeClassBy(a);this._currentTheme=this._oModel.getLayout()},_initPrism:function(){var a={};for(type in Prism.languages.javascript){if(type.substring(0,8)===this.PREFIX_CLASS){return}a[this.PREFIX_CLASS+type]=Prism.languages.javascript[type];delete Prism.languages.javascript[type]}Prism.languages.javascript=a},_assignElements:function(){this._$elEditable=this._$elContainer.find(".se_editable");this._$elViewArea=this._$elContainer.find(".se_viewArea");this._$elCodeViewArea=this._$elContainer.find(".__se_code_view");this._$elFontSize=this._$elContainer.find(".__se_fontSize");this._$elScrollArea=this._$elContainer.find(".se_textView");this._bindEvents()},_bindEvents:function(){this._$elScrollArea.on({mousedown:this._onMouseDownCodeViewArea.bind(this),scroll:this._onScrollCodeViewArea.bind(this),mouseup:this._onMouseUpCodeViewArea.bind(this)})},_unbindEvents:function(){this._$elScrollArea.off()},_setStyleEditable:function(){this._$elEditable[0].style["whiteSpace"]="pre"},_onMouseUpCodeViewArea:function(a){if(this.isScrolling){a.stopPropagation()}this.isScrolling=false},_onScrollCodeViewArea:function(){this.isScrolling=true},_onMouseDownCodeViewArea:function(){this.isScrolling=false},_showEditable:function(){this._activateEditable();this._deactivateCodeView()},_applyStyle:function(a){this._$elCodeViewArea[0].innerHTML=a},_deactivateCodeView:function(){this._bIsViewMode=false},_activateCodeView:function(){this._bIsViewMode=true},_deactivateEditable:function(){this._$elEditable.off();this._$elEditable.removeClass("is-on")},_activateEditable:function(){this._$elEditable.addClass("is-on");setTimeout(function(){this._$elEditable.focus()}.bind(this),1)},_getCodeContents:function(){return this._$elEditable.val()},_convertCodeStyleBy:function(a){return Prism.highlight(a,Prism.languages.javascript)},_onClickToolBar:function(a,b,c,d){if(b==="delete"){setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);return}if(b==="codeTheme"){this.updateTheme(c)}else if(b==="codeSize"&&d===true){this.updateFontSize(c)}this._requestCompHistory()},_changeThemeUI:function(a){this._$elContainer.removeClass(this._currentTheme).addClass(a);this._currentTheme=a},_changeFontSizeUI:function(a){var b=this._getFontSizeClassBy(a);this._$elFontSize.removeClass(this._currentFontSizeClass).addClass(b);this._currentFontSizeClass=b},_getFontSizeClassBy:function(a){return this.PREV_FONTSIZE_CLASS+a},_showPlaceholderText:function(){this._$elCodeViewArea.addClass(this.PLACEHOLDER_CLASS);this._$elCodeViewArea[0].innerHTML=se.i18n.getMsg("MSG_EMPTY_CODE_CONTENTS")},updateHighlightCode:function(){var a="";var b=this._getCodeContents();var c=b.length>0;if(c){a=this._convertCodeStyleBy(b);this._applyStyle(a);this._oModel.setCodeContents(b);this._$elCodeViewArea.removeClass(this.PLACEHOLDER_CLASS)}else{this._showPlaceholderText()}this._activateCodeView();this._deactivateEditable()},updateTheme:function(a){this._changeThemeUI(a);this._oModel.setLayout(a)},updateFontSize:function(a){this._changeFontSizeUI(a);this._oModel.changeFontSize(a);this.updateAutoSize(this._$elEditable)},readonly:function(a){a=a!==false;this._$elCodeViewArea.attr("readonly",a);this._bReadonly=a},_IMPL_onCreated:function(){},_addDataAttrForAutoSize:function(){this._$elEditable.data("autosize",{allowEnter:true,maxLength:this.MAX_SIZE,onOverflow:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_EXCEED_MAX_CONTENTS_LENGTH").replace("{=MAXLENGTH}",this.MAX_SIZE))}.bind(this)})},_IMPL_onAfterRender:function(){this._assignElements();this._addDataAttrForAutoSize();this._setStyleEditable();this._bindEvents();this.updateHighlightCode()},_IMPL_onRender:function(a,b){return a(b)},_IMPL_onUpdateModel:function(){this._oModel.setCodeContents(this._getCodeContents())},_IMPL_onUpdateUI:function(){var a=this._oModel;var b=a.getLayout();var c=a.getComponentStyle().fontSize;var d=a.getCodeContents();this._$elEditable.val(d);this._changeThemeUI(b);this._changeFontSizeUI(c);this._oToolbar.changeBtnValue({codeTheme:b,codeSize:c})},_IMPL_onDestroyed:function(){this._IMPL_onFocusOut();this._unbindEvents();this._$elViewArea=null;this._$elEditable=null;this._$elCodeViewArea=null},_showEditableByMode:function(){if(this._bIsViewMode===true){this._showEditable()}},_activateWatcher:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this)},_IMPL_onFocusIn:function(a){this._processByPayLoad(a);this._showEditableByMode();setTimeout(function(){this._activateWatcher()}.bind(this),1)},_processByPayLoad:function(a){switch(a.action){case $SE_CONFIG.ACTION.MOVE:if(this._isFromDown(a)){this._placeCursorAtLast()}else{this._placeCursorAtFirst()}break;default:this._$elEditable.focus()}},_placeCursorAtLast:function(){var a=this._$elEditable.val().length;this._$elEditable.focus();$SE_COMMON_UTIL.setSelectionRange(this._$elEditable[0],a,a)},_placeCursorAtFirst:function(){this._$elEditable.focus();$SE_COMMON_UTIL.setSelectionRange(this._$elEditable[0],0,0)},isCursorAtStart:function(){return $SE_TEXTAREA_HELPER.isCursorAtStart(this._$elEditable[0])},isCursorAtEnd:function(){var a=this._getCodeContents().length;return $SE_TEXTAREA_HELPER.isCursorAtEnd(this._$elEditable[0],a)},canMoveUpward:function(){return $SE_TEXTAREA_HELPER.hasPrevLine(this._$elContainer,this._$elEditable,this.currentCaretOffsetTop())},canMoveDownward:function(){return $SE_TEXTAREA_HELPER.hasNextLine(this._$elContainer,this._$elEditable,this.currentCaretOffsetTop())},currentCaretOffsetTop:function(){var a=this._$elEditable[0];var b=this._$elContainer.offset().top;return $SE_COMMON_UTIL.getCaretCoordinates(a,a.selectionEnd).top+b},_IMPL_onFocusOut:function(){this.updateHighlightCode();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onUpdateStyle:function(){},_IMPL_onAfterMountToolbar:function(){this._oToolbar.setBtnClickEventListener(this._onClickToolBar.bind(this));this._oToolbar.changeBtnValue({codeTheme:this._oModel.getLayout(),codeSize:this._oModel.getComponentStyle().fontSize})}});se.defineClass("se.TableCompView",se.BaseCompView,{TABLE_CONFIG:{DEFAULT_ROW:3,DEFAULT_COLUMN:3,SELECT_CELL_CLASSNAME:"se_selectedCell",REMOVE_SELECTION_RANGE_CLASS_NAME:"is-cellSelected",DEFAULT_BACKGROUND_COLOR:"rgb(255, 255, 255)",DEFAULT_ALIGN:"left",ALIGN_PREFIX:"se_align-",REGEX:{ALIGN:/se_align-([^\s]+)/},DEFAULT_BORDER_STYLE:{STYLE_NAME:"thinLine",COLOR:"#d4d4d4"},DEFAULT_CELL_HEIGHT:43,MIN_CELL_WIDTH:22,MIN_CELL_HEIGHT:43},PREVIEW_DEFAULT_COLUMN:{MOBILE:3,TABLET:6},CELL_STYLES:["height","width","color"],construct:function(){_.extendOwn(this,se.TableCore);this._initVar()},_initVar:function(){this._textViewMap={};this._textView=null;this.aSelectedCells=[];this._colControllerWidths=[];this._rowControllerHeights=[];this._previewWidth=document.body.clientWidth+"px";this._previewType=this._getPreviewType();this._tableWidthPX=0;this._aCellName=["TD"];this._rxCellNames=new RegExp("^("+this._aCellName.join("|")+")$","i");this._currentLayout=this._oModel.getLayout()},_assignElements:function(){this.elSelectionStartTable=this._$elContainer.find("table");this._$sectionArea=this._$elContainer.find(".__se_section");this._$tableWrap=this._$elContainer.find(".se_table_wrap");this._$controlbar=this._$elContainer.find(".se_tableControlbar");this._elColControllers=this._$elContainer.find(".__se_controller_col");this._elRowControllers=this._$elContainer.find(".__se_controller_row");this._elSelectAllBtn=this._$elContainer.find(".__se_select_all");this._elContextMenu=this._$elContainer.find(".__se_context_menu");this.htMap=this._getCellMapping(this.elSelectionStartTable);this._$verticalBar=this._$elContainer.find(".__se_cell_resize_bar_vertical");this._$horizontalBar=this._$elContainer.find(".__se_cell_resize_bar_horizontal")},_bindEvent:function(){this.elSelectionStartTable.on("mouseleave",this._onMouseLeaveOnCell.bind(this)).on("mousedown","td",this._onMouseDownOnCell.bind(this)).on("mousemove","td",this._onMouseMoveOnCell.bind(this)).on("mouseup","td",this._onMouseUpOnCell.bind(this)).on("mouseenter","td",this._onMouseEnterOnCell.bind(this));this._$verticalBar.on("mousedown",this._onMouseDownVerticalBar.bind(this));this._$horizontalBar.on("mousedown",this._onMouseDownHorizontalBar.bind(this));$(document.body).on("mousemove",this._onMouseMoveOnResizeHorizontalBar.bind(this));$(document.body).on("mouseup",this._onMouseUpOnResizeHorizontalBar.bind(this));this._elContextMenu.on("click","button",this._onClickContextMenuBtn.bind(this));this._elSelectAllBtn.on("click",this._onClickSelectAllBtn.bind(this));this._elRowControllers.on("click","a",this._onClickController.bind(this)).on("click","button",this._onClickInsertBtn.bind(this));this._elColControllers.on("click","a",this._onClickController.bind(this)).on("click","button",this._onClickInsertBtn.bind(this));this._$sectionArea.on("mousedown",this._onMouseDownSection.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TABLE.PASTED_TABLE_IN_TABLE,this.onPasteInTable.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TABLE.MOUSE_UP_ON_CELL,this._onMouseUpOnCell.bind(this))},_onMouseDownSection:function(){this._removeClassFromSelection();this._deselectAllController();this._hideContextMenu()},getCellOffset:function(){var a=this.elSelectionStartTable.find("td").eq(0);return(parseFloat(a.css("margin-top"),10)||0)+(parseFloat(a.css("padding-top"),10)||0)+(parseFloat(a.css("border-top"),10)||0)},focusByArrowKey:function(a){var b=this._getEditableFocusedCell()[0];var c=this._getBasisCellPosition(b);var d=this.htMap;var e=this._calculatePos(a,c);this.enableEditable(d[e.x][e.y]);this.focusTextView()},_calculatePos:function(a,b){var c={x:b.x,y:b.y};var d=this.htMap;var e=d[b.x][b.y];var f=this._oModel.getColumnCount()-1;var g=this.elSelectionStartTable.find("tr").length-1;switch(a){case $SE_CONFIG.TRIGGER.RIGHT:if(this._textView.isCursorAtEnd()){c.x+=1;break}else{return b}case $SE_CONFIG.TRIGGER.LEFT:if(this._textView.isCursorAtStart()){c.x-=1;break}else{return b}case $SE_CONFIG.TRIGGER.DOWN:if(this._textView.isCursorAtBottom()){c.y+=1;break}else{return b}case $SE_CONFIG.TRIGGER.UP:if(this._textView.isCursorAtTop()){c.y-=1;break}else{return b}}if(c.x<0||c.x>f||c.y<0||c.y>g){return b}if(d[c.x][c.y]===e){c=this._calculatePos(a,c)}return c},onPasteInTable:function(a,b){var c=$(a.getElement()).parents("td");var d=$(b).find("tr");var e,f;this.htMap=this._getCellMapping(this.elSelectionStartTable);f=this._getBasisCellPosition(c[0]);e=this._getContentsMap(d);this._updateContentsBy(f,e)},_updateContentsBy:function(a,b){var c=a.x;var d=a.y;var e=0;var f,g,h,i;for(d;d<this.htMap[c].length;d++){f=this.htMap[c][d];g=b[e];if(h===f){i=this._getAllAffectedCells(c+1,d,1,this.elSelectionStartTable);f=i.aCellsAfter[d]}if(g===undefined){return}this._updateTRContents(f,g);h=f;e++}},_updateTRContents:function(a,b){var c=a;var d=0;var e=b[d];var f;while(c&&e!==undefined){f=$(c).find("[contenteditable=true]");selry.edit(f.get(0)).setContents(e);c=this._getNextCell(c);e=b[++d]}},_getContentsMap:function(a){var b=[];a.each(function(a,c){var d=$(c).find("td");var e=[];d.each(function(a,b){e.push(b.textContent)}.bind(this));b.push(e)}.bind(this));return b},deleteTableByHotkey:function(){switch(this._getStateSelectedLine()){case"column":this.deleteColumn();break;case"row":this.deleteRow();break;case"all":setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);break;default:break}this._drawTableController()},_onClickContextMenuBtn:function(a){var b=$(a.currentTarget);var c=b.data("contextMenu");var d=c.indexOf("delete")>-1;var e=d?"tbl*c.delete":"tbl*c."+c;clickcr(this,e,"","",a);if(b.hasClass("is-disabled")){return}switch(c){case"merge":this.merge();break;case"splitRow":this.split("row");break;case"splitColumn":this.split("column");break;case"deleteRow":this.deleteRow();break;case"deleteColumn":this.deleteColumn();break;case"deleteAll":setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);break;default:break}this._clearAllTextView();this._refreshCellsWidth();this._drawTableController();if(!d){this._selectController()}this._hideContextMenu();this._updateTableViewToModel();this._requestCompHistory();this._toggleTableWidthToolbar()},_onClickInsertBtn:function(a){a.stopPropagation();clickcr(this,"tbl.insertpoint","","",a);var b=$(a.currentTarget);var c=b.parents().hasClass("__se_controller_col")?"column":"row";var d=0;this._hideContextMenu();this._deselectCells();switch(c){case"column":d=this._elColControllers.find("a button").index(b);if(d<0){return}this._selectAll_Column(d);this._insertColumnAfter();break;case"row":d=this._elRowControllers.find("a button").index(b);if(d<0){return}this._selectAll_Row(d);this._insertRowBelow();break;default:break}this._clearAllTextView();this._refreshCellsWidth();this._drawTableController();this._selectController();this._updateTableViewToModel();this._requestCompHistory();this._toggleTableWidthToolbar()},_refreshCellsWidth:function(){var a=this.elSelectionStartTable;var b=[];$.each(a.find("td"),function(a,c){b.push($(c).outerWidth())}.bind(this));$.each(a.find("td"),function(a,c){$(c).outerWidth(b[a])}.bind(this))},_onClickSelectAllBtn:function(a){this._selectAll_Column(0);this._selectAll_Row();this._selectController()},_onClickController:function(a){var b=$(a.target);var c=b.parent().hasClass("__se_controller_col")?"column":"row";var d=0;this._deselectCells();switch(c){case"column":d=this._getColIndexByController(b);this._selectAll_Column(d);break;case"row":d=this._getRowIndexByController(b);this._selectAll_Row(d);default:break}this._selectController();this._showContextMenu()},_getColIndexByController:function(a){var b=parseInt(a.offset().left,10);var c=0,d;$.each(this.htMap,function(a,e){d=parseInt($(e[0]).offset().left,10);if(d<=b){c=a}});return c},_getRowIndexByController:function(a){var b=parseInt(a.offset().top,10);var c=0,d;$.each(this.htMap[0],function(a,e){d=parseInt($(e).offset().top,10);if(d<=b){c=a}});return c},_toggleSelectAllBtn:function(){var a=this._getStateSelectedLine()==="all"?true:false;if(a){this._elSelectAllBtn.addClass("is-on")}else{this._elSelectAllBtn.removeClass("is-on")}},_selectController:function(){var a=this._elColControllers.find("a");var b=this._elRowControllers.find("a");var c=$(this.htMap[this.htSelectionSPos.x][this.htSelectionSPos.y]);var d=$(this.htMap[this.htSelectionEPos.x][this.htSelectionEPos.y]);var e=this._getBorderWidth(c);var f,g,h,i,j,k,l,m;f=c.offset();g=d.offset();if(!f||!g){return}h=parseInt(f.left-e.left,10);i=parseInt(g.left+d.width(),10);j=parseInt(f.top-e.top,10);k=parseInt(g.top+d.height(),10);this._deselectAllController();for(var n=0;n<a.length;n++){l=$(a[n]).offset().left;if(h<=l&&i>l){$(a[n]).addClass("is-on")}}for(var n=0;n<b.length;n++){m=$(b[n]).offset().top;if(j<=m&&k>m){$(b[n]).addClass("is-on")}}if(this.htSelectionSPos.x===0){$(a[0]).addClass("is-on")}if(this.htSelectionSPos.y===0){$(b[0]).addClass("is-on")}this._toggleSelectAllBtn()},_deselectAllController:function(){var a="is-on";this._elColControllers.find("a").removeClass(a);this._elRowControllers.find("a").removeClass(a);this._elSelectAllBtn.removeClass(a)},_onMouseDownHorizontalBar:function(a){this.isResizing=true;var b=this._$resizeTargetCell;this._$elContainer.addClass("__drag_cancel");this._deselectCells();this._deselectAllController();this._hideContextMenu();this.startTopPos=this._$horizontalBar.offset().top;this.startHeight=a.pageY;var c=this._getBasisCellPosition(b[0]);this.allAffectedCells=this._getAllAffectedCells(c.x,c.y,2,this.elSelectionStartTable)},_onMouseMoveOnResizeHorizontalBar:function(a){if(!this.isResizing){return}var b=a.pageY-this.startHeight;var c=this.startTopPos+b-this._getTopCorrectedGap();this._$horizontalBar.css("top",c+"px")},_onMouseUpOnResizeHorizontalBar:function(a){if(!this.isResizing){return}this._$elContainer.removeClass("__drag_cancel");this.isResizing=false;var b=a.pageY-this.startHeight;this._resizeAffectedCellsHeight(b);this._drawTableController();this._requestCompHistory();this._locateResizeBar(this._$resizeTargetCell);this.startTopPos=null;this.startHeight=null},_resizeAffectedCellsHeight:function(a){var b;var c=this.allAffectedCells.aCellsBefore;for(var d=0;d<c.length;d++){var e=c[d];b=0;b=e.style.height;if(isNaN(parseFloat(b,10))){b=0}else{b=parseFloat(b,10)}b+=a;e.style.height=Math.max(b,this.TABLE_CONFIG.MIN_CELL_HEIGHT)+"px"}var f=this.allAffectedCells.aCellsAfter;for(var d=0;d<f.length;d++){var e=f[d];b=0;b=e.style.height;if(isNaN(parseFloat(b,10))){b=0}else{b=parseFloat(b,10)}b-=a;e.style.height=Math.max(b,this.TABLE_CONFIG.MIN_CELL_HEIGHT)+"px"}},_onMouseDownVerticalBar:function(a){this.isResizing=true;var b=this._$resizeTargetCell;this._$elContainer.addClass("__drag_cancel");this._deselectCells();this._deselectAllController();this._hideContextMenu();this.startLeftPos=this._$verticalBar.offset().left;this.startWidth=a.pageX;this._$elContainer.on("mousemove",this._onMouseMoveOnResizeVerticalBar.bind(this));this._$elContainer.on("mouseup",this._onMouseUpOnResizVerticaleBar.bind(this));var c=this._getBasisCellPosition(b[0]);this.allAffectedCells=this._getAllAffectedCells(c.x,c.y,1,this.elSelectionStartTable)},_onMouseMoveOnResizeVerticalBar:function(a){if(!this.isResizing){return}var b=a.pageX-this.startWidth;var c=this.startLeftPos+b-this._getLeftCorrectedGap();this._$verticalBar.css("left",c+"px")},_onMouseUpOnResizVerticaleBar:function(a){if(!this.isResizing){return}this._$elContainer.removeClass("__drag_cancel");this.isResizing=false;this._$elContainer.off();var b=a.pageX-this.startWidth;if(this._getNextCell(this._$resizeTargetCell[0])){this._resizeAffectedCellsWidth(b)}else{var c=this._getTableWidthPercentByMovingPixels(b);this.changeTableWidth(c)}this._drawTableController(true);this._requestCompHistory();this._locateResizeBar(this._$resizeTargetCell);this.startLeftPos=null;this.startWidth=null},_getTableWidthPercentByMovingPixels:function(a){var b=this.elSelectionStartTable.width();var c=parseInt((this._oModel.getTableWidth()*(b+a)/b).toFixed(0),10);c=Math.min(100,Math.max(1,c));return c},_resizeAffectedCellsWidth:function(a){if(this.allAffectedCells.nMinBefore!=-1&&a<-1*this.allAffectedCells.nMinBefore){a=-1*this.allAffectedCells.nMinBefore+this.TABLE_CONFIG.MIN_CELL_WIDTH}if(this.allAffectedCells.nMinAfter!=-1&&a>this.allAffectedCells.nMinAfter){a=this.allAffectedCells.nMinAfter-this.TABLE_CONFIG.MIN_CELL_WIDTH}var b;var c=[];var d=this.allAffectedCells.aCellsBefore;for(var e=0;e<d.length;e++){var f=d[e];b=0;b=$(f).outerWidth();if(isNaN(parseFloat(b,10))){b=0}else{b=parseFloat(b,10)}b+=a;c.push(b)}var g=[];var h=this.allAffectedCells.aCellsAfter;for(var e=0;e<h.length;e++){var f=h[e];b=0;b=$(f).outerWidth();if(isNaN(parseFloat(b,10))){b=0}else{b=parseFloat(b,10)}b-=a;g.push(b)}$.each(c,function(a,b){var c=$(this.allAffectedCells.aCellsBefore[a]);c.outerWidth(Math.max(b,this.TABLE_CONFIG.MIN_CELL_WIDTH))}.bind(this));$.each(g,function(a,b){var c=$(this.allAffectedCells.aCellsAfter[a]);c.outerWidth(Math.max(b,this.TABLE_CONFIG.MIN_CELL_WIDTH))}.bind(this))},_onMouseEnterOnCell:function(a){var b=$(a.target);if(this.isResizing){return}if(b[0].tagName!=="td"){b=b.closest("td")}this._$resizeTargetCell=b;this._locateResizeBar(b)},_locateResizeBar:function(a){var b=parseFloat(a.css("border-left"))*2;var c=a.offset().left+a.outerWidth(true)-this._getLeftCorrectedGap();var d=a.offset().top+a.outerHeight(true)-this._getTopCorrectedGap();this._$verticalBar.css("left",c+"px");this._$horizontalBar.css("top",d+"px")},_getLeftCorrectedGap:function(){var a=($(document.body).width()-this._getSectionAreaWidth())/2;var b=parseFloat(this._$tableWrap.css("margin-left"),10);return a+b},_getTopCorrectedGap:function(){var a=this._$elContainer.offset().top;return a},_onMouseLeaveOnCell:function(){if(!this.isMouseDown){return}if(this._textView&&this._textView.editableView.state.hasFocus){this._textView.blurFromEditable()}},showPreviewBy:function(a){var b=100;var c;if(a){this._previewType=a.sType;this._previewWidth=a.sSize}if(this._previewType!==$SE_CONFIG.PREVIEW_TYPE.PC){b=100;c=this._getTableWidth(this._previewWidth,this._previewType)}else{b=this._oModel.getTableWidth();c=this._getTableWidthForPC()}this._setWidthTableWrap(b);this._setTableWidth(c)},_getTableWidthForPC:function(){var a=this._tableWidthPX;var b=this._oModel.getTableWidth();var c=b===100;var d=this._oModel.getColumnCount()===this.TABLE_CONFIG.DEFAULT_COLUMN;if(c&&d){a=parseInt($SE_CONFIG.SERVICE_CONFIG.CONTENTS_STANDARD_WIDTH,10)}return a},_getPreviewType:function(){var a="";var b=parseInt(this._previewWidth,10);var c=parseInt($SE_CONFIG.PREVIEW_SIZE.MOBILE,10);var d=parseInt($SE_CONFIG.PREVIEW_SIZE.TABLET,10);if(b<=c){a=$SE_CONFIG.PREVIEW_TYPE.MOBILE}else if(b<=d){a=$SE_CONFIG.PREVIEW_TYPE.TABLET}else{a=$SE_CONFIG.PREVIEW_TYPE.PC}return a},_getTableWidth:function(a,b){var a=parseInt(a,10)||$SE_CONFIG.SERVICE_CONFIG.CONTENTS_STANDARD_WIDTH;var c=this.PREVIEW_DEFAULT_COLUMN.MOBILE;var d=this._oModel.getColumnCount();if(b===$SE_CONFIG.PREVIEW_TYPE.TABLET){c=this.PREVIEW_DEFAULT_COLUMN.TABLET}if(c>=d){return"100%"}return a/c*d},_setTableWidth:function(a){if(a==="100%"){this.elSelectionStartTable[0].style.width=a}else{this.elSelectionStartTable.width(a)}},_onMouseDownOnCell:function(a){var b=a.currentTarget;this.isMouseDown=true;this.isLeaveOnEditable=false;this._deselectCells();this._deselectAllController();this._hideContextMenu();this._mouseLeaveOnEditable=function(a){this.isLeaveOnEditable=true;this._textView.blurFromEditable()}.bind(this);if(this._textView){this._textView.$el.on("mouseleave",".se_cellArea",this._mouseLeaveOnEditable)}this.startCell=b;this.htSelectionSPos=this._getBasisCellPosition(b);this._oToolbar.closeActiveButton()},_onMouseMoveOnCell:function(a){var b=a.currentTarget;this._$currentCell=b;if(!this.isMouseDown){return}this.htSelectionEPos=this._getBasisCellPosition(b);if(!this._isSelectedSingleCell()||this.isLeaveOnEditable){this._selectBetweenCells(this.startCell,b);this._selectController();this.isLeaveOnEditable=true}},enableEditable:function(a){var b=this._getBasisCellPosition(a);var c=this._textViewMap[b.x+"_"+b.y];if(!c){this._composeSubViews(a)}else{this._textView=c}},_onMouseUpOnCell:function(a){var b=a?a.currentTarget:this._$currentCell;if(!this.isMouseDown){return}if(this._textView){this._textView.$el.off("mouseleave",".se_cellArea",this._mouseLeaveOnEditable)}if(!this.isLeaveOnEditable){this.enableEditable(b);this.focusTextView()}else{this._selectCellsAndEnableEditable(b);this._showContextMenu()}this.updateToolbarByStyle();this.isLeaveOnEditable=false;this.isMouseDown=false;this._$currentCell=null;
},_hideContextMenu:function(){this._elContextMenu.removeClass("is-on")},_showContextMenu:function(){if(this._previewType!==$SE_CONFIG.PREVIEW_TYPE.PC){return}var a=this._elColControllers.find(".is-on").last();var b=this._elRowControllers.find(".is-on").first();if(!a.offset()||!b.offset()){return}var c=a.parent().parent().offset();var d=this._getBorderWidth(b).top;var e=b.offset().top-c.top-d;var f=a.offset().left-c.left+a.width();var g=this.htSelectionEPos.x===this.htMap.length-1;var h={top:e,right:"",left:f};if(g){h.right=0;h.left=""}this._setStateContextBtn();this._elContextMenu.css(h).addClass("is-on")},_getBorderWidth:function(a){var b={top:0,left:0};b.top=parseFloat(a.css("border-top-width"))||0;b.left=parseFloat(a.css("border-left-width"))||0;return b},_setStateContextBtn:function(){var a=this._elContextMenu.find(".delete");var b=this._elContextMenu.find(".merge");var c=this._isSelectedSingleCell();var d=this._getStateSelectedLine();var e="";var f="is-disabled";if(c===1){b.addClass(f)}else{b.removeClass(f)}switch(d){case"column":a.removeClass(f);e="deleteColumn";break;case"row":a.removeClass(f);e="deleteRow";break;case"all":a.removeClass(f);e="deleteAll";break;default:a.addClass(f)}a.data("contextMenu",e)},_getStateSelectedLine:function(){var a=false;var b=this.htMap[0].length-1;var c=this.htMap.length-1;var d=Math.abs(this.htSelectionEPos.x-this.htSelectionSPos.x);var e=Math.abs(this.htSelectionEPos.y-this.htSelectionSPos.y);var f=e===this.htMap[0].length-1;var g=d===this.htMap.length-1;if(b===e){a="column"}else if(c===d){a="row"}if(f&&g){a="all"}return a},_selectCellsAndEnableEditable:function(a){this.htSelectionEPos=this._getBasisCellPosition(a);this._selectBetweenCells(this.startCell,a);this._selectController();$.each(this.aSelectedCells,function(a,b){this.enableEditable(b)}.bind(this))},_getStyleMapper:function(a,b){return b.getStyleMapper({})},_getCompStyleByClass:function(a,b){return a.currentStyle(b)},_makeBtnStates:function(a){return{fontFamily:a.fontFamily,fontSizeTable:a.fontSize,fontColor:a.fontColor,strikeThrough:a.strikeThrough,bold:a.bold,textAlignGroup:a.textAlign,tableWidth:a.tableWidth,borderStyle:a.borderStyle}},_checkStyleToToolbar:function(a,b,c){if(this._textView){var d=this._getStyleMapper(b,a);var e=a.extractStyle("start",d);if(!e){return}}else{var e={}}e.textAlign=this.getAlign();e.componentAlignGroup=this.getComponentAlign();e.tableWidth=b.getTableWidth();e.borderStyle={styleName:this._getBorderStyle(),color:this._getBorderColor()};c.changeBtnValue(this._makeBtnStates(e))},updateToolbarByStyle:function(a,b){if(a&&a.which===229){return}var c=this._checkStyleToToolbar.bind(this,this._textView,this._oModel,this._oToolbar);this.clearCheckStyle();if(b){this._nTimerCheckStyle=setTimeout(c,b)}else{c()}},clearCheckStyle:function(){clearTimeout(this._nTimerCheckStyle);this._nTimerCheckStyle=null},focusTextView:function(a){this._textView.enableEditable();this._textView.focusToEditable();this._textView.focusWithAction(a);this._locateResizeBar(this._getEditingCells(this._textView.$el));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this);this._showToolbar()},_clearAllTextView:function(){this._textView=null;this._textViewMap={}},_isSelectedSingleCell:function(){return this.htSelectionSPos.x===this.htSelectionEPos.x&&this.htSelectionSPos.y===this.htSelectionEPos.y},getBackgroundColor:function(){var a=this._getEditingCells();var b="";var c="";this._removeClassFromSelection();for(var d=0,e=a.length;d<e;d++){var f=$(a[d]);if(b===""){b=f.css("background-color")}if(b!==f.css("background-color")){c=this.TABLE_CONFIG.DEFAULT_BACKGROUND_COLOR;break}else{c=b}}this._addClassToSelection();return c},setBackgroundColor:function(a){if(typeof a!=="string"){return}var b=this._getEditingCells();$.each(b,function(b,c){$(c).css("background-color",a)}.bind(this));this._deselectCells();this._deselectAllController()},_getEditingCells:function(){var a;if(this.aSelectedCells.length>0){a=this.aSelectedCells}else{a=this._getEditableFocusedCell()}return a},_getEditableFocusedCell:function(){return this._textView&&this._textView.$el.closest(".se_cell")||null},_unbindEvent:function(){this.elSelectionStartTable.off();this._$verticalBar.off();this._$horizontalBar.off();this._elContextMenu.off();this._elSelectAllBtn.off();this._elRowControllers.off();this._elColControllers.off()},_IMPL_onRender:function(a,b){return a(b)},_IMPL_onAfterRender:function(){var a=this._oModel.getTableRows();this._drawTableView(a);this._assignElements();this._bindEvent();this.showPreviewBy();if(this._oModel.getTableWidth()===100){this._oToolbar.disableButton(["componentAlignGroup"])}this._toggleTableWidthToolbar()},_IMPL_onMounted:function(){this._setTableWidthByPixels();this._setAllCellsWidth();this._setAllCellsHeight();this._drawTableController()},_getSectionAreaWidth:function(){return parseInt($SE_CONFIG.SERVICE_CONFIG.CONTENTS_STANDARD_WIDTH,10)},_setTableWidthByPixels:function(){if(this._previewType!==$SE_CONFIG.PREVIEW_TYPE.PC){this._setTableWidth("100%");return}var a=this._oModel.getTableWidth();var b=this._getSectionAreaWidth();this._tableWidthPX=b*(a/100);this.elSelectionStartTable.width(this._tableWidthPX)},_setAllCellsWidth:function(){var a=this._getSectionAreaWidth();var b=this.elSelectionStartTable.find("td");_.forEach(b,function(b){var c=parseFloat(b.style.width,10).toFixed(8);b.style.width=a*(c/100)+"px"}.bind(this))},_setAllCellsHeight:function(){var a=this.elSelectionStartTable.find("td");_.forEach(a,function(a){var b=$(a);var c=parseFloat($(a).attr("data-height"),10);b.outerHeight(c);b.attr("data-height",null)}.bind(this))},_composeSubViews:function(a){var b=this._makeEditableView(this._getCompileValue(a));var c=this._makeTextView(b);c.appendTo(a);var d=this._getBasisCellPosition(a);this._textViewMap[d.x.toString()+"_"+d.y.toString()]=c;this._textView=c},_getCompileValue:function(a){var b=$(a).find(".__se_editable_value");var c=[];for(var d=0,e=b.length;d<e;d++){var f=b[d];c.push($(f).html());$(f).remove()}return c.join("<br>")},_makeEditableView:function(a){return new se.EditableSubCompView({ieMode:$SE_COMMON_UTIL.detectIE(),state:{value:a},template:se.editor.template.canvas["tableEditableView.hbs"],events:{keyup:function(a,b){if(b.isInitialized){this.updateToolbarByStyle()}this._drawTableController()}.bind(this),mouseup:function(a){this.updateToolbarByStyle(a,500)}.bind(this),mousedown:function(a,b){if(b.isInitialized){this._oToolbar.closeActiveButton()}}.bind(this)}})},_makeTextView:function(a){return new se.TextSubCompView({template:se.editor.template.canvas["tableTextView.hbs"],subViews:{editableView:{selector:".__textArea",view:a,strategy:"append"}}})},_updateTableViewToModel:function(){var a=this._$elContainer.find(".__se_viewArea");this._removeClassFromSelection();this._oModel.setTableRows(a);this._addClassToSelection()},_drawTableController:function(a){var b="",c="";this._setControllerPositionList();b=this._getColController(this._colControllerWidths);this._elColControllers.html(b);if(!a){c=this._getRowController(this._rowControllerHeights);this._elRowControllers.html(c)}},_insertTable:function(a){var b=se.editor.template.canvas["tableView.hbs"];var c=b({cells:a,tableInlineStyle:this._oModel.getTableInlineStyle()});this._$elContainer.find(".__se_tableView_insert_point").html(c);return c},_getTableHtml:function(a){var b=se.editor.template.canvas["tableView-row.hbs"];var c=se.editor.template.canvas["tableView-column.hbs"];var d="";for(var e=0;e<a.length;e++){var f="";var g=a[e].tableColumns.length;for(var h=0;h<g;h++){var i=a[e].tableColumns[h];f=f.concat(c({tableInlineStyle:i.tableInlineStyle,columnClassName:i.columnClassName,colSpan:i.colSpan,rowSpan:i.rowSpan,width:i.width,height:i.height,backgroundColor:i.backgroundColor,value:this._drawEditableHtml(i.value),textAlign:i.textAlign}))}d=d.concat(b({rowClassName:a[e].rowClassName,columns:f}))}return d},_setControllerPositionList:function(){var a=[],b=[];var c=this.elSelectionStartTable.offset().left;var d=this.elSelectionStartTable.offset().top;var e=this.elSelectionStartTable.outerWidth();var f=this.elSelectionStartTable.outerHeight();var g=this._getBorderWidth(this.elSelectionStartTable);this._colControllerWidths=[];this._rowControllerHeights=[];$.each(this.htMap,function(e,f){$.each(f,function(f,h){if(!h){return}var i=$(h);var j=i.offset();var k=j.left;var l=j.top;var m=k-c;var n=l-d;var o=this._getBorderWidth(i);var p=o.left+g.left;var q=o.top+g.top;if(e>0&&m>p){b.push(m)}if(f>0&&n>q){a.push(n)}}.bind(this))}.bind(this));b.push(e);a.push(f);this._colControllerWidths=this._getUniqueSortNumber(b);this._rowControllerHeights=this._getUniqueSortNumber(a)},_getUniqueSortNumber:function(a){return $.unique(a.sort(function(a,b){return a-b}))},_getColController:function(a){var b=se.editor.template.canvas["tableController-column.hbs"];var c="";var d=0;for(var e=0;e<a.length;e++){var f=a[e]-d;c=c.concat(b({index:e,width:f+"px"}));d+=f}return c},_getRowController:function(a){var b=se.editor.template.canvas["tableController-row.hbs"];var c="";var d=0;for(var e=0;e<a.length;e++){var f=a[e]-d;c=c.concat(b({index:e,height:f+"px"}));d+=f}return c},_drawEditableHtml:function(a){var b=se.editor.template.canvas["tableEditableView.hbs"];var c;c=b({value:a});return c},_drawTableView:function(a){var b=a.length;var c="";if(b>0){c=this._getTableHtml(a)}else{c=this._getDefaultTableHtml()}this._insertTable(c)},_getDefaultTableHtml:function(){var a=se.editor.template.canvas["tableView-row.hbs"];var b=se.editor.template.canvas["tableView-column.hbs"];var c="";for(var d=0;d<this.TABLE_CONFIG["DEFAULT_ROW"];d++){var e="";for(var f=0;f<this.TABLE_CONFIG["DEFAULT_COLUMN"];f++){e=e.concat(b({width:(100/this.TABLE_CONFIG["DEFAULT_COLUMN"]).toFixed(8),height:this.TABLE_CONFIG.DEFAULT_CELL_HEIGHT,value:this._drawEditableHtml()}))}c=c.concat(a({columns:e}))}return c},_IMPL_onAfterMountToolbar:function(){this._oToolbar.setBtnClickEventListener(this.handleClickToolbar.bind(this));this._oToolbar.changeBtnValue({tableLayoutGroup:this._oModel.getLayout(),borderStyle:{styleName:this._getBorderStyle(),color:this._getBorderColor()},tableWidth:this._oModel.getTableWidth(),componentAlignGroup:this.getComponentAlign()});this._toggleComponentAlignGroupToolbar(this._oModel.getTableWidth())},getTableWidthMinValue:function(){var a=this._oModel.getColumnCount()||3;var b=a*this.TABLE_CONFIG.MIN_CELL_WIDTH;return Math.ceil(b/this._getSectionAreaWidth()*100)},_toggleTableWidthToolbar:function(){var a=this._getSectionAreaWidth();if(this.elSelectionStartTable.width()>a+this.TABLE_CONFIG.MIN_CELL_WIDTH){this._oToolbar.disableButton(["tableWidth"])}else{this._oToolbar.enableButton(["tableWidth"])}},_toggleComponentAlignGroupToolbar:function(a){if(0<a&&100>a){this._oToolbar.enableButton(["componentAlignGroup"])}else{this._oToolbar.disableButton(["componentAlignGroup"])}},handleClickToolbar:function(a,b,c,d,e){this._hideContextMenu();this._textView&&this._textView.restoreSelection();this._executeEditByGroup(b,c)},_executeEditByGroup:function(a,b){var c=this._getEditingCells();switch(a){case"bold":case"strikeThrough":this.toggleStyle(a);break;case"fontSizeParagraph":this.changeFontSize(b);break;case"fontColor":this.changeFontColor(b);break;case"fontFamily":this.changeFontFamily(b);break;case"textAlignGroup":this.changeAlign(b);break;case"cellBackgroundColor":this.changeCellBackgroundColor(b);break;case"borderStyle":this.changeBorderStyle(b);break;case"tableWidth":this.changeTableWidth(b);break;case"tableLayoutGroup":this.changeComponentLayout(b);break;case"componentAlignGroup":this.changeComponentAlign(b);break;case"delete":setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,$SE_CONFIG.TRIGGER.TRASH)},4);break}this._drawTableController()},changeBorderStyle:function(a){if(typeof a!=="object"){return}if(a.type==="color"){this._setBorderColor(a.value)}else if(a.type==="style"){this._setBorderStyle(a.value)}this._requestCompHistory()},_setBorderStyle:function(a){var b=this.elSelectionStartTable;var c=b.find("td");b.css({"border-spacing":a.tableBorderSpacing,"border-collapse":a.tableBorderCollapse,"border-width":a.tableBorderWidth,"border-style":a.tableBorderStyle,"border-color":a.borderColor});$.each(c,function(b,c){$(c).css("border-width",a.borderWidth).css("border-style",a.borderStyle).css("border-color",a.borderColor)}.bind(this));this._oModel.setTableInlineStyle(this._getTableInlineStyle());this._oModel.setBorderStyleName(a.styleName)},_getTableInlineStyle:function(){var a=this.elSelectionStartTable;var b=a.attr("style").split(";");var c=[];c=_.filter(b,function(a){var b=a.split(":");var c=b[0].trim();return c!=="width"});return c.join(";")},_getBorderStyle:function(){return this._oModel.getBorderStyleName()||this.TABLE_CONFIG.DEFAULT_BORDER_STYLE.STYLE_NAME},_setBorderColor:function(a){var b=this.elSelectionStartTable;var c=b.find("td");b.css("border-color",a);c.css("border-color",a);b.attr("data-border-color",a);this._oModel.setTableInlineStyle(this._getTableInlineStyle())},_getBorderColor:function(){return this.elSelectionStartTable.attr("data-border-color")||this.TABLE_CONFIG.DEFAULT_BORDER_STYLE.COLOR},selectFullContentRange:function(a,b){a.editableView.editable.selectNodeContents($(b).find(".__se_editable_value")[0])},changeMultiCellStyle:function(a,b){$.each(this.aSelectedCells,function(c,d){this.enableEditable(d);var e=this._getBasisCellPosition(d);var f=this._textViewMap[e.x+"_"+e.y];f.enableEditable();this.selectFullContentRange(f,d);switch(a){case"bold":case"strikeThrough":f.toggleStyle(a);break;case"fontSize":case"fontFamily":f.setInlineStyleByClass(a,b);break;case"fontColor":f.changeFontColor(b);break}setTimeout(function(){f.blurFromEditable()},500)}.bind(this))},toggleStyle:function(a){if(this.aSelectedCells.length>0){this.changeMultiCellStyle(a)}else{this._textView&&this._textView.toggleStyle(a)}this._requestCompHistory()},changeFontSize:function(a){if(typeof a!=="string"){return}if(this.aSelectedCells.length>0){this.changeMultiCellStyle("fontSize",a)}else{this._textView&&this._textView.setInlineStyleByClass("fontSize",a)}this._requestCompHistory()},changeFontFamily:function(a){if(typeof a!=="string"){return}if(this.aSelectedCells.length>0){this.changeMultiCellStyle("fontFamily",a)}else{this._textView&&this._textView.setInlineStyleByClass("fontFamily",a)}this._requestCompHistory()},changeFontColor:function(a){if(typeof a!=="string"){return}if(this.aSelectedCells.length>0){this.changeMultiCellStyle("fontColor",a)}else{this._textView&&this._textView.changeFontColor(a)}this._requestCompHistory()},changeTableWidth:function(a){if(typeof a!=="number"){return}var b=this.getTableWidthMinValue();if(a<b){a=b}this._tableWidthPX=this._getSectionAreaWidth()*(a/100);this._changeTableWidthUI(a);this._oModel.setTableWidth(a);this._requestCompHistory()},_changeTableWidthUI:function(a){this._setWidthTableWrap(a);this.elSelectionStartTable.width(this._tableWidthPX);this._refreshCellsWidth();this._toggleComponentAlignGroupToolbar(a);this._oToolbar.changeBtnValue({tableWidth:a})},_setWidthTableWrap:function(a){this._$tableWrap.width(a+"%")},changeCellBackgroundColor:function(a){if(typeof a!=="string"){return}this.setBackgroundColor(a);this._requestCompHistory()},getComponentAlign:function(){return this._oModel.getComponentStyle()["align"]||"left"},changeComponentLayout:function(a){if(typeof a==="boolean"){return}this._changeLayoutUI(a);this._oModel.setLayout(a);this._deselectCells();this._removeInlineCellStyle();this._refineStyleBy(this.elSelectionStartTable[0]);this._restoreDefaultBorderStyle();this._requestCompHistory()},_restoreDefaultBorderStyle:function(){var a=this.TABLE_CONFIG.DEFAULT_BORDER_STYLE;this._oModel.setBorderStyleName(a.STYLE_NAME);this._oToolbar.changeBtnValue({borderStyle:{styleName:a.STYLE_NAME,color:a.COLOR}})},_removeInlineCellStyle:function(){var a=this._$elContainer.find("td");a.each(function(a,b){this._refineStyleBy(b)}.bind(this))},_refineStyleBy:function(a){var b=$(a.style);b.each(function(b,c){if(this.CELL_STYLES.indexOf(c)<0){a.style[c]=""}}.bind(this))},_changeLayoutUI:function(a){this._$elContainer.removeClass(this._currentLayout).addClass(a);this._currentLayout=a},changeComponentAlign:function(a){if(typeof a!=="string"){return}this._changeComponentAlignUI(a);this._oModel.setComponentStyle({align:a});this._requestCompHistory()},_changeComponentAlignUI:function(a){$SE_STYLE_HELPER.changeAlignClassName(this._$sectionArea,a);this._oToolbar.changeBtnValue({componentAlignGroup:a})},getAlign:function(){var a=this.TABLE_CONFIG.DEFAULT_ALIGN;var b=this._getEditingCells();if(b){var c=[];_.forEach(b,function(a){var b=$SE_STYLE_HELPER.getAlignForModel($(a))||this.TABLE_CONFIG.DEFAULT_ALIGN;c.push(b)}.bind(this));c=_.uniq(c);if(c.length===1){a=c[0]}}return a},changeAlign:function(a){if(typeof a!=="string"){return}var b=this._getEditingCells();var c=this.TABLE_CONFIG.ALIGN_PREFIX;$.each(b,function(b,d){var e=d.className.match(this.TABLE_CONFIG.REGEX.ALIGN)?d.className.match(this.TABLE_CONFIG.REGEX.ALIGN)[1]:this.TABLE_CONFIG.DEFAULT_ALIGN;var f=c+e;f=f.toString().trim();$(d).removeClass(f).addClass(c+a)}.bind(this));this._requestCompHistory()},getPlainText:function(){return this.elSelectionStartTable.find("td").text()},_IMPL_onFocusIn:function(a){if(a.action!==$SE_CONFIG.ACTION.MOVE){this.enableEditable(this.htMap[0][0]);this.focusTextView()}this.updateToolbarByStyle()},_IMPL_onFocusOut:function(){this._deselectCells();this._deselectAllController();this._hideContextMenu();this.isMouseDown=false;this.isLeaveOnEditable=false;this._textView&&this._textView.disableEditable();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onUpdateModel:function(){this._updateTableViewToModel();this._drawTableController()},_IMPL_onUpdateUI:function(){$SE_FOCUS_HELPER.blurFromActiveElement();this.focusOut();this._unbindEvent();this._clearAllTextView();var a=this._oModel.getTableRows();this._drawTableView(a);this._assignElements();this._bindEvent();this._setTableWidthByPixels();this._setAllCellsWidth();this._setAllCellsHeight();this._changeTableWidthUI(this._oModel.getTableWidth());this._changeLayoutUI(this._oModel.getLayout());this._changeComponentAlignUI(this._oModel.getComponentStyle().align);this._drawTableController();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onUpdateStyle:function(a,b){},_IMPL_onReadonly:function(a){},_IMPL_onDestroyed:function(){this._unbindEvent()}});se.defineClass("se.WrappingParagraphCompView",se.BaseCompView,{construct:function(){this._initVar()},_initVar:function(){this._sId=this._createId("wp");this._prevLayout=this._oModel.getLayout();this._aroundSlot=this._createAroundSlot();this._wrapSlot=this._createWrapSlot();this._activeSlot=null;this._onEnterCaption=this._onEnterCaption.bind(this);this._onKeyDownDelete=this._onKeyDownDelete.bind(this,this._aroundSlot.isCursorAtEnd.bind(this._aroundSlot));this._onKeyDownBackspace=this._onKeyDownBackspace.bind(this,this._aroundSlot.isCursorAtStart.bind(this._aroundSlot))},_createAroundSlot:function(){var a={parentId:this.getId(),toolbar:this._oToolbar,buttonSetPolicy:this._buttonSetPolicy,events:{mousedown:this._onMouseDownAround.bind(this),onDecomposed:this._onDecomposed.bind(this),onChangeText:this._onChangeTextFromAround.bind(this),onChangeComponent:this._onChangeAroundComp.bind(this)}};var b=this._oModel.getParagraph();return new se.AroundParagraphSlot(b,a)},_createWrapSlot:function(){var a=this._oModel.getWrapComp();var b=a.getCompType();var c=se["Wrap"+$SE_STRING.capitalize(b)+"Slot"];var d={toolbar:this._oToolbar,buttonSetPolicy:this._buttonSetPolicy,layout:this._oModel.getLayout(),events:{mousedown:this._onMouseDownWrapSlot.bind(this),onLoaded:this._onLoadedWrapSlot.bind(this),onDecomposed:this._onDecomposed.bind(this),onChangeLayout:this._onChangeLayout.bind(this),onChangeComponent:this._onChangeTextFromWrap.bind(this),onChangeText:this._onInputFromWrap.bind(this)}};return new c(a,d)},_onEnterCaption:function(a){if(a.target.classList.contains("__captionView")){this.focus("aroundSlot",{trigger:$SE_CONFIG.TRIGGER.ENTER,action:$SE_CONFIG.ACTION.MOVE})}return false},_onChangeTextFromAround:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CONVERT_PORTION_AS_COMP,this.getId(),a,b);this._updateMinHeightOfAroundSlot()},_onInputFromWrap:function(){this._updateMinHeightOfAroundSlot()},_onMouseDownAround:function(){this.focus("aroundSlot")},_onChangeTextFromWrap:function(a){this._oModel.setWrapComp(a);setTimeout(this._updateMinHeightOfAroundSlot.bind(this),1);this._requestCompHistory();this._requestUpdateLibrary()},_onChangeAroundComp:function(a){this._oModel.setParagraph(a);this._requestCompHistory()},_onLoadedWrapSlot:function(){this._updateMinHeightOfAroundSlot()},_onMouseDownWrapSlot:function(a){this.focus("wrapSlot",a)},_onChangeLayout:function(a){this._changeLayout(a);this._wrapSlot.resize();this._updateMinHeightOfAroundSlot();this._requestCompHistory()},_onKeyDownDelete:function(a,b){if(a.call(null)===false){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_AFTER_COMP,this,b.which);b.preventDefault();b.stopPropagation()},_onKeyDownBackspace:function(a,b){if(a.call(null)){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_BEFORE_COMP,this,b.which);b.preventDefault();b.stopPropagation()}else if(this._aroundSlot.unwrapDropCapByKeyBoard()){b.preventDefault();b.stopPropagation()}},_onDecomposed:function(a,b){if(a==="delete"){setTimeout(this.deleteSingleSlot.bind(this,b),1)}else{setTimeout(this.decompose.bind(this,a,b),1)}},_IMPL_onAfterRender:function(){this._composeSubViews(this._$elContainer.find(".__editArea"))},_IMPL_onMounted:function(){this._updateMinHeightOfAroundSlot()},_IMPL_onUpdateModel:function(){this._syncModelWithUI()},_IMPL_onUpdateUI:function(){this._updateUIWithModel();if(this._bFocused){this._focusOnly("wrapSlot")}},_IMPL_onUpdateStyle:function(a,b){this._aroundSlot.updateStyle(a,b)},_IMPL_onFocusIn:function(a){a=a||{};if(a.action==="insert"){return}this._bindEvent();this.focus(this.adviceEventSlot(a.$event,a.trigger),a)},_IMPL_onFocusOut:function(){this.blur();this._unbindEvent()},_IMPL_onReadonly:function(a){this._wrapSlot.readonly(a);this._aroundSlot.readonly(a)},_IMPL_onResize:function(){this._wrapSlot.resize();this._updateMinHeightOfAroundSlot()},_IMPL_onDestroyed:function(){if(this._aroundSlot){this._aroundSlot.destroy();this._wrapSlot.destroy()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_IMPL_onRefineDataByTheme:function(a){var b=this._wrapSlot;var c=b.getModel();var d,e,f;if(c.getCompType()!=="quotation"){return}d=b.getQuotationType(c.getLayout());e=b.supportThemeList.indexOf(a)>=0;f=b.supportTypeList.indexOf(d)>=0;if(!e&&!f){b.updateUIByQuotationBtn("blockquote",b.TYPES.DEFAULT)}},_requestUpdateLibrary:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ADD_LIBRARY_RESOURCE,this,false,true)},_joinWrapCompDataWith:function(a,b){var c=this._getWrapCompData();c[a]=b;return c},_getAroundCompData:function(){return this._aroundSlot.getModel().getJson()},_getWrapCompData:function(){var a=this._wrapSlot.getModel();return a.getJsonWithCompId()},decompose:function(a,b){var c=this._getAroundCompData();var d=this._joinWrapCompDataWith(a,b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DECOMPOSE,this,c,d)},_extractOppositeCompData:function(a){return a==="wrapSlot"?this._getAroundCompData():this._getWrapCompData()},deleteSingleSlot:function(a){a=a||"wrapSlot";var b=this._extractOppositeCompData(a);if(a==="wrapSlot"){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_REMOVE_COMPONENT,[this.getId()])}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{target:this,compData:b,shouldFocus:true,shouldUpdateLibrary:true,bPushHistory:true})},_bindEvent:function(){this._aroundSlot.bindEvents();this._wrapSlot.bindEvents()},_unbindEvent:function(){this._aroundSlot.unbindEvents();this._wrapSlot.unbindEvents()},_composeSubViews:function(a){var b=this._aroundSlot.render(a);var c=b.find(".__subWrap");this._wrapSlot.prependTo(c)},_changeLayout:function(a){var b=this._prevLayout;var c=a;var d=this._$elContainer[0].classList;d.remove("se_"+b);d.add("se_"+c);this._oModel.setLayout(c);this._prevLayout=c},_isMobileDeviceView:function(){return $(document.body).width()>768},_updateMinHeightOfAroundSlot:function(){var a=1;if(this._isMobileDeviceView()){a=this._wrapSlot.height()}this._aroundSlot.changeMinHeight(a)},_isFromWrappingSlot:function(a){if(!a){return true}return this._wrapSlot.isContain($(a.target))},adviceEventSlot:function(a,b){if(b===$SE_CONFIG.TRIGGER.UP||b===$SE_CONFIG.TRIGGER.LEFT||b===$SE_CONFIG.TRIGGER.PASTE||b===$SE_CONFIG.TRIGGER.BACKSPACE||b===$SE_CONFIG.TRIGGER.DELETE){return"aroundSlot"}if(this._isFromWrappingSlot(a)){return"wrapSlot"}return"aroundSlot"},deleteSubCompWithLibrary:function(){this.deleteSingleSlot("wrapSlot")},getCurrentSlotDataAsJson:function(){if(this.isSelected()){return this.getModelDataAsJson()}else{return this._activeSlot.getModel().getJson()}},getImageDataAsJson:function(){var a=this.getModel().getWrapComp();if(a.getCompType()===$SE_CONFIG.COMP_TYPE.IMAGE){return a.getJson()}else{return null}},_syncModelWithUI:function(){this._wrapSlot.syncModel();this._aroundSlot.syncModel();this._oModel.setWrapComp(this._wrapSlot.getModel());this._oModel.setParagraph(this._aroundSlot.getModel())},_updateUIWithModel:function(){this._aroundSlot.repaint(this._oModel.getParagraph());this._wrapSlot.repaint(this._oModel.getWrapComp(),this._oModel.getLayout());this._changeLayout(this._oModel.getLayout());this._updateMinHeightOfAroundSlot();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ADD_LIBRARY_RESOURCE,[this])},_activateSlot:function(a){this._activeSlot=this["_"+a]},_clearActiveSlot:function(){this._activeSlot=null},_blurFromActive:function(){var a=this.getActiveSlot();if(a){a.blur()}},blur:function(){this._blurFromActive();this._clearActiveSlot();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.DEACTIVATE,this)},_focusOnly:function(a,b){this._activateSlot(a);this.getActiveSlot().focus(b)},_focusTo:function(a,b){this._focusOnly(a,b);this._updateMinHeightOfAroundSlot()},getSlot:function(a){return this["_"+a]},isCurrentSlot:function(a){return this.getActiveSlot()===this.getSlot(a)},_changeToolbarNclickPrefix:function(a){this._oToolbar.setNclickPrefix(this._getNclickPrefix(a))},focus:function(a,b){if(this.isCurrentSlot(a)){return}this._blurFromActive();this._focusTo(a,b);this._changeToolbarNclickPrefix(this._activeSlot.getCompType());setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.ACTIVATE,this,{fEnter:this._onEnterCaption,fBackspace:this._onKeyDownBackspace,fDelete:this._onKeyDownDelete})}.bind(this),1)},getActiveSlot:function(){return this._activeSlot},getRepresent:function(){return this._wrapSlot.getRepresent()},setRepresent:function(a){this._wrapSlot.setRepresent(a)},enablePlaceholder:function(){this._aroundSlot.enablePlaceholder()},disablePlaceholder:function(){if(this._aroundSlot){this._aroundSlot.disablePlaceholder()}},hidePlaceholder:function(){this._aroundSlot.hidePlaceholder()},showPlaceholder:function(){this._aroundSlot.showPlaceholder()},canSplitted:function(){return this._aroundSlot.canSplitted()},disableSplit:function(){this._aroundSlot.disableSplit()},enableSplit:function(){this._aroundSlot.enableSplit()},adviseInsertViewComp:function(a){return this._aroundSlot.adviseInsertViewComp(a)},isCursorAtStart:function(a){if(this.isCurrentSlot("wrapSlot")){return true}if(this._aroundSlot.isCursorAtStart()){this._focusToInactiveSlot();a.stopPropagation();a.preventDefault()}return false},isCursorAtEnd:function(a){if(this.isCurrentSlot("wrapSlot")){this._focusToInactiveSlot();a.stopPropagation();a.preventDefault();return false}return this._aroundSlot.isCursorAtEnd()},canMoveUpward:function(a){if(this.isCurrentSlot("wrapSlot")){return true}if(this._aroundSlot.canMoveUpward()){this._focusToInactiveSlot();a.stopPropagation();a.preventDefault()}return false},canMoveDownward:function(a){if(this.isCurrentSlot("wrapSlot")){this._focusToInactiveSlot();a.stopPropagation();a.preventDefault();return false}return this._aroundSlot.canMoveDownward()},_focusToInactiveSlot:function(){if(this.isCurrentSlot("aroundSlot")){this.focus("wrapSlot")}else{this.focus("aroundSlot")}},getPlainText:function(a){if(a==="around"){return this._aroundSlot.getPlainText()}return this._aroundSlot.getPlainText()+" "+this._wrapSlot.getPlainText()},getTextContents:function(a){if(a==="around"){return this._aroundSlot.getTextContents()}return this._aroundSlot.getTextContents()+" "+this._wrapSlot.getTextContents()},shouldDeleteSingleSlot:function(){return this.isWrappingParagraph()&&this.isSelected()===false},getEditableView:function(){return this._aroundSlot.getEditableView()},pasteHTML:function(a){if(a===""){return}var b=this.getActiveSlot();b.pasteHTML(a)},getLastStyle:function(){return this._aroundSlot.getLastStyle()}});se.defineController("se.CanvasViewController",{construct:function(){this._initVar();this._createModule();this._bindModuleEvent();this._bindGatewayEvent();this._preprocessByViewColumnCount();$SE_SCROLL_HELPER.initialize()},_initVar:function(){this._oDocument=null;this._htCacheCanvasHistoryData=null;this.RESTORE_TRANSACTION=false;this._aCopyStack=[];this._bIsInitialized=false;this._bEnablePushHistory=false;this._sEditingMode=$SE_CONFIG.EDITING_MODE.NORMAL;this._nShowTimer=-1},_createModule:function(){this._oKeyActionHandler=new se.CanvasKeyActionHandler;this._oFileDialogHandler=new se.FileDialogHandler;this._oComponentListView=new se.ComponentListView;new se.EditableMergeService;new se.EditAreaWatcher;new se.InsertGuideView;new se.CanvasHistoryHandler;new se.InsertPointMarkerView;new se.MediaContentsImagePositioner;new se.ImageToolTip;if($SE_CONFIG.SERVICE_CONFIG.FEATURES.TAGS){new se.TagsInput({$parent:$("#se_canvas_body"),template:se.editor.template.canvas["tags-input.hbs"]})}var a={aWhiteListStyle:["color","display","visibility"]};if($SE_COMMON_UTIL.detectIE()){a.aWhiteListStyle.push("background-color")}new se.CanvasCopyPasteHandler(a);this._dropImageUpload()},_dropImageUpload:function(){var a=new se.ImageFileUploaderComponent;this.contentDropZone=new se.DropZone($("#se_canvas_wrapper"),a);a.on("IMAGE_FILE_UPLOADER.COMPLETE_ALL",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,a)})},_bindModuleEvent:function(){},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT,function(a){window.focus();this.insertComponent(a)}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT_WITH_FILEDIALOGUE,function(a){window.focus();this.insertComponentWithFileDialogue(a)}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT_LIST_WITH_FILEDIALOGUE,function(a){window.focus();this.insertComponentListWithFileDialogue(a)}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMEN_TTITLE,function(){var a=this.getDocumentTitleComp();return a.getModelDataAsJson().title}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.GET_TAG,function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.GET_TAG_LIST)}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.GET_DOCUMENT,this.getDocument.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.RESTORE_CANVAS,this.restoreCanvas.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.GET_COMPONENTS_DATA,this.getComponentsData.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.RESTORE_COMPONENT,this.restoreComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.SHOW_INSERT_GUIDE_WITH_COORDINATE,this.showInsertGuideWithCoordinate.bind(this));
$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.FOCUS_OUT_FOCUSED,this.focusOutFocused.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.FOCUS_BY_COMP_TYPE,this.focusByCompType.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE,this.resetInsertGuide.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.FIND_COMPONENT_BY_ID,this.findComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.FIND_SUBCOMPONENT_BY_ID,this.findSubComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.DELETE_COMPONENT_BY_ID,this.deleteComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.DELETE_LIBRARIES_WITH_COMP,this.deleteLibrariesWithComp.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.APPLY_THEME,this.applyTheme.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.APPLY_DOC_STYLE,this.applyDocStyle.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.UPDATE_REPRESENTATIVE_IMAGE,this.updateRepresentativeImage.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.PULL_INSERT_GUIDE_TARGET,this.pullInsertGuideTarget.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY,this.requestPushHistory.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ADD_LIBRARY_RESOURCE,this.addLibraryResource.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_REMOVE_COMPONENT,this.requestPushRemoveComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.FIND_INSERT_POINT_MARKER_COMPONENT,this.findInsertPointMarkerComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CLEAR_ALL_LAYER,this.clearAllLayer.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.HIDE_INSERT_POINTS,this.hideInsertPoints.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.SHOW_DEFAULT_INSERT_POINT,this.showDefaultInsertPoint.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_COMP_HISTORY,this.requestPushCompHistory.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.START_DRAG,this.startDrag.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.STOP_DRAG,this.stopDrag.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.COMPLETE_DRAG,this.completeDrag.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CURRENT_EDITING_MODE,this.currentEditingMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_DRAGGING_MODE,this.changeDraggingMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_SELECTING_MODE,this.changeSelectingMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CHANGE_NORMAL_MODE,this.changeNormalMode.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DISABLED_PUSH_HISTORY,this.disabledPushHistory.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.ENABLED_PUSH_HISTORY,this.enabledPushHistory.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,this.replaceComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.WRAP_COMPONENT,this.wrapComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DECOMPOSE,this.decompose.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,this.insertComponentContext.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CONVERT_PORTION_AS_COMP,this.convertPortionAsComp.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.APPEND_EMPTY_LINE_WITH_FOCUS,this.appendEmptyLineWithFocus.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT,this.deleteComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.DELETE_COMPONENT_BY_ID,this.deleteComponentById.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.GET_COMPONENTS_DATA,this.getComponentsData.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.READONLY,this.readonly.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.BACKGROUND.SET_IMAGE_BACKGROUND_METRIC,this.setImageBackgroundMetric.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TABLE.CHANGE_PREVIEW,this._resizeTableCompsByPreview.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TERMS.SET_SUBTITLE,this.setTermsSubtitle);$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.TERMS.GET_SUBTITLE,this.getTermsSubtitle)},readDocument:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_DOCUMENT_DATA);this._oDocument=a.oDocument;var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_EDITOR_VIEW_TAG);var c=[];if(!$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_DOC_ID)&&b){a.oTagData=b.split(",")}if(b){c=a.oTagData}else{c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_META_DATA).getTags()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.SET_TAG_LIST,c);this._updateDocumentInfo();this.createCanvas(this._oDocument.getTheme(),this._oDocument.getComponents())},getDocument:function(){var a=this.getComponentsData();if(a&&a.length>1&&a[0]["@ctype"]===$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){this._oDocument.setTitle(a[0].title)}this._oDocument.setComponents(a);return this._oDocument},insertComponent:function(a){this.changeNormalMode();this.insertComponentContext(a)},insertComponentWithFileDialogue:function(a,b){this._oFileDialogHandler.insertViewCompWithFileDialogue(a,b)},insertComponentListWithFileDialogue:function(a,b){this._oFileDialogHandler.insertViewCompListWithFileDialogue(a,b)},showInsertGuideWithCoordinate:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RENDER_INSERT_GUIDE_WITH_COORDINATE,a,b)},resetInsertGuide:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET)},findComponentById:function(a){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a)},findSubComponentById:function(a){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_SUB_COMPONENT_BY_ID,a)},findComponentBySubComponentId:function(a){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_SUB_COMPONENT_ID,a)},pullInsertGuideTarget:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET);return a},getDocumentTitleComp:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DOCUMENT_TITLE)},_pushCanvasHistory:function(){if(this._hasCachedCanvasHistory()){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.PUSH_HISTORY,{TYPE:"canvas",DATA:$.extend(true,{},this._htCacheCanvasHistoryData)});this._clearCacheCanvasHistory()}var a=this.getDocument();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.PUSH_HISTORY,{TYPE:"canvas",DATA:$.extend(true,{},a.getJson(true))})},_pushCompHistory:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.PUSH_HISTORY,{TYPE:"component",DATA:a});this._cacheCanvasHistory()},_hasCachedCanvasHistory:function(){return this._htCacheCanvasHistoryData},_cacheCanvasHistory:function(){var a=this.getDocument();this._htCacheCanvasHistoryData=JSON.parse(JSON.stringify(a.getJson(true)))},_clearCacheCanvasHistory:function(){this._htCacheCanvasHistoryData=null},_addLibrary:function(a,b,c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ADD_LIBRARY_DATA,a,{bReset:b,bChangedOnToolbar:c})},restoreCanvas:function(a,b){this.restoreCanvasContext(a,b);this._updateDocumentInfo(a);if(this._getDocumentTitle()){this._getDocumentTitle().activateDropEvent()}},focusByCompType:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_BY_COMP_TYPE,a)},focusOutFocused:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED)},$ON_VIEW_COPY_COMP:function(){this._oKeyActionHandler.copyComponent()},$ON_VIEW_PASTE_COMP:function(){this._oKeyActionHandler.pasteComponent()},$ON_VIEW_DELETE_COMP:function(a){this._oKeyActionHandler.deleteComponent(a.keyCode);a.preventDefault()},$ON_VIEW_APPEND_AFTER_ACTIVATED:function(){this.appendEmptyLineWithFocus()},$ON_ENTER_SELETING_MODE:function(){this.enterSelectMode()},$ON_EXIT_SELETING_MODE:function(){this.exitSelectMode()},$ON_SELECT_ALL_COMP:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT_ALL)},$ON_VIEW_INSERT_COMP:function(a){if(a===$SE_CONFIG.COMP_TYPE.IMAGE||a===$SE_CONFIG.COMP_TYPE.VIDEO||a===$SE_CONFIG.COMP_TYPE.MAP){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.FILE_DIALOG.INSERT_COMPONENT_WITH_POPUP,{compData:a,shouldFocus:true})}else{this.insertComponent({compData:a,shouldFocus:true})}},$ON_MOVE_FOCUS_WITH_KEYBOARD:function(a){if(this.currentEditingMode()===$SE_CONFIG.EDITING_MODE.SELECT){return}if(this._isOnMentionLayer()){a.stopPropagation();a.preventDefault();return}var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.MOVE_FOCUS_WITH_KEY,a.keyCode,a);if(b){a.stopPropagation();a.preventDefault()}return b},_isOnMentionLayer:function(){if(!$SE_CONFIG.SERVICE_CONFIG.USE_AUTO_MENTION){return false}var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CURRENT_FOCUSED);return a&&a._oModel._compType==="paragraph"&&a._textView.editableView.state.isMentionLayerOpened},applyTheme:function(a){var b=$SE_MODEL_DATA_COORD.getCurrentTheme();this._updateDocumentInfo({theme:a});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_THEME,b,a)},applyDocStyle:function(a){this._cacheCanvasHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_DOC_STYLE,a)},updateRepresentativeImage:function(a,b){var c=a.aCompId;this._updateRepresentativeImageInfo(c,b)},_updateRepresentativeImageInfo:function(a,b){if(!a){return}_.each(a.reverse(),function(a){var c=this.findComponentById(a);if(c===undefined||c===null){c=this.findComponentBySubComponentId(a)}if(!c){return}if(b){c.setRepresent(true,a)}else{c.setRepresent(false,a)}}.bind(this))},_updateDocumentInfo:function(a){this._oDocument.updateData(a);$SE_MODEL_DATA_COORD.setCurrentTheme(this._oDocument.getTheme());this._oDocument.setDocumentStyle($SE_MODEL_DATA_COORD.getThemeDocStyle(this._oDocument.getTheme()))},_bindEvents:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"click",this._onClickOutside.bind(this),true);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"mouseleave",this._onMouseLeaveOutside.bind(this),true);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"contextmenu",this._onContextMenu.bind(this),false);this.contentDropZone.activateDropEvent();if(this._getDocumentTitle()){this._getDocumentTitle().activateDropEvent()}$(window).on("resize.CanvasViewController",se.util.Common.debounce(this._onResizeCanvasWindow.bind(this),100)).on("focus.CanvasViewController",this._onFocusCanvasWindow.bind(this));$(document).on("keyup.CanvasViewController",this._onKeyUpContext.bind(this)).on("mousedown.CanvasViewController",this._onMouseDownDocument.bind(this)).on("mouseup.CanvasViewController",this._onMouseUpDocument).on("mouseleave.CanvasViewController",this._onMouseLeaveDocument.bind(this)).on("mouseenter.CanvasViewController",this._onMouseEnterDocument.bind(this)).on("click.CanvasViewController","a[href]",this._onClickAnchorOnContentEditable.bind(this))},_unbindEvents:function(){$(window).off(".CanvasViewController");$(document).off(".CanvasViewController");this.contentDropZone.deactivateDropEvent();if(this._getDocumentTitle()){this._getDocumentTitle().deactivateDropEvent()}},_getDocumentTitle:function(){return this._oComponentListView.getCompViewList({compType:$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE})[0]},_getTableComps:function(){return this._oComponentListView.getCompViewList({compType:$SE_CONFIG.COMP_TYPE.TABLE})},_resizeTableCompsByPreview:function(a){var b=this._getTableComps();$(b).each(function(b,c){c.showPreviewBy(a)})},_preprocessByViewColumnCount:function(){var a=$SE_CONFIG.SERVICE_CONFIG.VIEW_COLUMN_COUNT;if(a!==""&&$SE_CONFIG.SERVICE_CONFIG.SERVICE_NAME==="blog"){document.body.classList.add("se_blog");document.body.classList.add("se_blog_layout"+a)}},_isFromEditable:function(a){var b=false;if(a.is("[contenteditable], textarea, input")){b=true}else if(a.parents("[contenteditable]").is("[contenteditable], textarea, input")){b=true}return b},_isFromComponent:function(a){return a.is(".se_sectionArea")||a.parents(".se_sectionArea").length>0},_onContextMenu:function(a){var b=$(a.target);if(a.ctrlKey===false&&a.which!==1&&this._isFromEditable(b)){return}this.clearSelection(false);if(a.ctrlKey&&this._isFromComponent(b)){return false}else{this.clearAllLayer();$(document).trigger("mouseup");$(document).trigger("keyup")}},_onMouseUpDocument:function(){$SE_SCROLL_HELPER.deactivate();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TABLE.MOUSE_UP_ON_CELL)},_onKeyUpContext:function(a){if(!a.shiftKey&&!a.ctrlKey&!a.metaKey){this.exitSelectMode()}},_onClickOutside:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);this.clearSelection();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESELECT_ALL);this.hideInsertPoints()},_onMouseLeaveOutside:function(){this.changeNormalMode()},_onResizeCanvasWindow:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESIZE);$SE_SCROLL_HELPER.update()},_onFocusCanvasWindow:function(){this.exitSelectMode()},_onMouseDownDocument:function(a){var b=$(a.target);if(b.is("input[type=file]")){return}if(this.currentEditingMode()===$SE_CONFIG.EDITING_MODE.SELECT){return}$SE_FOCUS_HELPER.blurFromActiveElement();$SE_SCROLL_HELPER.activate();this.clearAllLayer();this.clearSelection(false);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_INSERT_PANEL)},_onMouseLeaveDocument:function(){$SE_SCROLL_HELPER.pause();var a=this.currentEditingMode();if(a===$SE_CONFIG.EDITING_MODE.SELECT){return}this._changeDisabledMode();this.showDefaultInsertPoint(1e3);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.CLEAR_AUTO_LAYER)},_onMouseEnterDocument:function(){$SE_SCROLL_HELPER.resume();var a=this.currentEditingMode();if(a===$SE_CONFIG.EDITING_MODE.SELECT){return}this.changeNormalMode();clearTimeout(this._nTidHideInsertPointMarker)},_onClickAnchorOnContentEditable:function(a){if($(a.target).parents("[contenteditable]").length>0){return false}},_onCreated:function(){this._bIsInitialized=true;this._bindEvents();this.enabledPushHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.BIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"outter");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.FETCH_DEFAULT_EDITTOR_SETTING)},_doAfterInsertComponent:function(a,b){var c=b===undefined?true:b;if(this._bIsInitialized===false||!a||a.length===0){return}if(c){this.requestPushHistory()}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET);this.addLibraryResource(a);if($SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_FORCE_ORDER){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RERENDER_FORCE_ORDER)}},_doBeforeInsertComponent:function(a){if(a===false){return}this.requestPushHistory()},enterSelectMode:function(){this.changeSelectingMode();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_INSERT_PANEL)},exitSelectMode:function(){this.changeNormalMode()},addLibraryResource:function(a,b,c){var d=this._getLibraryResouces(a);this._addLibrary(d,b,c)},_getLibraryResouces:function(a){var b=[];var c=[];if($.isArray(a)){c=a}else{c.push(a)}c.forEach(function(a){var c=this._getComponentModelData(a);var d=c["@ctype"];var e;if(this._isLibraryResource(c)){b.push(c)}else if(d===$SE_CONFIG.COMP_TYPE.IMAGE_STRIP){b=b.concat(c.components)}else if(d==$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){if(c.background.image){e=c.compId;c=c.background.image;c["@ctye"]=$SE_CONFIG.COMP_TYPE.IMAGE;c.compId=e;b.push(c)}}else if(d==$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH){c.wrapComp.compId=c.compId;b.push(c.wrapComp)}},this);return b},_getComponentModelData:function(a){if(!a){return a}if(a.getModelDataAsJson){return a.getModelDataAsJson()}return a},_isLibraryResource:function(a){var b=a["@ctype"];return b==$SE_CONFIG.COMP_TYPE.IMAGE||b==$SE_CONFIG.COMP_TYPE.AUDIO||b==$SE_CONFIG.COMP_TYPE.VIDEO||b==$SE_CONFIG.COMP_TYPE.MAP},requestPushHistory:function(){if(!this._bEnablePushHistory){return}this._pushCanvasHistory()},requestPushCompHistory:function(a){this._pushCompHistory(a)},requestPushRemoveComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{ids:a})},findInsertPointMarkerComponent:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.TARGET_COMPONENT_TO_INSERT);var b=a.attr("id");return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b)},clearSelection:function(a){$SE_COMMON_UTIL.clearSelection(a)},clearAllLayer:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.CLEAR_AUTO_LAYER);if(this.currentEditingMode()===$SE_CONFIG.EDITING_MODE.SELECT){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESELECT_ALL)},hideInsertPoints:function(){clearTimeout(this._nTidHideInsertPointMarker);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_ALL)},showDefaultInsertPoint:function(a){if(a){clearTimeout(this._nTidHideInsertPointMarker)}this._nTidHideInsertPointMarker=setTimeout(function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.SHOW_DEFAULT)}.bind(this),a||100)},createCanvas:function(a,b){window.focus();var c=this.insertComponentContext({compData:b,shouldFocus:false});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_THEME,a);this._imageResourceLoaded(function(){this.addLibraryResource(c,true);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE);setTimeout(function(){var a=c[c.length>1?1:0];if(a.getCompType()===$SE_CONFIG.COMP_TYPE.MR_BLOG){a=c[2]}this._onCreated();if(!$SE_MODAL.isOpen()){this._disableHistoryFocus(a)}this.requestPushHistory();if($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_OEPN_WRITING_MATERIAL_NAME)){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,{compData:$SE_CONFIG.COMP_TYPE.MATERIAL,shouldFocus:true,materialType:$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_OEPN_WRITING_MATERIAL_NAME)})}}.bind(this),400)}.bind(this));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DOCUMENT,this.getDocument())},startDrag:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.HIDE);this.changeDraggingMode();this._cacheCanvasHistory();this.disabledPushHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.BIND_DRAG_OUT_SIDE_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.UNBIND_EVENT);$SE_SCROLL_HELPER.activate()},stopDrag:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET);this.changeNormalMode();if($SE_CONFIG.SERVICE_CONFIG.COMPONENT_LIST_FORCE_ORDER){var a=true;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RERENDER_FORCE_ORDER,a)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UNBIND_DRAG_OUT_SIDE_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.BIND_EVENT);$SE_SCROLL_HELPER.deactivate();this._clearCacheCanvasHistory()},completeDrag:function(){this.enabledPushHistory();this.requestPushHistory()},currentEditingMode:function(){return this._sEditingMode},changeDraggingMode:function(){this.clearAllLayer();this.clearSelection(false);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_ALL);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.START_DRAG_MODE);this._sEditingMode=$SE_CONFIG.EDITING_MODE.DRAG},changeSelectingMode:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FINISH_DRAG_MODE);this._sEditingMode=$SE_CONFIG.EDITING_MODE.SELECT},_changeDisabledMode:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FINISH_DRAG_MODE);this._sEditingMode=$SE_CONFIG.EDITING_MODE.DISABLED},changeNormalMode:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FINISH_DRAG_MODE);this._sEditingMode=$SE_CONFIG.EDITING_MODE.NORMAL},disabledPushHistory:function(){this._bEnablePushHistory=false},enabledPushHistory:function(){this._bEnablePushHistory=true},replaceComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);a=$.extend(true,a,{});this._doBeforeInsertComponent();var b=a.shouldUpdateLibrary===undefined?true:a.shouldUpdateLibrary;var c=a.target;if(b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{sId:c.getId()})}var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.REPLACE_COMPONENT,a);this._doAfterInsertComponent(d,a.bPushHistory);return d},wrapComponent:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);this._doBeforeInsertComponent();var b=a.id;var c=a.layout;var d=typeof a.bPushHistory;var e=a.shouldUpdateLibrary===undefined?true:a.shouldUpdateLibrary;var f=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,b);if(typeof d==="undefined"){d=true}if(e){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{sId:f.getId()})}var g=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.WRAP_COMPONENT,b,c);this._doAfterInsertComponent(g,d);return g},decompose:function(a,b,c){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);this.disabledPushHistory();var d=a.getId();var e=this._oComponentListView.decompose(a,b,c);this.requestPushRemoveComponent([d]);this.addLibraryResource(e);this.enabledPushHistory();this._pushCanvasHistory()},insertComponentContext:function(a){this._doBeforeInsertComponent();var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.INSERT_COMPONENT,$.extend(true,{target:$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED),action:$SE_CONFIG.ACTION.INSERT},a));this._doAfterInsertComponent(b,a.bPushHistory);if(a.bFromLibrary){$SE_ANIMATION_HELPER.animatesDrop(b[0].getContainerWrappingElement())}return b},convertPortionAsComp:function(a,b,c){var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,a);var e=c.sInsertType;if(e==="before"){d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,a)||$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DOCUMENT_TITLE)}else if(e==="split"){this.insertComponentContext({insertType:$SE_CONFIG.INSERT_TYPE.DEFAULT,compData:c.htData,shouldFocus:false,bPushHistory:false,target:d})}this.enabledPushHistory();this.insertComponentContext({insertType:$SE_CONFIG.INSERT_TYPE.DEFAULT,compData:b,shouldFocus:true,bPushHistory:false,target:d})},appendEmptyLineWithFocus:function(a){if(!$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED)&&!a){return null}this._doBeforeInsertComponent();var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPEND_EMPTY_LINE_WITH_FOCUS,a);if(b){this._doAfterInsertComponent(b)}return b},deleteComponent:function(a){if(!$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CAN_DELETE_CURRENT_TARGET)){return}var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_DELETE_TARGETS,a);if(b.length===0){return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);this.requestPushRemoveComponent(b);this.requestPushHistory();this.disabledPushHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_COMPONENT,b,a);this.enabledPushHistory();this.requestPushHistory()},deleteComponentById:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{sId:a});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_COMPONENT_BY_ID,a);if(!b){this.requestPushHistory()}},deleteLibrariesWithComp:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,{asIds:a});this.requestPushHistory();this.disabledPushHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_LIBRARIES_WITH_COMP,a);this.enabledPushHistory();this.requestPushHistory()},getComponentsData:function(a){var b=[];var c;var d;c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST);c.forEach(function(c){if(a){d=c.getModel().getData()}else{d=c.getModelDataAsJson()}if(c.getCompType()!=$SE_CONFIG.COMP_TYPE.AUDIO||!c.getIsUploading()){b.push(d)}},this);return b},readonly:function(a){a=a!==false;if($SE_CONFIG.ENV_SETTING.READONLY===a){return}this.clearAllLayer();this.clearSelection(false);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.HIDE_ALL);var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST,{compType:$SE_CONFIG.COMP_TYPE.IMAGE_STRIP});if(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY_SORTABLE);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY_SELECTABLE);if(b&&b[0]){this._oComponentListView.destroyDraggable(b)}$SE_MEDIA.closeAll();$SE_MEDIA.pause();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.UNBIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UNBIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.UNBIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.DISABLE_BUTTON);this._unbindEvents();this.requestPushHistory()}else{this._bindEvents();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.BIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.BIND_EVENT);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.BIND_EVENT);if(b&&b[0]){this._oComponentListView.applyDraggable(b)}$SE_MEDIA.unpause();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_SELECTABLE);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.APPLY_SORTABLE);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.ENABLE_BUTTON)}var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST);c.forEach(function(b){b.readonly(a)},this);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.TAGS_INPUT.READONLY,a);$SE_CONFIG.ENV_SETTING.READONLY=a},restoreCanvasContext:function(a,b){var c=$SE_MODEL_DATA_COORD.getCurrentTheme();this.RESTORE_TRANSACTION=true;b=b?b:false;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DETACH_ALL);var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMPONENT_MAP);var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_HISTORY.RESTORE_CANVAS,a,d);var f=e.oFocusComponent;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET,e.htComponentMap,a.theme);if(!f&&!a.bHistory){var g=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST);f=g.length>1?g[1]:g[0];if(f.getCompType()===$SE_CONFIG.COMP_TYPE.MR_BLOG){f=g[2]}}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.CLEAR_LIBRARY_COMP_DATA);this.addLibraryResource($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST),b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_DIRECTORY_META);clearTimeout(this._nShowTimer);this._imageResourceLoaded(function(){$SE_HOTKEY.unpause();this.RESTORE_TRANSACTION=false;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE);if(f){setTimeout(function(){this._disableHistoryFocus(f);if(!a.bHistory){this._htCacheCanvasHistoryData=null;this.requestPushHistory();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"inner")}}.bind(this),100)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.HIDE_LOADING_LAYER,"inner")}}.bind(this));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DOCUMENT,this.getDocument())},restoreComponent:function(a){var b={htCompMap:$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMPONENT_MAP)};var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_HISTORY.RESTORE_COMPONENT,a,b);var d=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SET_COMPONENT_MAP,c.htComponentMap);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE_OF_ALL,d);this.addLibraryResource($SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST),false);var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BY_ID,c.sFocusCompId);if(e){this._disableHistoryFocus(e)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UPDATE_DOCUMENT,this.getDocument());this._cacheCanvasHistory()},_disableHistoryFocus:function(a){a.setHistoryTransaction(true);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,a,{action:$SE_CONFIG.ACTION.RESTORE});a.setHistoryTransaction(false)},_imageResourceLoaded:function(a){var b=function(a,b){$(a).each(function(){if(this.complete||$(this).height()>0){b.apply(this)}else{$(this).on("load.imgchecker",function(){b.apply(this)});$(this).on("error.imgchecker",function(){b.apply(this)});$(this).on("img.imgchecker",function(){b.apply(this)})}})};var c=$("#se_canvas_body").find(".__se_check_image");var d=c.length;if(d>0){b(c,function(){$(this).removeClass("__se_check_image");d--;if(d===0){a()}})}else{a()}},setImageBackgroundMetric:function(a){a=a||{};var b=a.sCompId;var c=this.findComponentById(b);if(!c){return}var d=c.getCompType();if(d===$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){c.setBackgroundMetric(a)}},setTermsSubtitle:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST)[0];var c=b.getModel();if(c.getCompType()!=="documentTitle"){return}c.setSubtitle(a)},getTermsSubtitle:function(){var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST)[0];var b=a.getModel();if(b.getCompType()!=="documentTitle"){return""}return b.getSubtitle()},destroy:function(){this._unbindEvents();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DESTROY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_POINT_MARKER.DESTROY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.DESTROY);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COPY_PASTE.DESTROY)}});
//# sourceMappingURL=blog_desktop_normal_editor_canvas_view.min.js.map