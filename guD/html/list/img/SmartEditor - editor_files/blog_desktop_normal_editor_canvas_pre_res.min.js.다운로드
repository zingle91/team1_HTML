/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineComponent("se.BaseCompView",{construct:function(a,b,c){this._oModel=a;this._oToolbar=b;this._callback=c;this._buttonSetPolicy=new se.CanvasToolbarButtonSetPolicy($SE_CONFIG.SERVICE_CONFIG.DESKTOP_TOOLBAR);this._htFocusHistoryData=null;this._$elContainer=null;this._sId=a.getCompId()||this._createId(this.getCompType());this._tplComponent=se.editor.template.canvas[this.getTemplatePrefix()+"-component.hbs"];this._bHistoryTransaction=false;this._bEnableSplit=true;this._bFocused=false;this._bSelected=false;this._bReadonly=false;this._isDestroyed=false;this._IMPL_onCreated()},_createId:function(a){return a+"_"+Math.floor(Math.random()*1e9)+""+(new Date).getTime()},_bindCommonEvent:function(){},_unbindCommonEvent:function(){if(this._$elContainer){this._$elContainer.off()}},_remove:function(){if(!this._$elContainer){return}$SE_COMMON_UTIL.removeElement(this._$elContainer[0]);this._$elContainer=null;this._oModel=null;this._oToolbar=null;this._sId=null;this._tplComponent=null},compromiseScrollHeight:function(){var a=this._$elContainer.outerHeight(true);var b=this._$elContainer.offset().top;$SE_SCROLL_HELPER.compromiseScrollHeight(a,b)},render:function(){var a=this._oModel.getJson();a.id=this.getId();this._$elContainer=$(this._IMPL_onRender(this._tplComponent,a));this._IMPL_onAfterRender();return this._$elContainer},destroy:function(){clearTimeout(this._timeoutShowToolbar);clearTimeout(this._timeoutForBlur);if(this._isDestroyed){return}this._unmountToolbar();this._unbindCommonEvent();this._IMPL_onDestroyed();this._remove();this._isDestroyed=true},isDestroyed:function(){return this._isDestroyed},update:function(a){this._bHistoryTransaction=true;if(a){this._oModel=a}this._IMPL_onUpdateUI();this._bHistoryTransaction=false},updateAutoSize:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.UPDATE_AUTO_SIZE,a)},canAutoSize:function(){var a=this.getCompType();var b=$SE_CONFIG.COMP_TYPE;if(a===b.PARAGRAPH||a===b.STICKER||a===b.MATERIAL||a===b.HORIZONTAL_LINE||a===b.AUDIO||a===b.FILE){return false}return true},canSplitted:function(){return false},resize:function(){this._IMPL_onResize()},show:function(){this._$elContainer.show()},setId:function(a){this._sId=a},select:function(){if(this.isSelected()){return}this._$elContainer.addClass("ui-selected");this._bSelected=true;$SE_COMMON_UTIL.clearSelection();this._timeoutForBlur=setTimeout(function(){$SE_FOCUS_HELPER.blurFromActiveElement()},1)},deselect:function(){if(!this.isSelected()){return}this._bSelected=false;this._$elContainer.removeClass("ui-selected")},toggleSelected:function(){if(!this._$elContainer){return}if(this.isSelected()){this.deselect()}else{this.select()}window.focus()},_shouldCompromiseScrollHeight:function(a){var b=this.getCompType();var c=a.action;if(c===$SE_CONFIG.ACTION.READY||c===$SE_CONFIG.ACTION.RESTORE){return true}if(this.isTextEditable()||this.isDocumentTitle()){return false}switch(a.action){case $SE_CONFIG.ACTION.MOVE:if(a.trigger===$SE_CONFIG.TRIGGER.CLICK){return false}return this.isTextEditable()===false;case $SE_CONFIG.ACTION.COMPOSE:case $SE_CONFIG.ACTION.INSERT:return b!==$SE_CONFIG.COMP_TYPE.IMAGE&&b!==$SE_CONFIG.COMP_TYPE.STICKER}return false},_compromiseScrollHeightByAction:function(a){if(this._shouldCompromiseScrollHeight(a)){this.compromiseScrollHeight()}},_mountToolbar:function(){if(this._oToolbar){this._oToolbar.mountTo({key:this.getId(),target:this._$elContainer.find(".se_editArea").eq(0),nclickPrefix:this._getNclickPrefix(this.getCompType())});if(!this.isWrappingParagraph()){this._oToolbar.changeActiveBtns(this._buttonSetPolicy.getButtonSet(this._oModel))}this._IMPL_onAfterMountToolbar()}},_unmountToolbar:function(){if(this._oToolbar){this._oToolbar.unmount(this.getId())}},focusIn:function(a){if(this._bFocused||!this._$elContainer||!this._oToolbar){return}a=a||{};this._bFocused=true;this._bindCommonEvent();this._clearAllLayer();this._showToolbarByAction(a.action);this._htFocusHistoryData=$.extend(true,{},this.getModelDataAsJson());this._IMPL_onFocusIn(a);if(this.getCompType()!==$SE_CONFIG.COMP_TYPE.TABLE){this._compromiseScrollHeightByAction(a)}},_showToolbar:function(){this._mountToolbar();this._$elContainer.addClass("is-focused")},_showToolbarByAction:function(a){clearTimeout(this._timeoutShowToolbar);if(a===$SE_CONFIG.ACTION.INSERT){this._timeoutShowToolbar=setTimeout(this._showToolbar.bind(this),4)}else{this._showToolbar()}},_hideToolbar:function(){clearTimeout(this._timeoutShowToolbar);this._$elContainer&&this._$elContainer.removeClass("is-focused");this._unmountToolbar()},focusOut:function(){if(this._bFocused===false){return}this._bFocused=false;this._htFocusHistoryData=null;this._hideToolbar();this._unbindCommonEvent();this._IMPL_onFocusOut();$SE_COMMON_UTIL.clearSelection()},enableStickyToolbar:function(){this._oToolbar.enableStickyToolbar()},getContainerElement:function(){return this._$elContainer.get(0)},getContainerWrappingElement:function(){return this._$elContainer},getId:function(){return this._sId},getCompType:function(){return this._oModel.getCompType()},_getNclickPrefix:function(a){switch(a){case $SE_CONFIG.COMP_TYPE.SCHEDULE:return"scd";case $SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE:return"ttl";case $SE_CONFIG.COMP_TYPE.PARAGRAPH:case $SE_CONFIG.COMP_TYPE.SECTION_TITLE:return"txt";case $SE_CONFIG.COMP_TYPE.IMAGE:return"pht";case $SE_CONFIG.COMP_TYPE.IMAGE_STRIP:return"sbs";case $SE_CONFIG.COMP_TYPE.VIDEO:return"mov";case $SE_CONFIG.COMP_TYPE.MAP:return"map";case $SE_CONFIG.COMP_TYPE.AUDIO:return"aud";case $SE_CONFIG.COMP_TYPE.MATERIAL:return"mat";case $SE_CONFIG.COMP_TYPE.QUOTATION:return"quo";case $SE_CONFIG.COMP_TYPE.HORIZONTAL_LINE:return"div";case $SE_CONFIG.COMP_TYPE.OGLINK:return"ogl";case $SE_CONFIG.COMP_TYPE.STICKER:return"stk";case $SE_CONFIG.COMP_TYPE.FILE:return"fil";case $SE_CONFIG.COMP_TYPE.TALKTALK:return"tal";case $SE_CONFIG.COMP_TYPE.CODE:return"cod";case $SE_CONFIG.COMP_TYPE.MR_BLOG:return"mrb";case $SE_CONFIG.COMP_TYPE.TABLE:return"tbl"}},getTemplatePrefix:function(){var a=this._oModel.getCompType();if(this.isDocumentTitle()){var b=$SE_CONFIG.SERVICE_CONFIG.TITLE.type;a=a+"-"+b}return a},getModelDataAsJson:function(){this.updateModel();var a=this._oModel.getJson();a.compId=this._sId;a.focusComp=this._bFocused;return a},getModel:function(){return this._oModel},setHistoryTransaction:function(a){this._bHistoryTransaction=a},isFocused:function(){return this._bFocused},isSelected:function(){return this._bSelected},isDocumentTitle:function(){return this._oModel.getCompType()===$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE},isParagraph:function(){return this.getCompType()===$SE_CONFIG.COMP_TYPE.PARAGRAPH},isWrappingParagraph:function(){return this.getCompType()===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH},isImageSortable:function(){return this.getCompType()===$SE_CONFIG.COMP_TYPE.IMAGE||this.getCompType()===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH},isSectionTitle:function(){return this.getCompType()===$SE_CONFIG.COMP_TYPE.SECTION_TITLE},isTextMergeable:function(){return this.isParagraph()||this.isSectionTitle()||this.isWrappingParagraph()},isLibraryResource:function(){var a=this.getCompType();return a==$SE_CONFIG.COMP_TYPE.IMAGE||a==$SE_CONFIG.COMP_TYPE.IMAGE_STRIP||a==$SE_CONFIG.COMP_TYPE.AUDIO||a==$SE_CONFIG.COMP_TYPE.VIDEO||a==$SE_CONFIG.COMP_TYPE.MAP},closeCurrentActiveDropdown:function(){if(this._oToolbar){this._oToolbar.closeAllLayer()}},_clearAllLayer:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.CLEAR_ALL_LAYER);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.SHOW_DEFAULT_INSERT_POINT,0)},renderBelow:function(a){a.getContainerWrappingElement().after(this.render());this._IMPL_onMounted()},renderAbove:function(a){a.getContainerWrappingElement().before(this.render());this._IMPL_onMounted()},appendTo:function(a){var b=this.getContainerWrappingElement();if(!b){b=this.render()}b.appendTo(a);this._IMPL_onMounted()},_prependTo:function(a){var b=this.getContainerWrappingElement();if(!b){b=this.render()}b.prependTo(a)},prependTo:function(a){this._prependTo(a);this._IMPL_onMounted()},moveToAfter:function(a){a.getContainerWrappingElement().after(this.getContainerWrappingElement())},moveToBefore:function(a){a.getContainerWrappingElement().before(this.getContainerWrappingElement())},moveToByPosition:function(a,b){if(b==="above"){this.moveToBefore(a)}else{this.moveToAfter(a)}},isTextEditable:function(){var a=this.getCompType();return a===$SE_CONFIG.COMP_TYPE.SECTION_TITLE||a===$SE_CONFIG.COMP_TYPE.QUOTATION||a===$SE_CONFIG.COMP_TYPE.CODE||a===$SE_CONFIG.COMP_TYPE.PARAGRAPH||a===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH},isCursorAtStart:function(){return true},isCursorAtEnd:function(){return true},canMoveUpward:function(){return true},canMoveDownward:function(){return true},currentCaretOffsetTop:function(){},_isFocusFromUp:function(a){return a.trigger===$SE_CONFIG.TRIGGER.RIGHT||a.trigger===$SE_CONFIG.TRIGGER.DOWN},_isFromDown:function(a){return a.trigger===$SE_CONFIG.TRIGGER.LEFT||a.trigger===$SE_CONFIG.TRIGGER.UP},_requestCompHistory:function(a){if(!this._bHistoryTransaction){this.executeCompHistory(a)}},executeCompHistory:function(a){if(this._htFocusHistoryData){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_COMP_HISTORY,this._htFocusHistoryData);this._htFocusHistoryData=null}var b=$.extend(true,{},this.getModelDataAsJson());b.compId=this._sId;b.focusEvent=a?true:false;$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_COMP_HISTORY,b)},updateStyle:function(a,b){this._bHistoryTransaction=true;this._IMPL_onUpdateStyle(a,b);this._bHistoryTransaction=false},refineDataByTheme:function(a){this._bHistoryTransaction=true;this._IMPL_onRefineDataByTheme(a);this._bHistoryTransaction=false},getPlainText:function(){return""},getTextContents:function(){return $SE_COMMON_UTIL.escapeHtml(this.getPlainText())},updateModel:function(){if(this._bReadonly){this._updateReadonly();this._IMPL_onUpdateModel();this._$elContainer.find("textarea").each(function(){var a=$(this);var b=a.parent().children("div.se_textarea.se_readonly").last();if(b.length>0){b.text(this.value)}})}else{this._IMPL_onUpdateModel()}},_updateReadonly:function(a){this._$elContainer.find("textarea").each(function(){var b=$(this);var c=b.parent().children("div.se_textarea.se_readonly").last();if(c.length>0){b.val($SE_COMMON_UTIL.getInnerText(c.get(0)))}if(a){c.remove();b.attr("readonly",false);b.show()}})},readonly:function(a){a=a===false?false:true;if(this._bReadonly===a){return}if(a){this.deselect();this._$elContainer.find("textarea").each(function(){var a=$(this);var b=a.height();a.attr("readonly",true).hide();$('<div class="se_textarea se_readonly">').text(this.value).css("min-height",b).appendTo(a.parent())})}else{this._updateReadonly(true);this._IMPL_onUpdateModel()}this._IMPL_onReadonly(a);this._bReadonly=a},shouldDeleteSingleSlot:function(){return false},_IMPL_onReadonly:function(a){},_IMPL_onCreated:function(){},_IMPL_onAfterRender:function(){},_IMPL_onRender:function(a,b){return a(b)},_IMPL_onMounted:function(){},_IMPL_onResize:function(){},_IMPL_onUpdateModel:function(){},_IMPL_onUpdateUI:function(){},_IMPL_onDestroyed:function(){},_IMPL_onFocusIn:function(a){},_IMPL_onFocusOut:function(){},_IMPL_onUpdateStyle:function(){},_IMPL_onAfterMountToolbar:function(){},_IMPL_onRefineDataByTheme:function(a){}});se.defineClass("se.BaseComponentModel",{construct:function(a){a=a||{};this._compId=a.compId;this._compType=a?a["@ctype"]:"unknown";this._layout=a&&a.layout&&a.layout.trim()!==""?a.layout:"default";this._componentStyle=a&&a.componentStyle?a.componentStyle:{"@ctype":"componentStyle"};this._isFocused=a?a.isFocused||false:false;if(a&&a.storedNo){this._storedNo=a.storedNo}this._htData=a;this._genGetterSetter("compId");this._genGetterSetter("compType");this._genGetterSetter("layout");this._genGetterSetter("componentStyle");this._genGetterSetter("isFocused")},getData:function(){return this._htData},getJson:function(){var a=$.extend(true,{},this._getJsonData());a["@ctype"]=this._compType;a.layout=this._layout;a.isFocused=this._isFocused;if(this._storedNo){a.storedNo=this._storedNo}if(this._componentStyle){this._componentStyle["@ctype"]="componentStyle"}else{this._componentStyle={"@ctype":"componentStyle"}}a.componentStyle=this._componentStyle;return a},getJsonWithCompId:function(){var a=this.getJson();a.compId=this.getCompId();return a},updateWith:function(a){this.updateSizeWithAlign&&this.updateSizeWithAlign(a.originalWidth,a.originalHeight);Object.keys(a).forEach(function(b){var c=a[b];if(typeof c==="object"){c=JSON.parse(JSON.stringify(a[b]))}this["_"+b]=c}.bind(this))},isWrappingParagraph:function(){return this.getCompType()===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH},_genGetterSetter:function(a){var b=a.substr(0,1).toUpperCase()+a.substr(1,a.length);Object.getPrototypeOf(this)["get"+b]=function(){return this["_"+a]};Object.getPrototypeOf(this)["set"+b]=function(b){this["_"+a]=b}},_getModelInstance:function(a,b){if(!a||!a["@ctype"]){return null}var c=$SE_STRING.capitalize(a["@ctype"]);var d=se[c+"Model"];var e=$SE_MODEL_DATA_COORD.getDefaultCompData((b?b+"_":"")+a["@ctype"]);return new d(_.extend(e,a))}});se.defineComponent("se.EditableMergeService",{construct:function(){this._assignProperties();this._attachEvents()},_attachEvents:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_BEFORE_COMP,this.mergeWithBeforeComp.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.EDITABLE_MERGE_SERVICE.MERGE_WITH_AFTER_COMP,this.mergeWithAfterComp.bind(this))},_assignProperties:function(){this._compIndexMap={sectionTitle:0,paragraph:1,wrappingParagraph:2};this._mergeRule=this._generateMergeRule()},_generateMergeRule:function(){var a=$SE_CONFIG.TEXT_MERGE;var b={};b[$SE_CONFIG.TRIGGER.DELETE]=[[null,a.REVERSE,a.REVERSE],[a.FORWARD,a.FORWARD,a.REVERSE],[a.FORWARD,a.FORWARD,a.FORWARD]];b[$SE_CONFIG.TRIGGER.BACKSPACE]=[[null,a.REVERSE,a.REVERSE],[a.FORWARD,a.FORWARD,a.REVERSE],[a.FORWARD,a.FORWARD,a.REVERSE]];return b},mergeWithBeforeComp:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_BEFORE,a.getId());this._merge({trigger:b,base:a,target:c})},mergeWithAfterComp:function(a,b){var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_COMPONENT_AFTER,a.getId());this._merge({trigger:b,base:a,target:c})},_merge:function(a){var b=a.target;if(!b){return}var c=a.base;var d=(c.isSectionTitle()&&b.isSectionTitle())===false;if(b&&b.isTextMergeable()&&d){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY);this.execute(a)}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.SELECT,b)}},_decideMergeStretagy:function(a,b,c){var d=this._compIndexMap[b.getCompType()];var e=this._compIndexMap[c.getCompType()];var f=this._mergeRule[a];return f[d][e]},execute:function(a){var b=a.trigger;var c=a.base;var d=a.target;var e=this._decideMergeStretagy(b,c,d);if(e===$SE_CONFIG.TEXT_MERGE.REVERSE){c=a.target;d=a.base}this._focusTo(c,b);this._mergeByStragtegy(e,b,c,d);this._clearIngredient(d)},_clearIngredient:function(a){if(a.isWrappingParagraph()){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REPLACE_COMPONENT,{target:a,compData:a._getWrapCompData(),shouldFocus:false,shouldUpdateLibrary:false,skipLastEditableRule:true,bPushHistory:false})}else{$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.DELETE_COMPONENT_BY_ID,a.getId());$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.REQUEST_PUSH_HISTORY)}},_focusTo:function(a,b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,a,{trigger:b})},_shouldInsertEmptyLine:function(a){return a===$SE_CONFIG.COMP_TYPE.SECTION_TITLE||a===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH||a===$SE_CONFIG.COMP_TYPE.PARAGRAPH},_combineAsBackspace:function(a,b,c){if(a===$SE_CONFIG.TEXT_MERGE.FORWARD){this._prepend(b,c)}else{this._append(b,c)}},_combineAsDelete:function(a,b,c){if(a===$SE_CONFIG.TEXT_MERGE.FORWARD){this._append(b,c)}else{this._prepend(b,c)}},_mergeByStragtegy:function(a,b,c,d){if(b===$SE_CONFIG.TRIGGER.BACKSPACE){this._combineAsBackspace(a,c,d)}else{this._combineAsDelete(a,c,d)}},_extractTargetContents:function(a){if(a.isWrappingParagraph()){return a.getTextContents("around")}if(a.isSectionTitle()){return a.getTextContents().replace(/\n/gi,"<br/>")}return a.getTextContents()},_append:function(a,b){if(b.isParagraph()){b.getEditableView().unwrapDropCap()}var c=a.getEditableView();var d=this._extractTargetContents(b);var e=this._shouldInsertEmptyLine(b.getCompType())&&!c.hasEndBr();if(d){c.appendHtml(d,e)}else{c.cursorToEnd()}},_prepend:function(a,b){var c=a.getEditableView();var d=this._extractTargetContents(b);c.unwrapDropCap();if(d){c.prependHtml(d,this._shouldInsertEmptyLine(b.getCompType()))}else{c.cursorToStart()}}});window.$SE_MENTION=se.defineStatic("se.MentionController",function(){var a=[];var b;var c,d;var e={top:0};var f;var g,h;var i;function j(a,b){if(c){c.remove()}g=se.editor.template.common["gp-mentionLayer.hbs"];h=se.editor.template.common["gp-mentionList.hbs"];b.append(g);c=$(".__se_mentionAutoComplete");d=c.find(".__se_gpFollowingList");i=a.onClickMentionListItem||function(){};s()}function k(b){var c;var d=[],e=[];a.forEach(function(a){c=a.nickName||"";if(m(c,b)){d.push(a)}if(l(c,b)){e.push(a)}});return d.concat(e)}function l(a,b){return a.toLowerCase().indexOf(b.toLowerCase())>0}function m(a,b){return a.toLowerCase().indexOf(b.toLowerCase())===0}function n(a){if(a.length===0){return}d.html(h({users:a}))}function o(a,b){var d;f=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CURRENT_FOCUSED);p().then(function(){d=k(a);if(d.length===0){return}n(d);q(b);c.show()})}function p(){var c=$.Deferred();if(a.length>0||b){c.resolve()}else{$.ajax({url:$SE_CONFIG.API.GP_FOLLOWING}).done(function(d){a=d.result;b=d.isSuccess&&a.length===0;c.resolve()})}return c.promise()}function q(a){var b=5;var d=window.pageYOffset||document.documentElement.scrollTop;e.top=a.bottom+b+d;c.css("top",e.top+"px")}function r(){c.hide()}function s(){c.on("click",".__se_gpUser",t.bind(this));c.on("mouseover",".__se_gpUser",u.bind(this));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"click.exceptMentionLayer",r)}function t(a){if(f){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_IN,f)}i($(a.currentTarget));a.stopPropagation();a.preventDefault()}function u(a){var b=d.find(".is-focused");if(b){b.removeClass("is-focused")}$(a.currentTarget).addClass("is-focused")}function v(){var a=d.find(".is-focused");var b=a.prev();if(a.index()>0){a.removeClass("is-focused");b.addClass("is-focused");x(b)}}function w(){var a=d.find(".__se_gpUser");var b=d.find(".is-focused");var c=b.next();if(b.index()<a.length-1){b.removeClass("is-focused");c.addClass("is-focused");y(c)}}function x(a){var b=a.offset().top<c.position().top;if(b){c.scrollTop(c.scrollTop()-a.height())}}function y(a){var b=c.position().top+c.height();var d=a.offset().top+a.height();var e=d>b;if(e){c.scrollTop(c.scrollTop()+a.height())}}function z(){var a=d.find(".is-focused");i(a)}function A(){r();c=null}return{create:j,destroy:A,show:o,hide:r,onClickMentionListItem:t,onKeyUpMentionList:v,onKeyDownMentionList:w,onEnterMentionList:z}}());se.defineClass("se.AbstractCompositeSubCompView",{"default":{name:"se.AbstractCompositeSubCompView",state:{},props:{},template:Handlebars.compile("<div></div>"),subViews:{},events:{}},construct:function(a){a=a||{};this.state=_.extend({},JSON.parse(JSON.stringify(this.default.state||{})),a.state);this.props=_.extend({},JSON.parse(JSON.stringify(this.default.props||{})),a.props);this.template=a.template||this.default.template;this.events=_.extend({},this.default.events,a.events);this.subViewRenderSpec=_.extend({},this.default.subViews,a.subViews);this.subViews=[];this.$el=null},_publish:function(a){return $(this.template(a))},compose:function(){var a=this.subViewRenderSpec;this.subViews=Object.keys(a).map(this._renderSubComponents.bind(this,a,this.$el))},_extractOrCreateView:function(a){var b=a.view;if(typeof b==="function"){b=new b(a.options)}return b},_renderSubComponents:function(a,b,c){var d=a[c];var e=d.selector;var f=d.strategy;var g=this._extractOrCreateView(d);var h=g.render();var i=b.find(e);i[f](h);this[c]=g;return g},render:function(){this.$el=this._publish(this.state);this.$el[0].setAttribute("data-name",this.default.name);this.compose();this._onAfterRender();this._bindEvents(this.events);return this.$el},appendTo:function(a){var b=this.render();b.appendTo(a)},prependTo:function(a){var b=this.render();b.prependTo(a)},_onAfterRender:function(){},_bindEvents:function(){},_detachAllEvents:function(){if(this.$el){this.$el.off()}},_remove:function(){if(this.$el){this.$el.remove();this.$el=null}},_destroySubViews:function(){if(!this.subViews){return}this.subViews.forEach(function(a){a.destroy()});this.subViews=null},_clear:function(){this._remove();this._detachAllEvents();this._destroySubViews()},isContain:function(a){if(this.$el.get(0)===a.get(0)){return true}if(this.$el.has(a).length>0){return true}return false},executeCallback:function(a){var b=Array.prototype.slice.call(arguments);(a||function(){}).apply(this,b.slice(1))},destroy:function(){this._clear()},enableEvents:function(){AbstractMethodNotOverrideException("enableEvents")},disableEvents:function(){AbstractMethodNotOverrideException("disableEvents")}});se.defineComponent("se.InsertGuideView",{construct:function(){this._assignElements();this._createModules();this._initVar();this._bindGatewayEvent()},_assignElements:function(){this._$elGuideLine=$('<div class="se_dragPosition" style="opacity:0;top:0px;"></div>');this._$elComponents=null;$(document.body).append(this._$elGuideLine)},_initVar:function(){this._$elTargetCompToInsert=null;this._$elDragging=null;this._$elInsertPosBar=null;this._sInsertGuidePosition=null;this._sGuideType=null;this._$elDraggingElements=null;this._htPrevInsertGuideTarget={prevElement:null,topBorder:null,bottomBorder:null};this._createModules()},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RENDER_INSERT_GUIDE_WITH_COORDINATE,this.renderInsertGuideWithCoordinate.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.CURRENT_TARGET,this.currentTarget.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.RESET,this.reset.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.IS_INSERT_GUIDE_SHOWN,this.isInsertGuideShown.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.INSERT_GUIDE.DESTROY,this.destroy.bind(this))},_createModules:function(){this._oComponentGuideLineResolver=new se.ComponentGuideLineResolver;this._oMultiDragGuideLineResolver=new se.MultiDragGuideLineResolver;this._oSubComponentGuideLineResolver=new se.SubComponentGuideLineResolver;this._oInsertGuidePresenter=new se.InsertGuidePresenter},_cacheActiveInsertGuide:function(a,b,c){this._$elTargetCompToInsert=a;this._sInsertGuidePosition=b;this._sGuideType=c},_cacheDraggingElement:function(a){this._$elDragging=this._findDraggingComponentWrapper(a)},_findEdgeComponentElement:function(a,b){var c=se.util.Scroll,d=a.first();if(c.isMousePointerAboveForGuideline(d,b)){return d}else{return a.last()}},_findClosestComponentElement:function(a,b){var c=0,d=this._$elComponents;if(!d){d=$(".se_component:not(.se_documentTitle, .ui-sortable-helper, .ui-sortable-placeholder, .__se_drag_helper)");this._$elComponents=d}var e=[];var f=null;for(var g=0;g<d.length;g++){f=d[g];if(this._isInside(b,f)){e.push(f);break}}if(e.length===c){return this._findEdgeComponentElement(d,b)}return $(e[0])},_calculateTargetPos:function(a){var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_OFFSET_CACHE,a);var c=b.marginTop-b.paddingTop;var d={topBorder:b.top-c,bottomBorder:b.top+b.height,prevElement:a};return d},_isInside:function(a,b){var c=this._htPrevInsertGuideTarget||{};var d=c.prevElement;if(d!==b){c=this._calculateTargetPos(b);this._htPrevInsertGuideTarget=c}return a>=c.topBorder&&a<=c.bottomBorder},_renderToSide:function(a,b){this.clear();if(b===-1){return}var c=this._getInsertPostElement();var d=a.find(".__subComp");var e=d.eq(b>0?b-1:0);var f=e.length>0?window.getComputedStyle(e[0]):undefined;c.height(parseInt(f?f.getPropertyValue("height"):0,10));if(b>0){c.insertAfter(e)}else{e.parent().prepend(c)}this._cacheActiveInsertGuide(a,b,"composite")},_getInsertPostElement:function(){if(this._$elInsertPosBar){return this._$elInsertPosBar}this._$elInsertPosBar=$('<div class="se_imagePositionBar">');return this._$elInsertPosBar},_findDraggingComponentWrapper:function(a){var b=a;if(a.length===0||!a[0].classList.contains("se_component")){b=a.parents(".se_component")}return b},_isSubComponentDragging:function(a){return a.length>0&&!a[0].classList.contains("se_component")&&!a[0].classList.contains("__se_lib_drag")},_routeToRender:function(a,b){var c=b.target;switch(c){case"top":this._renderAbove(a);return;case"bottom":this._renderBelow(a);return;case"left":case"right":this._renderToSide(a,b.index);return;case"cancel":this.reset();return;default:this.clear()}},_isImageComponent:function(a){var b=a[0].classList;return b.contains("se_image")||b.contains("se_imageStrip")},_isTextComponent:function(a){var b=a[0].classList;return b.contains("se_paragraph")||b.contains("se_sectionTitle")},_findPlaceholder:function(){return $(".ui-sortable-placeholder")},_renderAbove:function(a){this.clear();var b=this._oInsertGuidePresenter.renderAbove(this._$elGuideLine,a);if(b){this._cacheActiveInsertGuide(a,$SE_CONFIG.INSERT_GUIDE_POSITION.ABOVE,"sort")}else{this._cacheActiveInsertGuide(null,null,null)}},_renderBelow:function(a){this.clear();var b=this._oInsertGuidePresenter.renderBelow(this._$elGuideLine,a);if(b){this._cacheActiveInsertGuide(a,$SE_CONFIG.INSERT_GUIDE_POSITION.BELOW,"sort")}else{this._cacheActiveInsertGuide(null,null,null)}},_queryInsertPosition:function(){return this._sInsertGuidePosition},_removeGuidePost:function(){if(this._$elInsertPosBar){this._$elInsertPosBar.remove()}},_cacheActiveInsertGuide:function(a,b,c){this._$elTargetCompToInsert=a;this._sInsertGuidePosition=b;this._sGuideType=c},clear:function(){var a=this.getActiveComponent();if(a===null){return}this._oInsertGuidePresenter.hideGuideLine(this._$elGuideLine,this._$elTargetCompToInsert);this._removeGuidePost()},reset:function(){this.clear();this._cacheActiveInsertGuide(null,null,null);this._$elDraggingElements=null;this._$elComponents=null;this._htPrevInsertGuideTarget=null},getActiveComponent:function(){return this._$elTargetCompToInsert},currentTarget:function(){return{to:this._$elTargetCompToInsert.attr("id"),from:this._$elDragging.attr("id"),position:this._sInsertGuidePosition,type:this._sGuideType}},_getDraggingElements:function(){if(this._$elDraggingElements===null){this._$elDraggingElements=this._findDraggingElements()}return this._$elDraggingElements},_findDraggingElements:function(){var a=$(".__se_drag_item");if(a.length===0){a=$(window.parent.document.body).find(".__se_drag_item")}return a},_hasNoDragElement:function(a){return a.length===0},renderInsertGuideWithCoordinate:function(a,b){var c=this._findClosestComponentElement(a,b);var d=this._getDraggingElements();var e=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS).length>1;var f=null;if(this._hasNoDragElement(d)){return}if(e){f=this._oMultiDragGuideLineResolver}else if(this._isSubComponentDragging(d)){f=this._oSubComponentGuideLineResolver}else{f=this._oComponentGuideLineResolver}var g=f.adviceInsertSlot(c,d,a,b);this._routeToRender(c,g);this._cacheDraggingElement(d)},isInsertGuideShown:function(){return this._sInsertGuidePosition!==null},destroy:function(){this._$elGuideLine.remove();this._$elTargetCompToInsert=null;this._$elGuideLine=null;this._sInsertGuidePosition=null;this._oComponentGuideLineResolver=null;this._oSubComponentGuideLineResolver=null}});se.defineComponent("se.InsertGuidePresenter",{construct:function(){},renderAbove:function(a,b){var c=b[0];var d=this._findPlaceholder();var e=this._extractComputedStyle(c);var f=this._getMarginTop(e);var g=b.offset().top;if(this._isAtTop(f)){this._showUpperGuideLineAt(c)}else{this._moveGuideLineAt(a,g-f);this.showGuideLine(a)}b.before(d);return true},renderBelow:function(a,b){var c=b[0];var d=this._findNext(b);var e=this._findPlaceholder();var f=this._extractComputedStyle(d[0]);var g=this._extractComputedStyle(c);var h=this._getMarginTop(f);var i=b.offset().top;if(this._isAtBottom(h)){this._showBottomGuideLineAt(c)}else{this._moveGuideLineAt(a,i+parseInt(g.getPropertyValue("height"),10)+h);this.showGuideLine(a)}b.after(e);return true},showGuideLine:function(a){a[0].style.opacity=1},hideGuideLine:function(a,b){a[0].style.opacity=0;var c=b[0].getElementsByClassName("se_sectionArea")[0];if(!c){return}c.classList.remove("is-dragPosition");c.classList.remove("is-dragPositionBottom")},_isAtTop:function(a){return a===0},_isAtBottom:function(a){return isNaN(a)||a===0},_moveGuideLineAt:function(a,b){a.css("transform","translateY("+b+"px)")},_findNext:function(a){var b=a.next();if(b.length>0&&b[0].classList.contains("ui-sortable-placeholder")){b=b.next()}if(b.length>0&&b[0].classList.contains("ui-sortable-helper")){b=b.prev()}return b},_extractComputedStyle:function(a){return a?window.getComputedStyle(a):undefined},_getMarginTop:function(a){return parseInt(a?a.getPropertyValue("margin-top"):0,10)/2},_showUpperGuideLineAt:function(a){a.getElementsByClassName("se_sectionArea")[0].classList.add("is-dragPosition")},_showBottomGuideLineAt:function(a){a.getElementsByClassName("se_sectionArea")[0].classList.add("is-dragPositionBottom")},_findPlaceholder:function(){return $(".ui-sortable-placeholder")}});se.defineClass("se.InsertDefaultAction",{construct:function(){this._initVar();this._assignElements()},_initVar:function(){this._bFragmenetMode=false;this._elCanvasFragment=null;this._elTitleFragment=null},_assignElements:function(){this._$elTitleWrapper=$("#se_title_wrapper");this._$elComponentsWrapper=$("#se_components_wrapper")},_getComponentInstance:function(a,b){var c=[];if($.isArray(a)){c=a.map(function(a){return $SE_COMPONENT_FACTORY.getComponentInstance(a,b)})}else{c=[$SE_COMPONENT_FACTORY.getComponentInstance(a,b)]}c=_.without(c,null,undefined);return c},_getComponentData:function(a,b){var c=null;if(typeof a=="string"){c=$SE_COMPONENT_FACTORY.getComponentData(a)}else if(typeof a=="object"){c=a}if(b){c=[].concat(c);c.forEach(function(a){if(a["@ctype"]===$SE_CONFIG.COMP_TYPE.PARAGRAPH||a["@ctype"]===$SE_CONFIG.COMP_TYPE.WRAPPING_PARAGRAPH){a.INIT_STYLE=b}})}return c},_findWrapperToAppend:function(a){if(a.isDocumentTitle()){return this._bFragmenetMode?this._elTitleFragment:this._$elTitleWrapper}else{return this._bFragmenetMode?this._elCanvasFragment:this._$elComponentsWrapper}},_insertBelow:function(a,b){var c=this._findWrapperToAppend(a);if(b&&b.isDocumentTitle()){a.prependTo(c)}else{a.appendTo(c)}},_appendComponentIntoCanvas:function(a,b){if(b&&b.isDocumentTitle()===false){a.renderBelow(b)}else{this._insertBelow(a,b)}return a},execute:function(a){var b=this._getComponentData(a.compData,a.lastStyle);var c=this._getComponentInstance(b,a.callbacks);var d=a.target;if(!d&&c.length>1){this._bFragmenetMode=true;this._elCanvasFragment=document.createDocumentFragment();this._elTitleFragment=document.createDocumentFragment()}c.map(function(a){d=this._appendComponentIntoCanvas(a,d);return d}.bind(this));if(this._bFragmenetMode){if(this._elTitleFragment.hasChildNodes()){this._$elTitleWrapper.get(0).appendChild(this._elTitleFragment)}if(this._elCanvasFragment.hasChildNodes()){this._$elComponentsWrapper.get(0).appendChild(this._elCanvasFragment)}}this._bFragmenetMode=false;this._elCanvasFragment=null;this._elTitleFragment=null;return c;
}});se.defineClass("se.GuideLineResolver",{construct:function(){this._htComposableRuleTable=[[true,false],[true,false],[true,false],[true,false]];this._arxFoundChecker=[/se_image\b/,/se_imageStrip\b/];this._asDragChecker=[/se_image\b/,/__subComp\b/,/__se_img_lib\b/,/__se_searchedImage\b/]},_findNext:function(a){var b=a.next();if(b.length>0&&b[0].classList.contains("ui-sortable-placeholder")){b=b.next()}if(b.length>0&&b[0].classList.contains("ui-sortable-helper")){b=b.prev()}return b},_findPrev:function(a){var b=a.prev();if(b.length>0&&b[0].classList.contains("ui-sortable-placeholder")){b=b.prev()}if(b.length>0&&b[0].classList.contains("ui-sortable-helper")){b=b.prev()}return b},_decideComposableSlot:function(a,b,c){var d=this._calculateComposableSlot(a,b,c);var e=d.slotIndex;var f=d.slotTarget;var g=se.util.Scroll.queryPointerPosition(f,b,c);if(g==="right"&&e!==-1){e++}if((g==="right"||g==="left")&&e===-1){g="cancel"}if(e===-1){g=se.util.Scroll.queryVerticalPointerPosition(a,c)}return{target:g,index:e}},_findDraggingComponentWrapper:function(a){var b=a;if(!b[0].classList.contains("se_component")){b=a.parents(".se_component")}return b},_getFoundType:function(a){var b=this._arxFoundChecker;var c=a[0].getAttribute("class");for(var d=0;d<b.length;d++){if(b[d].test(c)){return d}}return-1},_getDragType:function(a){var b=this._asDragChecker;var c=a[0].getAttribute("class");for(var d=0;d<b.length;d++){if(b[d].test(c)){return d}}return-1},_isComposable:function(a,b){var c=this._getFoundType(a);var d=this._getDragType(b);if(!$SE_CONFIG.SERVICE_CONFIG.IS_IMAGE_STRIP_AVAILABLE||c===-1||d===-1){return false}var e=this._htComposableRuleTable[d][c];if(e){return true}var f=3;var g=a.find(".__subComp").length;if(e===false&&g<f){return true}return false},_calculateComposableSlot:function(a,b,c){var d=-1;var e=null;var f=a.find(".__subComp").not(".ui-draggable-dragging");for(var g=0;g<f.length;g++){if(se.util.Common.isContain(b,c,f[g])){e=f.eq(g);d=g;break}}if(!e){e=a}return{slotTarget:e,slotIndex:d}}});se.defineComponent("se.ImageToolTip",{construct:function(){this._initVal();this._bindEvent()},_initVal:function(){this._oToolTip},_bindEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.SHOW,this.show.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.COMMAND.IMAGE_TOOLTIP.HIDE,this.hide.bind(this))},_getImageCompList:function(){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.GET_COMP_VIEW_LIST,{compType:$SE_CONFIG.COMP_TYPE.IMAGE})},_getTooltipTarget:function(a){var b;$.each(a,function(a,c){var d=c.getModelDataAsJson();var e=d.uploadedLocal;var f=d.animationGIF;var g=d.displayFormat&&this.isVR360Available(d.displayFormat);if(e&&!f&&!g){b=c.getContainerWrappingElement()[0];return false}}.bind(this));return b},isVR360Available:function(a){return $SE_CONFIG.IMAGE.FORMAT.VR360_SUPPORT.indexOf(a)>=0},_isNeedTooltip:function(){return $SE_CONFIG.SERVICE_CONFIG.USE_TOOLTIP&&!this._oToolTip&&$SE_COMMON_UTIL.getCookie($SE_CONFIG.COOKIE_NAMES.PHOTO_EDITOR)!=="T"},_showTooltip:function(a){if(!this._isNeedTooltip()){return}this._oToolTip=this._createToolTip(a);this._oToolTip.ntooltip("openTooltip")},_createToolTip:function(a){return $(a).find(".se_viewArea").ntooltip({left:-55,type:"topLeft",pointerType:"down",autoClose:true,message:"이미지를 원하는 대로<br>편집할 수 있어요!"})},show:function(){var a=this._getTooltipTarget(this._getImageCompList());this._showTooltip(a)},hide:function(){if(this._oToolTip){this._oToolTip.ntooltip("closeAll")}},destroy:function(){this._oToolTip.destory()}});se.defineClass("se.CanvasToolbarActionButtonView",{construct:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._fExecuteAction=a.executeAction||function(){};this._elSelected=null;this._bIsShown=false;this._bIsInputPanelOpened=false;this._sCurrentValue=null},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){this._fExecuteAction(a);this._callOnClickListener(a,false)},_callOnClickListener:function(a,b){this._fHandleMouseDown.call(this,a,this._htOptions.group,null,b)},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["action-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent()},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},getButtonLabel:function(){return this._$elBtn.text()},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._elSelected=null;this._bIsShown=null;this._sCurrentValue=null}});se.defineComponent("se.CanvasToolbarTableWidthButtonView",{construct:function(a){this._htOptions=a;this._initVar()},_initVar:function(){this._fHandleMouseDown=this._htOptions.onClick||function(){};this._sGroupName=this._htOptions.group;this._isDisabled=false;this._prevValue=this._htOptions.value},_assignButtonViewElements:function(){var a=this._$elContainer;this._$input=a.find(".__se_table_width_input");this._$slider=a.find("[type='range']");this._$submitBtn=a.find(".__se_submit_btn")},_bindButtonViewEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this));this._$input.on("click",this._onClickInput.bind(this)).on("keyup",this._onKeyUpBtn.bind(this)).on("keydown",this._onKeyDownBtn.bind(this));this._$submitBtn.on("click",this._onClickSubmitBtn.bind(this))},_onClickSubmitBtn:function(a){if(this._$input.val()===""){this._$input.val(this._prevValue)}var b=parseInt(this._$input.get(0).value,10);this._$slider.val(b).change();this._callOnClickListener(a,b,true);this._prevValue=b;this.closeSubPanel()},focusInput:function(){var a=this._$input.get(0).value;this._$input.focus();if($SE_COMMON_UTIL.detectIE()){$SE_STRING.setCaretPosition(this._$input.get(0),a.length)}},_onClickInput:function(a){this.focusInput()},_onKeyDownBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){if(this._$input.val()===""){this._$input.val(this._prevValue)}a.preventDefault();return}if(a.keyCode!==$SE_CONFIG.TRIGGER.BACKSPACE&&a.keyCode!==$SE_CONFIG.TRIGGER.ENTER&&isNaN(a.key)){a.preventDefault();return}var b=this._$input.val()+a.key;if(b.length>=3&&parseInt(b,10)>100){a.preventDefault();return}},_onKeyUpBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickSubmitBtn(a)}},_onClickBtn:function(a){if(this._isDisabled){a.preventDefault();return}var b=this.isSubPanelOpened();if(b){this.closeSubPanel();b=false}else{this.openSubPanel();b=true}this._callOnClickListener(a,b,false)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},mountTo:function(a){this._$elContainer=$(se.editor.template.common["table-width-button.hbs"](this._htOptions));this._$elContainer.appendTo(a);this._assignButtonViewElements();this._bindButtonViewEvent();this.changeValue(this._htOptions.value)},changeValue:function(a){this._$input.val(a);this._$slider.val(a).change();this._prevValue=a},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},_isInitRangeSlider:function(){return this._$slider.attr("data-init")},_initRangeSlider:function(){this._$slider.rangeslider({polyfill:false,onSlide:this._onSlide.bind(this),onSlideEnd:this._onSlideEnd.bind(this)}).attr("data-init",true)},_onSlide:function(a,b){this._$input.val(b)},_onSlideEnd:function(a,b){this._callOnClickListener({target:this._$slider[0],preventDefault:function(){},stopPropagation:function(){}},b,true)},openSubPanel:function(){this._$elContainer.addClass("is-active");this._isPanelOpened=true;if(!this._isInitRangeSlider()){this._initRangeSlider()}else{this._$slider.rangeslider("update",true)}this.changeValue(this._prevValue);var a=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(a&&a.getCompType()===$SE_CONFIG.COMP_TYPE.TABLE){var b=a.getTableWidthMinValue();this._$slider.attr("min",b);this._$slider.rangeslider("update",true)}},closeSubPanel:function(){this._$elContainer.removeClass("is-active");this._isPanelOpened=false},enable:function(){this._$elContainer.removeClass("is-disabled");this._isDisabled=false},disable:function(){this._$elContainer.addClass("is-disabled");this._isDisabled=true},isSubPanelOpened:function(){return!!this._isPanelOpened}});se.defineComponent("se.CanvasToolbarLineHeightButtonView",{construct:function(a){this._htOptions=a;var b=a.checker||{};this._fValidate=b.validator||function(){return true};this._initVar()},_initVar:function(){this._bIsSubPanelOpend=false;this._fHandleMouseDown=this._htOptions.onClick||function(){}},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["lineHeight-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this.changeValue(b.value)},_assignElements:function(){var a=this._$elContainer;this._$elBtn=$(".__se_toolbar_btn",a);this._$elOptionContainer=$(".__se_select_options",a);this._$elInput=$(".__se_lineheight_input",a);this._$elSubmitBtn=$(".__se_submit",a)},_bindEvent:function(){this._$elContainer.on("click",".__se_option_btn",this._onClickOption.bind(this));this._$elBtn.on("click",this._onClickBtn.bind(this));this._$elInput.on("click",this._onClickInput.bind(this)).on("keyup",this._onKeyUpBtn.bind(this)).on("keydown",this._onKeyDownBtn.bind(this)).on("input",this._onInputValue.bind(this));this._$elSubmitBtn.on("click",this._onClickSubmitBtn.bind(this))},_onClickSubmitBtn:function(a){var b=this._$elInput;var c=b.val();var d;a.stopPropagation();a.preventDefault();d=this._fValidate(c);if(d.validFormat&&d.validRange){this._doProcessVaild(a,c)}else{this._doProcessInVaild(d)}},_doProcessVaild:function(a,b){this.changeValue(b);this.closeSubPanel();this._callOnClickListener(a,b,true)},_doProcessInVaild:function(a){var b;if(a.validFormat===false){b=se.i18n.getMsg("MSG_ERROR_LINEHEIGHT_FORMAT")}else if(a.validRange===false){b=se.i18n.getMsg("MSG_ERROR_LINEHEIGHT_RANGE");this._$elInput.val(50)}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,b);this._$elInput.focus()},_onKeyUpBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickSubmitBtn(a)}},_onKeyDownBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){a.preventDefault()}},_onInputValue:function(a){this._activateSubmitBtn()},_activateSubmitBtn:function(){var a=this._$elInput.val();var b=this._$elSubmitBtn;if(a!==""){b.addClass("is-on")}else{b.removeClass("is-on")}},_onClickInput:function(a){this._$elInput.focus()},_onClickOption:function(a){var b=$(a.currentTarget);var c=b.attr("data-lineheight");a.preventDefault();this.changeValue(c);this.closeSubPanel();this._callOnClickListener(a,c,true)},_onClickBtn:function(a){a.preventDefault();a.stopPropagation();if(this.isSubPanelOpened()){this.closeSubPanel()}else{this.openSubPanel()}this._callOnClickListener(a,"",false)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},changeValue:function(a){this._deselect();this._select(a)},_deselect:function(){this._$elOptionContainer.find(".__se_option_btn").removeClass("is-selected");this._$elInput.val("");this._$elSubmitBtn.removeClass("is-on")},_select:function(a){var b;if(a===""){a=190}b=this._$elOptionContainer.find("[data-lineheight="+a+"]");if(b.length>0){b.addClass("is-selected")}else{this._$elInput.val(a);this._activateSubmitBtn()}},openSubPanel:function(){this._$elContainer[0].classList.add("is-active");this._bIsSubPanelOpend=true},closeSubPanel:function(){this._$elContainer[0].classList.remove("is-active");this._bIsSubPanelOpend=false},isSubPanelOpened:function(){return this._bIsSubPanelOpend},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown}});se.defineComponent("se.CanvasToolbarSpecialLetterButtonView",{_MAX_RECENT_CHAR:20,construct:function(a){this._htOptions=a;this._initVar();this._initComponent()},_initVar:function(){this._fHandleMouseDown=this._htOptions.onClick||function(){};this._sGroupName=this._htOptions.group},_initComponent:function(){this._oRecentUsedRepos=new se.CanvasToolbarRepository},_assignButtonViewElements:function(){var a=this._$elContainer;this._$elRecentUsedContainer=$(".__se_recent_used_char_container",a);this._$elMoreCharBtnLabel=$(".__se_button_label",a);this._$elMoreCharBtn=$(".__se_more_char",a)},_bindButtonViewEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this)).on("click",".__se_char",this._onClickRecentUsedChar.bind(this));this._$elMoreCharBtn.on("click",this._showPopup.bind(this))},_loadRecentUsedChar:function(){var a=this._oRecentUsedRepos.fetchRecentUsed(this._sGroupName);if(!this._hasUsedChar()){a=this._htOptions["defaultChar"]}this._asRecentUsedChar=a;var b=this._generateRecentUsedCharHtml(a.slice().reverse());this._$elRecentUsedContainer.html(b)},_hasUsedChar:function(){var a=this._oRecentUsedRepos.fetchRecentUsed(this._sGroupName);return!(_.isArray(a)&&a[0]==="")},_updateButtonLabel:function(){var a=this._hasUsedChar()===true?se.i18n.getMsg("MSG_SPECIAL_LETTER_USED_LABEL"):se.i18n.getMsg("MSG_SPECIAL_LETTER_DEFAULT_LABEL");this._$elMoreCharBtnLabel.text(a)},_generateRecentUsedCharHtml:function(a){if(typeof a==="string"){a=[a]}return se.editor.template.common["specialLetter-recent-used-list.hbs"]({"char":a})},_addRecentUsedChar:function(a){this._removeSameChar(a);this._dropOldestChar();this._asRecentUsedChar.push(a);this._$elRecentUsedContainer.html(this._generateRecentUsedCharHtml(this._asRecentUsedChar.slice().reverse()));this._oRecentUsedRepos.saveRecentUsed(this._htOptions.group,this._asRecentUsedChar)},_removeSameChar:function(a){this._asRecentUsedChar=_.without(this._asRecentUsedChar,a)},_dropOldestChar:function(){if(this._asRecentUsedChar.length>=this._MAX_RECENT_CHAR){this._asRecentUsedChar.shift()}},_showPopup:function(a){a.stopPropagation();$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:se.editor.template.common["specialLetter-popup.hbs"](this._htOptions),"class":"pop_specialLetter_wrap",beforeOpen:function(){this.closeSubPanel();this._isPanelOpened=true}.bind(this),afterOpen:function(){this._assignPopupElement();this._bindPopupEvent()}.bind(this),afterClose:function(){this._isPanelOpened=false;clickcr(this,"smb*d.close","","",event)}.bind(this)});$SE_MODAL.open()},_assignPopupElement:function(){this._$elPopupContainer=$(".__se_pop_content",parent.document.body);this._$aElTabs=$(".__se_tab",this._$elPopupContainer);this._$aElCharContainer=$(".__se_char_container",this._$elPopupContainer)},_bindPopupEvent:function(){this._$elPopupContainer.on("contextmenu",function(a){$SE_MODAL.close();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FOCUS_OUT_FOCUSED);this._stopEvent(a)}.bind(this)).on("mousedown",this._stopEvent.bind(this)).on("click",".__se_char",this._onClickChar.bind(this)).on("click",".__se_tab",this._onClickTabBtn.bind(this))},_stopEvent:function(a){a.preventDefault();a.stopPropagation()},_deselectTab:function(){this._$elPopupContainer.find(".__se_character_item").removeClass("is-active")},_selectTab:function(a){this._$elPopupContainer.find(".__se_character_item").eq(a).addClass("is-active")},_changeContainer:function(a){this._$aElCharContainer.removeClass("is-active").eq(a).addClass("is-active")},_onClickBtn:function(a){var b=this.isSubPanelOpened();if(b){this.closeSubPanel();b=false}else{this.openSubPanel();b=true}this._callOnClickListener(a,b,false)},_onClickTabBtn:function(a){var b=this._$aElTabs;var c=$.inArray(a.currentTarget,b);this._deselectTab();this._selectTab(c);this._changeContainer(c);this._callOnClickListener(a,"",false)},_onClickChar:function(a){a.stopPropagation();var b=$(a.currentTarget);var c=b.text();this._addRecentUsedChar(c);this._callOnClickListener(a,c.trim(),true)},_onClickRecentUsedChar:function(a){a.stopPropagation();var b=$(a.currentTarget);var c=b.text();this._callOnClickListener(a,c.trim(),true)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},mountTo:function(a){this._$elContainer=$(se.editor.template.common["specialLetter-button.hbs"](this._htOptions));this._$elContainer.appendTo(a);this._assignButtonViewElements();this._bindButtonViewEvent();this._loadRecentUsedChar()},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(){this._$elContainer.addClass("is-active");this._isPanelOpened=true;this._updateButtonLabel()},closeSubPanel:function(){this._$elContainer.removeClass("is-active");this._isPanelOpened=false},isSubPanelOpened:function(){return!!this._isPanelOpened}});se.defineClass("se.CanvasToolbarRepository",{construct:function(){this.localStorage=typeof localStorage==="object"?localStorage:{setItem:function(){},getItem:function(){},removeItem:function(){}}},saveRecentUsed:function(a,b){this.localStorage.setItem(this._makeKey(a),b)},fetchRecentUsed:function(a){var b=this.localStorage.getItem(this._makeKey(a))||"";return b.split(",")},removeRecentUsed:function(a){this.localStorage.removeItem(this._makeKey(a))},_makeKey:function(a){return $SE_CONFIG.USER_INFO.id+":RECENT_USED:"+a}});se.defineComponent("se.CanvasToolbarColorPickerButtonView",{_MAX_RECENT_COLOR:20,construct:function(a){this._htOptions=a;this._tplPalletCell=se.editor.template.common["color-pallet-cell.hbs"];this._fHandleMouseDown=a.onClick||function(){};this._asRecentUsedColors=[];this._bIsShown=false;this._bIsPalletLoaded=false;this._bIsAttached=false;this._bIsInputPanelOpened=false;this._elSelected=null;this._sCurrentValue=null;this._oColorPickerRepository=new se.CanvasToolbarRepository},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn");this._$elOptions=this._$elContainer.find(".__se_select_options");this._$elColorPalletWrapper=this._$elContainer.find(".__se_color_pallet");this._$elColorPallet=$("<ul>");this._$elRecentUsedPallet=this._$elContainer.find(".__se_recent_pallet")},_clearElements:function(){this._$elBtn=null;this._$elOptions=null;this._$elColorPalletWrapper=null;this._$elColorPallet=null;this._$elRecentUsedPallet=null;this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this)).on("click",".__se_select_options",this._onClickOptions.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){var b=null;if(this.isSubPanelOpened()){this.closeSubPanel();b=false}else{this.openSubPanel();b=true}this._callOnClickListener(a,b,false)},_onClickOptions:function(a){var b=a.target;var c=b.getAttribute("data-value");this.changeValue(c);this.closeSubPanel();this._addRecentUsedColor(c);this._callOnClickListener(a,c,true);return false},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["colorPicker-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this._loadRecentUsedColors();this.changeValue(b.value)},_isLatestRecentUsedColor:function(a){var b=this._asRecentUsedColors;return b[b.length-1]===a},_removeSameColorOnRecentUsed:function(a){this._asRecentUsedColors=_.without(this._asRecentUsedColors,a);this._$elRecentUsedPallet.find("li").has('[data-value="'+a+'"]').remove()},_dropOldestRecentUsedColor:function(){if(this._asRecentUsedColors.length>=this._MAX_RECENT_COLOR){this._asRecentUsedColors.shift();this._$elRecentUsedPallet.find("li").last().remove()}},_addRecentUsedColor:function(a){if(this._isLatestRecentUsedColor(a)){return}this._removeSameColorOnRecentUsed(a);this._dropOldestRecentUsedColor();this._asRecentUsedColors.push(a);this._$elRecentUsedPallet.prepend(this._generateRecentUsedColorsHtmlString(a));this._oColorPickerRepository.saveRecentUsed(this._htOptions.group,this._asRecentUsedColors)},_select:function(a){this._elSelected=this._findOptionElement(a);if(this._elSelected){this._sCurrentValue=a;this._elSelected.classList.add("is-selected")}if(this._htOptions.group!=="cellBackgroundColor"){this._$elBtn[0].style.backgroundColor=a}},_getSelected:function(){return this._elSelected},_findOptionElement:function(a){return this._$elColorPallet.get(0).querySelector('[data-value="'+a+'"]')},_deselect:function(){var a=this._getSelected();if(a){a.classList.remove("is-selected")}},_generateColorPallet:function(){this._$elColorPallet.html(this._generateRecentUsedColorsHtmlString(this._htOptions.options))},attachColorPallet:function(){this._$elColorPalletWrapper.append(this._$elColorPallet);this._bIsAttached=true},_createColorPallet:function(){this._generateColorPallet();this.attachColorPallet();this._bIsPalletLoaded=true},_loadRecentUsedColors:function(){var a=this._htOptions.group;var b=this._oColorPickerRepository.fetchRecentUsed(a);var c=this._generateRecentUsedColorsHtmlString(b.slice().reverse());this._$elRecentUsedPallet[0].innerHTML=c;this._asRecentUsedColors=b},_generateRecentUsedColorsHtmlString:function(a){if(typeof a==="string"){a=[a]}return this._tplPalletCell({colorSets:a})},changeValue:function(a){if(a==null){a=""}if(this._bIsPalletLoaded===false){this._createColorPallet()}this._deselect();this._select(a)},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(){if(this._bIsPalletLoaded===false){this._createColorPallet()}if(this._bIsAttached===false){this.attachColorPallet()}this._$elContainer[0].classList.add("is-active");this._bIsInputPanelOpened=true},closeSubPanel:function(){this._$elContainer[0].classList.remove("is-active");this._bIsInputPanelOpened=false},isSubPanelOpened:function(){return this._bIsInputPanelOpened},getButtonLabel:function(){return this._$elBtn.text()},getSelectedOptionLabel:function(){return this._elSelected.getAttribute("title")},dettachPallet:function(){this._$elColorPallet.detach();this._bIsAttached=false},getValue:function(){return this._sCurrentValue},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._asRecentUsedColors=null;this._bIsShown=null;this._bIsPalletLoaded=null;this._bIsAttached=null;this._bIsInputPanelOpened=null;this._elSelected=null;this._sCurrentValue=null}});se.defineComponent("se.CanvasToolbarGroupToggleButtonView",{construct:function(a){a.value=a.value||a.items[0].value;this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._elSelected=null;this._sCurrentValue=null;this._bIsShown=false},_assignElements:function(){},_clearElements:function(){this._$elBtns.remove();this._$elBtns=null},_bindEvent:function(){this._$elBtns.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this))},_unbindEvent:function(){this._$elBtns.off()},_onClickBtn:function(a){var b=a.target;var c=b.getAttribute("data-value");this.changeValue(c);this._callOnClickListener(a)},_callOnClickListener:function(a){this._fHandleMouseDown.call(this,a,this._htOptions.group,this.getValue(),true)},_generateTemplateString:function(a){var b=se.editor.template.common["groupToggle-button.hbs"](a);return b.replace(/>[\s]+\</gi,"><")},_render:function(a,b){var c=this._generateTemplateString(a);this._$elBtns=$(c);this._$elBtns.appendTo(b)},mountTo:function(a){var b=this._htOptions;this._render(b,a);this._assignElements();this._bindEvent();this.changeValue(b.value)},_deselected:function(a){if(a){a.classList.remove("is-active");this._elSelected=null}},_select:function(a){if(!a){a=""}var b=this.findElementByValue(a);if(b){b.classList.add("is-active")}this._elSelected=b;this._sCurrentValue=a},changeValue:function(a){this._deselected(this._elSelected);this._select(a)},findElementByValue:function(a){return this._$elBtns.filter(function(b,c){return c.childNodes[0].getAttribute("data-value")==a})[0]},show:function(){this._$elBtns.addClass("is-on");this._bIsShown=true},hide:function(){this._$elBtns.removeClass("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},getButtonLabel:function(){return this._$elBtn.attr("title")},getValue:function(){return this._sCurrentValue},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._elSelected=null;this._bIsShown=null}});se.defineComponent("se.CanvasToolbarInputButtonView",{_readyValidator:function(a){var b=a.checker||{};this._fFormatter=b.formatter||function(a){return a};this._fValidate=b.validator||function(){return true};this._fOnFailedValiate=b.onFail||function(){}},construct:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._elSelected=null;this._bIsShown=false;this._bIsInputPanelOpened=false;this._sCurrentValue="";this._isDisabled=false;this._readyValidator(a)},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn");this._$elInput=this._$elContainer.find(".__se_input");this._$elApply=this._$elContainer.find(".__se_apply")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this)).on("click",".__se_apply",this._onClickApplyBtn.bind(this)).on("keyup",".__se_input",this._onKeyUpBtn.bind(this)).on("keydown",".__se_input",this._onKeyDownBtn.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){if(this._isDisabled){a.preventDefault();return}if(this.isSubPanelOpened()){this.closeSubPanel(a)}else{this.openSubPanel(a)}},_doProcessForValid:function(a,b){this.closeSubPanel();this._callOnClickListener(a,b,true)},_doProcessForInvalid:function(a){this._fOnFailedValiate(a);this.focusInput()},_onClickApplyBtn:function(a){var b=this._fFormatter(this._$elInput.val());if(this._fValidate(b)){this._doProcessForValid(a,b)}else{this._doProcessForInvalid(b)}},_onKeyUpBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickApplyBtn(a)}},_onKeyDownBtn:function(a){if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){a.preventDefault()}},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["input-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this.changeValue(b.value)},focusInput:function(){var a=this._$elInput.get(0).value;$SE_STRING.setCaretPosition(this._$elInput.get(0),a.length)},changeValue:function(a){this._sCurrentValue=a;this._$elInput.val(a);this._hightlight(a)},_hightlight:function(a){if(a&&$.trim(a)!==""){this._$elContainer[0].classList.add("is-activated")}else{this._$elContainer[0].classList.remove("is-activated")}},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(a){this._$elContainer[0].classList.add("is-active");this._bIsInputPanelOpened=true;if(a){this._callOnClickListener(a,true,false)}this.focusInput()},closeSubPanel:function(a){this._$elContainer[0].classList.remove("is-active");this._bIsInputPanelOpened=false;if(a){this._callOnClickListener(a,false,false)}this._$elInput.blur()},isSubPanelOpened:function(){return this._bIsInputPanelOpened},getButtonLabel:function(){return this._$elBtn.attr("title")},getSelectedOptionLabel:function(){return this._elSelected.getAttribute("title")},getValue:function(){return this._sCurrentValue},enable:function(){this._$elContainer.removeClass("is-disabled");this._isDisabled=false},disable:function(){this._$elContainer.addClass("is-disabled");this._isDisabled=true},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._elSelected=null;this._bIsShown=null;this._sCurrentValue=null;this._fHandleMouseDown=null;this._fValidate=null;this._fOnFailedValiate=null}});se.defineComponent("se.CanvasToolbarMediaResizeButtonView",{VIDEO_PLAYER_MIN_WIDTH:250,IMAGE_PANORAMA_MIN_HEIGHT:50,construct:function(a){this._initVar(a)},_initVar:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._elSelected=null;this._bIsShown=false;this._bIsInputPanelOpened=false;this.IMAGE_STANDARD_WIDTH=parseInt($SE_CONFIG.SERVICE_CONFIG.CONTENTS_STANDARD_WIDTH,10)||700;this._htComponentInfo=null},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["media-resize-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent()},changeValue:function(a){this._hightlight(a)},_toggleApplyButton:function(){var a=this.getValue().width;var b=this.getValue().height;var c=a>0&&b>0&&this._validateImageSize(a);var d=a!==this._htComponentInfo.width;if(c&&d){this._$elApply.removeClass("is-disable")}else{this._$elApply.addClass("is-disable")}},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn");this._$elInputWidth=this._$elContainer.find(".__se_input_width");this._$elInputHeight=this._$elContainer.find(".__se_input_height");this._$elApply=this._$elContainer.find(".__se_btn_apply");this._$elReset=this._$elContainer.find(".__se_btn_reset")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickResizeBtn.bind(this)).on("click",".__se_btn_apply",this._onClickApplyBtn.bind(this)).on("click",".__se_btn_reset",this._onClickResetBtn.bind(this)).on("click",".__se_input_width",this._focusWidthInput.bind(this)).on("click",".__se_input_height",this._focusHeightInput.bind(this)).on("keyup",".__se_input_width",this._onKeyUpWidthInput.bind(this)).on("keyup",".__se_input_height",this._onKeyUpHeightInput.bind(this)).on("keydown",".__se_input_width",this._onKeyDownInput.bind(this)).on("keydown",".__se_input_height",this._onKeyDownInput.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickResizeBtn:function(a){if(this.isSubPanelOpened()){this.closeSubPanel()}else{this.openSubPanel()}this._callOnClickListener(a,null,false)},_onClickApplyBtn:function(a){clickcr(this,"pht*q.sizeok","","",a);if(this._$elApply.hasClass("is-disable")){return}if(this.isValidToApply()){var b={type:"resize",mediaSize:this.getValue()};this._callOnClickListener(a,b,true);this.closeSubPanel()}},isValidToApply:function(){if(this._isVideoComp()){return this._validateMinSize("width",this.VIDEO_PLAYER_MIN_WIDTH)}if(this._isPanoramaImageComp()){return this._validateMinSize("height",this.IMAGE_PANORAMA_MIN_HEIGHT)}return true},_onClickResetBtn:function(a){clickcr(this,"pht*q.sizereset","","",a);if(this._$elReset.hasClass("is-disable")){return}var b={type:"reset"};this._callOnClickListener(a,b,true);this.closeSubPanel()},_initInputPlaceHolder:function(){var a=this._getMaxResize();this._$elInputWidth.attr("placeholder",a.width);this._$elInputHeight.attr("placeHolder",a.height)},_getMaxResize:function(){var a=this.IMAGE_STANDARD_WIDTH;var b=this._htComponentInfo.originalWidth||this._htComponentInfo.displayWidth||this._htComponentInfo.width||a;var c=this._htComponentInfo.originalHeight||this._htComponentInfo.displayHeight||this._htComponentInfo.height||0;
b=b>a?a:b;c=this._getInputMediaSizeByRatio(b,c).height;return{width:b,height:c}},_toggleResetButton:function(){var a=this._isChangedDisplayImageSize();if(a){this._$elReset.removeClass("is-disable")}else{this._$elReset.addClass("is-disable")}},_isChangedDisplayImageSize:function(){if(this._isVideoComp()){return this._htComponentInfo.isResized}else{return this._htComponentInfo.width!==this._htComponentInfo.originalWidth}},_onKeyUpWidthInput:function(a){var b=this._$elInputWidth.val();if(b&&!$.isNumeric(b)){this._$elInputWidth.val(b.replace(/[^0-9]/g,""));return}this._changeInputValue(b,null);if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickApplyBtn(a);return}},_onKeyUpHeightInput:function(a){var b=this._$elInputHeight.val();if(b&&!$.isNumeric(b)){this._$elInputHeight.val(b.replace(/[^0-9]/g,""));return}this._changeInputValue(null,b);if(a.keyCode===$SE_CONFIG.TRIGGER.ENTER){this._onClickApplyBtn(a);return}},_onKeyDownInput:function(a){if(a.keyCode===229){return false}},_changeInputValue:function(a,b){var c=this._getInputMediaSizeByRatio(a,b);this._updateWidthHeight(c.width,c.height)},_focusWidthInput:function(a){clickcr(this,"pht*q.sizew","","",a);$SE_STRING.setCaretPosition(this._$elInputWidth.get(0),this._$elInputWidth.val().length)},_focusHeightInput:function(a){clickcr(this,"pht*q.sizeh","","",a);$SE_STRING.setCaretPosition(this._$elInputHeight.get(0),this._$elInputHeight.val().length)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},_setFocusedComponentInfo:function(){var a=$("#se_components_wrapper").children(".is-focused").attr("id");var b=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.GET_COMPONENTS_DATA);this._htComponentInfo=null;b.forEach(function(b){if(b.compId==a){this._htComponentInfo=b.wrapComp||b;return false}}.bind(this))},_getInputMediaSizeByRatio:function(a,b){var c=this._getMediaRatio();var d=isNaN(parseInt(a,10))?"":parseInt(a,10);var e=isNaN(parseInt(b,10))?"":parseInt(b,10);if(a){e=Math.round(d*c)}else if(b){d=Math.round(e*(1/c))}return{width:d,height:e}},_getMediaRatio:function(){var a=this._getMediaSizeByType();return Math.round(a.height/a.width*100)/100},_getMediaSizeByType:function(){var a,b;if(this._isVideoComp()){var c=this._getVideoMediaSize();a=c.width;b=c.height}else{a=this._htComponentInfo.originalWidth||this._htComponentInfo.width;b=this._htComponentInfo.originalHeight||this._htComponentInfo.height}return{width:a,height:b}},_getVideoMediaSize:function(){var a,b;var c=this._getDefaultVideoDisplayRatio(this._htComponentInfo);a=this._htComponentInfo.displayWidth||this.IMAGE_STANDARD_WIDTH;b=this._htComponentInfo.displayHeight||c*a;return{width:a,height:b}},_getDefaultVideoDisplayRatio:function(a){var b;if(a.width&&a.height){b=a.height>=a.width?1:a.height/a.width}else{b=9/16}return b},_getErrorMsg:function(a){var b=this._htComponentInfo.originalWidth;var c="";if(a>=this.IMAGE_STANDARD_WIDTH){c=se.i18n.getMsg("MSG_ERROR_IMAGE_RESIZE_UNDER").replace("{=MAXWIDTH}",this.IMAGE_STANDARD_WIDTH)}else if(a>=b){c=se.i18n.getMsg("MSG_ERROR_IMAGE_RESIZE_OVER").replace("{=MAXWIDTH}",b)}return c},_validateImageSize:function(a){var b=this._getErrorMsg(a);if(b){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,b)}return b?false:true},_validateMinSize:function(a,b){var c,d;if(a==="width"){d=this._$elInputWidth.val()}else if(a==="height"){d=this._$elInputHeight.val()}if(d<b){c=se.i18n.getMsg("MSG_ERROR_RESIZE_UNDER_MIN").replace("{{=TARGET}}",$SE_CONFIG.TARGET[a]).replace("{{=MINWIDTH}}",b);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,c)}return c?false:true},_hightlight:function(a){if(a&&$.trim(a)!==""){this._$elContainer[0].classList.add("is-activated")}else{this._$elContainer[0].classList.remove("is-activated")}},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(){this._$elContainer[0].classList.add("is-active");this._bIsInputPanelOpened=true;this._focusWidthInput();this._setFocusedComponentInfo();if(this._htComponentInfo!=null){this._initInputPlaceHolder();this._setDefaultInputValue()}},_updateWidthHeight:function(a,b){this._$elInputWidth.val(a);this._$elInputHeight.val(b);this._toggleApplyButton();this._toggleResetButton()},_setDefaultInputValue:function(){var a="";var b="";if(this._isChangedDisplayImageSize()){var c=this._getDefaultInputValueByType();a=c.width;b=c.height}this._updateWidthHeight(a,b)},_getDefaultInputValueByType:function(){var a,b;if(this._isVideoComp()&&!this._htComponentInfo.isResized){a=this._htComponentInfo.displayWidth;b=this._htComponentInfo.displayHeight}else if(this._isVideoComp()&&this._htComponentInfo.isResized){a=this._htComponentInfo.resizedWidth;b=this._htComponentInfo.resizedHeight}else{a=this._htComponentInfo.width;b=this._htComponentInfo.height}return{width:a,height:b}},_isVideoComp:function(){return this._htComponentInfo["@ctype"]==="video"},_isPanoramaImageComp:function(){return $SE_CONFIG.SERVICE_CONFIG.IS_PANORAMA_AVAILABLE&&this._htComponentInfo["@ctype"]==="image"&&this._htComponentInfo.generationFormat==="panorama"},closeSubPanel:function(){this._$elContainer[0].classList.remove("is-active");this._bIsInputPanelOpened=false;this._$elInputWidth.blur();this._$elInputHeight.blur()},isSubPanelOpened:function(){return this._bIsInputPanelOpened},getButtonLabel:function(){return this._$elBtn.attr("title")},getSelectedOptionLabel:function(){return this._elSelected.getAttribute("title")},getValue:function(){return{width:parseInt(this._$elInputWidth.val(),10)||"",height:parseInt(this._$elInputHeight.val(),10)||""}},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._elSelected=null;this._bIsShown=null;this._fHandleMouseDown=null;this._htComponentInfo=null;this.IMAGE_STANDARD_WIDTH=null}});se.defineComponent("se.CanvasToolbarSelectButtonView",{construct:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._sGroup=this._htOptions.group;this._elSelected=null;this._bIsShown=false;this._bIsInputPanelOpened=false;this._sCurrentValue=null;this._isDisabled=false},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn");this._$elOptions=this._$elContainer.find(".__se_select_options")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this)).on("click",".__se_select_options",this._onClickOptions.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){if(this._isDisabled){a.preventDefault();return}var b=null;if(this.isSubPanelOpened()){this.closeSubPanel();b=false}else{this.openSubPanel();b=true}this._callOnClickListener(a,b,false)},_onClickOptions:function(a){var b=a.target;var c=b.getAttribute("data-value");this._deselect();this._select(c);this.closeSubPanel();this._callOnClickListener(a,c,true)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c,this._htOptions.key)},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["select-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this.changeValue(b.value)},_select:function(a){if(!a){a=this._htOptions.value}this._elSelected=this._findOptionElement(a);if(this._elSelected){var b=this._elSelected.getAttribute("title");this._elSelected.classList.add("is-selected");this._changeBtnLabel(this._sGroup,b);if(this._sGroup==="textAlignGroup"){this._$elBtn.addClass("se_"+this._sGroup+"-"+a)}else if(this._sGroup==="componentAlignGroup"){this._$elBtn.addClass("se_"+this._sGroup+"-"+a)}}this._sCurrentValue=a},_preprocessForCard:function(a){if($SE_CONFIG.ENV_SETTING.IS_CARD_DOC&&a==="나눔바른고딕"){a="나눔바른"}return a},_changeBtnLabel:function(a,b){b=this._preprocessForCard(b);if(a==="fontFamily"||a==="componentAlignGroup"){this._$elBtn.find("span").text(b)}else if(a==="textAlignGroup"||a==="tableLayoutGroup"){return false}else{this._$elBtn.text(b)}},_getSelected:function(){return this._elSelected},_findOptionElement:function(a){return this._$elOptions.find('[data-value="'+a+'"]')[0]},_deselect:function(){var a=this._getSelected();if(a){if(this._sCurrentValue){this._$elBtn.removeClass("se_"+this._sGroup+"-"+this._sCurrentValue)}a.classList.remove("is-selected")}},changeValue:function(a){this._deselect();this._select(a)},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(){this._$elContainer[0].classList.add("is-active");this._bIsInputPanelOpened=true},closeSubPanel:function(){this._$elContainer[0].classList.remove("is-active");this._bIsInputPanelOpened=false},isSubPanelOpened:function(){return this._bIsInputPanelOpened},getButtonLabel:function(){if(this._sGroup==="fontFamily"){return this._$elBtn.find("span").text()}else{return this._$elBtn.text()}},getSelectedOptionLabel:function(){return this._elSelected.getAttribute("title")},getValue:function(){return this._sCurrentValue},enable:function(){this._$elContainer.removeClass("is-disabled");this._isDisabled=false},disable:function(){this._$elContainer.addClass("is-disabled");this._isDisabled=true},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._elSelected=null;this._bIsShown=null;this._sCurrentValue=null}});se.defineComponent("se.CanvasToolbarSwitchButtonView",{construct:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._nCurrentIndex=this._findIndexByValue(a.values,a.value);this._sCurrentValue=null;this._bIsShown=false;a.index=this._nCurrentIndex;a.nclick=a.nclicks[this._nCurrentIndex]},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){this.changeValue(this._getNextValue());this._callOnClickListener(a)},_getNextValue:function(){var a=this._nCurrentIndex;if(a===this._htOptions.values.length-1){a=0}else{a+=1}return this._htOptions.values[a]},_callOnClickListener:function(a){this._fHandleMouseDown.call(this,a,this._htOptions.group,this.getValue(),false)},_findIndexByValue:function(a,b){var c=0;for(var d=0;d<a.length;d++){if(a[d]===b){c=d;break}}return c},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["switch-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this.changeValue(b.value)},_changeCurrentIndex:function(a){this._nCurrentIndex=a;this._$elBtn[0].setAttribute("data-nclick",this._htOptions.nclicks[a])},_switchValue:function(a){var b="se_";var c=this._htOptions.group;var d=b+c+"_"+this._sCurrentValue;var e=b+c+"_"+a;var f=this._$elBtn[0].classList;f.remove(d);f.add(e);this._sCurrentValue=a},changeValue:function(a){var b=this._findIndexByValue(this._htOptions.values,a);this._switchValue(a);this._changeCurrentIndex(b)},getIndex:function(){return this._nCurrentIndex},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},getButtonLabel:function(){return this._$elBtn.attr("title")},getValue:function(){return this._sCurrentValue},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._nCurrentIndex=null;this._sCurrentValue=null;this._bIsShown=null}});se.defineClass("se.CanvasToolbarToggleButtonView",{construct:function(a){this._htOptions=a;this._fHandleMouseDown=a.onClick||function(){};this._elSelected=null;this._bIsShown=false;this._bIsChecked=false;this._isDisabled=false},_assignElements:function(){this._$elBtn=this._$elContainer.find(".__se_toolbar_btn")},_clearElements:function(){this._$elContainer.remove();this._$elContainer=null},_bindEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this))},_unbindEvent:function(){this._$elContainer.off()},_onClickBtn:function(a){if(this._isDisabled){a.preventDefault();return}if(this._bIsChecked){this.changeValue(false)}else{this.changeValue(true)}this._callOnClickListener(a)},_callOnClickListener:function(a){this._fHandleMouseDown.call(this,a,this._htOptions.group,this._bIsChecked,false)},mountTo:function(a){var b=this._htOptions;this._$elContainer=$(se.editor.template.common["toggle-button.hbs"](b));this._$elContainer.appendTo(a);this._assignElements();this._bindEvent();this.changeValue(b.value)},_turnOn:function(){this._$elContainer[0].classList.add("is-active");this._bIsChecked=true},_turnOff:function(){this._$elContainer[0].classList.remove("is-active");this._bIsChecked=false},changeValue:function(a){if(a){this._turnOn()}else{this._turnOff()}},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},getButtonLabel:function(){return this._$elBtn.attr("title")},getValue:function(){return this._bIsChecked},enable:function(){this._$elContainer.removeClass("is-disabled");this._isDisabled=false},disable:function(){this._$elContainer.addClass("is-disabled");this._isDisabled=true},destroy:function(){this._unbindEvent();this._clearElements();this._htOptions=null;this._fHandleMouseDown=null;this._elSelected=null;this._bIsShown=null}});se.defineComponent("se.CanvasToolbarBorderStyleButtonView",{_MAX_RECENT_COLOR:20,construct:function(a){this._htOptions=a;this._initVar()},_initVar:function(){this._fHandleMouseDown=this._htOptions.onClick||function(){};this._sGroupName=this._htOptions.group;this._tplPalletCell=se.editor.template.common["color-pallet-cell.hbs"];this._colorPickerRepository=new se.CanvasToolbarRepository},_assignButtonViewElements:function(){var a=this._$elContainer;this._$styleBtn=a.find(".__se_border_style_btn");this._$styleWrapper=a.find(".__se_style_wrapper");this._$colorBtn=a.find(".__se_border_color_btn");this._$colorWrapper=a.find(".__se_color_wrapper");this._$recentUsedPallet=a.find(".__se_recent_used_color_pallete");this._$colorPallete=a.find(".__se_color_pallete")},_bindButtonViewEvent:function(){this._$elContainer.on("click",".__se_toolbar_btn",this._onClickBtn.bind(this)).on("click",".__se_tooltip_btn",this._onClickOption.bind(this));this._$styleBtn.on("click",this._onClickStyleBtn.bind(this));this._$colorBtn.on("click",this._onClickColorBtn.bind(this))},_onClickOption:function(a){a.preventDefault();var b=$(a.target);var c="__se_table_border_style_label";if(b.hasClass(c)){b=b.closest(".__se_tooltip_btn")}var d={};var e=this._getValueType(a.target);d.type=e;if(e==="color"){d.value=$(a.target).attr("data-value");this._$colorBtn.css("background-color",d.value);this._$colorBtn.attr("data-color",d.value);this._addRecentUsedColor(d)}else{d.value={};d.value={styleName:b.attr("data-style-name"),tableBorderWidth:b.attr("data-table-width")||"",tableBorderStyle:b.attr("data-table-style")||"",tableBorderSpacing:b.attr("data-table-spacing")||"",tableBorderCollapse:b.attr("data-table-collapse")||"",borderWidth:b.attr("data-width"),borderStyle:b.attr("data-style"),borderColor:this._getColorValue(),name:b.find("."+c).text()};this.changeValue(d.value)}this._callOnClickListener(a,d,true);this.closeSubPanel()},_getColorValue:function(){return this._$colorBtn.attr("data-color")||this._$colorBtn.css("background-color")},_getValueType:function(a){var b="";a=$(a);if(a.closest(".__se_color_wrapper").length>0){b="color"}else if(a.closest(".__se_style_wrapper").length>0){b="style"}return b},_showStyleOption:function(){this._hideColorOption();this._$styleWrapper.addClass("is-active")},_hideStyleOption:function(){this._$styleWrapper.removeClass("is-active")},_showColorOption:function(){this._hideStyleOption();this._$colorWrapper.addClass("is-active")},_hideColorOption:function(){this._$colorWrapper.removeClass("is-active")},_onClickStyleBtn:function(a){a.preventDefault();if(this._$styleWrapper.hasClass("is-active")){this._hideStyleOption()}else{this._showStyleOption()}},_onClickColorBtn:function(a){a.preventDefault();clickcr(this,"tbl.b*color","","",a);if(this._$colorWrapper.hasClass("is-active")){this._hideColorOption()}else{this._showColorOption()}},_onClickBtn:function(a){var b=this.isSubPanelOpened();if(b){this.closeSubPanel();b=false}else{this.openSubPanel();b=true}this._callOnClickListener(a,b,false)},_callOnClickListener:function(a,b,c){this._fHandleMouseDown.call(this,a,this._htOptions.group,b,c)},mountTo:function(a){this._$elContainer=$(se.editor.template.common["border-style-button.hbs"](this._htOptions));this._$elContainer.appendTo(a);this._assignButtonViewElements();this._bindButtonViewEvent();this._drawPallete();this._loadRecentUsedColors();this.changeValue(this._htOptions.value)},_drawPallete:function(){var a=this._tplPalletCell({colorSets:this._htOptions["options"]["color"]});this._$colorPallete.html(a)},changeValue:function(a){if(a.styleName){var b="se_table_border_style_";var c=this._$styleBtn[0].className.match(/se_table_border_style_([^\s]+)/)[1];this._$styleBtn.removeClass(b+c).addClass(b+a.styleName);this._$styleBtn.find(".__se_label").text(a.name)}if(a.color){this._$colorBtn.css("background-color",a.color);this._$colorBtn.attr("data-color",a.color)}},show:function(){this._$elContainer[0].classList.add("is-on");this._bIsShown=true},hide:function(){this._$elContainer[0].classList.remove("is-on");this._bIsShown=false},isShown:function(){return this._bIsShown},openSubPanel:function(){this._$elContainer.addClass("is-active");this._isPanelOpened=true},closeSubPanel:function(){this._$elContainer.removeClass("is-active");this._hideStyleOption();this._hideColorOption();this._isPanelOpened=false},isSubPanelOpened:function(){return!!this._isPanelOpened},_loadRecentUsedColors:function(){var a=this._htOptions.group;var b=this._colorPickerRepository.fetchRecentUsed(a);var c=this._generateRecentUsedColorsHtmlString(b.slice().reverse());this._$recentUsedPallet[0].innerHTML=c;this._recentUsedColors=b},_generateRecentUsedColorsHtmlString:function(a){if(typeof a==="string"){a=[a]}return this._tplPalletCell({colorSets:a})},_addRecentUsedColor:function(a){if(this._isLatestRecentUsedColor(a)){return}this._removeSameColorOnRecentUsed(a);this._dropOldestRecentUsedColor();this._recentUsedColors.push(a);this._$recentUsedPallet.prepend(this._generateRecentUsedColorsHtmlString(a));this._colorPickerRepository.saveRecentUsed(this._htOptions.group,this._recentUsedColors)},_isLatestRecentUsedColor:function(a){var b=this._recentUsedColors;return b[b.length-1]===a},_removeSameColorOnRecentUsed:function(a){this._recentUsedColors=_.without(this._recentUsedColors,a);this._$recentUsedPallet.find("li").has('[data-value="'+a+'"]').remove()},_dropOldestRecentUsedColor:function(){if(this._recentUsedColors.length>=this._MAX_RECENT_COLOR){this._recentUsedColors.shift();this._$recentUsedPallet.find("li").last().remove()}}});$SE_BUTTON_FACTORY=se.defineStatic("se.CanvasToolbarButtonFactory",function(){var a=function(a,b){switch(a){case"select":return new se.CanvasToolbarSelectButtonView(b);case"toggle":return new se.CanvasToolbarToggleButtonView(b);case"groupToggle":return new se.CanvasToolbarGroupToggleButtonView(b);case"switch":return new se.CanvasToolbarSwitchButtonView(b);case"input":return new se.CanvasToolbarInputButtonView(b);case"colorPicker":return new se.CanvasToolbarColorPickerButtonView(b);case"action":return new se.CanvasToolbarActionButtonView(b);case"specialLetter":return new se.CanvasToolbarSpecialLetterButtonView(b);case"lineHeight":return new se.CanvasToolbarLineHeightButtonView(b);case"mediaResize":return new se.CanvasToolbarMediaResizeButtonView(b);case"tableWidth":return new se.CanvasToolbarTableWidthButtonView(b);case"borderStyle":return new se.CanvasToolbarBorderStyleButtonView(b)}};return{createButton:a}}());se.defineClass("se.CanvasToolbarButtonSetPolicy",{construct:function(a){this._displayConfig=JSON.parse(JSON.stringify(a.display))},getButtonSet:function(a){var b=this._decideButtonSet(a)||[];return this._preprocessEntryByType(a,b.slice(0))},_preprocessEntryByType:function(a,b){var c=a.getCompType();if(!c){return b}var d=$SE_STRING.capitalize(c);var e=this["_entryFor"+d];if(typeof e==="function"){return e.call(this,a,b)}return b},_decideButtonSet:function(a){var b=this._displayConfig[a.getCompType()]||{};var c=b.default;if(se.CanvasRectHelper.isMobileViewPort()){c=b.mobile}else if(se.CanvasRectHelper.isTabletViewPort()){c=b.tablet}return c||b.default},_useWrapParagraph:function(){return $SE_CONFIG.SERVICE_CONFIG.FEATURES.WRAP_PARAGRAPH===true},_entryForQuotation:function(a,b){if(this._addWrapAroundOnQuotation(a.getLayout())){b.splice(4,0,"wrapAroundWithClear")}return b},_addWrapAroundOnQuotation:function(a){return se.CanvasRectHelper.isDesktopViewPort()&&this._useWrapParagraph()},_entryForImage:function(a,b){if(a.isMoreThanMaxWidth()){b[_.indexOf(b,"imageAlign")]="imageDisplay"}if(a.getUploadedLocal()&&!a.getAnimationGIF()){b.splice(1,0,"imageEdit")}if(se.CanvasRectHelper.isDesktopViewPort()&&this._useWrapParagraph()){b.splice(2,0,"wrapAround")}if($SE_CONFIG.IMAGE.FORMAT.VR360_SUPPORT.indexOf(a.getDisplayFormat())>=0){b=_.without(b,"imageEdit","link","mediaResize","wrapAround")}if($SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG&&!a.getAnimationGIF()){var c=$SE_CONFIG.SERVICE_CONFIG.MEDIATAG_CONFIG.TOOLBAR_BUTTON_POSITION[a.getCompType()];b.splice(c,0,"mediaTag")}return b},_entryForVideo:function(a,b){return b},_entryForMap:function(a,b){if(!$SE_CONFIG.ENV_SETTING.IS_GP_SERVICE&&a.getLayout()===$SE_CONFIG.MAP.LAYOUT_TYPE.TEXT){b.push("componentAlign")}return b},_entryForTalktalk:function(a,b){var c=a.getLayout()==="custom"&&a.getImage()&&a.getImage().isMoreThanMaxWidth();if(c){return _.without(b,"componentAlign")}return b}});se.defineClass("se.BlogCanvasToolbarButtonSetPolicy",se.CanvasToolbarButtonSetPolicy,{construct:function(a){this._displayConfig=JSON.parse(JSON.stringify(a.display))},_entryForParagraph:function(a,b){if($SE_CONFIG.SERVICE_CONFIG.VIEW_WIDTH<=500){b[_.indexOf(b,"textAlign")]="textAlignGroup";delete b[_.indexOf(b,"superscript")];delete b[_.indexOf(b,"subscript")]}return b}});window.se.CanvasToolbarButtonSetPolicy=se.BlogCanvasToolbarButtonSetPolicy;se.defineComponent("se.CanvasCommonToolbar",{construct:function(a,b){if(typeof a==="string"){this._sType=a;this._htConfig=b||{}}else{this._htConfig=a}this._htButtons={};this._bShowToolTip=false;this._sMountedKey="";this._sNclickPrefix="";this._bIsStickied=false;this._fOnClickBtnListener=null;this._oActiveButton=null;this._render()},_attachEvents:function(){this._$elContainer.on("mousedown",function(a){return false})},_detachEvents:function(){this._$elContainer.off()},closeActiveButton:function(){if(this._oActiveButton&&this._oActiveButton.closeSubPanel){this._oActiveButton.closeSubPanel()}},hasSubPanel:function(a){var b=this._htButtons[a];return b&&!!b.openSubPanel},_isSubPanelOpened:function(a){var b=this._htButtons[a];return b&&b.isSubPanelOpened&&b.isSubPanelOpened()},_handleIECursor:function(a,b){if(this._sType!=="basic"||a==="mediaResize"){return}var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(c&&c.getCompType()===$SE_CONFIG.COMP_TYPE.TABLE){return}if(this._isSubPanelOpened(a)&&!b){this._hideIECursor()}else{this._showIECursor()}},_handleIECursorAfter:function(a,b){if(this._sType!=="basic"||a==="mediaResize"){return}var c=$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.FIND_ACTIVATED_COMPONENTS)[0];if(c&&c.getCompType()===$SE_CONFIG.COMP_TYPE.TABLE){return}if(this._isSubPanelOpened(a)&&b){this._hideIECursor()}},_showIECursor:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.SHOW_IECURSOR)},_hideIECursor:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.EDIT_AREA_WATCHER.HIDE_IECURSOR)},_resetActiveButton:function(a,b){var c=this._htButtons[a];if(this._oActiveButton&&c===this._oActiveButton){return}if(b===false){this.closeActiveButton();this._oActiveButton=this._htButtons[a]}},_applyFontFamilyToButton:function(a){["fontFamily","fontSize","fontSizeTitle"].forEach(this._updateFontFamily.bind(this,a))},changeFontFamily:function(a){["fontFamily","fontSize","fontSizeTitle","fontSizeParagraph"].forEach(this._updateFontFamily.bind(this,a))},_updateFontFamily:function(a,b){var c=this._htButtons[b];if(!c){return}c._$elContainer.attr("class",function(a,b){return b.replace(/(^|\s)se_ff_\S+/g,"")}).addClass("se_ff_"+a)},_processByGroup:function(a,b,c,d,e){var f=$(b.currentTarget);switch(c){case"fontFamily":if(e){this._applyFontFamilyToButton(d)}else{$SE_CONFIG.WEB_FONT.REGULAR_LOAD=true;this._loadWebFont(f.data("loadfont"),f)}break;case"bold":this._loadWebFontBold();break;case"blockquote":this._loadWebFontBold();break}},_loadWebFont:function(a,b){setTimeout(function(){if(!a||a!=="load"){var c=b.parent().find(".__se_tooltip_btn");for(var d=0;d<c.length;d++){$(c.get(d)).addClass("se_ff_"+$(c.get(d)).data("value"))}}}.bind(this),100)},_loadWebFontBold:function(){setTimeout(function(){if(!$SE_CONFIG.WEB_FONT.BOLD_LOAD){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.WEB_FONT_BOLD_LOADING);$SE_CONFIG.WEB_FONT.BOLD_LOAD=true}}.bind(this),100)},_callNclick:function(a){var b=a.getAttribute("data-nclick");if(b==null){return}clickcr(this,this._makeNClickCode(b),"")},_makeNClickCode:function(a){if(a.indexOf(".")===-1){return this._sNclickPrefix+"."+a}return a},_onClickButtons:function(a,b,c,d,e){a.preventDefault();a.stopPropagation();this._callNclick(a.target);var f=this._htConfig[b].type;var g=Array.prototype.slice.call(arguments);g.push(f);this._handleIECursor(b,d);this._resetActiveButton(e||b,d);this._processByGroup(f,a,b,c,d);if(this._fOnClickBtnListener){this._callClickBtnListener(b,g)}this._handleIECursorAfter(b,d)},_callClickBtnListener:function(a,b){if(a==="delete"){setTimeout(function(){this._fOnClickBtnListener.apply(this,b)}.bind(this),1)}else{this._fOnClickBtnListener.apply(this,b)}},_createButtons:function(){var a=this._htConfig;var b={};var c=this._onClickButtons.bind(this);if(!a){return}Object.keys(a).forEach(function(d){var e=a[d];var f=e.type;e.onClick=c;e.key=d;var g=$SE_BUTTON_FACTORY.createButton(f,e);g.mountTo(this._$elBtnContainer);b[d]=g}.bind(this));return b},_render:function(){var a=se.editor.template.common["common-toolbar.hbs"];this._$elContainer=$(a({loadFont:$SE_CONFIG.WEB_FONT.REGULAR_LOAD}));this._$elBtnContainer=this._$elContainer.find(".__se_btn_container");this._elFragmentDocument=document.createDocumentFragment();this._attachEvents();this._htButtons=this._createButtons()},appendTo:function(a){if(!a){return}if(!a.jquery){a=$(a)}if(a.has(this._$elContainer).length===0){a.prepend(this._$elContainer)}a=null},setNclickPrefix:function(a){if(a===undefined){return}this._sNclickPrefix=a},_setMountKey:function(a){this._sMountedKey=a.key},mountTo:function(a){clearTimeout(this._timeoutForEnableSticky);this._setMountKey(a);this.setNclickPrefix(a.nclickPrefix);this.appendTo(a.target);this._timeoutForEnableSticky=setTimeout(this.enableStickyToolbar.bind(this),50)},_detachColorPicker:function(){var a=this._htButtons;var b=this._htConfig;Object.keys(a).forEach(function(c){if(b[c].type==="colorPicker"){a[c].dettachPallet()}})},unmount:function(a){if(this._sMountedKey===a){this._elFragmentDocument.appendChild(this._$elContainer.get(0));this._detachColorPicker();this.closeActiveButton()}},setBtnClickEventListener:function(a){this._fOnClickBtnListener=a},_hideAllButtons:function(){var a=this._htButtons;Object.keys(a).forEach(function(b){a[b].hide()})},_showButtons:function(a){if(!a){return}var b=this._htButtons;a.forEach(function(a){b[a].show();this._showToolTip(a)}.bind(this))},_showToolTip:function(a){var b=this._htConfig[a];var c=$SE_CONFIG.SERVICE_CONFIG.USE_TOOLTIP&&b.toolTip&&$SE_COMMON_UTIL.getCookie($SE_CONFIG.COOKIE_NAMES.PHOTO_EDITOR)!=="T"&&!this._bShowToolTip;if(!c){return}setTimeout(function(){var b=this._createToolTip(a);b.ntooltip("openTooltip")}.bind(this),100);this._bShowToolTip=true},_createToolTip:function(a){var b=this._htConfig[a];var c=".__"+b.className;var d=$(c);var e=d.ntooltip({top:-120,left:-45,type:"custom",pointerType:"down",message:b.toolTip,appendTarget:this._$elContainer});return e},changeActiveBtns:function(a){this._hideAllButtons();this._showButtons(a)},disableButton:function(a){var b=this._htButtons;_.forEach(a,function(a){if(b[a]){b[a].disable()}})},enableButton:function(a){var b=this._htButtons;_.forEach(a,function(a){if(b[a]){b[a].enable()}})},changeBtnValue:function(a){var b=this._htButtons;var c=null;Object.keys(a).forEach(function(d){c=a[d];if(b[d]){b[d].changeValue(c)}});if(a.fontFamily){this._applyFontFamilyToButton(a.fontFamily)}},_initStickyToolbar:function(){if(this._sType==="basic"){this._$elContainer.addClass("fixedsticky").NStickToolbar({top:"0px",startTop:$SE_SCROLL_HELPER.getSizeStore().gnbHeight*-1+20+"px"});this._bIsStickied=true}},stripStickyToolbar:function(){if(this._sType==="basic"){this._$elContainer.removeClass("fixedsticky").NStickToolbar("destroy")}},disableStickyToolbar:function(){this._$elContainer.NStickToolbar("disable")},_resetStickToolbar:function(){if(this._sType==="basic"){this._$elContainer.NStickToolbar("reset",{top:"0px",startTop:$SE_SCROLL_HELPER.getSizeStore().gnbHeight*-1+"px"})}},enableStickyToolbar:function(){if(this._sType!=="basic"||!this._$elContainer){return}if(this._bIsStickied){this._resetStickToolbar()}else{this._initStickyToolbar()}},getButton:function(a){return this._htButtons[a]},closeAllLayer:function(){var a=this._htButtons;Object.keys(a).forEach(function(b){var c=a[b];if(c.closeSubPanel){c.closeSubPanel()}});this._oActiveButton=null},switchWrappingMode:function(){var a=this._$elContainer.get(0);var b=a.getElementsByClassName("se_toolbar")[0];b.classList.add("se_subToolbar")},switchNormalMode:function(){var a=this._$elContainer.get(0);var b=a.getElementsByClassName("se_toolbar")[0];b.classList.remove("se_subToolbar")},destroy:function(){clearTimeout(this._timeoutForEnableSticky);this._bIsStickied=null;this._htButtons=null;this._$elContainer.remove();this._elFragmentDocument=null;this._$elContainer=null;this._$elBtnContainer=null;this._oActiveButton=null}});
//# sourceMappingURL=blog_desktop_normal_editor_canvas_pre_res.min.js.map