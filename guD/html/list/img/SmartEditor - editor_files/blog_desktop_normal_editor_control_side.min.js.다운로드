/*! SmartEditor3 - v1.0.0 - 2018-05-10
* Copyright (c) 2018 NAVER Corp; Licensed  */

se.defineComponent("se.ItemDnD",{construct:function(a,b){var c={sDragItemClass:"",fCallback:function(){},nDragDelay:100,oDragAreaOffset:{top:0,left:0,right:0,bottom:0}};var d=$.extend(true,c,b);this._initVar(d);this._wrapperElements(a)},_initVar:function(a){this._isCardDoc=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._bMakeDrag=false;this._bIsInsertGuideShown=false;this._sDragClass=a.sDragItemClass;this._fDropCallback=a.fCallback;this._nDragDelay=a.nDragDelay;this._nSideBarWidth=$("#se_side_bar").width();this._nTopMenuHeight=$("#se_top_menu_area").height();this._nCanvasOffsetLeft=null;this._oDragAreaOffset=a.oDragAreaOffset},_wrapperElements:function(a){this._$elArea=$(a);this._assignCanvasFrame();this._$elCanvasDocument=null;this._$elBodyWrapper=$(document.body);this._aDragList=null},_assignCanvasFrame:function(){if(this._isCardDoc){this._$elCanvasFrame=$("div.editor-content")}else{this._$elCanvasFrame=$("#"+$SE_CONFIG.ENV_SETTING.CANVAS_FRAME_ID)}},_bindDragEvents:function(){this._$elBodyWrapper.on("mouseleave.itemDnD",this._onMouseLeaveWhileDragging.bind(this)).on("mouseenter.itemDnD",this._onMouseEnterWhileDragging.bind(this))},_unbindDragEvents:function(){this._$elBodyWrapper.off("mouseleave.itemDnD").off("mouseenter.itemDnD")},_onMouseUpOutsideWhileDragging:function(){this._$elFrameOverlay.remove()},_onMouseLeaveWhileDragging:function(){$(document).on("mouseup.itemDnD",this._onMouseUpOutsideWhileDragging.bind(this))},_onMouseEnterWhileDragging:function(){$(document).off("mouseup.itemDnD")},attachDrag:function(){if(this._isCardDoc){this._assignCanvasFrame()}this._aDragList=this._$elArea.find(this._sDragClass);this._aDragList.draggable({containment:"window",iframeFix:true,revert:true,cancel:false,revertDuration:0,scroll:true,helper:function(a){var b=$(a.currentTarget);var c=b.clone();c.removeClass("is-filled");c.find(".btn_del_lib").remove();c.css("position","fixed");return c},start:this._onStartDragComponent.bind(this),drag:this._onDragComponent.bind(this),stop:this._onStopDragComponent.bind(this),delay:this._nDragDelay});this._bMakeDrag=true},_getCanvasDocument:function(){if(!this._$elCanvasDocument){this._$elCanvasDocument=this._$elCanvasFrame.contents()}return this._$elCanvasDocument},_moveCanvasScrollByItem:function(a,b){var c=this._getCanvasDocument();switch(this._computeOverPosition(a.pageY)){case"top":this._nRepeatMoveScroll=setInterval(function(){c.scrollTop(c.scrollTop()-20);this._triggerDragEvent(a,b)}.bind(this),50);break;case"bottom":this._nRepeatMoveScroll=setInterval(function(){c.scrollTop(c.scrollTop()+20);this._triggerDragEvent(a,b)}.bind(this),50)}},_onStartDragComponent:function(a,b){this.trigger("addLibraryInfoOnDrag",{target:$(a.currentTarget)});this._bindDragEvents();b.helper.addClass("is-dragging __se_drag_item");this._adjustHelperAtCursor(b.helper,a);this._nCanvasOffsetLeft=this._$elCanvasFrame.offset().left;this._$elFrameOverlay=$("<div class='frameOverlay' style='position: absolute; top: 0; z-index: 90; left: 0; height: 100%; width: 100%; background-color:rgba(0,0,0,0);'></div>");$(document.body).append(this._$elFrameOverlay);this._cacheCurrentOffsets()},_adjustHelperAtCursor:function(a,b){var c=b.clientX;var d=b.clientY;var e=$(a.context);var f=e.offset();var g=parseInt(e.width())/2;var h=parseInt(e.height())/2;var i=f.left+g;var j=f.top+h;var k=g/2;var l=h/2;var m=i-c;var n=j-d;var o=m<k&&m>-k;var p=n<l&&n>-l;if(!o){var q=i>c?-k:g;$(a).css("margin-left",q)}if(!p){var r=j>d?-l:h;$(a).css("margin-top",r)}},_triggerDragEvent:function(a,b){this._bIsInsertGuideShown=true;this.trigger("onDragCanvasComponent",{oUI:b,left:a.pageX-this._nCanvasOffsetLeft,top:a.pageY+this._getCanvasDocument().scrollTop()-this._nTopMenuHeight,height:b.helper.height()})},_triggerStopDragComponent:function(){this._bIsInsertGuideShown=false;this.trigger("onStopDragComponent")},_computeOverPosition:function(a){var b=60;var c=$SE_SIZE_STORE.getCanvasRect();if(c.top>a-b){return"top"}if(c.bottom<a+b){return"bottom"}},_onDragComponent:function(a,b){clearInterval(this._nRepeatMoveScroll);if(this.isOverlapCanvas(a.pageX,a.pageY)){this._moveCanvasScrollByItem(a,b);this._triggerDragEvent(a,b)}else{if(this._bIsInsertGuideShown){this._triggerStopDragComponent()}}},_onStopDragComponent:function(a,b){this.trigger("removeLibraryInfoAfterDrag",{target:$(a.target)});this._unbindDragEvents();this._$elFrameOverlay.remove();clearInterval(this._nRepeatMoveScroll);if(this.isOverlapCanvas(a.pageX,a.pageY)===false){this._triggerStopDragComponent();return}this._bIsInsertGuideShown=false;this._fDropCallback.call(this,b.helper);this._resetCurrentOffsetsCache()},_resetCurrentOffsetsCache:function(){this.trigger("resetCurrentOffsetsCache")},_cacheCurrentOffsets:function(){this.trigger("cacheCurrentOffsets")},isOverlapCanvas:function(a,b){var c=this._getDraggableArea();if(b>=c.top&&b<=c.bottom&&(a>=c.left&&a<=c.right)){return true}return false},_getDraggableArea:function(){var a=$SE_SIZE_STORE.getCanvasRect();return{top:a.top+this._oDragAreaOffset.top,left:a.left+this._oDragAreaOffset.left,right:a.right-this._oDragAreaOffset.right,bottom:a.bottom-this._oDragAreaOffset.bottom}},activate:function(){if(this._bMakeDrag){this._aDragList.each(function(a,b){if(b.classList.contains("ui-draggable")){$(b).draggable("enable")}})}},deactivate:function(){if(this._bMakeDrag){this._aDragList.each(function(a,b){if(b.classList.contains("ui-draggable")){$(b).draggable("disable")}})}},briefPauseDrag:function(){this.deactivate();setTimeout(function(){this.activate()}.bind(this),50)}});se.defineComponent("se.CompPanel",{construct:function(){this._initVar();this._wrapperElements();this._createComponents();this._createComponentList();this._bindEvent()},_initVar:function(){this._bNonBlockEvent=false;this._bIsClickActive=false;this._bIsActive=false;this._$elContainer=null;this._$elCanvasFrame=null;this._$elPanelContents=null;this._oTemplate=se.editor.template.control["compPanelList.hbs"];this._oDragHandler=null;this._htNClickCode={post:{},blog:{}};this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SCHEDULE]="sdb*c.schedule";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.PARAGRAPH]="sdb*c.text";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.IMAGE]="sdb*c.photo";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.VIDEO]="sdb*c.movie";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MAP]="sdb*c.map";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.AUDIO]="sdb*c.audio";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MATERIAL]="sdb*c.material";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.STICKER]="sdb*c.sticker";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.QUOTATION]="sdb*c.quotation";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.HORIZONTAL_LINE]="sdb*c.division";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.OGLINK]="sdb*c.oglink";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CODE]="sdb*c.code";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS]="sdb*c.sns";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SEARCH_IMAGE]="sdb*c.photosearch";this._htNClickCode.post[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.TABLE]="sdb*c.table";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SCHEDULE]="sdb*c.schedule";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.PARAGRAPH]="sdb*c.text";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.IMAGE]="sdb*c.photo";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.VIDEO]="sdb*c.movie";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MAP]="sdb*c.map";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.FILE]="sdb*c.file";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MATERIAL]="sdb*c.material";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.STICKER]="sdb*c.sticker";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.QUOTATION]="sdb*c.quotation";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.HORIZONTAL_LINE]="sdb*c.division";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.OGLINK]="sdb*c.oglink";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.TALKTALK]="sdb*c.talk";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CODE]="sdb*c.code";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS]="sdb*c.sns";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SEARCH_IMAGE]="sdb*c.photosearch";this._htNClickCode.blog[$SE_CONFIG.COMP_INSERT_ITEM_TYPE.TABLE]="sdb*c.table";this._htNClickCode.demo=this._htNClickCode.post;this._htLayer={}},_wrapperElements:function(){this._$elContainer=$("#se_side_comp_panel");this._$elPanelContents=this._$elContainer.find(".__se_side_panel_cont");this._$elCompListArea=$("#se_side_comp_list");this._$elCanvasFrame=$("#se_canvas_frame")},_createComponents:function(){this._oDragHandler=new se.ItemDnD(this._$elCompListArea,{sDragItemClass:".se_componentList",fCallback:this._dropComp.bind(this)});this._oDragHandler.on("onDragCanvasComponent",function(a){this.trigger("onDragComponentToInsert",a)}.bind(this));this._oDragHandler.on("onStopDragComponent",function(a){this.trigger("onStopDragComponentToInsert",a)}.bind(this));this._oDragHandler.on("resetCurrentOffsetsCache",function(a){this.trigger("resetCurrentOffsetsCache",a)}.bind(this));this._oDragHandler.on("cacheCurrentOffsets",function(a){this.trigger("cacheCurrentOffsets",a)}.bind(this))},_createComponentList:function(){var a=$SE_MODEL_DATA_COORD.getInsertCompItemList();this._$elCompListArea.get(0).innerHTML=this._oTemplate({list:a});var b=a.some(function(a){return a.itemType===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.TALKTALK});if(b){this._checkTalktalkProfiles()}this._oDragHandler.attachDrag()},_checkTalktalkProfiles:function(){var a=$SE_CONFIG.USER_INFO.TALKTALK_PROFILES;if(a&&a.length>0){var b=this._getCompLayer("talktalk");b.setAccountList(a)}else{this._removeTalktalkBtn()}},_removeTalktalkBtn:function(){this._$elCompListArea.find("li:has([data-itemtype='talktalk'])").remove()},_dropComp:function(a){var b=a.find("[data-itemtype]").data("itemtype");var c={insertType:$SE_CONFIG.INSERT_TYPE.INSERT_GUIDE,compData:b,shouldFocus:true,insertPos:$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.PULL_INSERT_GUIDE_TARGET)};if(b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.AUDIO){this._insertComponentWithFileDialogue(c)}else if(b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.IMAGE){this._insertComponentListWithFileDialogue(c)}else if(b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.FILE){this._openUploadFileModal(c)}else if(b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.VIDEO||b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MAP){this._insertComponentWithPopup(c)}else if(b===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.OGLINK){this._popupLayer(c)}else if(this._hasComponentInsertLayer(b)){this._insertComponentWithlLayer(c)}else{this._insertComponentToInsertPlace(c)}},isOverlapCanvas:function(a){var b=$(document.elementFromPoint(a.left,a.top)),c=this._$elCanvasFrame[0];if(b[0]===c){return true}return b.prev()[0]===c},_bindEvent:function(){this._$elContainer.on("click",this._onClickPanelContents.bind(this));this._$elContainer.find(".__se_side_panel_toggle_btn").on("click",function(a){clickcr(a.target,"sdb.component","","",a);if(this._bIsActive){this.deactivate()}else{this.activate()}}.bind(this));$(".__se_open_searchImageLayer_subBtn").on("click",function(){this._insertComponentWithlLayer({compData:"searchImage",shouldFocus:true})}.bind(this))},_bindPanelEvent:function(){var a=this._onClickPanelItem.bind(this);this._$elCompListArea.on("click",".__se_comp_btn",a);this._oDragHandler.activate();setTimeout(function(){this._bNonBlockEvent=false}.bind(this),50)},_onClickPanelItem:function(a){var b=$(a.target);while(!b[0].classList.contains("__se_comp_btn")){b=b.parent()}var c=b.data("itemtype");var d=this._htNClickCode[$SE_CONFIG.ENV_SETTING.SERVICE_NAME];if(d&&d[c]){clickcr(a.target,d[c],"","")}var e={compData:c,shouldFocus:true};if(c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MAP||c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.VIDEO){this._insertComponentWithPopup(e)}else if(c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.OGLINK){this._bNonBlockEvent=true;this._popupLayer(e)}else if(c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.AUDIO){this._insertComponentWithFileDialogue(e)}else if(c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.IMAGE){this._insertComponentListWithFileDialogue(e)}else if(c===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.FILE){this._bNonBlockEvent=true;this._openUploadFileModal(e)}else if(this._hasComponentInsertLayer(c)){this._bNonBlockEvent=true;this._insertComponentWithlLayer(e)}else{this._insertComponent(e)}this._oDragHandler.briefPauseDrag()},_hasComponentInsertLayer:function(a){return a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.MATERIAL||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.STICKER||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.TALKTALK||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SCHEDULE||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.SEARCH_IMAGE||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.STOREFARMIMAGE||a===$SE_CONFIG.COMP_INSERT_ITEM_TYPE.CONVERT_HTML},_unbindPanelEvent:function(){this._$elCompListArea.off("click");this._oDragHandler.deactivate()},_onClickPanelContents:function(){if(!this._bNonBlockEvent){$(document.body).trigger("click.bodyclick")}return false},_insertComponent:function(a){if(!a.compData){return}this.trigger("onInsertComponent",a)},_insertComponentToInsertPlace:function(a){if(!a.compData){return}this.trigger("onInsertComponent",a)},_insertComponentWithFileDialogue:function(a){if(!a.compData){return}this.trigger("onInsertComponentWithFileDialogue",a)},_insertComponentListWithFileDialogue:function(a){if(!a.compData){return}this.trigger("onInsertComponentListWithFileDialogue",a)},_insertComponentWithPopup:function(a){window.focus();if(!a.compData){return}var b=a.compData;if(b==="image"||b==="video"||b==="map"){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.FILE_DIALOG.INSERT_COMPONENT_WITH_POPUP,a)}},_popupLayer:function(a){this.trigger("onPopupLayer",a)},_openUploadFileModal:function(a){var b=new se.FileModalLayer({fInsertFileDialogueComponent:$.proxy(function(){this._insertComponentWithFileDialogue(a)},this),fInsertComponent:$.proxy(function(b){a.compData=b;this._insertComponent(a)},this)})},openCompLayer:function(a,b){this._insertComponentWithlLayer(a,b)},_insertComponentWithlLayer:function(a,b){var c=this._getCompLayer(a.compData,b);c.activate(a,b)},_getCompLayer:function(a){if(typeof a==="object"){a=a["@ctype"]}var b=this._htLayer[a];if(!b){var c=$SE_STRING.capitalize(a)+"Layer";b=new se[c];b.on("onAddComponent",function(a){this.trigger("onInsertComponentWithLayer",a)}.bind(this));this._htLayer[a]=b}return b},_updatePanelWrapperMaxHeight:function(){setTimeout(function(){this._$elPanelContents.css("maxHeight");var a=this._$elCompListArea.innerHeight();var b=""+a+"px";this._$elPanelContents.css({maxHeight:b,overflow:"visible"})}.bind(this),0)},activate:function(){this._bIsActive=true;this._bindPanelEvent();this._$elContainer.addClass("is-active");this._$elPanelContents.show();this._updatePanelWrapperMaxHeight()},deactivate:function(){this._bIsActive=false;this._unbindPanelEvent();this._$elContainer.removeClass("is-active");this._$elPanelContents.css({maxHeight:"0px",overflow:"hidden"})},destroy:function(){}});se.defineComponent("se.LibraryPanel",{construct:function(){this._initVar();this._createModule();this._bindModuleEvent()},_initVar:function(){this._isCardDoc=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._oLibraryData=null;this._oLibraryView=null},_bindModuleEvent:function(){this._oLibraryData.on("toggleDimmedPanel",function(a){this._oLibraryView.toggleDimmedPanel(a.sLibraryId)}.bind(this));this._oLibraryData.on("deleteLibrariesWithComp",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.DELETE_LIBRARIES_WITH_COMP,a.aCompId)}.bind(this));this._oLibraryData.on("resetAllMedia",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.RESET_ALL_MEDIA,a.ahtTargets)}.bind(this));this._oLibraryView.on("clearLibraryMap",function(a){this._oLibraryData.clearLibraryMap()}.bind(this));this._oLibraryView.on("deleteLibraryFromMapById",function(a){this._oLibraryData.deleteLibraryFromMapById(a.sLibraryId)}.bind(this));this._oLibraryView.on("deleteLinkedComponents",function(a){this._oLibraryData.deleteLinkedComponents(a.sLibraryId)}.bind(this));this._oLibraryView.on("downsizeLibraryIds",function(a){this._oLibraryData.downsizeLibraryIds(a.aLibraryId)}.bind(this));this._oLibraryView.on("removeComponentByIds",function(a){this._oLibraryData.removeComponentByIds(a.aCompId)}.bind(this));this._oLibraryView.on("removeRepresentFromModelJsonById",function(a){this._oLibraryData.removeRepresentFromModelJsonById(a.sLibraryId)}.bind(this));this._oLibraryView.on("downsizeLibraryComponentMap",function(a){this._oLibraryData.downsizeLibraryComponentMap(a.sLibraryId,a.aCompId)}.bind(this));this._oLibraryView.on("onInsertComponent",function(a){this.trigger("onInsertComponent",a)}.bind(this));this._oLibraryView.on("onDragComponentToInsert",function(a){this.trigger("onDragComponentToInsert",a)}.bind(this));this._oLibraryView.on("onStopDragComponentToInsert",function(a){this.trigger("onStopDragComponentToInsert",a)}.bind(this));this._oLibraryView.on("onUpdateRepresentativeImage",function(a){this.trigger("onUpdateRepresentativeImage",a)}.bind(this));this._oLibraryView.on("updateRepresentativeInModelJson",function(a){this._oLibraryData.updateRepresentativeInModelJson(a.sLibraryId,a.isToSet)}.bind(this));this._oLibraryView.on("resetCurrentOffsetsCache",function(a){this.trigger("resetCurrentOffsetsCache")}.bind(this));this._oLibraryView.on("cacheCurrentOffsets",function(a){this.trigger("cacheCurrentOffsets")}.bind(this))},_createModule:function(){this._oLibraryData=new se.LibraryItemData;this._oLibraryView=new se.LibraryItemView(this._oLibraryData)},isOverlapCanvas:function(a,b){return this._oLibraryView.isOverlapCanvas(a,b)},addLibraryData:function(a,b){if(this._isLibraryLocked()){return}if(!$.isArray(a)){a=[a]}this._oLibraryView.saveCurrentRImageIdOnAdd(a);b=b||{};var c=this._oLibraryView.removeChangedMediaOnAdd(a,b);var d=this._oLibraryView.addLibraryData(a,b);var e=c?c:d;this._updateLibraryPanel(e)},downsizeLibraryByCardId:function(a){this._oLibraryData.downsizeLibraryByCardId(a)},updateLibraryModel:function(a){this._oLibraryData.updateLibraryModel(a)},clearLibrary:function(){this._oLibraryView.clearLibrary()},clearLibraryCompData:function(a){this._oLibraryData.clearLibraryCompData(a);this._updateLibraryPanel()},_updateLibraryPanel:function(a){this._oLibraryView.updateLibraryPanel(a)},getLibraryMap:function(){return this._oLibraryData.getLibraryMap()},getLibraryIds:function(){return this._oLibraryData.getLibraryIds()},removeLibraryData:function(a,b){if(this._isLibraryLocked()){return}if(this._isCardDoc){this._oLibraryView.removeLibraryData(a,b)}else{this._oLibraryData.removeCompInLibraryByModelJson(a,b)}this._updateLibraryPanel()},getAttachFromLibrary:function(){return this._oLibraryData.getAttachFromLibrary(this._oLibraryView.getCurrentRepresentative())},setAttachToLibrary:function(a,b){var c=this.convertAttachToModelJson(a);if(c.length>0){this.addLibraryData(c,{bReset:b})}},convertAttachToModelJson:function(a){return this._oLibraryData.convertAttachToModelJson(a)},onRemoveComponent:function(a){if(this._isLibraryLocked()){return}this._oLibraryView.onRemoveComponent(a)},reset:function(){this._oLibraryView.reset()},activate:function(){this._oLibraryView.activate()},deactivate:function(){this._oLibraryView.deactivate()},destroy:function(){},_isLibraryLocked:function(){return this._oLibraryView.isLibraryLocked()},disableChangeLibrary:function(){this._oLibraryView.disableChangeLibrary()},enableChangeLibrary:function(){this._oLibraryView.enableChangeLibrary()}});se.defineComponent("se.LibraryItemData",{construct:function(){this._initVar()},_initVar:function(){this._isCardDoc=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._bIsActive=false;this._bKeepLibrary=false;this._aChangedLibraryId=null;this._aLibraryIdNeedPanelUpdate=[];this._htLibraryIdAsIs=null;this._rxCardId=null;this._rxEmptyCardId=null;this._rxVR360Path=/\/PM-1.P-eq\//;this._rxParanomaPath=/\/PM-1.P-pa\//;this._rxVR360TypeQueryString=/\?type\=.+$/;this._$elListContainer=null;this._htLibraryMap={};this._aLibraryId=[];this._htCompIdModelJson={};this._KEY_MAP={};this._KEY_MAP[$SE_CONFIG.COMP_TYPE.IMAGE]="src";this._KEY_MAP[$SE_CONFIG.COMP_TYPE.VIDEO]="vid";this._KEY_MAP[$SE_CONFIG.COMP_TYPE.AUDIO]="audioId";this._KEY_MAP[$SE_CONFIG.COMP_TYPE.MAP]="placeId";this._KEY_MAP[$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE]="compId"},addLibraryModel:function(a){if(!a){return}var b=[],c=[];if($.isArray(a)){b=a}else{b.push(a)}b.forEach(function(a){var b=this._registerModel(a);if(!b){return}var d=b.sLibraryId;if(!d){return}this._addLibraryIdNeedPanelUpdate(d);if(!b.isRegistered){c.push(d)}},this);return c},updateLibraryModel:function(a){a.forEach(function(a){this._registerModel(a,true)},this)},_registerModel:function(a,b){a=_.extend({},a);delete a.componentStyle;delete a.displayFormat;delete a.link;if(!this._isValidToRegister(a,b)){return null}return this._registerLibrary(a)},clearLibraryCompData:function(a){a=a||{};var b=a.bDim;var c;for(c in this._htLibraryMap){if(!this._htLibraryMap.hasOwnProperty(c)){continue}this._setCompIdsToLibrary(c,[]);if(b){this._addLibraryIdNeedPanelUpdate(c)}}},clearLibraryMap:function(){this._htLibraryMap={}},_isValidToRegister:function(a){return this._isValidComponent(a)&&this._hasLibraryId(a)},_isValidComponent:function(a){if(this._isUploadedLocalPassedComponent(a)){return true}var b=$SE_CONFIG.COMP_TYPE;var c=a["@ctype"];if(c===b.MAP){return true}return false},_isUploadedLocalPassedComponent:function(a){var b=a["@ctype"];var c=$SE_CONFIG.COMP_TYPE;var d=[c.IMAGE,c.VIDEO,c.AUDIO,c.FILE];return d.indexOf(b)>-1&&a.uploadedLocal===true},_hasLibraryId:function(a){return!!this.getLibraryIdFromModelJson(a)},_isLibraryRegistered:function(a){return this.getLibraryById(a)?true:false},unlinkAndGetLibraryIdToBeRemoved:function(a){this._aChangedLibraryId=[];this._htLibraryIdAsIs={};this._unlinkComponentOnAdd(a);return this._getLibraryIdsToBeRemovedOnAdd()},_unlinkComponentOnAdd:function(a){var b,c,d,e;a.forEach(function(a){b=a.compId;c=this.getLibraryIdFromModelJson(a);d=this.getLibraryIdFromLatestMap(b);e=d&&c!==d;if(e){this.unlinkComponentLibrary([b],c);this._aChangedLibraryId.push(c);this._htLibraryIdAsIs[c]=d}}.bind(this))},_getLibraryIdsToBeRemovedOnAdd:function(){var a=$.unique(this._aChangedLibraryId);var b=[];a.forEach(function(a){var c=this._htLibraryIdAsIs[a];var d=this.getLinkedCompIdsById(c);if(!d||d.length===0){b.push(c)}}.bind(this));return b},_registerLibrary:function(a){var b=a.compId;var c=this.getLibraryIdFromModelJson(a);var d=this._isLibraryRegistered(c);var e,f;if(d){e=this._htLibraryMap[c].oModel;f=e.represent;if(f){a.represent=true}this._htLibraryMap[c].oModel=$.extend(true,e,a);if(b&&this._htLibraryMap[c].aComp.indexOf(b)===-1){this._setCompIdsToLibrary(c,b,true)}}else{a.attachId=a.attachId||this._getUniqueAttachId();a.libId=c;a.isVR360=this._isVR360ModelJson(a);var g={oModel:a,sAttachId:a.attachId,aComp:[b]};this._htLibraryMap[c]=g;this._aLibraryId.push(c)}this._htCompIdModelJson[b]=a;return{sLibraryId:c,isRegistered:d}},_setCompIdsToLibrary:function(a,b,c){if(c){this._htLibraryMap[a].aComp.push(b)}else{if(typeof b==="string"){b=[b]}var d=this._htLibraryMap[a].aComp;var e=d.filter(this._getRemoveIdFilterFn(b));var f,g;for(f=e.length;f--;){g=e[f];delete this._htCompIdModelJson[g]}this._htLibraryMap[a].aComp=b;this._addLibraryIdNeedPanelUpdate(a)}},getLibraryMap:function(){return this._htLibraryMap},getLibraryIds:function(){return this._aLibraryId},downsizeLibraryIds:function(a){this._aLibraryId=this._aLibraryId.filter(this._getRemoveIdFilterFn(a))},removeCompInLibraryByModelJson:function(a,b){var c=[],d=[],e="";if(b){for(e in this._htLibraryMap){this.deleteLibraryFromMapById(e)}}if($.isArray(a)){c=a}else{c.push(a)}for(var f in c){d.push(c[f].compId)}var g=this.getLibraryIdsFromModelJsons(c);g.forEach(function(a){this.downsizeLibraryComponentMap(a,d)}.bind(this))},_addLibraryIdNeedPanelUpdate:function(a){this._aLibraryIdNeedPanelUpdate.push(a)},getLibraryIdsNeedPanelUpdate:function(){this._aLibraryIdNeedPanelUpdate=$.unique(this._aLibraryIdNeedPanelUpdate);return this._aLibraryIdNeedPanelUpdate},clearLibraryIdsNeedPanelUpdate:function(){this._aLibraryIdNeedPanelUpdate=[]},deleteLinkedComponents:function(a){var b=this.getLinkedCompIdsById(a)||[];if(b&&b.length>0){this._deleteComponentsByIds(b)}this.deleteLibraryFromMapById(a)},updateRepresentativeInModelJson:function(a,b){var c=this._htLibraryMap[a];var d;if(c){d=c.oModel}if(d){d.represent=b}},deleteLibraryFromMapById:function(a){delete this._htLibraryMap[a]},getLibraryIdFromModelJson:function(a){var b;var c=this._getMediaKeyFromModelJson(a);if(!c){return}b=a[c];if(this._isVR360ModelJson(a)){b=b.replace(this._rxVR360TypeQueryString,"");if($SE_CONFIG.ENV_SETTING.THUMBNAIL_TYPE){b+="?type="+$SE_CONFIG.ENV_SETTING.THUMBNAIL_TYPE}}return b},getLibraryIdsFromModelJsons:function(a){var b=$.unique(a.map(function(a){return this.getLibraryIdFromModelJson(a)}.bind(this)));return b},_getMediaKeyFromModelJson:function(a){var b=this._KEY_MAP[a["@ctype"]];return b},getLibraryById:function(a){var b=this._htLibraryMap[a];return b},getModelJsonById:function(a){var b=this.getLibraryById(a);var c=b?b.oModel:null;return c},getUpdateReqData:function(a,b){var c=null;if(b){var d,e,f;d=this.getModelJsonById(a);e=d["@ctype"];if(e===$SE_CONFIG.COMP_TYPE.IMAGE){f=d.src}else if(e===$SE_CONFIG.COMP_TYPE.VIDEO){f=d.thumbnail.src}else if(e===$SE_CONFIG.COMP_TYPE.DOCUMENT_TITLE){f=d.background.image.src}c={"@ctype":"representativeImage",type:d["@ctype"],libraryId:a,thumbnail:{"@ctype":"simpleThumbnail",src:f}}}var g=this.getLinkedCompIdsById(a);if(!g||g.length===0){return}var h={htData:c,aCompId:g};return h},getRearrangedLibraryId:function(a,b){b=b||{};var c=b.bPrepend;var d=this._aLibraryId.slice();if(!a){return d}var e,f,g;e=0;f=d.length;for(;e<f;e++){g=d[0];d.push(d.shift());if(g===a){d.pop();break}}if(c){d.unshift(a)}return d},_getUniqueAttachId:function(){return $SE_CONFIG.LIBRARY.ATTACH_ID_PREFIX+(new Date).getTime()+(Math.random()*1e5).toFixed()},getAttachFromLibrary:function(a){var b=[];var c,d,e,f,g;for(c in this._htLibraryMap){if(!this._htLibraryMap.hasOwnProperty(c)){continue}d=this.getLibraryById(c);e=d.aComp;if(!e||e.length===0){continue}f=d.oModel;delete f.componentStyle;g={id:d.sAttachId,component:f};if(a&&a.data("libid")===c){g.represent=true}b.push(g)}return b},_isVR360ModelJson:function(a){var b=a.src;return!!b&&this._rxVR360Path.test(b)||!!b&&this._rxParanomaPath.test(b)},convertAttachToModelJson:function(a){var b;var c;var d=[];if(a){a.forEach(function(a){b=a.component;b.attachId=a.attachId;d.push(b)})}return d},_getRemoveIdFilterFn:function(a){return function(b){if(typeof a==="string"){return b!==a}else if(Array.isArray(a)){return a.indexOf(b)===-1}}},_deleteComponentsByIds:function(a){if(this._isCardDoc){var b;var c=a.map(function(a){b=a.split("|");return{cardId:b[0],compKey:b[1]}});this.trigger("resetAllMedia",{ahtTargets:c})}else{this.trigger("deleteLibrariesWithComp",{aCompId:a})}},removeRepresentFromModelJsonById:function(a){var b=this.getLibraryById(a);if(b&&b.oModel){b.oModel.represent=false}},getLibraryIdFromLatestMap:function(a){var b;var c=this._htCompIdModelJson[a];if(!c){return}b=this.getLibraryIdFromModelJson(c);return b},getLinkedCompIdsById:function(a){var b;var c=this.getLibraryById(a);if(!c){return}b=c.aComp.slice(0);return b},getLinkedCardInfosById:function(a){var b=this.getLinkedCompIdsById(a);var c;if(b&&b.length>0){c=b.map(function(a){var b=a.split("|");return{cardId:b[0],compKey:b[1]}})}return c},unlinkComponentLibrary:function(a,b){var c,d,e,f,g;for(c=a.length;c--;){d=a[c];if(!d){continue}e=this.getLibraryIdFromLatestMap(d);if(e===b){continue}g=this.getLinkedCompIdsById(e);if(!g||g.indexOf(d)===-1){continue}this.downsizeLibraryComponentMap(e,[d]);this._addLibraryIdNeedPanelUpdate(e)}},removeComponentByIds:function(a){var b=[];a.forEach(function(a){if(a.indexOf($SE_CONFIG.COMP_TYPE.IMAGE_STRIP)>-1){var c=this._findComponentById(a);if(c){b=b.concat(c.getOwnSubCompIds())}}else{b.push(a)}}.bind(this));var c=_.without(b.map(function(a){return this.getLibraryIdFromLatestMap(a)}.bind(this)),null);if(c.length===0){return}c.reverse().forEach(function(a){var c=this.getLinkedCompIdsById(a);if(_.isArray(c)&&c.length>0){this.downsizeLibraryComponentMap(a,b)}}.bind(this))},_findComponentById:function(a){return $SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.FIND_COMPONENT_BY_ID,a)},_toggleDimmedPanelById:function(a){this.trigger("toggleDimmedPanel",{sLibraryId:a})},downsizeLibraryByCardId:function(a){var b,c;this._rxCardId=new RegExp("^("+a.join("|")+")\\|");for(b in this._htLibraryMap){if(!this._htLibraryMap.hasOwnProperty(b)){continue}c=this._htLibraryMap[b];this._downsizeLibraryComponentMapByCardId(b);this._aLibraryIdNeedPanelUpdate.push(b)}},_downsizeLibraryComponentMapByCardId:function(a){var b=this.getLinkedCompIdsById(a);if(!b){return}this._setCompIdsToLibrary(a,b.filter(function(a){return!this._rxCardId.test(a)}.bind(this)))},_getRemoveIdFilterFnByCardIds:function(){return function(a){return!this._rxCardId.test(a)}.bind(this)},downsizeLibraryComponentMap:function(a,b){var c=this.getLinkedCompIdsById(a);if(!c){return}this._setCompIdsToLibrary(a,c.filter(this._getRemoveIdFilterFn(b)))},reset:function(){this._aResource=[];this._htLibKey={}},destroy:function(){},_isCompInLibraryMap:function(a){return!!this.getLibraryIdFromLatestMap(a)}});se.defineComponent("se.LibraryItemView",{construct:function(a){this._initVar(a);this._assignElements();this._bindEvent();this._createModule();this._bindModuleEvent();this._createTemplateHandler()},_initVar:function(a){this._isCardDoc=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC;this._htLibraryConf=$SE_CONFIG.LIBRARY;this._oLibraryData=a;this._bIsActive=false;this._bKeepLibrary=false;this._$elListContainer=null;this._$elPanelContents=null;this._oTemplate=null;this._oDragHandler=null;this._htConst={UI_PICKED:"is-active",LIBRARY_LIST_ID:"se_side_lib_list"};this._$elCurrentRImage=null;this._sLastRImageId=null;this._bUseRImage=$SE_CONFIG.SERVICE_CONFIG.FEATURES.REPRESENTATIVE_IMAGE===true},_assignElements:function(){this._$elContainer=$("#se_side_lib_panel");this._$elListContainer=$("#se_side_lib_list");this._$elCanvasFrame=$("#se_canvas_frame");this._$elPanelContents=this._$elContainer.find(".__se_side_panel_cont");this._$elCanvasFrame=$("#"+$SE_CONFIG.ENV_SETTING.CANVAS_FRAME_ID);this._$elCanvasDocument=null},_createTemplateHandler:function(){this._oTemplate=se.editor.template.control["libPanelList.hbs"]},_bindEvent:function(){this._$elContainer.find(".__se_side_panel_toggle_btn").on("click",function(a){if(this._$elContainer[0].classList.contains(this._htLibraryConf.CLASS_EMPTY)){return}if(!this._isCardDoc){clickcr(a.target,"sdb.library","","")}if(this._bIsActive){this.deactivate()}else{this.activate()}}.bind(this))},_bindModuleEvent:function(){this._oDragHandler.on("onDragCanvasComponent",function(a){this.trigger("onDragComponentToInsert",a)}.bind(this));this._oDragHandler.on("onStopDragComponent",function(a){this.trigger("onStopDragComponentToInsert",a)}.bind(this));this._oDragHandler.on("resetCurrentOffsetsCache",function(a){this.trigger("resetCurrentOffsetsCache")}.bind(this));this._oDragHandler.on("cacheCurrentOffsets",function(a){this.trigger("cacheCurrentOffsets")}.bind(this));this._oDragHandler.on("addLibraryInfoOnDrag",function(a){this._addLibraryInfoOnDrag(a.target)}.bind(this));this._oDragHandler.on("removeLibraryInfoAfterDrag",function(a){this._removeLibraryInfoAfterDrag(a.target)}.bind(this))},_onClickPanelContents:function(){return false},_createModule:function(){this._oDragHandler=new se.ItemDnD(this._$elListContainer,{sDragItemClass:".__se_lib_drag",fCallback:this._dropItem.bind(this)
})},_dropItem:function(a){var b=a.find("div").data("libid");var c=a.find("div");this._insertComponent(b,true);clickcr(c,"sdb*l.drag","","")},_addLibraryInfoOnDrag:function(a){var b=a.find("div").data("libid");var c=this._oLibraryData.getLibraryById(b);var d;if(c){d=c.oModel}if(d){a.attr("data-model",JSON.stringify(d));if(this._isCardDoc){a.attr("data-compType",d["@ctype"])}}},_removeLibraryInfoAfterDrag:function(a){a.attr("data-model","");a.attr("data-compType","")},isOverlapCanvas:function(a,b){var c=a.left,d=a.left+a.width,e=a.top,f=a.top+a.height;if(b.top>e&&b.top<f){if(b.left>c&&b.left<d){return true}}return false},_bindPanelEvent:function(){this._$elListContainer.off("click");this._$elListContainer.on("click",".se_libraryList",function(a){a.preventDefault();var b=$(a.target);if(b[0].classList.contains("__se_temp_lib")){return}var c=b;while(!c[0].classList.contains("se_libraryList")){c=c.parent()}var d=$(".__se_lib_item",c);var e;if(d[0]){if(b[0].classList.contains("btn_del_lib")){e="sdb*l.del";this._removeLibrary(d)}else{e="sdb*l.thumb";this._onClickMedia(d)}}if(e){clickcr(a.target,e,"","")}}.bind(this));this._oDragHandler.activate()},_unbindPanelEvent:function(){this._$elListContainer.off("click");this._oDragHandler.deactivate()},_toggleLibraryActivationByPanelLength:function(){var a=this._getPanelLength();if(a===0){this.deactivate();this._$elContainer.addClass(this._htLibraryConf.CLASS_EMPTY)}else{this._$elContainer.removeClass(this._htLibraryConf.CLASS_EMPTY);this.activate()}},_getPanelLength:function(){return $("li.se_libraryList",this._$elListContainer).length},addLibraryData:function(a,b){if(this._bKeepLibrary){return}b=b||{};var c=typeof b.bReset==="boolean"?b.bReset:false;this._updateModelAndComponentOnAdd(a);var d=this._addLibraryModel(a);var e=this._addLibraryPanel(d);this._oDragHandler.attachDrag();if(d.length>0||c){this._toggleLibraryActivationByPanelLength();this._updatePanelWrapperMaxHeight()}return this._isCurrentRepresentativeExist()?null:e},_updateModelAndComponentOnAdd:function(a){if(!this._bUseRImage){return}var b=this._isCurrentRepresentativeExist();var c;var d;var e;var f;var g=false;if(b){c=this._getRepresentativeImageId();for(d=a.length;d--;){e=a[d];f=this._getLibraryIdFromModelJson(e);if(f!==c){if(e.represent){e.represent=false}g=true}}if(g){this._updateRepresentativeDataByMedia(this.getCurrentRepresentative(),true)}}},_getRepresentativeImageId:function(){var a=this.getCurrentRepresentative();var b;if(a&&a[0]){b=this._getLibraryIdByMedia(a)}return b},_getLibraryIdFromModelJson:function(a){return this._oLibraryData.getLibraryIdFromModelJson(a)},_isCurrentRepresentativeExist:function(){var a=this.getCurrentRepresentative();return!!a&&!!a[0]},saveCurrentRImageIdOnAdd:function(a){this._newRImageOnAdd=this._getNewRImageIdOnAdd(a)},removeChangedMediaOnAdd:function(a,b){b=b||{};var c=b.sTriggerType;var d=this._getRepresentativeImageId();var e=this._newRImageOnAdd;this._newRImageOnAdd=null;var f=this._oLibraryData.unlinkAndGetLibraryIdToBeRemoved(a);var g=c===this._htLibraryConf.TRIGGER_TYPE.DROP;if(this._isCardDoc&&g){return}f.forEach(function(a){this._removeLibrary(a)}.bind(this));var h=this._getRepresentativeImageId();return h===d?h:e},_getNewRImageIdOnAdd:function(a){var b;var c;var d;var e;a.some(function(a){b=this._getLibraryIdFromLatestMap(a.compId);if(!b){return false}if(this._isMediaRepresentative(this._getLibraryPanel(b))!==true){return false}d=b;if(a.uploadedLocal!==true){return false}c=this._getLibraryIdFromModelJson(a);if(b===c){return false}e=c;return true}.bind(this));return e},_addLibraryModel:function(a){return this._oLibraryData.addLibraryModel(a)},removeLibraryData:function(a,b){var c=$.isArray(a)?a:[a];this._oLibraryData.removeCompInLibraryByModelJson(c,b)},clearLibrary:function(){this.trigger("clearLibraryMap");this._clearLibraryPanel()},_clearLibraryPanel:function(){this._$elListContainer.empty();this._clearRepresentativeImage()},_clearRepresentativeImage:function(){this._$elCurrentRImage=null},_deleteLibraryData:function(a){this.trigger("deleteLibraryFromMapById",{sLibraryId:a})},_removeLibrary:function(a){var b=typeof a==="string"?a:a.data("libid");var c=typeof a==="string"?this._getLibraryPanel(a):a;if(!b){return}this._deleteLinkedComponents(b);this._setNextRepresentativeImage({libraryId:b});this._downsizeLibraryIds([b]);c.parent().remove();this._toggleLibraryActivationByPanelLength();this._updatePanelWrapperMaxHeight()},_deleteLinkedComponents:function(a){this.trigger("deleteLinkedComponents",{sLibraryId:a})},_downsizeLibraryIds:function(a){this.trigger("downsizeLibraryIds",{aLibraryId:a})},_setNextRepresentativeImage:function(a){if(!this._bUseRImage){return}var b=a?a.compId:null;var c=a?a.libraryId:null;if(b&&!c){c=this._getLibraryIdFromLatestMap(b)}if(!c){return}this._changeRepresentativeImageById(c)},setAttachToLibrary:function(a,b){var c=this._convertAttachToModelJson(a);if(c.length>0){this.addLibraryData(c,{bReset:b})}},_convertAttachToModelJson:function(a){return this._oLibraryData.convertAttachToModelJson(a)},onRemoveComponent:function(a){if(this._bKeepLibrary){return}var b=[];if(a.sId){b=[a.sId]}else if(a.asIds){b=a.asIds}else if(a.ids){b=a.ids}if(!b||b.length===0){return}b=b.concat(a.subCompIds?a.subCompIds:[]);this._removeComponentByIds(b);this.updateLibraryPanel()},_removeComponentByIds:function(a){this.trigger("removeComponentByIds",{aCompId:a})},updateLibraryPanel:function(a){var b=this._getLibraryIdsNeedPanelUpdate();var c,d;for(c=b.length;c--;){d=b[c];this.toggleDimmedPanel(d)}this._clearLibraryIdsNeedPanelUpdate();this._setRepresentativeOnAdd(a)},_getLibraryIdsNeedPanelUpdate:function(){return this._oLibraryData.getLibraryIdsNeedPanelUpdate()},_clearLibraryIdsNeedPanelUpdate:function(){this._oLibraryData.clearLibraryIdsNeedPanelUpdate()},toggleDimmedPanel:function(a){var b=this._getLinkedCompIdsById(a);if(!b||b.length===0){this._showDimmedLayer(a);var c=this._getLibraryPanel(a);if(this._isMediaRepresentative(c)){this._unsetRepresentative(c)}}else{this._hideDimmedLayer(a)}},_getLinkedCompIdsById:function(a){return this._oLibraryData.getLinkedCompIdsById(a)},_getLinkedCardInfosById:function(a){return this._oLibraryData.getLinkedCardInfosById(a)},_showDimmedLayer:function(a){var b=this._getDimmedLayer(a);if(!b){return}b.show();this._removeRepresentFromModelJsonById(a)},_removeRepresentFromModelJsonById:function(a){this.trigger("removeRepresentFromModelJsonById",{sLibraryId:a})},_hideDimmedLayer:function(a){var b=this._getDimmedLayer(a);if(!b){return}b.hide()},_getDimmedLayer:function(a){var b=this._getLibraryPanel(a);if(!b[0]){return}var c=$("div.se_delete_dim",b.parent());if(!c[0]){return}return c},_downsizeLibraryComponentMap:function(a,b){this.trigger("downsizeLibraryComponentMap",{sLibraryId:a,aCompId:b})},reset:function(){this._aResource=[];this._htLibKey={}},_insertComponent:function(a){var b=$.extend(true,{},this._getModelJsonById(a));delete b.libId;delete b.compId;delete b.attachId;delete b.caption;this.trigger("onInsertComponent",{compData:b,shouldFocus:true,bFromLibrary:true})},_addLibraryPanel:function(a){var b,c,d=[],e,f;if(a.length>0){a.forEach(function(a){this._$elListContainer.find(".__se_temp_lib:last").remove();c=this._getModelJsonById(a);if(!c){return}if(c.represent){b=a}d.push(c)},this);e=this._$elListContainer.find(".__se_temp_lib:first");f=this._oTemplate({list:d});if(e[0]){e.before(f)}else{this._$elListContainer.append(f)}}return b},_setRepresentativeOnAdd:function(a){if(!this._bUseRImage){return}if(a){this._setMediaRepresentative(this._getLibraryPanel(a))}else{this._findRepresentativeIfNone()}},_updatePanelWrapperMaxHeight:function(){setTimeout(function(){this._$elPanelContents.css("maxHeight");var a=this._$elListContainer.innerHeight();var b=""+a+"px";this._$elPanelContents.css("maxHeight",b)}.bind(this),0)},_getLibraryPanel:function(a){var b=$('.__se_lib_item[data-libid="'+a+'"]');return b},setRepresentative:function(a){var b=a?a.compId:null;var c=a?a.libraryId:null;if(b&&!c){c=this._getLibraryIdFromLatestMap(b)}if(!c){return}this._setMediaRepresentative(this._getLibraryPanel(c))},_getLibraryIdFromLatestMap:function(a){return this._oLibraryData.getLibraryIdFromLatestMap(a)},_setMediaRepresentative:function(a,b){if(!this._bUseRImage||this._isMediaRepresentative(a)||!this._isRepresentable(a,b)){return}var c=this.getCurrentRepresentative();this._unsetRepresentative(c);this._setRepresentative(a)},_assignCanvasDocument:function(){if(!this._$elCanvasDocument){this._$elCanvasDocument=this._$elCanvasFrame.contents()}},_onClickMedia:function(a){this._setMediaRepresentative(a,{isOnClick:true})},_findRepresentativeIfNone:function(){if(this._isCurrentRepresentativeExist()){return}this._findNextCandidate(this._sLastRImageId,{bPrepend:true})},_changeRepresentativeImageById:function(a){var b=this._getLibraryPanel(a);if(!this._isMediaRepresentative(b)){return}this._unsetRepresentative(b);this._findNextCandidate(a)},_findAndSetRepresentative:function(a){a=a||this._getLibraryIds();var b=this._findCandidateInList(a);if(b){this._setRepresentative(b)}},_setRepresentative:function(a){if(!a||!this._bUseRImage){return}this._updateLastRImageId(null);this._setCurrentRepresentative(a);var b=a.parent();if(b[0].classList.contains(this._htConst.UI_PICKED)){return}b.addClass(this._htConst.UI_PICKED);this._updateRepresentativeDataByMedia(a,true)},_unsetRepresentative:function(a){if(!a||!this._bUseRImage){return}this._updateLastRImageId(a);this._clearRepresentativeImage();var b=a.parent();if(!b[0].classList.contains(this._htConst.UI_PICKED)){return}b.removeClass(this._htConst.UI_PICKED);this._updateRepresentativeDataByMedia(a,false)},_setCurrentRepresentative:function(a){this._$elCurrentRImage=a},_updateLastRImageId:function(a){var b=a?this._getLibraryIdByMedia(a):null;this._sLastRImageId=b},_updateRepresentativeDataByMedia:function(a,b){var c=this._getLibraryIdByMedia(a);this._updateRepresentativeDataById(c,b)},_updateRepresentativeDataById:function(a,b){this._updateRepresentativeInDoc(a,b);this._updateRepresentativeInModelJson(a,b)},_updateRepresentativeInDoc:function(a,b){if(!a){return}if(this._isCardDoc){var c=this._getLinkedCardInfosById(a);if(c&&c.length>0){this.trigger("onUpdateRepresentativeImage",{isToSet:b,aMedia:c})}}else{var d=this._getUpdateReqData(a,b);if(!d){return}this.trigger("onUpdateRepresentativeImage",{htReqData:d,isToSet:b})}},_updateRepresentativeInModelJson:function(a,b){this.trigger("updateRepresentativeInModelJson",{sLibraryId:a,isToSet:b})},_getUpdateReqData:function(a,b){return this._oLibraryData.getUpdateReqData(a,b)},getCurrentRepresentative:function(){return this._$elCurrentRImage},_isMediaRepresentative:function(a){var b=false;var c=this.getCurrentRepresentative();if(a&&a[0]&&this._isCurrentRepresentativeExist()&&c[0]===a[0]){b=true}return b},_findNextCandidate:function(a,b){var c=this._getRearrangedLibraryId(a,b);this._findAndSetRepresentative(c)},_isRepresentable:function(a,b){var c=b&&typeof b.isOnClick!=="undefined"?b.isOnClick:false;var d=true;if(!a[0].classList.contains($SE_CONFIG.REPRESENTATIVE_IMAGE.TYPE_CLASS.VIDEO)&&!a[0].classList.contains($SE_CONFIG.REPRESENTATIVE_IMAGE.TYPE_CLASS.IMAGE)){if(c){alert(se.i18n.getMsg("MSG_MALFORMED_MEDIA"))}return false}var e=this._getLibraryIdByMedia(a);var f=this._getModelJsonById(e);if(!f||!f.uploadedLocal){return false}var g=this._getLinkedCompIdsById(e);if(!g||g.length===0){if(c){alert(se.i18n.getMsg("MSG_NO_COMPONENT_IN_CANVAS"))}return false}return d},_getLibraryIdByMedia:function(a){var b=a.data("libid");return b},_findCandidateInList:function(a){var b=a.length;if(b===0){return}var c,d,e,f,g;c=0;d=b;for(;c<d;c++){e=a[c];f=this._getLibraryPanel(e);if(!f[0]){continue}if(this._isRepresentable(f)){g=f;break}}return g},_getLibraryMap:function(){return this._oLibraryData.getLibraryMap()},_getLibraryIds:function(){return this._oLibraryData.getLibraryIds()},_getMediaListLength:function(){return this._getLibraryIds().length},_getRearrangedLibraryId:function(a,b){return this._oLibraryData.getRearrangedLibraryId(a,b)},_getModelJsonById:function(a){return this._oLibraryData.getModelJsonById(a)},activate:function(){this._bIsActive=true;this._bindPanelEvent();this._$elContainer.addClass("is-active");this._$elPanelContents.show();this._updatePanelWrapperMaxHeight()},deactivate:function(){this._bIsActive=false;this._unbindPanelEvent();this._$elContainer.removeClass("is-active");this._$elPanelContents.css("maxHeight","0px")},destroy:function(){},isLibraryLocked:function(){return this._bKeepLibrary},disableChangeLibrary:function(){this._bKeepLibrary=true},enableChangeLibrary:function(){this._bKeepLibrary=false}});se.defineComponent("se.ThemePanel",{construct:function(){this._initVar();this._wrapperElements();this._createModule();this._bindEvent()},_initVar:function(){this._bIsActive=false;this._$elContainer=null;this._$elPanelContents=null;this._oTemplate=se.editor.template.control["themeList.hbs"];this._aThemeList=$SE_MODEL_DATA_COORD.getThemeInfos()},_wrapperElements:function(){this._$elContainer=$("#se_side_theme_panel");this._$elPanelContents=this._$elContainer.find(".__se_side_panel_cont");this._$elPanelContentsGroup=this._$elContainer.find(".se_documentProperties_Group");this._$elWrapperList=this._$elContainer.find(".__se_side_theme_list")},_createModule:function(){if(!$("#se_theme_paging")){return false}this._oPaging=new se.util.Paging($("#se_theme_paging"),{nPageBase:6,nPageUnit:5,nTotal:this._aThemeList.length,fTemplate:se.editor.template.control["paging-theme.hbs"]});if(this._aThemeList.length<=6){$("#se_theme_paging").hide()}this._oPaging.on("onMovePage",function(a){this._createThemeList(a.nStartIndex,a.nEndIndex);this._selectCheckTheme($SE_MODEL_DATA_COORD.getCurrentTheme())}.bind(this))},_createThemeList:function(a,b){var c=[];while(a<=b){c.push(this._aThemeList[a]);a++}this._$elWrapperList.html(this._oTemplate({list:c}))},_bindEvent:function(){this._$elContainer.find(".__se_side_panel_toggle_btn").on("click",function(a){clickcr(a.target,"sdb.theme","","");if(this._bIsActive){this.deactivate()}else{this.activate()}}.bind(this))},_bindPanelEvent:function(){this._$elWrapperList.on("click",".__se_theme_item",function(a){a.preventDefault();var b=$(a.target).closest(".__se_theme_item");var c=b.data("themetype");this.selectTheme(c);this.trigger("onChangeTheme",{sTheme:c})}.bind(this))},_onClickPanelContents:function(){return false},selectTheme:function(a){var b=0;this._aThemeList.forEach(function(c,d){if(c.name===a){b=d}},this);this._oPaging.movePage(this._oPaging.getIndexToPage(b));this._selectCheckTheme(a)},_selectCheckTheme:function(a){this._$elWrapperList.find(".__se_theme_item").removeClass("is-active").find(".tit_theme span.blind").remove();this._$elWrapperList.find("a[data-themetype='"+a+"']").addClass("is-active").find(".tit_theme").append("<span class='blind'>선택됨</span>")},_unbindPanelEvent:function(){this._$elWrapperList.off("click")},_updatePanelWrapperMaxHeight:function(){setTimeout(function(){this._$elPanelContents.css("maxHeight");var a=this._$elPanelContentsGroup.innerHeight();var b=""+a+"px";this._$elPanelContents.css("maxHeight",b)}.bind(this),0)},activate:function(){this._bIsActive=true;this._bindPanelEvent();this._$elContainer.addClass("is-active");this._$elPanelContents.show();this._updatePanelWrapperMaxHeight()},deactivate:function(){this._bIsActive=false;this._unbindPanelEvent();this._$elContainer.removeClass("is-active");this._$elPanelContents.css("maxHeight","0px")},destroy:function(){}});se.defineComponent("se.OglinkFetcher",{NINE_TO_SIXTEEN_RATIO:9/16,construct:function(){this._oLayer=se.editor.template.common["modal-oglink-layer-content.hbs"];this._initVar()},_initVar:function(){this._oOGModel=null;this._isProcessing=false;this._sUrl_queried="";this._htResponse={};this._temp_attach={};this._htOption={nWidth:$SE_CONFIG.OG.width,nHeight:$SE_CONFIG.OG.height};this.sDthumb=$SE_CONFIG.ENV_SETTING.DTHUMB_DOMAIN;this._bIsCard=$SE_CONFIG.ENV_SETTING.IS_CARD_DOC},openPopupLayer:function(a,b){this._htPayLoad=a;this._fCallback=b;this._$elPopupLayer=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:this._oLayer(),close:false,buttons:[{text:"확인","class":"type1",click:this._applyLink.bind(this)},{text:"취소","class":"type2",click:function(a){clickcr($(".pop_oglink_wrap .type2"),"pog.cancel","","",a);a.stopPropagation();$SE_MODAL.close()}}],"class":"pop_oglink_wrap",beforeClose:this._cancelLink.bind(this)});$SE_MODAL.open();this._$elInputArea=this._$elPopupLayer.find(".search_input");this._$elPreviewBtn=this._$elPopupLayer.find(".btn_search");this._$elSuggestLayer=this._$elPopupLayer.find(".og_preview");this._$elTxtArea=this._$elPopupLayer.find(".og_nocnt");this._$elApplyBtn=this._$elPopupLayer.find(".apply");this._$elCancelBtn=this._$elPopupLayer.find(".cancel");this._$elLoader=this._$elPopupLayer.find(".ico_loader");if(this._bIsCard){this._$elPreviewBtn.hide()}this._$elInputArea.focus();this._bindEvent()},_bindEvent:function(){this._$elPreviewBtn.on("click",$.proxy(this._previewLink,this));this._$elInputArea.on("keydown",$.proxy(this._keyDown,this));this._$elInputArea.on("paste",$.proxy(this._previewPasteLink,this))},_unbindEvent:function(){if(!this._$elPreviewBtn&&!this._$elApplyBtn&&!this._$elCancelBtn&&!this._$elInputArea){return}this._$elPreviewBtn.off();this._$elApplyBtn.off();this._$elCancelBtn.off();this._$elInputArea.off()},_previewLink:function(a){this._isDelete=false;this._processAttachLink(this._$elInputArea.val())},_previewPasteLink:function(a){if(this._bIsCard){return}setTimeout(function(){this._processAttachLink(this._$elInputArea.val())}.bind(this),0)},_keyDown:function(a){if(this._isProcessing){return}var b=a.keyCode;if(b!==13){return}if(this._bIsCard){this._applyLink(a)}else{this._previewLink()}return false},_processAttachLink:function(a,b){var c=this._refineStringToUrl(a);if(!c){this._clearLinkPreviewArea();this._showTxtLayer();return}var d=this._onSuccessLinkAjaxRequest(b);this._startSign();if(this._htResponse[c]){this._attachLink({sUrl:c,isDirectAttach:b});this._sUrl_queried=c;this._endSign()}else{this._crawl(c,d,0,3,1e3)}},_refineStringToUrl:function(a){if(!a){return}a=$.trim(a);var b=a.match(/[^\s]+$/);if(!b){return}a=b[0];if(this._containExceptString(a)&&a.length>63){return""}a=a.substr(0,2048);return a},_containExceptString:function(a){var b=/[0-9a-zA-Z\{\}\[\]\/?.,;:|\)*~`!^\-_+<>@\#$%&\\\=\(\'\"]/;for(var c=0;c<a.length;c++){return b.test(a.charAt(c))==false}},_onSuccessLinkAjaxRequest:function(a){return function(b,c){if(c&&!!c.url){this._sUrl_queried=b;this._htResponse[b]=c;this._attachLink({sUrl:b,isDirectAttach:a})}else{this._showTxtLayer()}}.bind(this)},_startSign:function(){this._isProcessing=true;this._sUrl_queried=""},_endSign:function(){this._isProcessing=false},_clearLinkPreviewArea:function(){if(!this._$elSuggestLayer){return}this._$elSuggestLayer.html("");this._hideTxtLayer()},_showTxtLayer:function(){if(this._$elTxtArea&&this._isTxtLayerOpen()===false){this._clearLinkPreviewArea();this._$elTxtArea.css("display","block")}},_hideTxtLayer:function(){if(this._$elTxtArea){this._$elTxtArea.css("display","none")}},_isTxtLayerOpen:function(){return this._$elTxtArea.css("display")==="block"},_attachLink:function(a){var b=a.sUrl,c,d=this._htResponse[b],e;if(!d)return;if(d.description&&d.description.length>300){d.description=d.description.substring(0,300)}d.layoutType=this._determineLayoutType(d);this._oOGModel=this._generateCompData(d);if(a.isDirectAttach){if(!d.image||this._isDelete){this._oOGModel.thumbnail=null;this._isDelete=false}$SE_MODAL.close();this._htPayLoad.compData=this._oOGModel;if(this._fCallback){this._fCallback(this._oOGModel)}else{this.trigger("onInsertComponent",this._htPayLoad)}this._oOGModel=null;this._closeLink();this._isDelete=false}else{this._addTempInfo();this._clearLinkPreviewArea();c=this._getPreviewHtml();this._$elSuggestLayer.html(c);this._$elThumbnail=this._$elPopupLayer.find(".se_btn_og_rmThumb");this._$elThumbnail.on("click",this._deleteThumb.bind(this))}},_generateCompData:function(a){var b=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.OGLINK);return _.extend(b,{title:a.title?$SE_STRING.getPlainText(a.title):"",link:a.url,domain:a.domain,layout:a.layoutType,desc:a.description?$SE_STRING.getPlainText(a.description):"",thumbnail:a.image&&a.image.url?{"@ctype":"thumbnail",src:a.image.url,width:a.image.width,height:a.image.height}:null,isVideo:a.video?true:false})},_addTempInfo:function(){this._temp_attach[this._oOGModel.id]=this._oOGModel},_getPreviewHtml:function(){var a=se.editor.template.common["oglink-component.hbs"],b=this._getThumbSize();if(this._isDelete){b.thumbnail=null}b.clickCode="pog";return a(b)},_deleteThumb:function(a){this._$elPopupLayer.find(".se_og_thumb").remove();this._isDelete=true},_getThumbSize:function(){var a=this._oOGModel;if(!a.thumbnail){return a}else if(this._isVerticalRatio(a.thumbnail)){a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff250_444");a.isVerticalThumbnail=true}else if(a.layout==="default"||a.layout==="og_shoppingAffiliate"){a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff120")}else if(a.thumbnail.height===a.thumbnail.width&&!this._isNMusic(a.thumbnail)){a.thumbnail.src=this._makeDThumb(a.thumbnail,"w480")}else{a.thumbnail.src=this._makeDThumb(a.thumbnail,"ff500_300")}return a},_makeDThumb:function(a,b){var c=this.sDthumb+"/?src=%22"+encodeURIComponent(a.src)+"%22&type="+b;var d=new Image;d.onerror=this._deleteThumb.bind(this);d.src=c;return c},_crawl:function(a,b,c,d,e){var f;if(c>d){this._endSign();this._showTxtLayer();return}var g={type:"get",data:{url:a,serviceId:$SE_CONFIG.ENV_SETTING.SERVICE_NAME},timeout:9e3,async:true};this._showLoader();$SE_AJAX.request($SE_CONFIG.API.OG_CRAWLER_API,g,{fSuccess:function(g,h,i){if(g["isBusy"]){setTimeout(function(){this._crawl(a,b,++c,d,e)}.bind(this),e)}else{f=g.summary;if(f){f.url=g.url;if(g.predefinedUrlPattern){f.predefinedUrlPattern=g.predefinedUrlPattern}}b(a,f);this._endSign()}this._hideLoader()}.bind(this),fError:function(a,b){this._endSign();this._showTxtLayer();this._hideLoader()}.bind(this)})},_showLoader:function(){if(this._$elLoader){this._$elLoader.addClass("is-on")}},_hideLoader:function(){if(this._$elLoader){this._$elLoader.removeClass("is-on")}},_determineLayoutType:function(a){var b=a.image;if(a.predefinedUrlPattern==="shoppingAffiliate"){return"og_shoppingAffiliate"}if(!b||this._isVerticalRatio(b)){return"default"}if(this._isVideo(a)||this._isBigSize(b)){return"og_bSize"}return"default"},_applyLink:function(a){var b,c;a.stopPropagation();clickcr(this._$elApplyBtn,"pog.ok","","",a);b=this._$elInputArea.val();b=$.trim(b);this._insertLink(b)},attachLinkFromParagraph:function(a){var b=$.trim(a);this._htPayLoad={compData:"oglink",shouldFocus:true};this._insertLink(b)},_insertLink:function(a){if(!this._isProcessing){this._processAttachLink(a,true)}else{this._attachLink({sUrl:this._sUrl_queried,isDirectAttach:true})}},_cancelLink:function(a){this._closeLink();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE)},_closeLink:function(){this._clearLinkPreviewArea();if(this._$elInputArea){this._$elInputArea.val("")}this._unbindEvent()},_isNMusic:function(a){return a.src.indexOf("http://musicmeta.phinf.naver.net")<0?false:true},_isVerticalRatio:function(a){return(a.width/a.height).toFixed(2)<=this.NINE_TO_SIXTEEN_RATIO?true:false},_isBigSize:function(a){return a.width>=this._htOption.nWidth&&a.height>=this._htOption.nHeight},_isVideo:function(a){return a.video&&a.url.indexOf("youtube")>=0}});se.defineComponent("se.MaterialLayer",{construct:function(){this._initVar();this._bindFunction()},_initVar:function(){this._fTemplate=se.editor.template.control["popup-material.hbs"];this._htTapList={};var a=$SE_CONFIG.SERVICE_CONFIG.COMP_DEFINE[$SE_CONFIG.COMP_TYPE.MATERIAL].defaultTab||"Book";this._oCurrentTap=this._makeNewTap(a);this._sFrom=null},_bindFunction:function(){this._fClickTapContainer=this._clickTapContainer.bind(this);this._fApplyMaterial=this._applyMaterial.bind(this)},activate:function(a){this._htPayLoad=a;this._modalShow();this._assignElements();this._bindEvent();$(this._$elTabContainer.find(">[value='"+this._oCurrentTap.getType()+"']").get(0)).addClass("is-active");this._oCurrentTap.activate(this._$elWrap)},deactivate:function(){this._enableSuggestion();this._oCurrentTap.deactivate();this._unbindEvent();this._unassignElements()},_modalShow:function(){this._$elWrap=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:this._fTemplate(),"class":"pop_subjectMatter_wrap",beforeClose:function(){this.deactivate();$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE)}.bind(this)});$SE_MODAL.open()},_bindEvent:function(){this._$elTabContainer.on("click",".subjectMatter_item",this._fClickTapContainer)},_unbindEvent:function(){this._$elTabContainer.off("click")},_assignElements:function(){this._$elTabContainer=$(".subjectMatter_tab",this._$elWrap);this._$elSelectedTap=$($(".subjectMatter_item",this._$elWrap).filter("[value='"+this._oCurrentTap.getType()+"']").get(0));this._$elOkCancel=$(".pop_btn ",this._$elWrap)},_unassignElements:function(){this._$elTabContainer=null;this._$elSelectedTap=null;this._$elOkCancel=null},_clickTapContainer:function(a){var b=$(a.currentTarget),c=b.attr("value");if(b[0].classList.contains("is-active")){return}this._$elSelectedTap.removeClass("is-active");this._$elSelectedTap=b.addClass("is-active");this._oCurrentTap.deactivate();if(!this._htTapList[c]){this._makeNewTap(c)}this._oCurrentTap=this._htTapList[c];this._oCurrentTap.activate(this._$elWrap)},_makeNewTap:function(a){var b=new se["MaterialLayer"+a+"Tap"];b.on("onAddComponent",function(a){this._htPayLoad.compData=a.htData;$SE_MODAL.close();this.trigger("onAddComponent",this._htPayLoad)}.bind(this));this._htTapList[b.getType()]=b;return b},_applyMaterial:function(){this._oCurrentTap.insertMaterialComp()},_enableSuggestion:function(){var a=this._htTapList;for(var b in a){a[b].enableSuggestion()}}});se.defineComponent("se.StickerLayer",{construct:function(){this._initVar()},_initVar:function(){this._modalTemplate=se.editor.template.control["popup-sticker.hbs"];this._packListTemplate=se.editor.template.control["popup-stickerPackList.hbs"];this._eachStickerTemplate=se.editor.template.control["popup-eachSticker.hbs"];this._TAB_SIZE=11},activate:function(a){this._htPayLoad=a;this._modalShow();this._assignElements();this._bindEvent()},deactivate:function(){this._unbindEvent();this._unassignElements()},_modalShow:function(){this._$elWrap=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:this._modalTemplate(),close:false,buttons:[{text:"취소","class":"type2",click:this._onClickCancel.bind(this)}],"class":"pop_sticker_wrap",beforeClose:this._onClickBeforeCancel.bind(this)});$SE_MODAL.open();this._requestPackList()},_bindEvent:function(){this._$elPrevBtn.on("click",this._onPrev.bind(this));this._$elNextBtn.on("click",this._onNext.bind(this));this._$elTabContainer.on("click",">li>button",this._onClickTab.bind(this));this._$elTabContainer.on("click","li div button",this._onClickSticker.bind(this))},_unbindEvent:function(){this._$elPrevBtn.off("click");this._$elNextBtn.off("click");this._$elTabContainer.off("click")},_assignElements:function(){this._$elPrevBtn=$(".btn_prev",this._$elWrap);this._$elNextBtn=$(".btn_next",this._$elWrap);this._$elTabContainer=$("ul.line_sticker_set",this._$elWrap)},_unassignElements:function(){this._$elPrevBtn=null;this._$elNextBtn=null;this._$elTabContainer=null},_requestPackList:function(){$SE_AJAX.request($SE_CONFIG.API.STICKER,{type:"get",timeout:2e3,dataType:"json"},{fSuccess:this._onLoadPackList.bind(this)})},_onLoadPackList:function(a,b,c){if(!this._$elTabContainer){return}var d=a.list;this._htPack={};this._htStickerInfo=a.info;for(var e=0,f=[],g;g=d[e];e++){g.seq=e;this._htPack[g.packCode]=g}this._$elTabContainer.html(this._packListTemplate(a));this._setTabView(0)},_requestStickerList:function(a){$SE_AJAX.request($SE_CONFIG.API.STICKER+"/"+a,{type:"get",timeout:2e3,contentType:"application/json",data:{packCode:a},dataType:"json"},{fSuccess:this._onLoadStickerList.bind(this,a)})},_onLoadStickerList:function(a,b){if(!this._$elTabContainer){return}var c;var d;var e;var f;var g=$("li>div",this._$elTabContainer);c=b.list;f=this._htStickerInfo;e=this._htPack[a];e.htSticker={};for(var h=0,i;i=c[h];h++){e.htSticker[i.stickerCode]=i}var j={sPackCode:a,aStickerList:c,htInfo:f,htPack:e};d=g[e.seq];d.innerHTML=this._eachStickerTemplate(j);this._htPack[a].isLoaded=true;$(d).find("li").each(function(){$(this).on("mouseover",function(){$(d).addClass("is-dimmed")}).on("mouseout",function(){$(d).removeClass("is-dimmed")})})},_onClickSticker:function(a){var b=$(a.currentTarget);var c=b.parents("ul").attr("data-value");var d=b.attr("data-value");var e=this._htPack[c];var f=e.htSticker[d];this._htPayLoad.compData=this._getJson({packCode:c,seq:f.seq,animated:e.isAnimated,original:{"@ctype":"thumbnail",src:f.originalUrl,width:f.imageWidth,height:f.imageHeight}});this.trigger("onAddComponent",this._htPayLoad);$SE_MODAL.close();if(e.isAnimated){clickcr(a.currentTarget,"psk.gifattach","","")}else{clickcr(a.currentTarget,"psk.attach","","")}return false},_onClickCancel:function(a){a.stopPropagation();$SE_MODAL.close();clickcr(a.currentTarget,"psk.cancel","","")},_onClickBeforeCancel:function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE);this.deactivate()},_getJson:function(a){return $.extend({"@ctype":$SE_CONFIG.COMP_TYPE.STICKER},a)},_onClickTab:function(a){var b=$(a.currentTarget);var c=b.data("value");var d=this._$elTabContainer.find(".is-active");var e=b.closest(".__se_sticker_container");this._changeActiveTab(d,e);if(this._htPack[c].isLoaded!==true){this._requestStickerList(c)}if(this._htPack[c].isAnimated){clickcr(a.currentTarget,"psk.gifstklist","","")}else{clickcr(a.currentTarget,"psk.stklist","","")}},_changeActiveTab:function(a,b){this._deactivateContainer(a);this._activateContainer(b)},_deactivateContainer:function(a){var b=this._htStickerInfo.tabOnName;var c=this._htStickerInfo.tabOffName;a.removeClass("is-active");a.find("img").attr("src",function(a,d){return d.replace(b,c)})},_activateContainer:function(a){var b=this._htStickerInfo.tabOnName;var c=this._htStickerInfo.tabOffName;a.addClass("is-active");a.find("img").attr("src",function(a,d){return d.replace(c,b)})},_onPrev:function(a){var b=this._nCurrentStart-this._TAB_SIZE;this._setTabView(b);clickcr(a.currentTarget,"psk.prev","","")},_onNext:function(a){var b=this._nCurrentStart+this._TAB_SIZE;this._setTabView(b);clickcr(a.currentTarget,"psk.next","","")},_setTabView:function(a){var b=this._$elPrevBtn;var c=this._$elNextBtn;var d=this._$elTabContainer.find(".__se_sticker_container");var e=d.length;var f=a+this._TAB_SIZE;this._nCurrentStart=a;b.prop("disabled",a<1);c.prop("disabled",f>=e);d.filter(".is-on").removeClass("is-on");for(var g=a;g<f;g++){d.eq(g).addClass("is-on")}if(a===e-1){this._deactivateContainer(this._$elTabContainer.find(".is-active"))}else{this._onClickTab({currentTarget:$(">li>button",this._$elTabContainer)[a]})}}});se.defineComponent("se.TalktalkLayer",{construct:function(){this._initVar()},_initVar:function(){this._fTpl=se.editor.template.control["popup-talktalk.hbs"];this._aAccountList=[];this._oCompData=null},_assignElements:function(){this._$elDropdownBtn=this._$elContainer.find("button.btn_dropDown");this._$elDropdownList=this._$elContainer.find(".dropDown_lst_wrap");this._$elDropdownScrollable=this._$elDropdownList.find(".__se_dropdown_scrollable_list");this._$elRadioBtns=this._$elContainer.find("input:radio");this._$elBannerDefault=this._$elContainer.find(".talk_banner_default");this._$elBannerImage=this._$elContainer.find(".talk_banner_image");this._$elBannerImageInput=this._$elBannerImage.find("input");this._$elBannerImageBtn=this._$elBannerImage.find("button")},_bindEvent:function(){this._$elContainer.on("click.talktalkLayer",this._onClickLayer.bind(this));this._$elDropdownBtn.on("click",this._onClickDropdownBtn.bind(this));
this._$elDropdownList.on("click","li",this._onClickDropdownList.bind(this));this._$elRadioBtns.on("click",this._onClickRadioBtns.bind(this));this._$elBannerImageInput.on("focus",function(){this.blur()});this._$elBannerImageBtn.on("click",this._onClickBannerImageBtn.bind(this))},_onClickLayer:function(a){this._hideDropdown()},_onClickDropdownBtn:function(a){a.stopPropagation();if(this._$elDropdownList.is(":visible")){this._hideDropdown()}else{this._showDropdown()}},_onClickDropdownList:function(a){a.preventDefault();var b=$(a.currentTarget);this._$elDropdownList.find("li").removeClass("is-selected");b.addClass("is-selected");this._$elDropdownBtn.html(b.find("a").html());this._oCompData.accountId=b.find(".talk_url_shortcut").text();this._oCompData.profileName=b.find(".talk_user_name").text();this._hideDropdown()},_showDropdown:function(){this._$elDropdownBtn.addClass("is-active");this._$elDropdownList.show();this._$elDropdownScrollable.scrollTo($(".is-selected",this._$elDropdownScrollable))},_hideDropdown:function(){this._$elDropdownBtn.removeClass("is-active");this._$elDropdownList.hide()},_onClickRadioBtns:function(a){var b=$(a.target);this._$elRadioBtns.removeClass("is-checked");b.addClass("is-checked");var c=b.val();if(c==="custom"){this._oCompData.layout="custom";this._$elBannerDefault.removeClass("is-on");this._$elBannerImage.addClass("is-on")}else{this._oCompData.layout="default";this._$elBannerDefault.addClass("is-on");this._$elBannerImage.removeClass("is-on")}},_onClickBannerImageBtn:function(){$SE_MEDIA.open($SE_CONFIG.COMP_TYPE.IMAGE,this._uploadedImage.bind(this),{maxFileCount:1,image:this._oCompData.image})},_uploadedImage:function(a){this._oCompData.image=a;this._$elBannerImageInput.val(a.alt)},_unbindEvent:function(){this._$elContainer.off(".talktalkLayer");this._$elDropdownBtn.off();this._$elDropdownList.off();this._$elRadioBtns.off();this._$elBannerImageInput.off();this._$elBannerImageBtn.off()},activate:function(a){this._htPayLoad=a;if(typeof a.compData==="object"){this._oCompData=a.compData}else{this._oCompData=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.TALKTALK);this._oCompData.accountId=this.defaultAccount.accountId;this._oCompData.profileName=this.defaultAccount.profileName}this._modalShow();this._assignElements();this._bindEvent()},deactivate:function(){$SE_MEDIA.closeAll();this._unbindEvent();for(var a in this){if(a.indexOf("_$el")===0){this[a]=null}}},setAccountList:function(a){this._aAccountList=a;this.defaultAccount=this._getMobileSelectedId(a)||a[0]},_getMobileSelectedId:function(a){return _.find(a,function(a){return a.isLinked===true})},_modalShow:function(){this._$elContainer=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:this._fTpl({accountList:this._aAccountList,accountId:this._oCompData.accountId,profileName:this._oCompData.profileName,fileName:this._oCompData.image?this._oCompData.image.alt:"",layout:this._oCompData.layout}),buttons:[{text:"확인","class":"type1",click:this._onApply.bind(this)}],"class":"pop_talktalk_wrap",beforeClose:this._onClose.bind(this)});$SE_MODAL.open()},_onApply:function(a){a.stopPropagation();if(this._oCompData.layout==="custom"&&!this._oCompData.image){alert(this._$elBannerImage.find("input").attr("placeholder"));return}$SE_MODAL.close();this._htPayLoad.compData=$.extend(true,{},this._oCompData);if(this._htPayLoad.fCallback){this._htPayLoad.fCallback(this._htPayLoad)}else{this.trigger("onAddComponent",this._htPayLoad)}},_onClose:function(){this.deactivate()}});se.defineComponent("se.FileModalLayer",{construct:function(a){this._initVar();$SE_FILE_VALIDATOR.init();$SE_FILE_VALIDATOR.updateTotalFileStatus();if($SE_FILE_VALIDATOR.validateTotalFile()===false){return}this._htOptions=$.extend({},{fInsertFileDialogueComponent:function(){},fInsertComponent:function(){}},a);this._assignElements();this._bindEvent()},_initVar:function(){this._sNDriveFileUploadUrl="/FileUploader/ndrive/"+$SE_CONFIG.ENV_SETTING.SERVICE_NAME+"/startlinkage.json?fileinfos="},_assignElements:function(){this._$elContainer=this._createContainer();this._$elLocalStorageBtn=this._$elContainer.find(".__se_local");this._$elNdriveBtn=this._$elContainer.find(".__se_ndrive")},_bindEvent:function(){this._$elLocalStorageBtn.on("click",this._onClickLocalStorageBtn.bind(this));this._$elNdriveBtn.on("click",this._onClickNdriveBtn.bind(this))},_createContainer:function(){var a=se.editor.template.common["modal-file-layer-content.hbs"];var b=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:a(),"class":"pop_file_wrap"});$SE_MODAL.open();return b},_onClickLocalStorageBtn:function(a){a.stopPropagation();$SE_MODAL.close();this._htOptions.fInsertFileDialogueComponent()},_onClickNdriveBtn:function(a){$SE_MEDIA.open($SE_CONFIG.COMP_TYPE.FILE,this._fNDriveUploadCallback.bind(this))},_fNDriveUploadCallback:function(a){var b=JSON.parse(a)[0];var c=this._htOptions.fInsertComponent;if($SE_FILE_VALIDATOR.validateFile(b)===false){return}$SE_AJAX.request(this._sNDriveFileUploadUrl+encodeURIComponent(a),{timeout:5e3,fSuccess:function(a){if(a.result===""){return}var b=a.result;var d=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.FILE);d.src=b.attachDirectory+"/"+b.attachFile;d.fileName=b.attachFile;d.fileSize=b.attachSize;d.uploadedLocal=true;d.fileType="ndrive";c(d)},fFail:function(a){var b=se.i18n.getMsg("MSG_AJAX_FILE_ERROR_CONTENT");var c=se.editor.template.common["modal-file-error-content.hbs"];if(a.errorMsg&&""!==a.errorMsg){b=a.errorMsg}$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:c({errorMsg:b}),"class":"pop_demoErr_wrap",dimmed:true,buttons:[{text:"확인","class":"type2",click:function(a){a.stopPropagation();$SE_MODAL.close()}}]});$SE_MODAL.open()},bShowFailMsg:true,bShowFailMsg:false});$SE_MODAL.close()},_unbindEvent:function(){this._$elLocalStorageBtn.off();this._$elNdriveBtn.off()},destroy:function(){this._unbindEvent();$SE_MODAL.close();this._$elContainer=null}});se.defineComponent("se.CloudSNSLayer",{NCLICK_CODE:{cloud:"cloud",facebook:"fb",pholar:"pholar",instagram:"insta"},MAX_IMAGE_COUNT:50,construct:function(a){this._imageUploader=new se.ExternalImageUploader;this._htOptions=$.extend(true,{},a)},_assignElements:function(){this._$elContainer=this._createContainer();this._$elCloudSNSBtn=this._$elContainer.find(".__se_cloudSNS")},_createContainer:function(){var a=se.editor.template.common["modal-cloudSNS-layer-content.hbs"];var b=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:a({isCloudsEnabled:$SE_CONFIG.SERVICE_CONFIG.FEATURES.NCLOUDS_IMAGES}),"class":"pop_cloudSns_wrap is-on",beforeClose:this.deactivate.bind(this)});return b},_bindEvent:function(){this._$elCloudSNSBtn.on("click","a",this._onClickCloudBtn.bind(this))},_unbindEvent:function(){this._$elCloudSNSBtn.off()},_onClickCloudBtn:function(a){a.preventDefault();var b=$(a.currentTarget).data("type");var c={sType:b,nMaxImageCount:this._htOptions.maxImageCount||this.MAX_IMAGE_COUNT};var d="psn."+this.NCLICK_CODE[b];clickcr(a.currentTarget,d,"","");$SE_MEDIA.open($SE_CONFIG.COMP_INSERT_ITEM_TYPE.CLOUD_SNS,this._fUploadCallback.bind(this),c)},activate:function(a,b){this._htPayload=a;this._htOptions=$.extend(true,{},b);this._assignElements();this._bindEvent();$SE_MODAL.open()},_fUploadCallback:function(a){this._imageUploader.upload(a,this._htPayload,this._htOptions.fCallback);$SE_MEDIA.closeAll();$SE_MODAL.close()},deactivate:function(){this._unbindEvent();this._$elContainer=null}});se.defineComponent("se.ScheduleLayer",{construct:function(){this._initVar()},_initVar:function(){this._fPopupTpl=se.editor.template.control["popup-schedule.hbs"];this._fScheduleListTpl=se.editor.template.control["scheduleList.hbs"];this._oCompData=null;this.ENV={SERVICE_NAME:$SE_CONFIG.ENV_SETTING.SERVICE_NAME,USER_ID:$SE_CONFIG.USER_INFO.id,SERVICE_HOME:$SE_CONFIG.ENV_SETTING.SERVICE_HOME,IS_IE:eg.agent().browser.name==="ie"};var a="YYYY.M.D.";var b="yy.m.d.";this.CONST={FORMAT:{DATEPICKER:{FOR_MOMENT:b,FOR_DISPLAY:b+"(D)"},MOMENT:{FROM_PLACEHOLDER:a,FROM_DATEPICKER:a+" h:m",FOR_DISPLAY:a+"(ddd)"}},CLASS:{UI_ACTIVE:"is-active",UI_EXTEND:"extend",UI_SCHEDULE_EXIST:"is-schedule",UI_HIDDEN:"hidden",UI_MONTH_CHANGE:"is-monthChange",UI_ON:"is-on"}};this._sStartDateTime=null;this._sEndDateTime=null;this._nRequiredMsgTimeoutId=null},_assignElements:function(){this._$elTitle=this._$elContainer.find("#schedule_title");this._$elDateWrapper=this._$elContainer.find(".__date_wrapper");this._$elBtnEndDate=this._$elContainer.find(".__btnEndDate");this._$elStartDate=this._$elContainer.find("#schedule_start_date");this._$elStartHour=this._$elContainer.find("#schedule_start_hour");this._$elStartMinute=this._$elContainer.find("#schedule_start_minute");this._$elEndDate=this._$elContainer.find("#schedule_end_date");this._$elEndHour=this._$elContainer.find("#schedule_end_hour");this._$elEndMinute=this._$elContainer.find("#schedule_end_minute");this._$elAllDayLabel=this._$elContainer.find(".__se_allday_label");this._$elAllDay=this._$elContainer.find("#chk_allday");this._$elTimeInput=this._$elContainer.find(".__se_time_input");this._$elPlace=this._$elContainer.find("#schedule_place");this._$elClearPlaceBtn=this._$elContainer.find(".__clear_place_btn");this._$elLink=this._$elContainer.find("#schedule_link");this._$elDesc=this._$elContainer.find("#schedule_desc");this._$elRequiredMsg=this._$elContainer.find(".__schedule_info");this._$elTabs=this._$elContainer.find(".scheduleTab");this._$elPanels=this._$elContainer.find(".schedulePanel");this._$elApplyBtnWrapper=this._$elContainer.find(".__se_pop_buttons");this._$elYearBtnWrapper=this._$elContainer.find(".wrap_btnYear");this._$elCurrentYear=this._$elContainer.find(".__se_current_year");this._$elMonths=this._$elContainer.find(".lst_month > li");this._$elEmptySchedule=this._$elContainer.find(".wrap_schedule_empty");this._$elScheduleListWrapper=this._$elContainer.find(".lst_schedule_by_Month");this._$elScheduleTotalCount=this._$elContainer.find(".__se_schedule_total_count");this._$elScheduleList=this._$elContainer.find(".ul_schedule");this._$elLoadingLayerOnListTab=this._$elContainer.find(".ly_schedule_loading");this._$elCloseBtn=this._$elContainer.find(".__se_pop_close")},_activateMaxlength:function(){this._oTitleMaxlength=new Maxlength(this._$elTitle.get(0),50,{onMaxlength:this._toastMaxLength.bind(this,se.i18n.getMsg("MSG_MAX_SCHEDULE_TITLE_LENGTH"))});this._oDescMaxlength=new Maxlength(this._$elDesc.get(0),200,{allowEnterKey:true,onMaxlength:this._toastMaxLength.bind(this,se.i18n.getMsg("MSG_MAX_SCHEDULE_DESCRIPTION_LENGTH"))});this._oTitleMaxlength.activate();this._oDescMaxlength.activate()},_deactivateMaxlength:function(){this._oTitleMaxlength.deactivate();this._oDescMaxlength.deactivate();this._oTitleMaxlength=null;this._oDescMaxlength=null},_bindEvent:function(){this._$elContainer.on("click.ScheduleLayer",this._onClickLayer.bind(this));this._$elDatepicker=$("#ui-datepicker-div");this._$elDatepicker.on("click.ScheduleLayer",function(a){a.stopPropagation()});this._$elStartDate.next("button").on("click",this._toggleDatepicker.bind(this,this._$elStartDate));this._$elEndDate.next("button").on("click",this._toggleDatepicker.bind(this,this._$elEndDate));this._$elContainer.find(".date_end").on("change","select",this._onChangeEndHM.bind(this));this._$elBtnEndDate.on("click",this._onClickBtnEndDate.bind(this));this._$elAllDayLabel.on("click",this._onClickAllDay.bind(this));this._$elPlace.on("click",this._onClickPlace.bind(this));this._$elClearPlaceBtn.on("click",this._onClickClearPlaceBtn.bind(this));this._$elTabs.on("click",this._onClickTab.bind(this));this._$elMonths.on("click",this._onClickMonth.bind(this));this._$elYearBtnWrapper.on("click","button",this._onClickYearBtn.bind(this));this._$elLink.on("keydown",this._onKeydownLink.bind(this));this._$elCloseBtn.on("click",this._onClickCloseBtn.bind(this))},_onKeydownLink:function(a){if(a.keyCode==13){a.preventDefault()}},_toggleDatepicker:function(a){if(a.datepicker("widget").is(":visible")){a.datepicker("hide")}else{a.datepicker("show")}},_onClickLayer:function(a){},_onChangeEndHM:function(){if(!this._$elEndDate.datepicker("getDate")){var a=this._$elEndDate.attr("placeholder");var b=this.CONST.FORMAT.MOMENT.FOR_DISPLAY;this._$elEndDate.datepicker("setDate",moment(a,b).format(b));this._onSelectEndDate()}},_onClickBtnEndDate:function(a){var b;if(this._$elDateWrapper.hasClass(this.CONST.CLASS.UI_EXTEND)){b="scd*a.delend";this._hideEndDateTimeWrapper()}else{b="scd*a.addend";this._showEndDateTimeWrapper()}clickcr(a.currentTarget,b,"","",a)},_showEndDateTimeWrapper:function(){this._$elDateWrapper.addClass(this.CONST.CLASS.UI_EXTEND);this._updateEndDateTimeWrapperOnShow()},_hideEndDateTimeWrapper:function(){this._$elDateWrapper.removeClass(this.CONST.CLASS.UI_EXTEND);this._updateEndDateTimeWrapperOnHide()},_updateEndDateTimeWrapperOnShow:function(){this._adjustEndDatePlaceholder();this._$elBtnEndDate.attr("title","종료일 제거하기 버튼");this._$elBtnEndDate.find(".blind").text("제거하기");this._autoPlusEndDateTimeInfo()},_autoPlusEndDateTimeInfo:function(){var a=this._getStartDateTimeFromDatepicker();var b=this._getMomentFromDatepickerFormatted(a);var c=b.add(1,"h");var d=this.CONST.FORMAT.MOMENT.FOR_DISPLAY;this._$elEndDate.datepicker("setDate",c.format(d));this._$elEndHour.val(""+c.hour());this._$elEndMinute.val(this._$elStartMinute.val())},_updateEndDateTimeWrapperOnHide:function(){this._$elBtnEndDate.attr("title","종료일 추가하기 버튼");this._$elBtnEndDate.find(".blind").text("추가하기");this._$elEndDate.val("");this._$elEndHour.val("0");this._$elEndMinute.val("00");this._$elStartDate.datepicker("option","maxDate",null)},_getHourFromMoment:function(a){return parseInt(a.format("H"),10)},_getMinuteFromMoment:function(a){return a.format("mm")},_adjustEndDatePlaceholder:function(){var a=this._$elEndDate.attr("placeholder");var b=moment(a,this.CONST.FORMAT.MOMENT.FROM_PLACEHOLDER).startOf("day");var c=this._$elStartDate.datepicker("getDate");var d=moment(c).startOf("day");if(b.diff(d)<0){this._$elEndDate.attr("placeholder",d.format(this.CONST.FORMAT.MOMENT.FOR_DISPLAY))}},_onClickPlace:function(a){clickcr(a.currentTarget,"scd*a.addmap","","",a);$SE_MEDIA.open($SE_CONFIG.COMP_INSERT_ITEM_TYPE.MAP,function(a){if(this._$elPlace){var b=JSON.parse(decodeURIComponent(a));this._setLocation(b)}}.bind(this),{layout:"default"})},_setLocation:function(a){var b=a&&a.title?a.title:null;this._oCompData.locationMap=a;this._$elPlace.val(b);this._toggleClearPlaceBtn()},_onClickClearPlaceBtn:function(a){clickcr(a.currentTarget,"scd*a.delmap","","",a);this._setLocation()},_toastMaxLength:function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,a)},_toggleClearPlaceBtn:function(){this._$elClearPlaceBtn.toggleClass(this.CONST.CLASS.UI_ON,!!this._oCompData.locationMap)},_onClickTab:function(a){var b=a.target;var c=$(b);var d=this.CONST.CLASS.UI_ACTIVE;if(c.hasClass(d)){return}this._$elTabs.removeClass(d).attr("aria-selected","false");this._$elPanels.addClass("hidden").attr("aria-hidden","true");var e=c.attr("id");var f;if(e==="schedule_tab2"){f="scd.list";this._setCurrentYear(moment().year())}else{f="scd.add"}clickcr(b,f,"","",a);c.addClass(d).attr("aria-selected","true");this._$elPanels.filter("[aria-labelledby='"+e+"']").removeClass("hidden").attr("aria-hidden","false");this._$elApplyBtnWrapper.toggleClass(this.CONST.CLASS.UI_HIDDEN)},_requestScheduleExistMonthsByYear:function(a){this._showLoadingLayerOnListTab();$SE_AJAX.request($SE_CONFIG.API.SCHEDULE_EXIST_MONTHS_BY_YEAR,{type:"GET",timeout:5e3,data:{serviceId:this.ENV.SERVICE_NAME,userId:this.ENV.USER_ID,year:a}},{fSuccess:this._onSuccessRequestScheduleExistMonthsByYear.bind(this)})},_onSuccessRequestScheduleExistMonthsByYear:function(a){var b=a.result;this._toggleScheduleExistMonths(b);if(b&&b.length>0){this._selectMonth(this._getAutoSelectedMonth(b))}else{this._showEmptySchedule();this._hideLoadingLayerOnListTab()}},_getAutoSelectedMonth:function(a){var b;var c=this._getSelectedMonthElem();if(c&&c.get(0)){b=this._getSelectedMonthFromElem(c)}else{b=this._getPresentMonthIndex()+1}if(a.indexOf(b)===-1){b=a[0]}return b},_getPresentMonthIndex:function(){return moment().month()},_getSelectedMonthElem:function(){return this._$elContainer.find(".lst_month > li."+this.CONST.CLASS.UI_ACTIVE)},_getSelectedMonthFromElem:function(a){return parseInt(a.data("month"),10)},_toggleScheduleExistMonths:function(a){var b=this.CONST.CLASS.UI_SCHEDULE_EXIST;var c=12;var d;var e;for(;c--;){d=$(this._$elMonths.get(c));e=this._getSelectedMonthFromElem(d);if(a.indexOf(e)>-1){d.addClass(b)}else{d.removeClass(b)}}},_onClickMonth:function(a){var b=a.currentTarget;var c=$(b);if(!c.hasClass(this.CONST.CLASS.UI_SCHEDULE_EXIST)){return}clickcr(b,"scd*l.month","","",a);var d=parseInt(c.data("month"),10);this._selectMonth(d)},_selectMonth:function(a){var b=this.CONST.CLASS.UI_ACTIVE;var c=$(this._$elMonths.get(a-1));var d;if(!c.hasClass(b)){d=this._getSelectedMonthElem();c.addClass(b)}if(d&&d.get(0)){d.removeClass(b)}this._requestScheduleList(a)},_onClickYearBtn:function(a){var b=a.currentTarget;var c=$(b);var d;var e=this._getCurrentYear();var f;if(c.hasClass("btn_before")){f="scd*l.prev";d=e-1}else if(c.hasClass("btn_next")){f="scd*l.next";d=e+1}clickcr(b,f,"","",a);if(typeof d==="number"){this._setCurrentYear(d)}},_onClickCloseBtn:function(a){clickcr(a.currentTarget,"scd.cancel","","",a)},_requestScheduleList:function(a){this._setMonthChangeOnLoadingLayerOnListTab();this._showLoadingLayerOnListTab();var b=moment();b.year(this._getCurrentYear()).month(a-1).hour(0).minute(0).second(0).date(1);var c=b.format();b.month(a).subtract(1,"second");var d=b.format();$SE_AJAX.request($SE_CONFIG.API.SCHEDULE_LIST,{type:"GET",timeout:5e3,data:{serviceId:this.ENV.SERVICE_NAME,userId:this.ENV.USER_ID,rangeDateFrom:c,rangeDateUntil:d}},{fSuccess:this._onSuccessRequestScheduleList.bind(this)})},_onSuccessRequestScheduleList:function(a){var b=a.result;if(b.length>0){this._drawScheduleList(b);this._showScheduleListWrapper()}else{this._showEmptySchedule()}this._hideLoadingLayerOnListTab();this._unsetMonthChangeOnLoadingLayerOnListTab()},_drawScheduleList:function(a){var b=this._refineDataForScheduleListTpl(a);var c=this._fScheduleListTpl({schedules:b});this._$elScheduleList.off(".nclick",".btn_goto");this._$elScheduleList.html(c);this._$elScheduleList.on("click.nclick",".btn_goto",function(a){clickcr(a.currentTarget,"scd*l.doc","","",a)});this._$elScheduleTotalCount.html(a.length)},_refineDataForScheduleListTpl:function(a){var b=a.length;var c;var d;var e=this.ENV.SERVICE_HOME;for(;b--;){c=a[b];d=$SE_TIME_UTIL.getFormattedDateTimeForSchedule(c.startDateTime,c.endDateTime,c.isAllDay);c.docLink=e+c.docLinkPath;a[b]=_.extend(c,d)}return a},_setCurrentYear:function(a){this._$elCurrentYear.html(a);this._requestScheduleExistMonthsByYear(a)},_getCurrentYear:function(){return parseInt(this._$elCurrentYear.html(),10)},_unbindEvent:function(){this._$elContainer.off(".ScheduleLayer");this._$elDatepicker.off(".ScheduleLayer");this._$elStartDate.next("button").off();this._$elEndDate.next("button").off();this._$elBtnEndDate.off();this._$elPlace.off();this._$elClearPlaceBtn.off();this._$elTabs.off();this._$elMonths.off();this._$elYearBtnWrapper.off()},_updateCompData:function(){this._setDateTimeFromDatepicker();this._oCompData.title=this._$elTitle.val();this._oCompData.startDateTime=this._getMomentFromDatepickerFormatted(this._sStartDateTime).format();this._oCompData.endDateTime=this._sEndDateTime?this._getMomentFromDatepickerFormatted(this._sEndDateTime).format():null;this._oCompData.link=this._getFormattedUrl();this._oCompData.description=this._$elDesc.val()},_getFormattedUrl:function(){var a=$SE_STRING.formatUrl(this._$elLink.val());return $SE_STRING.escapeFormattedUrl(a)},_getMomentFromDatepickerFormatted:function(a){return moment(a,this.CONST.FORMAT.MOMENT.FROM_DATEPICKER)},activate:function(a){this._htPayLoad=a;if(typeof a.compData==="object"){this._oCompData=a.compData}else{this._oCompData=$SE_MODEL_DATA_COORD.getDefaultCompData($SE_CONFIG.COMP_TYPE.SCHEDULE)}this._modalShow();this._assignElements();this._activateMaxlength();this._$elTitle.trigger("focus");this._toggleClearPlaceBtn();this._attachModules();this._bindEvent();this._updateCompData();this.initialCompData=JSON.parse(JSON.stringify(this._oCompData))},_attachModules:function(){var a=this.CONST.FORMAT.DATEPICKER.FOR_DISPLAY;$SE_COMMON_UTIL.createDatepicker(this._$elStartDate,{minDate:null,dateFormat:a,onSelect:this._onSelectStartDate.bind(this)});$SE_COMMON_UTIL.createDatepicker(this._$elEndDate,{minDate:this._$elStartDate.datepicker("getDate"),dateFormat:a,onSelect:this._onSelectEndDate.bind(this)})},_onSelectStartDate:function(a,b){var c=this._$elStartDate.datepicker("getDate");this._$elEndDate.datepicker("option","minDate",c);if(!this._$elEndDate.datepicker("getDate")){this._adjustEndDatePlaceholder()}this._updateStartDateTime()},_onSelectEndDate:function(a,b){var c=this._$elEndDate.datepicker("getDate");this._$elStartDate.datepicker("option","maxDate",c);this._updateEndDateTime()},_onClickAllDay:function(){this._oCompData.isAllDay=!this._oCompData.isAllDay;if(this._oCompData.isAllDay){this._$elAllDay.addClass("is-checked");this._$elDateWrapper.addClass("is-disabled");this._$elTimeInput.attr("disabled","disabled")}else{this._$elAllDay.removeClass("is-checked");this._$elDateWrapper.removeClass("is-disabled");this._$elTimeInput.removeAttr("disabled")}},_detachModules:function(){this._$elStartDate.datepicker("hide");this._$elEndDate.datepicker("hide");this._$elStartDate.datepicker("destroy");this._$elEndDate.datepicker("destroy")},deactivate:function(){$SE_MEDIA.closeAll();this._unbindEvent();this._detachModules();this._deactivateMaxlength();for(var a in this){if(a.indexOf("_$el")===0){this[a]=null}}},_getTplData:function(){var a=this._oCompData;var b={title:a.title,link:a.link,description:a.description,isAllDay:a.isAllDay,place:a.locationMap?a.locationMap.title:""};this._setDateTimeForTplData(b);return b},_setDateTimeForTplData:function(a){var b=this.CONST.FORMAT.MOMENT.FOR_DISPLAY;moment.locale($SE_CONFIG.LOCALE.KO,{weekdaysShort:"일.월.화.수.목.금.토".split(".")});var c=this._oCompData;var d=moment().startOf("day");a.today=d.format(b);this._setStartDateTimeOnTplData(a,c.startDateTime);this._setEndDateTimeOnTplData(a,c.endDateTime);a.months=_.range(1,13)},_getMomentForTplData:function(a){return a?moment(a):this._getCurrentMomentForDateTimeOnTplData()},_setStartDateTimeOnTplData:function(a,b){var c=this.CONST.FORMAT.MOMENT.FOR_DISPLAY;var d=this._getMomentForTplData(b);a.startDate=d.format(c);a.startHour=this._getHourFromMoment(d);a.startHours=_.range(0,24);a.startMinute=this._getMinuteFromMoment(d);a.startMinutes=$SE_STRING.getDigitFilledArithmeticProgression(0,60,5)},_setEndDateTimeOnTplData:function(a,b){var c=this.CONST.FORMAT.MOMENT.FOR_DISPLAY;var d;if(b){d=this._getMomentForTplData(b);a.endDate=d.format(c);a.endHour=this._getHourFromMoment(d);a.endMinute=this._getMinuteFromMoment(d)}a.endHours=_.range(0,24);a.endMinutes=$SE_STRING.getDigitFilledArithmeticProgression(0,60,5)},_getCurrentMomentForDateTimeOnTplData:function(){var a=moment();a.minute(Math.ceil(a.minute()/5)*5);return a},_modalShow:function(){this._$elContainer=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:this._fPopupTpl(this._getTplData()),buttons:[{text:"확인","class":"type1",click:this._onApply.bind(this)}],"class":"pop_schedule_wrap",beforeClose:this._onClose.bind(this),onClickDimmed:this._onClickDimmed.bind(this)});$SE_MODAL.open()},_onClickDimmed:function(){this._updateCompData();if(!this._isChanged()){$SE_MODAL.close()}},_isChanged:function(){return!$SE_COMMON_UTIL.isDeepEqual(this._oCompData,this.initialCompData)},_validate:function(){var a=!!this._$elTitle.val().trim()&&!!this._$elStartDate.val();if(a===false){this._showRequiredMsg();return false}if(!this._oCompData.isAllDay&&!this._validateDateTime()){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,se.i18n.getMsg("MSG_ENDDATETIME_INVALID"));return false}return true},_setDateTimeFromDatepicker:function(){this._updateStartDateTime();this._updateEndDateTime()},_updateStartDateTime:function(){this._sStartDateTime=this._getStartDateTimeFromDatepicker()},_updateEndDateTime:function(){this._sEndDateTime=this._getEndDateTimeFromDatepicker()},_getStartDateTimeFromDatepicker:function(){return $.datepicker.formatDate(this.CONST.FORMAT.DATEPICKER.FOR_MOMENT,this._$elStartDate.datepicker("getDate"))+" "+this._$elStartHour.val()+":"+this._$elStartMinute.val()},_getEndDateTimeFromDatepicker:function(){var a=this._$elEndDate.datepicker("getDate");return a?$.datepicker.formatDate(this.CONST.FORMAT.DATEPICKER.FOR_MOMENT,a)+" "+this._$elEndHour.val()+":"+this._$elEndMinute.val():null},_validateDateTime:function(){var a=!this._sEndDateTime;if(this._sEndDateTime){var b=this._getMomentFromDatepickerFormatted(this._sEndDateTime).diff(this._getMomentFromDatepickerFormatted(this._sStartDateTime));a=b>0}return a},_setMonthChangeOnLoadingLayerOnListTab:function(){this._$elLoadingLayerOnListTab.addClass(this.CONST.CLASS.UI_MONTH_CHANGE)},_unsetMonthChangeOnLoadingLayerOnListTab:function(){this._$elLoadingLayerOnListTab.removeClass(this.CONST.CLASS.UI_MONTH_CHANGE)},_showLoadingLayerOnListTab:function(){this._$elLoadingLayerOnListTab.addClass(this.CONST.CLASS.UI_ON)},_hideLoadingLayerOnListTab:function(){this._$elLoadingLayerOnListTab.removeClass(this.CONST.CLASS.UI_ON)},_showEmptySchedule:function(){var a=this.CONST.CLASS.UI_ON;this._$elScheduleListWrapper.removeClass(a);this._$elEmptySchedule.addClass(a);this._getSelectedMonthElem().removeClass(this.CONST.CLASS.UI_ACTIVE)},_showScheduleListWrapper:function(){var a=this.CONST.CLASS.UI_ON;this._$elEmptySchedule.removeClass(a);this._$elScheduleListWrapper.addClass(a)},_showRequiredMsg:function(){var a=this.CONST.CLASS.UI_ON;this._$elRequiredMsg.addClass(a);if(this._nRequiredMsgTimeoutId){clearTimeout(this._nRequiredMsgTimeoutId)}this._nRequiredMsgTimeoutId=setTimeout(function(){if(this._$elRequiredMsg){this._$elRequiredMsg.removeClass(a)}}.bind(this),3e3)},_onApply:function(a){clickcr(a.currentTarget,"scd*a.ok","","",a);a.stopPropagation();this._updateCompData();if(!this._validate()){return}$SE_MODAL.close();this._htPayLoad.compData=$.extend(true,{},this._oCompData);if(this._htPayLoad.fCallback){this._htPayLoad.fCallback(this._htPayLoad)}else{this.trigger("onAddComponent",this._htPayLoad)}},_onClose:function(){this.deactivate()}});se.defineComponent("se.ConvertHtmlLayer",{construct:function(){this._initVar()},_initVar:function(){this._htPayload={};this._setTimeout=null},_assignElements:function(){this._$elContainer=this._createContainer();this._$inputArea=this._$elContainer.find(".__se_input_area");this._$applyBtn=this._$elContainer.find(".__se_apply");this._$emptyStr=this._$elContainer.find(".__se_empty_str");this._$emptyComp=this._$elContainer.find(".__se_empty_comp")},_createContainer:function(){var a=se.editor.template.common["modal-convert-html-layer-content.hbs"];var b=$SE_MODAL.create($SE_CONFIG.MODAL_TYPE.BASIC,{content:a,"class":"pop_convert_html_wrap",beforeClose:this.deactivate.bind(this)});return b},_bindEvent:function(){this._$applyBtn.on("click",this._onClickApplyBtn.bind(this))},_unbindEvent:function(){this._$applyBtn.off()},_onClickApplyBtn:function(a){var b=this._$inputArea.val();if($SE_STRING.isEmpty(b)){this._showEmptyStr();return}$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.START);this._requestConvert()},_showEmptyStr:function(){this._$emptyComp.removeClass("is-on");this._$emptyStr.addClass("is-on");this._hide(this._$emptyStr)},_hide:function(a){clearTimeout(this._setTimeout);this._setTimeout=setTimeout(function(){a.removeClass("is-on")},3e3)},_showEmptyComp:function(){this._$emptyStr.removeClass("is-on");this._$emptyComp.addClass("is-on");this._hide(this._$emptyComp)},_requestConvert:function(){var a={type:"POST",data:this._$inputArea.val(),timeout:9e3,async:true,contentType:"text/html; charset=utf-8"};var b=$.param({resultType:"components"});$SE_AJAX.request($SE_CONFIG.API.CONVERT_HTML+$SE_CONFIG.ENV_SETTING.SERVICE_NAME+"?"+b,a,{fSuccess:this._fConverterCallback.bind(this)})},_insertComponent:function(a){var b=$.extend(this._htPayload,{compData:a});$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.CANVAS_CONTROL.INSERT_COMPONENT,b)},activate:function(a){this._htPayload=a;this._assignElements();this._bindEvent();$SE_MODAL.open();this._$inputArea.focus()},_fConverterCallback:function(a){var b=_.without(a.components,null,undefined);$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.UPLOAD_STATUS_BAR.END);if(b.length<1){this._showEmptyComp();return}this._insertComponent(b);$SE_MEDIA.closeAll();$SE_MODAL.close()},deactivate:function(){this._unbindEvent();this._$elContainer=null}});se.defineController("se.SidePanelController",{construct:function(){this._initVar();this._createModule();this._bindModuleEvent();this._bindGatewayEvent();this._assignElements()},_initVar:function(){this._oCompPanel=null;this._oLibPanel=null;this._sCurrentPanel=null;this._oThemePanel=null;this._htPanelMap={};this._sLibIdCache=null;this._$elEditorContainer=$(".editor-container");this._sClassExtend="is-extend";this._bDisabled=false;this._bReadonly=false},_assignElements:function(){this._$imageSearchSubBtn=$(".__se_open_searchImageLayer_subBtn")},_createModule:function(){this._oCompPanel=new se.CompPanel;this._oLibPanel=new se.LibraryPanel;this._oThemePanel=new se.ThemePanel;this._oOglinkFetcher=new se.OglinkFetcher;this._htPanelMap.comp=this._oCompPanel;this._htPanelMap.lib=this._oLibPanel},activateMenu:function(){this._oCompPanel.activate();this._oLibPanel.activate();this._oThemePanel.activate();this._bindEvent()},_bindEvent:function(){$("#se_side_toggle_btn").on("click",this._onClickSideToggleBtn.bind(this))},_onClickSideToggleBtn:function(a){a.preventDefault();if(this._bDisabled||this._bReadonly){return false}if(this._isPanelHidden()){clickcr(this._$elEditorContainer[0],"sdb.open","","");this._showPanel()}else{clickcr(this._$elEditorContainer[0],"sdb.close","","");this._hidePanel()}return false},_bindModuleEvent:function(){this._oLibPanel.on("onInsertComponent",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT,a)}.bind(this));this._oLibPanel.on("onDragComponentToInsert",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.SHOW_INSERT_GUIDE_WITH_COORDINATE,a.left,a.top)}.bind(this));this._oLibPanel.on("onStopDragComponentToInsert",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE)}.bind(this));this._oLibPanel.on("onUpdateRepresentativeImage",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.UPDATE_REPRESENTATIVE_IMAGE,a.htReqData,a.isToSet)}.bind(this));this._oLibPanel.on("resetCurrentOffsetsCache",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_CURRENT_OFFSETS_CACHE)}.bind(this));this._oLibPanel.on("cacheCurrentOffsets",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CACHE_CURRENT_OFFSETS)}.bind(this));this._oCompPanel.on("resetCurrentOffsetsCache",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_CURRENT_OFFSETS_CACHE)}.bind(this));this._oCompPanel.on("cacheCurrentOffsets",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CACHE_CURRENT_OFFSETS)}.bind(this));this._oCompPanel.on("onPopupLayer",function(a){this._oOglinkFetcher.openPopupLayer(a)}.bind(this));this._oCompPanel.on("onInsertComponent",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT,a)}.bind(this));this._oCompPanel.on("onDragComponentToInsert",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.SHOW_INSERT_GUIDE_WITH_COORDINATE,a.left,a.top)}.bind(this));this._oCompPanel.on("onStopDragComponentToInsert",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE)}.bind(this));this._oCompPanel.on("onInsertComponentWithFileDialogue",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT_WITH_FILEDIALOGUE,a);
}.bind(this));this._oCompPanel.on("onInsertComponentListWithFileDialogue",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT_LIST_WITH_FILEDIALOGUE,a)}.bind(this));this._oCompPanel.on("onInsertComponentWithLayer",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT,a)}.bind(this));this._oOglinkFetcher.on("onInsertComponent",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.INSERT_COMPONENT,a)}.bind(this));this._oThemePanel.on("onChangeTheme",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.APPLY_THEME,a.sTheme)}.bind(this));this._$elEditorContainer.on("dragover drop",function(a){a.preventDefault()})},_bindGatewayEvent:function(){$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.ADD_LIBRARY_DATA,this.addLibraryData.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.REMOVE_LIBRARY_PANEL_DATA,this.removeLibraryData.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.CLEAR_LIBRARY_COMP_DATA,this.clearLibraryCompData.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.UPDATE_LIBRARY_MODEL,this.updateLibraryModel.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.ON_REMOVE_COMPONENT,this.onRemoveComponent.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_ATTACH,this.getAttach.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.SET_ATTACH,this.setAttach.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.ATTACH_LINK_FROM_PARAGRAPH,this.attachLinkFromParagraph.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.DISABLE_CHANGE_LIBRARY,function(){return this.disableChangeLibrary()}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.ENABLE_CHANGE_LIBRARY,function(){return this.enableChangeLibrary()}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.CLEAR_LIBRARY,this.clearLibrary.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_LIBRARY_MAP,function(){return this.getLibraryMap()}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.GET_LIBRARY_IDS,function(){return this.getLibraryIds()}.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CONTROL.OPEN_COMP_LAYER,this.openCompLayer.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.DISABLE_BUTTON,this._disableImageSearchSubBtn.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.ENABLE_BUTTON,this._enableImageSearchSubBtn.bind(this))},$ON_SIDE_ATTACH_UPDATE:function(a){this._oLibPanel.setAttachToLibrary(a,true)},_disableImageSearchSubBtn:function(){this._$imageSearchSubBtn.attr("disabled","disabled")},_enableImageSearchSubBtn:function(){this._$imageSearchSubBtn.removeAttr("disabled")},attachLinkFromParagraph:function(a){this._oOglinkFetcher.attachLinkFromParagraph(a)},addLibraryData:function(a,b){this._oLibPanel.addLibraryData(a,b)},removeLibraryData:function(a,b){this._oLibPanel.removeLibraryData(a,b)},updateLibraryModel:function(a){this._oLibPanel.updateLibraryModel(a)},clearLibraryCompData:function(){this._oLibPanel.clearLibraryCompData()},updateTheme:function(a){this._oThemePanel.selectTheme(a)},getLibraryMap:function(){return this._oLibPanel.getLibraryMap()},getLibraryIds:function(){return this._oLibPanel.getLibraryIds()},disableChangeLibrary:function(){this._oLibPanel.disableChangeLibrary()},enableChangeLibrary:function(){this._oLibPanel.enableChangeLibrary()},clearLibrary:function(){this._oLibPanel.clearLibrary()},onRemoveComponent:function(a){this._oLibPanel.onRemoveComponent(a)},getAttach:function(){return this._oLibPanel.getAttachFromLibrary()},setAttach:function(a){this._oLibPanel.setAttachToLibrary(a)},$ON_MSG_APP_READY:function(){},openCompLayer:function(a,b){this._oCompPanel.openCompLayer(a,b)},$ON_DISABLE_SIDE_PANEL:function(){this._disable()},$ON_ENABLE_SIDE_PANEL:function(){this._enable()},readonly:function(a){a=a===false?false:true;if(this._bReadonly===a){return}this._bReadonly=a},_disable:function(){if(!this._bDisabled){this._bDisabled=true;this._bPanelVisibleOnDisable=!this._isPanelHidden();this._hidePanel()}},_enable:function(){if(this._bDisabled){this._bDisabled=false;if(this._bPanelVisibleOnDisable){this._showPanel()}}},_isPanelHidden:function(){return this._$elEditorContainer.hasClass(this._sClassExtend)},_showPanel:function(){this._$elEditorContainer.removeClass(this._sClassExtend)},_hidePanel:function(){this._$elEditorContainer.addClass(this._sClassExtend)}});se.defineClass("se.MaterialLayerBookTap",se.MaterialLayerCommonTap,{construct:function(){this._sGuideType="Book";this._sIdName="bid";this._sNClick="pmt.sbook"},_IMP_insertMaterialComp:function(a){var b=a.bigThumbnail2||a.bigThumbnail||a.thumbnail||"";var c=this._loadThumbnail(a,b);c.always(this._makeMaterialCompInfo.bind(this))},_makeMaterialCompInfo:function(a,b){var c=this.getType(),d=a.publishDay;var e=$SE_STRING.restoreSpecialChar(a.title);var f={"@ctype":$SE_CONFIG.COMP_TYPE.MATERIAL,title:e,link:a.linkUrl,thumbnail:b,id:a.isbn,subId:a.bid,type:c.substr(0,1).toLowerCase()+c.substr(1),volNo:a.volNo||"",detailInfo:[{"@ctype":"item",label:"저자",labelName:"author",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(a.author.replace(/\|/gi,", ")).replace(/ 지음$/gi,"")}]},{"@ctype":"item",label:"출판",labelName:"publisher",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(a.publisher)}]},{"@ctype":"item",label:"발매",labelName:"publishDay",values:[{"@ctype":"value",value:this._modifyDate(d)}]}]};this.trigger("onAddComponent",{htData:f})},_IMP_convertItems:function(a){var b=$.extend(true,{},{aItems:a}).aItems;for(var c=0,d=b.length;c<d;c++){b[c]["author"]=b[c]["author"].replace(/\|/gi,", ").replace(/ 지음$/gi,"");b[c]["thumb"]=b[c]["bigThumbnail2"]||b[c]["bigThumbnail"]||b[c]["thumbnail"]}return b},_IMP_getIdName:function(){return this._sIdName}});se.defineClass("se.MaterialLayerMovieTap",se.MaterialLayerCommonTap,{construct:function(){this._sGuideType="Movie";this._sIdName="mcode";this._sNClick="pmt.smovie"},_IMP_insertMaterialComp:function(a){var b=a.imageUrls.poster&&a.imageUrls.poster.url?a.imageUrls.poster.url:"";var c=this._loadThumbnail(a,b);c.always(this._makeMaterialCompInfo.bind(this))},_makeMaterialCompInfo:function(a,b){var c=this.getType();var d=$SE_STRING.restoreSpecialChar(a.titles.korean);var e=a.mcode;var f={"@ctype":$SE_CONFIG.COMP_TYPE.MATERIAL,title:d,link:a.destinationUrl,thumbnail:b,id:a[this._sIdName],subId:"",type:c.substr(0,1).toLowerCase()+c.substr(1),detailInfo:[{"@ctype":"item",label:"감독",labelName:"directors",values:this._modifyPeopleInfo(a.directors.director)},{"@ctype":"item",label:"출연",labelName:"actors",values:this._modifyPeopleInfo(a.actors.actor)},{"@ctype":"item",label:"개봉",labelName:"makingYear",values:[{"@ctype":"value",value:a.nations&&a.nations.nation?a.makingYear+" "+$SE_STRING.toStringSamePropertiesOfArray(a.nations.nation,"name",", "):a.makingYear}]}]};this.trigger("onAddComponent",{htData:f})},_IMP_convertItems:function(a){var b,c,d=$.extend(true,{},{aItems:a}).aItems;for(var e=0,f=d.length;e<f;e++){b=[];if(d[e]["actors"]["actor"]){for(var g=0,h=d[e]["actors"]["actor"].length;g<h;g++){b.push(d[e]["actors"]["actor"][g].name)}d[e]["actors"]=b.join(", ")}else{d[e]["actors"]=""}c=[];if(d[e]["directors"]["director"]){for(var g=0,h=d[e]["directors"]["director"].length;g<h;g++){c.push(d[e]["directors"]["director"][g].name)}d[e]["directors"]=c.join(", ")}else{d[e]["directors"]=""}if(d[e]["imageUrls"]["poster"]&&d[e]["imageUrls"]["poster"]["url"]){d[e]["imageUrls"]=d[e]["imageUrls"]["poster"]["url"]}else{d[e]["imageUrls"]=""}d[e]["actors"]=$SE_STRING.restoreSpecialChar(d[e]["actors"]);d[e]["directors"]=$SE_STRING.restoreSpecialChar(d[e]["directors"]);d[e]["titles"]["korean"]=$SE_STRING.restoreSpecialChar(d[e]["titles"]["korean"])}return d},_IMP_getIdName:function(){return this._sIdName}});se.defineClass("se.MaterialLayerBroadcastingTap",se.MaterialLayerCommonTap,{construct:function(){this._sGuideType="Broadcasting";this._sIdName="os";this._sNClick="pmt.stv"},_IMP_insertMaterialComp:function(a){var b=a.image||"";var c=this._loadThumbnail(a,b);c.always(this._makeMaterialCompInfo.bind(this))},_makeMaterialCompInfo:function(a,b){var c="Broadcast";var d=$SE_STRING.restoreSpecialChar(a.title);var e=a.mcode;var f={"@ctype":$SE_CONFIG.COMP_TYPE.MATERIAL,title:d,link:a.url,thumbnail:b,id:a[this._sIdName],subId:"",type:c.substr(0,1).toLowerCase()+c.substr(1),detailInfo:[]};if(a.producer&&a.producer.length>0){f.detailInfo.push({"@ctype":"item",label:"연출",labelName:"directors",values:this._modifyPeopleInfo(a["producer"])})}f.detailInfo.push({"@ctype":"item",label:"출연",labelName:"actors",values:this._modifyPeopleInfo(a["guest"])});f.detailInfo.push({"@ctype":"item",label:"방송",labelName:"makingYear",values:[{"@ctype":"value",value:a.year+", "+a.channel}]});this.trigger("onAddComponent",{htData:f})},_IMP_convertItems:function(a){var b=$.extend(true,{},{aItems:a}).aItems;for(var c=0,d=b.length;c<d;c++){b[c]["guest"]=this._modifyArrayToString(b[c]["guest"],", ");b[c]["producer"]=this._modifyArrayToString(b[c]["producer"],", ")}return b},_IMP_getIdName:function(){return this._sIdName}});se.defineClass("se.MaterialLayerMusicTap",se.MaterialLayerCommonTap,{construct:function(){this._sGuideType="Music";this._sIdName="albumID";this._sNClick="pmt.smusic"},_IMP_insertMaterialComp:function(a){var b=a.albumImg||"";var c=this._loadThumbnail(a,b);c.always(this._makeMaterialCompInfo.bind(this))},_makeMaterialCompInfo:function(a,b){var c=this.getType(),d=a.release;var e=$SE_STRING.restoreSpecialChar(a.title);var f=a.albumID;var g={"@ctype":$SE_CONFIG.COMP_TYPE.MATERIAL,title:e,link:a.albumUrl,thumbnail:b,id:a[this._sIdName],subId:"",type:c.substr(0,1).toLowerCase()+c.substr(1),detailInfo:[{"@ctype":"item",label:"아티스트",labelName:"artist",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(a.artist.replace(/♩/gi,", "))}]},{"@ctype":"item",label:"발매일",labelName:"release",values:[{"@ctype":"value",value:this._modifyDate(d)}]}]};this.trigger("onAddComponent",{htData:g})},_IMP_convertItems:function(a){var b=$.extend(true,{},{aItems:a}).aItems;for(var c=0,d=b.length;c<d;c++){b[c]["artist"]=b[c]["artist"].replace(/♩/gi,", ");b[c]["artist"]=$SE_STRING.restoreSpecialChar(b[c]["artist"]);b[c]["title"]=$SE_STRING.restoreSpecialChar(b[c]["title"])}return b},_IMP_getIdName:function(){return this._sIdName}});se.defineClass("se.MaterialLayerShoppingTap",se.MaterialLayerCommonTap,{_GOODS_TYPE_MAPPING:[[null,1,10,7,4,1,1,1,1],[null,2,11,8,5,2,2,2,2],[null,3,12,9,6,3,3,3,3]],construct:function(){this._sGuideType="Shopping";this._sIdName="id";this._sNClick="pmt.sgoods";this._registerHandlebarsHelper()},_IMP_insertMaterialComp:function(a){var b=a.imageUrl||"";var c=this._loadThumbnail(a,b);c.always(this._makeMaterialCompInfo.bind(this))},_makeMaterialCompInfo:function(a,b){var c=this.getType();var d=$SE_STRING.restoreSpecialChar(a.productTitle);var e=a.id;var f={"@ctype":"material",title:d,link:a["mallProductUrl"]=a["mallProductUrl"]?a["mallProductUrl"]:a["type"]==1||a["type"]==4?$SE_CONFIG.ENV_SETTING.SHOPPING_SEARCH+"?nv_mid="+a["id"]+"&section=price":$SE_CONFIG.ENV_SETTING.SHOPPING_SEARCH+"?nv_mid="+a["id"],thumbnail:b,id:a[this._sIdName],subId:"",type:c.substr(0,1).toLowerCase()+c.substr(1),detailInfo:[{"@ctype":"item",label:"",labelName:"type",values:[{"@ctype":"value",value:a.type}]},{"@ctype":"item",label:"",labelName:"isNaverPay",values:[{"@ctype":"value",value:a.isNaverPay}]},{"@ctype":"item",label:"",labelName:"isMblNaverPay",values:[{"@ctype":"value",value:a.isMblNaverPay}]},{"@ctype":"item",label:"",labelName:"mallNameOrg",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(a.mallNameOrg)}]},{"@ctype":"item",label:"",labelName:"price",values:[{"@ctype":"value",value:$SE_STRING.formatWithComma(a.price)}]}]};this.trigger("onAddComponent",{htData:f})},_convertToGoodsType:function(a,b){var c=this._GOODS_TYPE_MAPPING[a];if(!c){return null}return c[b]},_IMP_convertItems:function(a){var b;for(var c=0,d=a.length;c<d;c++){b=a[c];b["type"]=this._convertToGoodsType(b.mpTp,b.prodTp);b["productTitle"]=$SE_STRING.restoreSpecialChar(b["productTitle"]);b["mallProductUrl"]=b["mallProductUrl"]?b["mallProductUrl"]:b["type"]==1||b["type"]==4?$SE_CONFIG.ENV_SETTING.SHOPPING_SEARCH+"?nv_mid="+b["id"]+"&section=price":$SE_CONFIG.ENV_SETTING.SHOPPING_SEARCH+"?nv_mid="+b["id"]}return a},_IMP_getIdName:function(){return this._sIdName},_registerHandlebarsHelper:function(){var a=this.getType();Handlebars.registerHelper("shopping_content_text",function(b,c,d,e){var f="";if(a!=="Shopping"){return}if(b==1||b==4){f='<a href="'+e+'" target="_blank" class="subjectMatter_info_text cost_compare" style="z-index: 9999999999999999999999999999">가격비교 보기</a>'}else if(c==1&&d){f='<span class="subjectMatter_info_text npay">'+d+'<i class="blind">N페이 사용가능</i></span>'}else if(d){f='<span class="subjectMatter_info_text">'+d+"</span>"}return f})}});se.defineClass("se.MaterialLayerNewsTap",se.MaterialLayerCommonTap,{construct:function(){this._sGuideType="News";this._sIdName="articleId";this._sNClick="pmt.snews"},_IMP_insertMaterialComp:function(a){$SE_AJAX.request($SE_CONFIG.API.SEARCH_NEWS,{type:"GET",timeout:2e3,data:{oid:a.officeId,aid:a.articleId},dataType:"json"},{fSuccess:this._onSucessToGetNesInfo.bind(this)})},_IMP_convertItems:function(a){var b=$.extend(true,{},{aItems:a}).aItems;for(var c=0,d=b.length;c<d;c++){if(parseInt(b[c].photoType,10)>0||parseInt(b[c].type,10)>0){b[c]["imageLink"]=b[c]["imageOriginLink"]||b[c]["image140Link"]||b[c]["image120Link"]}else{b[c]["imageLink"]=""}b[c]["officeName"]=$SE_STRING.restoreSpecialChar(b[c]["officeName"]);b[c]["title"]=$SE_STRING.restoreSpecialChar(b[c]["title"])}return b},_IMP_getIdName:function(){return this._sIdName},_onSucessToGetNesInfo:function(a,b,c){var d=this.getType(),e=a.result,f=e.items[0],g,h=null,i;if(f.images){g=f.images.image instanceof Array?f.images.image[0]:f.images.image;h={};h.src=g.url;h.width=g.width;h.height=g.height}i={"@ctype":"material",title:$SE_STRING.restoreSpecialChar(f.title),link:f.orgUrl,id:f[this._sIdName],subId:f["officeId"],type:d.substr(0,1).toLowerCase()+d.substr(1),detailInfo:[{"@ctype":"item",label:"",labelName:"subcontent",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(f.subcontent)}]},{"@ctype":"item",label:"출처",labelName:"officeHname",values:[{"@ctype":"value",value:$SE_STRING.restoreSpecialChar(f.officeHname)}]}]};if(h){i.thumbnail={"@ctype":"thumbnail",src:h.src,width:h.width,height:h.height}}this.trigger("onAddComponent",{htData:i})}});se.defineComponent("se.SearchImageLayer",{THUMB_CLICK_DELAY:300,SHOW_COMPLETED_POPUP_DELAY:1200,ENTER_DELAY_TIME:100,SCROLL_DELAY_TIME:500,PER_PAGE:20,FIRST_PAGE:1,GRID_CONFIG:{COUNT:20*10,THRESHOLD:200,PREPEND_SCROLL_OFFSET:200},PROVIDERS:{UNSPLASH:{displayName:"Unsplash",queryString:"U"},PIXABAY:{displayName:"Pixabay",queryString:"P"},OGQ:{displayName:"OGQ",queryString:"O"}},DEFAULT_SIZE:"all",CCL_GUIDE:{1101:"CC BY-NC-SA",1100:"CC BY-NC",1001:"CC BY-SA",1000:"CC BY"},construct:function(){this._initVar();this._renderLayer();this._externalImageUploader=new se.ExternalImageUploader({isFromImageSearch:true})},_initVar:function(){this._htInsertPointPayload={};this._imageDataMap={};this._$editorContainer=$(".editor-container");this._$searchLayer=$(".__se_searchImageLayer");this._template=se.editor.template.control["searchImageLayer.hbs"];this._providerOptionTemplate=se.editor.template.control["searchImageProviderList.hbs"];this._listTemplate=se.editor.template.control["searchImageResultList.hbs"];this._captionTemplate=se.i18n.getMsg("IMAGE_SEARCH_CAPTION_TEMPATE");this._isActivated=false;this._isAjaxRequestDone=false;this._searchMode=null;this._sizeOption=this.DEFAULT_SIZE;this._sourceOption=this._getDefaultSourceOption();this.page=this.FIRST_PAGE;this._keyword="";this._clickTimer=null;this._clickCount=0;this._hasMoreResult=false;this.CCL_GUIDE_TEXT={"CC BY":se.i18n.getMsg("MSG_CC_BY"),"CC BY-SA":se.i18n.getMsg("MSG_CC_BY_SA"),"CC BY-NC":se.i18n.getMsg("MSG_CC_BY_NC"),"CC BY-NC-SA":se.i18n.getMsg("MSG_CC_BY_NC_SA"),cc0:se.i18n.getMsg("MSG_CC0"),"public":se.i18n.getMsg("MSG_PUBLIC")};this.CCL_GUIDE_LINK={"CC BY":se.i18n.getMsg("LINK_CCL_CC_BY"),"CC BY-SA":se.i18n.getMsg("LINK_CCL_CC_BY_SA"),"CC BY-NC":se.i18n.getMsg("LINK_CCL_CC_BY_NC"),"CC BY-NC-SA":se.i18n.getMsg("LINK_CCL_CC_BY_NC_SA"),cc0:se.i18n.getMsg("LINK_CCL_CC0"),"public":se.i18n.getMsg("LINK_CCL_PUBLIC")};this.DND_TOOLTIP_CONFIG={type:"left",pointerType:"right",top:0,left:0,message:se.i18n.getMsg("MSG_IMAGE_SEARCH_DND_TOOLTIP"),autoClose:true}},_assignElements:function(){this._$initialPage=this._$searchLayer.find(".__se_initPage");this._$searchButton=this._$searchLayer.find(".__se_search_image_btn");this._$searchInput=this._$searchLayer.find(".__se_search_image_input_keyword");this._$sortingBar=this._$searchLayer.find(".__se_sorting_searched_image");this._$sizeSortingLayer=this._$searchLayer.find(".__se_size_sorting_layer");this._$sourceSortingBtn=this._$searchLayer.find(".__se_source_sorting_btn");this._$sourceSortingLayer=this._$searchLayer.find(".__se_source_sorting_layer");this._$searchResultListWrapper=this._$searchLayer.find(".__se_searchedImageList");this._$scrollTarget=this._$searchLayer.find(".__se_ig_scrollTarget");this._$detailLayer=$(".__se_searchImageDetailLayer");this._$imageOnDetailLayer=this._$detailLayer.find(".__se_searchedImage_thumb");this._$loadingIconOnDetail=this._$detailLayer.find(".__se_imageLoading_detail");this._$detailContent=this._$detailLayer.find(".__se_searchImageDetailContent");this._$noResultPopup=this._$searchLayer.find(".__se_searchImage_noResult");this._$loadingIcon=null;this._$loadingForFirst=this._$searchLayer.find(".__se_imageLoading");this._$loadingMore=this._$searchLayer.find(".__se_imageLoading_more");this._$completedPopup=this._$editorContainer.find(".__se_completedInsertingImage_pop")},_bindEvents:function(){this._$searchLayer.on("click",".__se_close_searchImageLayer",this.deactivate.bind(this));this._$searchLayer.on("click",".__se_search_image_btn",this._onClickSearchBtn.bind(this));this._$searchLayer.on("keyup",".__se_search_image_input_keyword",_.debounce(this._onEnterSearch.bind(this),this.ENTER_DELAY_TIME));this._$searchLayer.on("focus",".__se_search_image_input_keyword",this._onFocusSearchInput.bind(this));this._$searchLayer.on("blur",".__se_search_image_input_keyword",this._onBlurSearchInput.bind(this));this._$searchLayer.on("click",".__se_sorting_btn",this._onClickSortingOptionBtn.bind(this));this._$searchLayer.on("click",".__se_sizeOption",this._onClickSizeSortingOptionValue.bind(this));this._$searchLayer.on("click",".__se_sourceOption",this._onClickSourceSortingOptionValue.bind(this));this._$searchResultListWrapper.on("click",".__se_insert_searchedImage_btn",this._onClickInsertBtn.bind(this));this._$searchResultListWrapper.on("click",".__se_searchedImage",this._onSingleClickThumb.bind(this));this._$searchResultListWrapper.on("dblclick",".__se_searchedImage",this._onDblClickThumb.bind(this));this._$detailLayer.on("click",".__se_insertDatailImage_btn",this._onClickInsertBtnOnDetailLayer.bind(this));this._$detailLayer.on("click",this._closeDetailLayer.bind(this));this._$detailLayer.on("click",".__se_searchedImage_detail",this._onClickDetailContent);this._$imageOnDetailLayer.on("load",this._onLoadedDetailImage.bind(this));this._$completedPopup.on("click",".__se_close_completedPop",this._closeCompletedPopup.bind(this));$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"click.exceptSearchOption",this._onClickExceptSearchOptionArea.bind(this));$SE_EVENT_HUB.on($SE_EVENT_HUB.MSG.CANVAS.IMAGE_SEARCH.CLOSE,this._deactivateFromOutSide.bind(this));this._$scrollTarget.on("scroll",_.throttle(this._changeOptionBarBorderStyle.bind(this),this.SCROLL_DELAY_TIME))},_unbindEvents:function(){this._$editorContainer.off("mouseup");this._$searchLayer.off();this._$searchResultListWrapper.off("click");this._$detailLayer.off();this._$imageOnDetailLayer.off("load");this._$completedPopup.off("click")},activate:function(a){if(!this._isActivated){this._htInsertPointPayload=a;this._assignElements();this._bindEvents();this._showLayer(this._$searchLayer);this._initDragNDrop();this._initInfiniteGrid();this._isActivated=true;clickcr(this._$searchLayer,"phs.open","","")}},deactivate:function(){this._unbindEvents();this._hideLayer(this._$searchLayer);this._resetLayerStatus();this._isActivated=false},_deactivateFromOutSide:function(){if(this._isActivated){this.deactivate()}},_resetLayerStatus:function(){var a=this._$sizeSortingLayer.find("[data-size='"+this.DEFAULT_SIZE+"']");this._setSizeOption(this.DEFAULT_SIZE);this._updateOptionUI(this._$sizeSortingLayer,a);this._resetSourceOptionLayer();this._$searchInput.val("");this._$searchInput.attr("placeholder",se.i18n.getMsg("MSG_IMAGE_SEARCH_PLACEHOLDER"));this._hideLayer(this._$noResultPopup);this._infiniteGrid.clear();this._infiniteGrid.destroy();this._imageDataMap={};this._showLayer(this._$initialPage)},_resetSourceOptionLayer:function(){var a=this._$sourceSortingLayer.find("input");$.each(a,function(a,b){if(!$(b).hasClass("is-checked")){this._check($(b))}}.bind(this))},_getProvidersOptionData:function(a){var b=Object.keys(a);var c=b.map(function(b){var c=a[b];return{providerQueryString:c.queryString,providerDisplayName:c.displayName,providerNclick:c.displayName.toLowerCase()}});return c},_getDefaultSourceOption:function(){var a=this.PROVIDERS;return Object.keys(a).map(function(b){return a[b].queryString}).join("")},_renderLayer:function(){var a=this._getProvidersOptionData(this.PROVIDERS);var b=this._providerOptionTemplate({providers:a});this._$searchLayer.append(this._template);this._$searchLayer.find(".__se_source_sorting_layer ul").append(b)},_initDragNDrop:function(){this._oDragHandler=new se.ItemDnD(this._$searchResultListWrapper,{sDragItemClass:".__se_searchedImage",oDragAreaOffset:{right:this._$searchLayer.width()},fCallback:this._dropComp.bind(this)});this._oDragHandler.on("onDragCanvasComponent",function(a){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.SHOW_INSERT_GUIDE_WITH_COORDINATE,a.left,a.top)}.bind(this));this._oDragHandler.on("onStopDragComponent",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CANVAS.RESET_INSERT_GUIDE)}.bind(this));this._oDragHandler.on("resetCurrentOffsetsCache",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.RESET_CURRENT_OFFSETS_CACHE)}.bind(this));this._oDragHandler.on("cacheCurrentOffsets",function(){$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.COMMAND.COMPONENT_LIST.CACHE_CURRENT_OFFSETS)}.bind(this))},_dropComp:function(a){var b=a.data("id");var c=this._findImageById(b);this._uploadImageToInsert(c);clickcr(a,"sdb*l.drag","","");clickcr(a,"phs.draginsert","","")},_changeOptionBarBorderStyle:function(){var a=this._$scrollTarget.scrollTop();var b="is-scrollable";if(a===0){this._$sortingBar.removeClass(b)}else{this._$sortingBar.addClass(b)}},_showLayer:function(a){if(!a.hasClass("is-on")){a.addClass("is-on")}},_hideLayer:function(a){if(a.hasClass("is-on")){a.removeClass("is-on")}},_onFocusSearchInput:function(){this._$searchInput.attr("placeholder","")},_onBlurSearchInput:function(){if(!this._isSearchKeywordExists()){this._$searchInput.attr("placeholder",se.i18n.getMsg("MSG_IMAGE_SEARCH_PLACEHOLDER"))}},_openSortingLayer:function(a){a.addClass("is-selected")},_closeSortingLayer:function(a){if(a.hasClass("is-selected")){a.removeClass("is-selected")}},_onClickSortingOptionBtn:function(a){var b=a.currentTarget;clickcr(b,$(b).data("nclick"),"","",a);var c=$(b).closest(".__se_sorting_layer");c.hasClass("is-selected")?this._closeSortingLayer(c):this._openSortingLayer(c)},_updateOptionUI:function(a,b){var c=a.find(".is-selected");c.removeClass("is-selected");b.addClass("is-selected")},_onClickSizeSortingOptionValue:function(a){var b=a.currentTarget;clickcr(b,"phs*s."+$(b).data("nclick"),"","",a);this._setSizeOption($(b).data("size"));this._updateOptionUI(this._$sizeSortingLayer,$(b));this._closeSortingLayer(this._$sizeSortingLayer);this._requestImageSearch()},_setSizeOption:function(a){this._sizeOption=a},_getSizeOption:function(){return this._sizeOption},_onClickSourceSortingOptionValue:function(a){var b=$(a.currentTarget).siblings("input");clickcr(a.currentTarget,"phs*p."+b.data("nclick"),"","",a);if(b.hasClass("is-checked")){this._validatedUncheck(b)}else{this._check(b)}this._requestImageSearch()},_validatedUncheck:function(a){var b=this._$sourceSortingLayer.find("input.is-checked").length;this._uncheck(a);if(b===1){sErrorMsg=se.i18n.getMsg("MSG_ERROR_PROVIDER_MIN_COUNT");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.POPUP_TOAST,sErrorMsg);this._check(a)}},_check:function(a){a.prop("checked",true);a.addClass("is-checked");this._setSourceOption(this._sourceOption+a.data("provider"))},_uncheck:function(a){a.prop("checked",false);a.removeClass("is-checked");this._setSourceOption(this._sourceOption.replace(a.data("provider"),""))},_setSourceOption:function(a){this._sourceOption=a},_getSourceOption:function(){return this._sourceOption},_onClickSearchBtn:function(){clickcr(this._$searchButton,"phs.search","","");this._requestImageSearch()},_requestImageSearch:function(){if(!this._isSearchKeywordExists()){return}this._infiniteGrid.clear();this._showLoadingBeforeAjaxDone();this.page=this.FIRST_PAGE;this._keyword=this._$searchInput.val();this._searchByKeyword().done(this._searchImageDoneCallback.bind(this))},_showLoadingBeforeAjaxDone:function(){this._hideLayer(this._$initialPage);this._hideLayer(this._$noResultPopup);this._showLayer(this._$loadingForFirst)},_isSearchKeywordExists:function(){var a=false;if(this._$searchInput.val()!==""){a=true}return a},_searchByKeyword:function(){var a=this._keyword;var b=this._getSourceOption();var c=this._getSizeOption();var d={page:this.page,providers:b,size_type:c,query:a};return this._getImageListByKeyword(d)},_searchImageDoneCallback:function(a){this._infiniteGrid.clear();this._hideLayer(this._$loadingForFirst);if(this._hasNoResult(a.result)){this._showLayer(this._$noResultPopup);return}this._hideLayer(this._$noResultPopup);this._appendSearchedImages(a)},_showToolTip:function(a){if(!this._isToolTipNecessary(a)){return}localStorage.setItem("SE3_IMAGE_SEARCH_DID_SEARCH","T");var b=this._$searchResultListWrapper.find(".__se_searchedImage")[0];this._dndTooltip=$(b).ntooltip(this.DND_TOOLTIP_CONFIG);this._dndTooltip.ntooltip("openTooltip")},_isToolTipNecessary:function(a){var b=a.target.length>0?true:false;var c=$SE_CONFIG.SERVICE_CONFIG.USE_TOOLTIP;var d=localStorage.getItem("SE3_IMAGE_SEARCH_DID_SEARCH")===null?true:false;return c&&b&&d},_collectSearchedData:function(a){$.each(a,function(a,b){b.username=b.username===""?se.i18n.getMsg("MSG_IMAGE_SEARCH_AUTHOR_UNKNOWN"):b.username;this._imageDataMap[b.id]=b}.bind(this))},_findImageById:function(a){return this._imageDataMap[a]},_onEnterSearch:function(a){var b=13;if(a.which===b){clickcr(a.target,"phs.search","","",a);this._requestImageSearch()}},_onClickExceptSearchOptionArea:function(a){var b=a.target;if(this._$sizeSortingLayer.find(b).length<1){this._closeSortingLayer(this._$sizeSortingLayer)}if(this._$sourceSortingLayer.find(b).length<1){this._closeSortingLayer(this._$sourceSortingLayer)}if(!this._$searchInput.is(b)&&this._$searchInput.is(":focus")){this._$searchInput.blur()}},_onSingleClickThumb:function(a){a.preventDefault();a.stopPropagation();var b=a.currentTarget;var c=$(b).data("id");var d=this._findImageById(c);this._clickCount+=1;this._clickTimer=setTimeout(function(){if(this._clickCount!==1){this._clickCount=0;return}this._setDetailLayer(d);this._openDetailLayer();clickcr(b,"phs.openview","","",a);this._clickCount=0}.bind(this),this.THUMB_CLICK_DELAY)},_onDblClickThumb:function(a){var b=$(a.currentTarget).data("id");var c=this._findImageById(b);clearTimeout(this._clickTimer);this._clickCount=0;this._uploadImageToInsert(c)},_openDetailLayer:function(){this._$detailLayer.addClass("is-on");this._$loadingIconOnDetail.addClass("is-on");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.BIND_GLOBAL_EVENT_HANDLER,"keydown",this._onPressESC.bind(this))},_closeDetailLayer:function(a){this._$detailLayer.removeClass("is-on");this._$detailContent.removeClass("is-on");$SE_EVENT_HUB.trigger($SE_EVENT_HUB.MSG.CONTROL.UNBIND_GLOBAL_EVENT_HANDLER,"keydown");clickcr(a.currentTarget,"phs.closeview","","",a)},_onPressESC:function(a){var b=27;if(a.which===b){this._closeDetailLayer(a)}},_setDetailLayer:function(a){this._$detailLayer.find(".__se_searchedImage_detail").data("id",a.id);this._$detailLayer.find(".__se_searchedImage_thumb").prop("src",a.urls.img);this._$detailLayer.find(".__se_searchedImage_link").attr("href",a.urls.img);this._$detailLayer.find(".__se_searchedImage_username").text(se.i18n.getMsg("MSG_IMAGE_SEARCH_AUTHOR")+a.username);this._$detailLayer.find(".__se_searchedImage_username").attr("href",a.urls.link);this._$detailLayer.find(".__se_searchedImage_size").text(a.width+"x"+a.height);this._$detailLayer.find(".__se_searchedImage_provider").text(a.providerDisplayName);this._setLicenseDetail(a.rights)},_getCclCode:function(a){var b;if(a){b=this.CCL_GUIDE[""+a.by+a.nc+a.nd+a.sa]}else{b="CC0"}return b},_setLicenseDetail:function(a){this._$detailLayer.find(".__se_searchedImage_ccl a").text(this.CCL_GUIDE_TEXT[a]).attr("href",this.CCL_GUIDE_LINK[a])},_onLoadedDetailImage:function(){this._$loadingIconOnDetail.removeClass("is-on");this._$detailContent.addClass("is-on")},_onClickDetailContent:function(a){a.stopPropagation()},_initInfiniteGrid:function(){this._infiniteGrid=new eg.InfiniteGrid(".__se_searchedImageList",{view:this._$scrollTarget,count:this.GRID_CONFIG.COUNT,threshold:this.GRID_CONFIG.THRESHOLD,itemSelector:".__se_searchedImage"}).on({append:this._onAppendRequired.bind(this),prepend:this._onPrependRequired.bind(this),layoutComplete:this._onLayoutComplete.bind(this),imageError:this._onImageError.bind(this)})},_onAppendRequired:function(){if(this._isAjaxRequestDone){var a=this._infiniteGrid.getGroupKeys();var b=a[a.length-1];this.page=b+1;this._searchByKeyword().done(this._appendSearchedImages.bind(this));this._isAjaxRequestDone=false}},_appendSearchedImages:function(a){if(this._hasNoResult(a.result)){this.page=this.FIRST_PAGE;return}this._collectSearchedData(a.result);this._appendImage(a);this._showLoadingBeforeLayoutComplete.call(this);this._setAjaxDone(true);this._setHasMoreResult(a.hasMore);this._oDragHandler.attachDrag()},_setAjaxDone:function(a){this._isAjaxRequestDone=a},_setHasMoreResult:function(a){this._hasMoreResult=a},_appendImage:function(a){var b=this._renderSearchResultList(a);var c=this.page;this._infiniteGrid.append(b,c)},_hasNoResult:function(a){return a.length===0?true:false},_onPrependRequired:function(){if(this._isAjaxRequestDone&&this.page>this.FIRST_PAGE){var a=this._infiniteGrid.getGroupKeys()[0];this.page=a-1;this._searchByKeyword().done(this._prependSearchedImages.bind(this));this._isAjaxRequestDone=false}},_prependSearchedImages:function(a){var b=this._renderSearchResultList(a);var c=this.page;this._infiniteGrid.prepend(b,c);var d=this._$scrollTarget.scrollTop();this._$scrollTarget.scrollTop(d+this.GRID_CONFIG.PREPEND_SCROLL_OFFSET);this._isAjaxRequestDone=true;this._oDragHandler.attachDrag()},_onLayoutComplete:function(a){if(this._isAdditionalRequestNeeded(a)){this._infiniteGrid.trigger("append")}this._hideLoading();this._showToolTip(a)},_onImageError:function(a){$SE_LOGGER.report({logType:"API",logLevel:"WARN",title:"ImageSearch Error",body:"ImageSearch image not found error : "+a.src})},_isAdditionalRequestNeeded:function(a){var b=a.target.length===0?true:false;if(b){return}var c=$(this._infiniteGrid.getBottomElement()).position().top<this._$scrollTarget.height()?true:false;return c&&this._hasMoreResult},_refineSearchedResult:function(a){var b=[];for(var c=0;c<a.length;c++){b.push({src:a[c].urls.thumb,id:a[c].id,size:a[c].width+"x"+a[c].height,provider:a[c].providerDisplayName})}return b},_renderSearchResultList:function(a){var b=a.result;var c=this._refineSearchedResult(b);return this._listTemplate({
list:c})},_showLoadingBeforeLayoutComplete:function(){this._$loadingIcon=this.page===this.FIRST_PAGE?this._$loadingForFirst:this._$loadingMore;if(this._infiniteGrid.isProcessing()){this._$loadingIcon.addClass("is-on")}},_hideLoading:function(){this._hideLayer(this._$loadingMore);this._hideLayer(this._$loadingForFirst)},_getImageListByKeyword:function(a){var b="imgs/search/list.json";var c={per_page:this.PER_PAGE};c=$.extend(true,c,a);return $.ajax({url:b,data:c,cache:false,error:this._onImageRequestFail.bind(this)})},_onImageRequestFail:function(){this._setAjaxDone(true);this.deactivate();$SE_AJAX.showError()},_onClickInsertBtn:function(a){a.stopPropagation();this._closeCompletedPopup();var b=a.currentTarget;var c=$(b).closest(".__se_searchedImage").data("id");var d=this._findImageById(c);this._uploadImageToInsert(d);clickcr(b,"phs.btninsert","","",a)},_onClickInsertBtnOnDetailLayer:function(a){a.stopPropagation();var b=$(".__se_searchedImage_detail").data("id");var c=this._findImageById(b);this._uploadImageToInsert(c);this._closeDetailLayer(a);clickcr(a.currentTarget,"phs.viewinsert","","",a)},_uploadImageToInsert:function(a){var b=this._captionTemplate.replace("{{=id}}",a.username).replace("{{=provider}}",a.providerDisplayName);var c=encodeURIComponent(a.urls.img);var d=[c];var e=$.extend(true,this._htInsertPointPayload,{compData:$SE_CONFIG.COMP_TYPE.IMAGE,shouldFocus:true});this._externalImageUploader.option.caption=b;this._externalImageUploader.option.captionLink=a.urls.link;this._externalImageUploader.upload(d,e,this._onCompletedInsertImage.bind(this));if(a.providerDisplayName===this.PROVIDERS.UNSPLASH.displayName){this._triggerUnsplashDownload(a.urls.downloadCallback)}clickcr(a,"phs."+a.providerDisplayName.toLowerCase()+"insert","","")},_triggerUnsplashDownload:function(a){if(!a){return}$.ajax({url:$SE_CONFIG.API.IMAGE_SEARCH_UNSPLASH_DOWNLOAD,data:{url:a}})},_onCompletedInsertImage:function(a){var b=this._$completedPopup;var c=b.find(".__se_insertedImage_thumb");c.css("background-image","url("+a.src+")");b.addClass("is-on");setTimeout(function(){b.removeClass("is-on");c.css("background-image","")},this.SHOW_COMPLETED_POPUP_DELAY)},_closeCompletedPopup:function(){if(this._$completedPopup.hasClass("is-on")){this._$completedPopup.removeClass("is-on")}}});
//# sourceMappingURL=blog_desktop_normal_editor_control_side.min.js.map